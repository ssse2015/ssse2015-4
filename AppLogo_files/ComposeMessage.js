//>>built
require({cache:{"url:ws/mail/ComposeMessageWidget.html":'<div data-dojo-attach-event="onkeydown: onKeyPressInputField">\n\t<div data-dojo-type="dijit/layout/StackContainer" class="composeMessage" data-dojo-attach-point="stackWidget">\n\t\t<div data-dojo-type="dijit/layout/BorderContainer" data-dojo-attach-point="layoutWidget" id="composeLayout" class="composeLayout">\n\t\t\t<div data-dojo-type="ws/widget/WSToolbar" data-dojo-props="region:\'top\'" data-dojo-attach-point="toolbar" vizType="Controls">\n\t\t\t\t<\!-- the id on this button is for Oasis scripting --\>\n\t\t\t\t<div id="sendButton" data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick:sendMessage" data-dojo-attach-point="sendButton" tip="${ComposeSendButton}" iconClassName="sendIcon">${Button_Label_Send}</div>\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick:saveMessage" data-dojo-attach-point="saveDraftButton" title="${SaveDraftTip}" tip="${ComposeSaveAsDraftButton}" iconClassName="draftIcon">${Save}</div>\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick:spellCheck" data-dojo-attach-point="spellCheckButton" iconClassName="spellIcon">${ComposeSpellingButton}</div>\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick:deleteDraft" data-dojo-attach-point="deleteDraftButton" iconClassName="delIcon">${ComposeDeleteDraftButton}</div>\n\n                <div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick:cancel" data-dojo-attach-point="cancelButton" title="${Cancel}" iconClassName="cancelIcon" data-dojo-props="toolbarPosition: \'right\'"></div>\n                <div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick:onClickNewWindow" data-dojo-attach-point="newWindowLink" title="${NewWindowTip}" iconClassName="newWindowIcon" data-dojo-props="toolbarPosition: \'right\'">${NewWindow}</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div data-dojo-type="ws/widget/Pane" data-dojo-props="region:\'top\'" class="header" data-dojo-attach-point="headerWidget">\n                <div style="padding-right: 0;" class="field">\n                    <div style="display:none" data-dojo-attach-point="fromAddressEditBoxDiv">\n                        <div data-dojo-type="ws/widget/DefaultTextbox" data-dojo-attach-point="fromAddressEditBox" data-dojo-attach-event="onKeyPress:processEditBoxKeyPress, onBlur:saveFriendlyName" style="width:20%;float:left;padding:5px;" tabindex="99"></div>\n                    </div>\n                    <div>\n                        <a href="#" class="fnameA" data-dojo-attach-event="onclick:fromAddressEdit" data-dojo-attach-point="fromAddressSpan" >${friendlyFromName}</a>\n                        <div data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="fromSelect" size="byValue"></div>\n                    </div>\n                    <div class="emailEntryLinks">\n                        <span data-dojo-attach-event="onclick:showCc" class="bccLink" data-dojo-attach-point="showCcLink"\n                              title="${ShowCcTip}">${Cc}</span>&nbsp;\n                        <span data-dojo-attach-event="onclick:showBcc" class="ccLink" data-dojo-attach-point="showBccLink"\n                              title="${ShowBccTip}">${Bcc}</span>\n                    </div>\n\t\t\t\t\t<div class="feedback" data-dojo-attach-point="feedbackNode"><span class="feedbackSpin" data-dojo-attach-point="feedbackSpin" data-dojo-attach-point="feedbackSpin"></span><span class="feedbackMsg" data-dojo-attach-point="feedbackMsg"></span></div>\n                   <span class="newWindowLink" data-dojo-attach-event="onclick:onClickNewWindow" data-dojo-attach-point="newWindowLink" title="${NewWindowTip}"></span>\n               </div>\n                <div ghostText="${To}" class="toField" data-dojo-type="ws/address/ComposeAddressField" data-dojo-attach-point="toField"\n                     lineHeight="14" data-dojo-props="tabindex: 100"></div>\n                <div ghostText="${Cc}" class="ccField" data-dojo-type="ws/address/ComposeAddressField" data-dojo-attach-point="ccField"\n                     lineHeight="14" style="display:none" data-dojo-props="tabindex: 101"></div>\n                <div ghostText="${Bcc}" class="bccField" data-dojo-type="ws/address/ComposeAddressField" data-dojo-attach-point="bccField"\n                     lineHeight="14" style="display:none" data-dojo-props="tabindex: 102"></div>\n                <div class="subjectContainer field wsInput">\n                    <div class="subjectLabel">${Subject}:</div>\n                    <div style="overflow: hidden;"><input class="subject" type="text" name="Subject" id="subjectField" data-dojo-attach-point="subjectInput" tabindex="103" /></div>\n                </div>\n                <div data-dojo-attach-point="attachmentRow" style="display:none; position: relative;">\n                    <div class="attachmentContainer">\n                        <span data-dojo-attach-point="attachmentDisplay"></span>\n                    </div>\n                </div>\n\t\t\t</div>\n\t\t\t<div data-dojo-type="ws/pictures/PictureEditor" id="editor" data-dojo-props="region:\'center\'" data-dojo-attach-point="editor" showAttachFile="true" data-dojo-props="tabindex: 104"></div>\n\t\t</div>\n\t</div>\n    <input data-dojo-attach-point="focusInput" type="text" style="position:absolute;width:0;height:0;border:none;outline:none;padding: 0;margin: 0;" />\n</div>\n',
"url:ws/widget/WSEditorDocument.css":'html, body {padding: 0 0 0 0; margin: 0; border: none; background-color: transparent; font-family: Helvetica,Arial,sans-serif; font-size: 10pt;}body {padding: 15px 15px 15px 15px;}p {margin: 0; padding: 0;}a.spell {padding-bottom: 2px; background: yellow url("${affinityimages}bg_spellingErr.gif") bottom left repeat-x; color: #000; text-decoration: none; cursor: pointer;}a.spell:hover {color: #b00;}img.wsThumbnail {display: none;}img.wsPlaceholder {background: #F4F4F4 url("${baseimages}common/progressAnimation_lg.gif") center center no-repeat; border: 1px solid #DADAD6 !important;}.AOLPicturesFullSizeLink {height: 1px; width: 1px; overflow: hidden;}',
"ws/widget/SmileyPalette":function(){define("ws/widget/SmileyPalette",["dojo/_base/declare","dojo","dijit","dijit/_Widget","dijit/_TemplatedMixin"],function(q,n,j,a,d){return q([a,d],{templateString:"<div class='wsMenu' style='width:103px;height:89px;overflow:hidden;background: #fff url(${affinityimages}smileyPalette.png)!important;cursor:pointer;display:none' data-dojo-attach-event='onmousedown:onClick'></div>",imageNames:[["smile","wink","kiss","bigkiss"],["cry","frown","indecision","shame"],["grin",
"greed","shock","yell"],["cool","foot","halo","tongue"]],altTexts:[[":-)",";-)",":-*",":-X"],[":'(",":-(",":-\\",":-["],[":-D",":-$","=-O",">:O"],["8-)",":-!","O:-)",":-P"]],onClick:function(a){var d=n.position(this.domNode),k=Math.floor((a.pageY-d.y)/this.smileyHeight),m=Math.floor((a.pageX-d.x)/this.smileyWidth);3<k&&(k=3);3<m&&(m=3);d=this.altTexts[k][m];k=Config.SmileyImageURL+this.imageNames[k][m]+Config.SmileyImageExt;n.stopEvent(a);this.onSmileyClicked(d,k)},smileyHeight:25,smileyWidth:25,
onSmileyClicked:function(){}})})},"ws/widget/WSEditor":function(){require({cache:{"url:ws/widget/WSEditor.html":'<div style="height:100%;width:100%;">\n<div class="wsEditor" data-dojo-type="dijit/layout/BorderContainer" data-dojo-attach-point="layoutWidget">\n    <div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="toolbarPaneParent" data-dojo-props="region:\'top\'" class="toolbarContainer">\n        <div class="toolbar" data-dojo-attach-point="toolbarPane">\n            <\!-- we need to use &nbsp; as innerHTML for the anchor tags otherwise, IE8/7 will show the text overlayed on top of the icons. Using transparent css color\n            for the text does not work neither --\>\n            <a href="#" class="attachBtn" data-dojo-attach-point="attachButton" title="${ChooseFileTooltip}" data-dojo-attach-event="onClick: openAttachFileDialog"></a>\n            <\!-- Insert Pictures button is dynamically inserted here, by PictureEditor.js --\>\n            <a href="#" class="wsLink enableRTE" data-dojo-attach-point="richTextButton" title="${Basic_SwitchToRichEditor}" data-dojo-attach-event="onclick: enableRichText"><span class="wsLink">${Basic_SwitchToRichEditor}</span></a>\n            <a href="#" data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="fontPicker" disableMouseStates="true" title="${FontType}" data-dojo-props="\'class\': \'fontfamilyIcon\'" >&nbsp;</a>\n            <a href="#" data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="fontSizePicker" disableMouseStates="true" title="${FontSize}" data-dojo-props="\'class\': \'fontsizeIcon\'" >&nbsp;</a>\n            <a href="#" data-dojo-attach-point="boldItem" title="${Bold}" data-dojo-attach-event="onclick: boldClick" class="boldIcon">&nbsp;</a>\n            <a href="#" data-dojo-attach-point="italicItem" title="${Italic}" data-dojo-attach-event="onclick: italicClick" class="italicIcon">&nbsp;</a>\n            <a href="#" data-dojo-attach-point="underlineItem" title="${Underline}" data-dojo-attach-event="onclick: underlineClick" class="underlineIcon">&nbsp;</a>\n            <a href="#" data-dojo-attach-point="forecolorItem" title="${FontColor}" data-dojo-attach-event="onclick: fontColorClick" class="forecolorIcon" data-dojo-attach-point="forecolorButton">&nbsp;</a>\n            <a href="#" data-dojo-attach-point="hilitecolorItem" title="${BackgroundColor}" data-dojo-attach-event="onclick: backgroundColorClick" class="hilitecolorIcon">&nbsp;</a>\n            <a href="#" data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="justifyPicker" disableMouseStates="true" title="${Alignment}" data-dojo-props="\'class\': \'justifyIcon\'" >&nbsp;</a>\n            <a href="#" data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="listPicker" disableMouseStates="true" title="${Lists}" data-dojo-props="\'class\': \'insertListIcon\'" >&nbsp;</a>\n            <a href="#" data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="indentPicker" disableMouseStates="true" title="${Indentation}" data-dojo-props="\'class\': \'indentPickerIcon\'" >&nbsp;</a>\n            <a href="#" title="${HorizontalRule}" data-dojo-attach-event="onclick: horizontalRuleClick" class="insertHorizontalRuleIcon">&nbsp;</a>\n            <a href="#" title="${InsertSmiley}" data-dojo-attach-event="onclick: smileyClick" class="smileyIcon" data-dojo-attach-point="smileyButton">&nbsp;</a>\n            <a href="#" title="${InsertLink}" data-dojo-attach-event="onclick: linkClick" class="linkIcon" data-dojo-attach-point="linkButton">&nbsp;</a>\n            <\!-- Stationery button is dynamically inserted here, by WSEditor.js --\>\n            <a href="#" data-dojo-attach-point="htmlmodeItem" title="${ViewHTMLSource}" data-dojo-attach-event="onclick: htmlModeClick" class="htmlmodeIcon">&nbsp;</a>\n        </div>\n    </div>\n\t<div class="wsInput iframePane" data-dojo-type="ws/widget/Pane" data-dojo-props="region:\'center\'" data-dojo-attach-point="iframePane">\n\t\t<iframe border="none" frameBorder="0" data-dojo-attach-point="iframe" width="100%" height="100%" src="about:blank" tabindex="${tabindex}" name="${id}_body" allowtransparency="true" data-dojo-attach-event="onload: onIframeLoaded"></iframe>\n\t</div>\n\t<div class="wsInput textareaPane" data-dojo-type="ws/widget/Pane" data-dojo-props="region:\'center\'" data-dojo-attach-point="textareaPane" style="display: none; overflow: hidden;">\n\t\t<textarea class="wsInputBare" data-dojo-attach-point="textarea" tabindex="105"></textarea>\n\t</div>\n</div>\n</div>\n',
"url:ws/widget/WSEditor.css":"","url:ws/widget/WSEditorDocument.css":'html, body {padding: 0 0 0 0; margin: 0; border: none; background-color: transparent; font-family: Helvetica,Arial,sans-serif; font-size: 10pt;}body {padding: 15px 15px 15px 15px;}p {margin: 0; padding: 0;}a.spell {padding-bottom: 2px; background: yellow url("${affinityimages}bg_spellingErr.gif") bottom left repeat-x; color: #000; text-decoration: none; cursor: pointer;}a.spell:hover {color: #b00;}img.wsThumbnail {display: none;}img.wsPlaceholder {background: #F4F4F4 url("${baseimages}common/progressAnimation_lg.gif") center center no-repeat; border: 1px solid #DADAD6 !important;}.AOLPicturesFullSizeLink {height: 1px; width: 1px; overflow: hidden;}'}});
define("ws/widget/WSEditor","dojo/_base/declare,dojo/text!ws/widget/WSEditor.html,dojo/text!ws/widget/WSEditor.css,dojo/text!ws/widget/WSEditorDocument.css,dojo,dijit,dijit/_Widget,dijit/_TemplatedMixin,dijit/_WidgetsInTemplateMixin,dojo/dom-attr,ws/mail/funmail,ws/widget/ColorPalette,ws/widget/LinkEditor,ws/widget/SmileyPalette,ws/browser,ws/html,ws/settings,ws/widget/util,ws/widget/Pane,ws/widget/Button,ws/widget/WSSelect,dijit/layout/BorderContainer".split(","),function(q,n,j,a,d,g,p,k,m,l,h,r,
o,c){ws.widget.fontOptions=[{value:"Arial, Helvetica, sans-serif",display:'<b style="font-weight: normal; font-family: Arial,Helvetica,sans-serif">Arial</b>',selected:!0,checked:!0},{value:"Comic Sans MS, sans-serif",display:'<b style="font-weight: normal; font-family: Comic Sans MS, sans-serif">Comic Sans MS</b>'},{value:"Courier New, Courier, mono",display:'<b style="font-weight: normal; font-family: Courier New, Courier, mono">Courier New</b>'},{value:"Georgia, Times New Roman, Times, Serif",display:'<b style="font-weight: normal; font-family: Georgia, Times New Roman, Times, Serif">Georgia</b>'},
{value:"impact, sans-serif",display:'<b style="font-weight: normal; font-family: impact, sans-serif">Impact</b>'},{value:"Tahoma, Arial, Helvetica, sans-serif",display:'<b style="font-weight: normal; font-family: Tahoma, Arial, Helvetica, sans-serif">Tahoma</b>'},{value:"Times New Roman, Times, serif",display:'<b style="font-weight: normal; font-family: Times New Roman, Times, serif">Times New Roman</b>'},{value:"Verdana, Arial, Helvetica, sans-serif",display:'<b style="font-weight: normal; font-family: Verdana, Arial, Helvetica, sans-serif">Verdana</b>'},
{value:"WingDings",display:'<b style="font-weight: normal;">WingDings</b>'}];3<=d.isFF&&ws.widget.fontOptions.splice(ws.widget.fontOptions.length-1,1);ws.widget.fontSizePicker=[{value:"1",display:"<span style='font-size:8pt;'>8 pt</span>",safari:"10px",other:"8pt"},{value:"2",display:"<span style='font-size:10pt;'>10 pt</span>",safari:"13px",other:"10pt",selected:!0,checked:!0},{value:"3",display:"<span style='font-size:12pt;'>12 pt</span>",safari:"16px",other:"12pt"},{value:"4",display:"<span style='font-size:14pt;'>14 pt</span>",
safari:"18px",other:"14pt"},{value:"5",display:"<span style='font-size:18pt;'>18 pt</span>",safari:"24px",other:"18pt"},{value:"6",display:"<span style='font-size:24pt;'>24 pt</span>",safari:"32px",other:"24pt"},{value:"7",display:"<span style='font-size:36pt;'>36 pt</span>",safari:"48px",other:"36pt"}];return q([p,k,m],{templateString:n,css:{templateString:j},bodyCss:{templateString:a},_earlyTemplatedStartup:!0,rng:null,currentCommand:null,htmlMode:!1,isStationeryMode:!1,showAttachFile:!1,showRichTextButton:!0,
blankLine:"",tabindex:500,doForceRichMode:!1,addNewLinesToRichContent:!0,addDefaultFontStyles:!0,auxDirty:!1,fontPicker:null,fontSizePicker:null,justifyPicker:null,listPicker:null,indentPicker:null,startup:function(){if(!this._started){this._started=!0;this.connect(this.fontPicker,"valueChanged","changeFont");this.connect(this.fontPicker.domNode,"onmousedown","setRange");this.connect(this.fontSizePicker,"valueChanged","changeFontSize");this.connect(this.fontSizePicker.domNode,"onmousedown","setRange");
this.connect(this.justifyPicker,"valueChanged","changeJustify");this.connect(this.justifyPicker.domNode,"onmousedown","setRange");this.connect(this.listPicker,"valueChanged","changeList");this.connect(this.listPicker.domNode,"onmousedown","setRange");this.connect(this.indentPicker,"valueChanged","changeIndent");this.connect(this.indentPicker.domNode,"onmousedown","setRange");this.connect(this.textarea,"onfocus","onFocusHandler");l.remove(this.domNode,"tabindex");if(!this.showAttachFile||!Config.HasLocalFileSystem)this.attachButton.style.display=
"none";this.richTextButton.style.display="none";if(!Config.ShowRichTextHtml)this.htmlmodeItem.style.display="none";this.fontPicker.setOptions(ws.widget.fontOptions);if("undefined"!=typeof Settings.ComposeFont)for(var f=0;f<this.fontPicker.options.length;f++)if(this.compareFontFamilyStr(this.fontPicker.options[f].value,Settings.ComposeFont)){for(var c=0;c<this.fontPicker.options.length;c++)this.fontPicker.options[c].checked=!1;this.fontPicker.options[f].checked=!0;break}this.fontSizePicker.setOptions(ws.widget.fontSizePicker);
if("undefined"!=typeof Settings.ComposeFontSize)for(f=0;f<this.fontSizePicker.options.length;f++)if(this.fontSizePicker.options[f].value==Settings.ComposeFontSize){for(c=0;c<this.fontSizePicker.options.length;c++)this.fontSizePicker.options[c].checked=!1;this.fontSizePicker.options[f].checked=!0;break}this.justifyPicker.setOptions([{value:"justifyleft",display:'<div class="iconMenuItem"><img src="'+Config.SpacerImageURL+'" class="justifyleftIcon"><span>'+Config.Strings.JustifyLeft+"</span></div>",
selected:!0,checked:!0},{value:"justifycenter",display:'<div class="iconMenuItem"><img src="'+Config.SpacerImageURL+'" class="justifycenterIcon"><span>'+Config.Strings.JustifyCenter+"</span></div>"},{value:"justifyright",display:'<div class="iconMenuItem"><img src="'+Config.SpacerImageURL+'" class="justifyrightIcon"><span>'+Config.Strings.JustifyRight+"</span></div>"}]);this.connect(this.justifyPicker,"createMenu",function(){d.addClass(this.justifyPicker.menu.domNode,"iconMenu");d.toggleClass(this.justifyPicker.domNode,
"activated",!0)});this.listPicker.setOptions([{value:"insertorderedlist",display:'<div class="iconMenuItem"><img src="'+Config.SpacerImageURL+'" class="insertorderedlistIcon"><span>'+Config.Strings.OrderedList+"</span></div>"},{value:"insertunorderedlist",display:'<div class="iconMenuItem"><img src="'+Config.SpacerImageURL+'" class="insertunorderedlistIcon"><span>'+Config.Strings.BulletedList+"</span></div>"}]);this.connect(this.listPicker,"createMenu",function(){d.addClass(this.listPicker.menu.domNode,
"iconMenu")});this.indentPicker.setOptions([{value:"outdent",display:'<div class="iconMenuItem"><img src="'+Config.SpacerImageURL+'" class="indentIcon"><span>'+Config.Strings.DecreaseIndent+"</span></div>"},{value:"indent",display:'<div class="iconMenuItem"><img src="'+Config.SpacerImageURL+'" class="outdentIcon"><span>'+Config.Strings.IncreaseIndent+"</span></div>"}]);this.resizeToolBar()}},resizeToolBar:function(f){if(7==d.isIE&&(this.richMode||f)){f=d.query(">*",this.toolbarPane);this.toolbarPane.style.visibility=
"hidden";var c=[],a=[];f.forEach(function(f){d.hasClass(f,"rttLabel")?"none"!=f.style.display&&a.push(f):"none"!=f.style.display&&c.push(f)});for(var f=32*c.length+2*c.length,g=0,h=0,h=0;h<a.length;h++)g+=d.coords(a[h]).w+2;this.toolbarPane.style.width=f+g-1+"px";this.toolbarPane.style.visibility="visible";this.toolbarPane.style.display="none";this.toolbarPane.style.display=""}},setAuxDirty:function(f){this.auxDirty=f},isAuxDirty:function(){return this.auxDirty},fixWebKitContentInit:function(){if(d.isWebKit){this.doc().body&&
!this.doc().body.firstChild&&this.doc().body.appendChild(document.createTextNode(""));var f=this.doc().createRange();f.selectNode(this.doc().body.firstChild);f.collapse(!0);var c=this.win().getSelection();c.removeAllRanges();c.addRange(f)}},setContent:function(f,c,a,g,h,m){this.updateMode();if(this.richMode){if(this.designModeEnabled){this.doc().body.innerHTML=f;this.fixWebKitContentInit();if(!d.isIE)this.doc().designMode="off",this.doc().designMode="on";this.updateToolbar(null,!0);(!m||m&&!this.isStationeryMode)&&
this.fixEditorForStationery();c&&c()}else this.enableDesignMode(f,c);setTimeout(d.hitch(this,function(){d.withDoc(this.doc(),function(){d.query(".aol_mobilecontentwrapper").removeClass("aol_mobilecontentwrapper")})}),100)}else this.textarea.value=g?f:a?f:ws.html.getText(f),c&&c();this.win().lastSelType=null;this.win().lastSelRange=null;this.ieEditorBookmark=this.win().lastSelNode=null;this.setAuxDirty(!1)},_setup:function(){},getStationeryDefaults:function(){var f=Settings.StationeryDefaults;if(f&&
!d.isObject(f))Settings.StationeryDefaults=d.fromJson(f);return Settings.StationeryDefaults?Settings.StationeryDefaults:null},hasStationeryDefaults:function(){var f=Settings.StationeryDefaults;return f&&f.pluginId&&f.name},enableDesignMode:function(f,c){var a=d.hitch(this,function(){this._enableDesignMode(f);c&&c()});d.isIE||this.iframe._loaded?ws.lang.setTimeout(a,10):this.iframe.onload=a},_enableDesignMode:function(f){var c=this.win(),a=this.doc();try{a.body.innerHTML=f,this.bodyCss.templateString?
d.withGlobal(c,"insertCssText",ws.widget,[this.bodyCss.templateString,!0]):d.withGlobal(c,"insertCssText",ws.widget,[d._getText(this.bodyCss.templatePath),!0])}catch(g){}if(d.isIE)a.body.contentEditable="true",this.connect(a,"onbeforedeactivate","onBeforeDeactivate");else try{a.designMode="on"}catch(h){d.isMoz&&ws.lang.setTimeout(d.hitch(this,function(){this.enableDesignMode(f)}),10);return}ws.widget.popup.registerWin(this.win());a=this.doc();d.isFF?(this.connect(a,"onfocus","onFocusHandler"),a.execCommand("enableObjectResizing",
!1,!1)):this.connect(c,"onfocus","onFocusHandler");this.connect(a,"onkeyup","updateToolbar");this.connect(a,"onmouseup","updateToolbar");d.isIE?this.connect(a,"onkeydown","ieKeyDown"):d.isMoz?this.connect(a,"onkeypress","geckoKeyPress"):d.isWebKit&&this.connect(a,"onkeydown","webkitKeyPress");this.connect(a,"onclick",function(f){d.publish("WSEditor/BodyClick",[{event:f}])});this.connect(a,"ondblclick",function(f){d.publish("WSEditor/BodyDblClick",[{event:f}])});if(d.isWebKit)this.webkitCursorFixFocus=
this.connect(this.win(),"onfocus","fixWebKitCursor");this.designModeEnabled=!0;this.reset(null,!1);if(d.isWebKit)a.designMode="off",a.designMode="on",a.body.setAttribute("contentEditable","true"),a.body.setAttribute("unselectable","off"),a.body.innerHTML=f,this.fixWebKitContentInit(),this.focus()},fixWebKitCursor:function(){var f=this.doc();if("false"==f.body.contentEditable){if((f=d.query("[contenteditable=true]",f.body))&&0!=f.length&&"<span></span>"==f[0].innerHTML)f[0].innerHTML="",this.disconnect(this.webkitCursorFixFocus)}else if("<span></span>"==
f.body.innerHTML)f.body.innerHTML="",this.disconnect(this.webkitCursorFixFocus)},isEmpty:function(){if(d.isWebKit)if(this.richMode){var f=this.doc().body.innerHTML;if(""==f||"<span>&nbsp;</span>"==f||"<span></span>"==f)return!0}else if(!d.trim(this.textarea.value))return!0;return!1},getEmptyHtml:function(){return d.isWebKit?"<span></span>":""},openAttachFileDialog:function(){},enableRichText:function(){},showAttachFileButtonInToolBar:function(){if(Config.HasLocalFileSystem){d.query(">",this.toolbarPane).forEach(function(f){"form"==
f.tagName.toLowerCase()?d.addClass(f,"rteOff"):f.style.display="none"},this);if(this.insertPicsBtn)this.insertPicsBtn.style.display="none";if(this.showAttachFile)this.attachButton.style.display=""}},showAllInToolBar:function(){if(Config.HasLocalFileSystem){d.query(">",this.toolbarPane).forEach(function(f){if((f!=this.htmlmodeItem||Config.ShowRichTextHtml)&&(f!=this.richTextButton||this.showRichTextButton)&&(f!=this.attachButton||this.showAttachFile))f.style.display="","form"==f.tagName.toLowerCase()&&
d.removeClass(f,"rteOff")},this);if(this.insertPicsBtn)this.insertPicsBtn.style.display="";this.positionAttachFileButton(!1)}},positionAttachFileButton:function(){},positionRichTextButton:function(){},updateMode:function(){if(this.richMode=this.useRichMode()){this.textareaPane.hide();this.showAllInToolBar();if(9<=d.isIE)this.iframePane.domNode.style.overflow="hidden";this.iframePane.show()}else this.textareaPane.show(),this.showAttachFileButtonInToolBar(),this.iframePane.hide();this.toolbarPaneParent.domNode.style.height=
"26px";this.positionRichTextButton();this.onResized()},useRichMode:function(){return this.doForceRichMode?!0:!Settings.UseRichEditor?!1:!(d.isIE&&ws.browser.ns8)},getBlankLine:function(){if(!this.blankLine)this.blankLine=d.isMoz?"<div> <br></div>":9==d.isIE||10==d.isIE?"<div class='aOL-ws_iE10-nL'></div>":"<br>";return this.useRichMode()?this.blankLine:"<br>"},getRichContent:function(){var f="";if(this.htmlMode)f=ws.html.renderedTextContent(this.doc().body);else{if((9==d.isIE||10==d.isIE)&&this.doc().body){var c=
d.query(".aOL-ws_iE10-nL",this.doc().body);if(c)for(var a=0;a<c.length;a++){var g=c[a];if(""==g.innerHTML)g.innerHTML="&nbsp;";d.removeClass(g,"aOL-ws_iE10-nL")}}if(d.isIE&&Config&&Config.IESanitizeTagsForSend&&0<Config.IESanitizeTagsForSend.length){var h=this.doc().body;if(h){var f=h.innerHTML,m=/([^"'\s>]+)\=(('[^']*')|("[^"]*")|([^"'\s>]+))/g,c=Config.IESanitizeTagsForSend.split(","),k=[];d.forEach(c,function(f){k=k.concat(d.query(f,h))});d.forEach(k,function(c){var e=c.outerHTML.toLowerCase(),
a=e.indexOf("<"+c.nodeName.toLowerCase());if(0<=a&&(e=e.indexOf(">"),0<=e&&e>a)){for(var a=c=c.outerHTML.slice(a,e+1),e=null,g=0;null!=(e=m.exec(c));)if(5<=e.length&&e[2]&&0<e[2].length&&"'"!=e[2].charAt(0)&&'"'!=e[2].charAt(0)){var h=e.index+e[1].length+1+g,a=a.slice(0,h)+'"'+a.slice(h);g++;h+=e[2].length+1;a=a.slice(0,h)+'"'+a.slice(h);g++}a!=c&&(e=f.indexOf(c),0<=e&&(f=f.slice(0,e)+a+f.slice(e+c.length)))}})}}else f=this.doc().body.innerHTML}c="<font";a=!1;"undefined"!=typeof Settings.ComposeColor&&
(a=!0,c+=" color='"+Settings.ComposeColor+"'");"undefined"!=typeof Settings.ComposeFontSize&&(a=!0,c+=" size='"+Settings.ComposeFontSize+"'");"undefined"!=typeof Settings.ComposeFont&&(a=!0,c+=" face='"+Settings.ComposeFont+"'");this.addDefaultFontStyles&&a&&(f=c+">"+f+"</font>");f=f.replace(/<p /gi,"<div ").replace(/<p>/gi,"<div>").replace(/<\/p>/gi,"</div>");this.addNewLinesToRichContent&&(f=f.replace(/<div/gi,"\n<div").replace(/<\/div>/gi,"</div>\n").replace(/<br>/gi,"<br>\n"));d.isIE&&(f=f.replace(/alt=">:O"/gi,
'alt="&gt;:O"'));return f},getPlainContent:function(f){if(this.richMode){f||(f=!1);var c=this.isStationeryMode?this.doc().getElementById("role_body"):this.doc().body;(f=ws.html.renderedTextContent(c,f))&&0<f.length&&(f=f.replace(/\u00a0/g," "));return f}return this.textarea.value},getStationeryContent:function(){if(this.isStationeryMode){var f=this.doc().getElementById("role_body");if(f)return f.innerHTML}return this.getContent()},getContent:function(){return this.richMode?this.getRichContent():this.getPlainContent()},
processBeforeSend:function(){return!1},boldClick:function(f){f.preventDefault();this.command("bold")},italicClick:function(f){f.preventDefault();this.command("italic")},underlineClick:function(f){f.preventDefault();this.command("underline")},horizontalRuleClick:function(f){f.preventDefault();this.command("inserthorizontalrule")},fontColorClick:function(f){f.preventDefault();this.dlgColorPalette("forecolor")},backgroundColorClick:function(f){f.preventDefault();this.dlgColorPalette("hilitecolor")},
smileyClick:function(f){f.preventDefault();this.dlgSmileyPalette()},linkClick:function(f){f.preventDefault();this.linkEditor=new o({callbackFunc:d.hitch(this,this.linkEditorDone)});this.linkEditor.startup(this.ieEditorBookmark);this.linkEditor.show(this.win(),this.linkButton);ws.reporting.reportDLAction("Mail-ComposeMessage-HyperlinkLinkClicked")},linkEditorDone:function(f){f||this.setAuxDirty(!0);this.updateToolbar();this.refocusAfterPopup()},command:function(f,c,a,g){var h=this.win();if(d.isMoz)try{h.document.execCommand("useCSS",
!1,!0),("hilitecolor"==f||"indent"==f||"outdent"==f)&&h.document.execCommand("useCSS",!1,!1)}catch(m){}try{h.focus(),d.isIE&&this.isStationeryMode&&!g&&this.getFunmail().moveCursorToBodyRole(this.doc(),!0),h.document.execCommand(f,!1,c),h.focus()}catch(k){if(3==d.isFF&&this.isStationeryMode&&("indent"==f||"outdent"==f||0==f.indexOf("justify")||-1!=f.indexOf("orderedlist"))&&k&&2147500037==k.result){var l=this.win().getSelection().getRangeAt(0),c=h.document.createElement("br");c.style.lineHeight="0px";
for(l=l.startContainer.parentNode;l&&"true"!=l.contentEditable;)l=l.parentNode;if(!l)throw"Selected node is not editable!";l.insertBefore(c,l.childNodes[0]);h.document.execCommand(f,!1,null);c.parentNode.removeChild(c)}}this._fixMe(f,g);a||(this.updateToolbar(),this.setAuxDirty(!0));return!0},changeFont:function(){d.isIE&&this.rng&&this.rng.select();this.fontPicker.menu&&this.fontPicker.menu.setChecked([this.fontPicker.currentIndex],!0);this.command("fontname",this.fontPicker.currentValue)},changeFontSize:function(){d.isIE&&
this.rng&&this.rng.select();this.fontSizePicker.menu&&this.fontSizePicker.menu.setChecked([this.fontSizePicker.currentIndex],!0);this.command("fontsize",this.fontSizePicker.currentValue)},changeJustify:function(){d.isIE&&this.rng&&this.rng.select();this.justifyPicker.menu.setChecked([this.justifyPicker.currentIndex],!0);this.command(this.justifyPicker.currentValue)},changeList:function(){d.isIE&&this.rng&&this.rng.select();this.listPicker.menu.setChecked([this.listPicker.currentIndex],!0);this.command(this.listPicker.currentValue)},
changeIndent:function(){d.isIE&&this.rng&&this.rng.select();this.command(this.indentPicker.currentValue)},htmlModeClick:function(){if(this.htmlMode){if(d.isIE){var f=escape(this.doc().body.innerText),f=f.replace("%3CP%3E%0D%0A%3CHR%3E","%3CHR%3E"),f=f.replace("%3CHR%3E%0D%0A%3C/P%3E","%3CHR%3E");this.doc().body.innerHTML=unescape(f)}else{var f=this.doc(),c=f.body.ownerDocument.createRange();c.selectNodeContents(f.body);f.body.innerHTML=c.toString()}this.htmlMode=!1;d.removeClass(this.htmlmodeItem,
"activated");if(this.isStationeryMode)this.doc().designMode="Off"}else if(f=this.addDefaultFontStyles,this.addDefaultFontStyles=!1,c=this.getRichContent(),this.addDefaultFontStyles=f,d.isIE?this.doc().body.innerText=c:(f=this.doc(),c=f.createTextNode(c),f.body.innerHTML="",f.body.appendChild(c)),this.htmlMode=!0,d.addClass(this.htmlmodeItem,"activated"),this.isStationeryMode)this.doc().designMode="On";this.focus()},dlgSmileyPalette:function(){this.setRange();if(!this.smileyPalette)this.smileyPalette=
new c,this._supportingWidgets.push(this.smileyPalette),this.smileyPalette.startup(),this.connect(this.smileyPalette,"onSmileyClicked","insertSmiley");this.smileyPalette.isShowing()?ws.widget.popup.close(this.smileyPalette):ws.widget.popup({popup:this.smileyPalette,around:this.smileyButton})},insertSmiley:function(f,c){ws.widget.popup.close(this.smileyPalette);var a=".gif"==Config.SmileyImageExt?19:25;this.insertHTML("<img src='"+c+"' alt='"+f+"' height="+a+" width="+a+">",d.isWebKit?!0:!1)},dlgColorPalette:function(f){this.setRange();
this.palette=this[f+"Palette"];if(!this.palette)this.palette=this[f+"Palette"]=new r,this._supportingWidgets.push(this.palette),this.palette.startup(),this.connect(this.palette,"onPaletteClicked","setColor");this.palette.isShowing()?ws.widget.popup.close(this.palette):(ws.widget.popup({popup:this.palette,around:this[f+"Item"]}),this.currentCommand=f)},setColor:function(f){var c=this.currentCommand;if(d.isIE){"hilitecolor"==c&&(c="backcolor");var a=this.win();if(a.lastSelRange&&"Control"!=a.lastSelType)a=
a.lastSelRange,a.select(),this.command(c,f),a.collapse(!1),a.select()}else this.command(c,f)},createStationeryBtn:function(){if(Config.HasLocalFileSystem&&!this.stationaryItem)this.stationaryItem=d.create("a",{title:Config.Strings.StationeryTooltip,id:"stationeryBtn",className:"stationeryIcon rttLabel"},this.linkButton,"after"),d.create("div",{className:"rttIcon"},this.stationaryItem),d.create("span",{innerHTML:Config.Strings.Stationery,className:"rttLabel2"},this.stationaryItem),this.connect(this.stationaryItem,
"onclick","onClickStationeryBtn"),this.subscribe("stationery/close","onClickStationeryBtn"),d.publish("WSEditor/StationeryBtnCreated",[])},onClickStationeryBtn:function(c,e){this.loadServicePlugin({serviceId:"stationery",pluginId:"STATIONERY_AOL",apiMessage:"selectStationery",apiArgs:{name:e}})},updateServiceBtn:function(){},loadServicePlugin:function(c){if(c||c.pluginId)ws.WebSuite.SidePanel.showStationery()?d.addClass(this.stationaryItem,"activated"):d.removeClass(this.stationaryItem,"activated")},
initStationery:function(){this.subscribe("WSEditor/BodyClick",function(c){if(this.isStationeryMode&&"true"!=c.event.target.contentEditable){var c=!0,e,a=null;if(d.isIE){if(e=this.doc().selection)try{var g=e.createRange(),a="Control"==e.type?"":g.text}catch(h){}}else(e=this.win().getSelection())&&(a=e.toString());null!=a&&""!=a&&(c=!1);if(c)this._bodyClickTO=setTimeout(d.hitch(this,function(){this.getFunmail().moveCursorToBodyRole(this.doc())}),400)}});this.subscribe("WSEditor/BodyDblClick",function(){clearTimeout(this._bodyClickTO)})},
getFunmail:function(){if(!this.funmail)this.funmail=new h,this.funmail.setDocument(this.doc());return this.funmail},handleFeaturesDraft:function(){this.convertPicturesInMail();this.handleStationeryDraft()},handleStationeryDraft:function(){this.getContent();var c=d.query("table#role_layout",this.doc()),e=!1;c&&(c=c[0]);if(c)try{var a=c.parentNode.parentNode,e=d.query("> div",a.parentNode)[0]==a}catch(g){}if(e)this.isStationeryMode=!0,this.fixEditorForStationery(),this.getFunmail().postcardHandler(this.doc().body.innerHTML),
Config.UseOMS&&(c=this.doc().getElementById("role_body"))&&c.setAttribute("contentEditable","true"),ws.lang.setTimeout(this,"updateToolbar",500)},resetStationeryState:function(){this.isStationeryMode=!1;this.stationeryState=null},clearStationery:function(){if(this.hasStationeryDefaults())Settings.StationeryDefaults={name:null,swatchUrl:null,pluginId:null},ws.settings.saveNow({StationeryDefaults:Settings.StationeryDefaults});var c=this.getStationeryContent();this.resetStationeryState();this.setContent(c,
null,!1,!1,"");this.setAuxDirty(!0)},resetPlugins:function(c){if(this.richMode){var e=this.doc(),a;if(!d.isFF)this.focus(),e.body.scrollTop=0,e.body.scrollLeft=0,e.queryCommandState("bold")&&this.command("bold",null,!0),e.queryCommandState("italic")&&this.command("italic",null,!0),e.queryCommandState("underline")&&this.command("underline",null,!0),e.queryCommandState("justifyRight")?this.command("justifyRight",null,!0):e.queryCommandState("justifyCenter")&&this.command("justifyCenter",null,!0),e.queryCommandState("insertOrderedList")?
this.command("insertOrderedList",null,!0):e.queryCommandState("insertUnorderedList")&&this.command("insertUnorderedList",null,!0);if(c.ComposeFontSize)for(a=0;a<this.fontSizePicker.options.length;a++){if(this.fontSizePicker.options[a].value==c.ComposeFontSize){a=d.isSafari?this.fontSizePicker.options[a].safari:this.fontSizePicker.options[a].other;e.body.style.fontSize=a.replace(/ /g,"");break}}else a=d.isSafari?this.fontSizePicker.options[0].safari:this.fontSizePicker.options[0].other,e.body.style.fontSize=
a.replace(/ /g,"");e.body.style.fontFamily=c.ComposeFont?c.ComposeFont:this.fontPicker.options[0].value;e.body.style.color=c.ComposeColor?c.ComposeColor:"rgb(0, 0, 0)";d.isFF||(this.command(d.isIE?"backcolor":"hilitecolor","transparent",!0),this.updateToolbar(null,!0),this.setAuxDirty(!1))}},resetCursor:function(c){void 0==c&&(c=!1);var e=this.doc(),a;a=this.win();if(this.richMode)if(d.isIE)a=e.body.createTextRange(),a.collapse(c),a.select();else{var g=a.getSelection();a=e.createRange();if((b=e.body||
e.getElementsByTagName("body"))&&b.length)a.selectNode(b[0]),a.collapse(c),g.removeAllRanges(),g.addRange(a)}else if(!(d.isIE&&8>=d.isIE)&&(e=this.textarea)&&"none"!=e.style.display)this.textarea.focus(),c?this.textarea.setSelectionRange(0,0):(c=e.value.length)?this.textarea.setSelectionRange(--c,c):this.textarea.setSelectionRange(0,0)},reset:function(c,e){var a=c?c:Settings;if(this.richMode)this.resetPlugins(a);else{if(7==d.isIE)this.toolbarPane.style.width=d.coords(this.richTextButton).w+34+"px";
this.richTextButton.style.borderRightWidth=0}e&&this.resetCursor(!0);this.resizeToolBar()},insertStationery:function(c){if(""==c.url)return this.clearStationery();d.xhrGet({url:"/webmail/proxy/stationery",content:{url:c.url},timeout:5E3,handleAs:"text",load:d.hitch(this,function(e){this._loadStationeryTemplate(e,c)}),error:function(){}})},_loadStationeryTemplate:function(c,e){this.isStationeryMode=!0;this.stationeryState=e;this.fixEditorForStationery();this.getFunmail().postcardHandler(c);this.setAuxDirty(!0);
ws.lang.setTimeout(this,"updateToolbar",500)},fixEditorForStationery:function(){try{if(this.isStationeryMode){this.doc().body.style.padding="0";if(d.isIE){if(!this.win().lastSelRange){var c=this.doc().getElementById("role_body");c&&(c.focus(),this.onBeforeDeactivate())}}else this.doc().designMode="on",this.doc().designMode="off";this.doc().body.setAttribute("contentEditable","false");this.doc().body.setAttribute("unselectable","on")}else{this.doc().body.style.padding="15px 15px 15px 15px";if(!d.isIE)this.doc().designMode=
"off",this.doc().designMode="on";this.doc().body.setAttribute("contentEditable","true");this.doc().body.setAttribute("unselectable","off")}}catch(e){}},insertHTML:function(c,e,a){var g=this.win();g.focus();d.isIE?(this.isStationeryMode&&!e&&this.getFunmail().moveCursorToBodyRole(this.doc(),!0,!0),g=e&&g.lastSelRange?g.lastSelRange:g.document.selection.createRange(),"Control"!=this.win().lastSelType&&(g.pasteHTML(c),g.collapse(!1),g.select())):(this.isStationeryMode&&(!d.isWebKit||!e)&&this.doc().getElementById("role_body").focus(),
a&&!d.isFF?(e=g.getSelection(),e.isCollapsed||e.deleteFromDocument(),e=e.getRangeAt(0),!e.collapsed&&e.collapse(),"<"!=c.charAt(0)&&(c="<span>"+c+"</span>"),c=d._toDom(c,g.document),a=c.firstChild.firstChild,e.insertNode(c.firstChild),e.selectNode(a),g=g.getSelection(),g.removeAllRanges(),g.addRange(e),g.collapseToEnd()):g.document.execCommand("insertHTML",!1,c));this.setAuxDirty(!0);this.updateToolbar(null,!0,!0);this.refocusAfterPopup()},refocusAfterPopup:function(){d.isWebKit?ws.lang.setTimeout(d.hitch(this,
function(){document.body.focus();ws.lang.setTimeout(d.hitch(this,function(){this.win().focus()}),100)}),100):3<=d.isFF&&this.win().focus()},setRange:function(){var c=this.win();this.focus();if(d.isIE){if(c=c.document.selection,null!=c)this.rng=c.createRange()}else c=c.getSelection(),this.rng=c.getRangeAt(c.rangeCount-1).cloneRange();return this.rng},onBeforeDeactivate:function(){this.ieEditorBookmark=null;var c=this.doc().selection,e=c.createRange();"Control"==c.type?this.win().lastSelNode=e.item(0):
this.ieEditorBookmark=e.getBookmark();this.win().lastSelType=c.type;this.win().lastSelRange=e},ieKeyDown:function(){var c=this.win().event,e=!1;if(8==c.keyCode){var a=this.doc().selection;a&&"Control"==a.type&&((e=a.createRange().item(0))&&e.parentNode&&e.parentNode.removeChild(e),e=!0)}if(c.ctrlKey&&13==c.keyCode)this.sendMessage(),e=!0;else if(c.altKey&&187==c.keyCode)this.spellCheck(),e=!0;else if(c.altKey)switch(String.fromCharCode(c.keyCode).toLowerCase()){case Config.Strings.KeyComposeClose:this.cancel(),
e=!0}else if(c.ctrlKey&&65<=c.keyCode&&90>=c.keyCode)switch(String.fromCharCode(c.keyCode).toLowerCase()){case Config.Strings.KeyComposeBold:this.command("bold",null);e=!0;break;case Config.Strings.KeyComposeItalic:this.command("italic",null);e=!0;break;case Config.Strings.KeyComposeUnderline:this.command("underline",null),e=!0}else if(13==c.keyCode&&9==d.isIE){var a=this.doc().selection,g=(a=a.createRange())?a.parentElement():null;g&&"P"==g.tagName&&!g.firstChild&&(a.pasteHTML("<br />"),e=!0)}else!c.shiftKey&&
c.keyCode===d.keys.TAB&&(this.insertTab(),e=!0);if(e)return c.cancelBubble=!0,c.returnValue=!1},webkitKeyPress:function(c){var e=!1,a=ws.html.fixKeyCodeForMac(c);c.ctrlKey?a==d.keys.ENTER&&(this.sendMessage(),e=!0):c.altKey&&(187==a?(this.spellCheck(),e=!0):88==a&&(this.cancel(),e=!0));e&&d.stopEvent(c)},geckoKeyPress:function(c){var e=!1;if(c.ctrlKey){switch(String.fromCharCode(c.charCode).toLowerCase()){case Config.Strings.KeyComposeBold:this.command("bold",null);e=!0;break;case Config.Strings.KeyComposeItalic:this.command("italic",
null);e=!0;break;case Config.Strings.KeyComposeUnderline:this.command("underline",null),e=!0}if(13==c.keyCode||77==c.keyCode&&d.isMac)this.sendMessage(),e=!0}else if(c.altKey)switch(c.keyChar.toLowerCase()){case Config.Strings.KeyComposeClose:this.cancel();e=!0;break;case "=":this.spellCheck(),e=!0}else!c.shiftKey&&c.keyCode===d.keys.TAB&&(this.insertTab(),e=!0);e&&(c.preventDefault(),c.stopPropagation())},insertTab:function(){this.insertHTML("&nbsp;&nbsp;&nbsp;&nbsp;",!1)},cancel:function(){},sendMessage:function(){},
updateToolbar:function(c,e){var a=!1;c&&"mouseup"==c.type&&(a=!0);var g=ws.WebSuite.SidePanel;this.stationaryItem&&g&&(g.isSelectedPanel(g.stationery)?d.addClass(this.stationaryItem,"activated"):d.removeClass(this.stationaryItem,"activated"));this.updateToolbarTimeout&&clearTimeout(this.updateToolbarTimeout);e?this._updateToolbar(a):this.updateToolbarTimeout=ws.lang.setTimeout(d.hitch(this,"_updateToolbar",a),300)},compareFontFamilyStr:function(c,e){var a=c.toLowerCase().split(","),g=e.toLowerCase().split(","),
h=d.trim(a[0]),m=d.trim(g[0]);return h==m||"arial"==h&&g[1]&&d.trim(g[1])==h&&"helvetica"==m&&a[1]&&d.trim(a[1])==m||"helvetica"==h&&g[1]&&d.trim(g[1])==h&&"arial"==m&&a[1]&&d.trim(a[1])==m?!0:!1},_updateToolbar:function(c){try{var e=this.doc(),a=!0,g,h=null;if(d.isIE){if(g=this.doc().selection)var m=g.createRange(),h="Control"==g.type?"":m.text}else(g=this.win().getSelection())&&(h=g.toString());null!=h&&""!=h&&(a=!1);var k=e.queryCommandValue("fontname");g=!1;h=0;if(k)for(var l=0;l<this.fontPicker.options.length;l++)this.fontPicker.options[l].checked=
!1,!g&&this.compareFontFamilyStr(this.fontPicker.options[l].value,k)&&(h=l,g=!0);if(!g){if("undefined"!=typeof Settings.ComposeFont)for(l=0;l<this.fontPicker.options.length;l++)if(this.compareFontFamilyStr(this.fontPicker.options[l].value,Settings.ComposeFont)){h=l;break}this.addDefaultFontStyles&&a&&this.command("fontname",this.fontPicker.options[h].value,!0,c)}this.fontPicker.setOption(h);this.fontPicker.menu?this.fontPicker.menu.setChecked([h],!0):(this.fontPicker.options[0].checked=!1,this.fontPicker.options[h].checked=
!0);var p=e.queryCommandValue("fontsize");g=!1;var o=this.isStationeryMode?2:1;if(!(null==p||""==p))for(l=0;l<this.fontSizePicker.options.length;l++){this.fontSizePicker.options[l].checked=!1;var j=d.isSafari?this.fontSizePicker.options[l].safari:this.fontSizePicker.options[l].value;!g&&p==j&&(o=l,g=!0)}if(!g&&"undefined"!=typeof Settings.ComposeFontSize)for(l=0;l<this.fontSizePicker.options.length;l++)if(this.fontSizePicker.options[l].value==Settings.ComposeFontSize){o=l;break}this.fontSizePicker.setOption(o);
!g&&this.addDefaultFontStyles&&a&&this.command("fontsize",this.fontSizePicker.currentValue,!0,c);this.fontSizePicker.menu?this.fontSizePicker.menu.setChecked([o],!0):(this.fontSizePicker.options[1].checked=!1,this.fontSizePicker.options[o].checked=!0);c=["justifyleft","justifycenter","justifyright"];this.justifyPicker.menu&&this.justifyPicker.menu.setUnchecked();for(l=0;l<c.length;l++)if(e.queryCommandState(c[l])){this.justifyPicker.menu&&this.justifyPicker.menu.setChecked([l],!0);this.justifyPicker.domNode.className=
"wsSelect "+c[l]+"Icon";break}else this.justifyPicker.menu&&this.justifyPicker.menu.setChecked([0],!0),this.justifyPicker.domNode.className="wsSelect justifyleftIcon";d.toggleClass(this.justifyPicker.domNode,"activated",!0);l=["bold","italic","underline"];for(c=0;c<l.length;c++){var r=this[l[c]+"Item"],n=e.queryCommandState(l[c]);d.toggleClass(r,"activated",n)}r=["insertorderedlist","insertunorderedlist"];this.listPicker.menu&&this.listPicker.menu.setUnchecked();for(n=0;n<r.length;n++)if(e.queryCommandState(r[n])){this.listPicker.menu&&
this.listPicker.menu.setChecked([n],!0);this.listPicker.domNode.className="wsSelect "+r[n]+"Icon";d.toggleClass(this.listPicker.domNode,"activated",!0);break}else d.toggleClass(this.listPicker.domNode,"activated",!1)}catch(q){}},onResized:function(){this.inherited(arguments);if(this.stationaryItem&&this.richMode)if(1==ws.WebSuite.widthMode)d.style(this.stationaryItem,"display","none");else{d.style(this.stationaryItem,"display","");var c=d.marginBox(this.toolbarPaneParent.domNode).w,e=d.marginBox(this.toolbarPane).w;
this.stationaryLabelNode=this.stationaryLabelNode||d.query(".rttLabel2",this.stationaryItem)[0];this.stationeryButtonWidth=this.stationeryButtonWidth||d.marginBox(this.stationaryItem).w;if("none"!=this.stationaryLabelNode.style.display){if(0>=c-e)this.stationaryLabelNode.style.display="none",d.replaceClass(this.stationaryItem,"rttLabelOff","rttLabel")}else if(0<c-(e-32+this.stationeryButtonWidth))d.replaceClass(this.stationaryItem,"rttLabel","rttLabelOff"),this.stationaryLabelNode.style.display=""}this.resizeToolBar();
this.richMode||(e=d.coords(this.textarea.parentNode),c=e.w-(d.isFF?18:28),e=e.h-15,d.isFF&&(e-=10),d.style(this.textarea,{width:(0>=c?0:c)+"px",height:(0>=e?0:e)+"px",margin:"0",padding:"15px 10px",overflow:"auto",fontFamily:"Helvetica,Arial,sans-serif"}))},focus:function(){this.richMode?this.win().focus():this.textarea.focus()},onFocusHandler:function(){d.publish("WSEditor/focus",[])},selectNode:function(c){if(c)if(d.isIE){var e=this.doc().body.createTextRange();try{e.moveToElementText(c),e.collapse(!0),
e.select()}catch(a){}}else{var g=this.win().getSelection(),e=this.doc().createRange();e.selectNode(c);e.collapse(!0);g.removeAllRanges();g.addRange(e)}},_fixMe:function(c,e){d.isIE&&this.isStationeryMode&&!e&&this.getFunmail().moveCursorToBodyRole(this.doc(),!0)},win:function(){return this.iframe.contentWindow},doc:function(){return d.io.iframe.doc(this.iframe)},onIframeLoaded:function(){this.iframe._loaded=!0}})})},"ws/widget/ColorPalette":function(){define("ws/widget/ColorPalette",["dojo/_base/declare",
"dojo","dijit","dijit/_Widget","dijit/_TemplatedMixin"],function(q,n,j,a,d){return q([a,d],{templateString:"<div class='wsMenu' style='width:206px;height:130px;overflow:hidden;background: #fff url(${baseimages}common/colors7x10.png)!important;cursor:pointer;display:none' data-dojo-attach-event='onclick:onClick'></div>",colorNames:["white,seashell,cornsilk,lemonchiffon,lightyellow,palegreen,paleturquoise,lightcyan,lavender,plum".split(","),"lightgrey,pink,bisque,moccasin,khaki,lightgreen,lightseagreen,lightskyblue,cornflowerblue,violet".split(","),
"silver,lightcoral,sandybrown,orange,palegoldenrod,chartreuse,mediumturquoise,skyblue,mediumslateblue,orchid".split(","),"gray,red,orangered,darkorange,yellow,limegreen,darkseagreen,royalblue,slateblue,mediumorchid".split(","),"dimgray,crimson,chocolate,coral,gold,forestgreen,seagreen,blue,blueviolet,darkorchid".split(","),"darkslategray,firebrick,saddlebrown,sienna,olive,green,darkcyan,mediumblue,darkslateblue,darkmagenta".split(","),"black,darkred,maroon,brown,darkolivegreen,darkgreen,midnightblue,navy,indigo,purple".split(",")],
onClick:function(a){var d=n.position(this.domNode),k=Math.floor((a.pageY-d.y)/this.colorHeight),a=Math.floor((a.pageX-d.x)/this.colorWidth);6<k&&(k=6);9<a&&(a=9);this.onPaletteClicked(this.colorNames[k][a]);ws.widget.popup.close(this)},colorHeight:20,colorWidth:20,onPaletteClicked:function(){}})})},"ws/mail/SendConfirmationCard":function(){require({cache:{"url:ws/mail/SendConfirmationCard.html":'<div>\n\t<\!--\n\t<div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="invitePane" style="display: none;">\n\t\t<table class="sendConfirmationTable" border="0" cellpadding="4" cellspacing="1">\n\t\t\t<tr>\n\t\t\t\t<td colspan="10"><span class="inputLabels">${To}: </span></td>\n\t\t\t\t<td colspan="40"><input type="text" class="wsInput regularInput" data-dojo-attach-point="toInput" /></td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td colspan="10"><span class="inputLabels">${Subject}: </span></td>\n\t\t\t\t<td colspan="40"><input type="text" class="wsInput regularInput" data-dojo-attach-point="subjectInput" /></td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td colspan="50">\n\t\t\t\t\t<textarea class="contentText" data-dojo-attach-point="inviteContent" rows="5" wrap="virtual"></textarea>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td colspan="25" align="right">\n\t\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: sendInvite">${Invite}</div>\n\t\t\t\t</td>\n\t\t\t\t<td colspan="25" align="left">\n\t\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: hide">${Cancel}</div>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t</div>\n\t--\>\n\t<div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="createListPane" style="display: none; overflow: auto;">\n\t\t<div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="creatingList" class="creatingList" style="display:none">\n\t\t\t<img src="${spacer}" class="mainSprite wsCloseBtn" data-dojo-attach-event="onclick: closeCard">\n\t\t\t<table class="createListTable" data-dojo-attach-point="createListTable">\n\t\t\t\t<tr>\n\t\t\t\t\t<td valign="top" data-dojo-attach-point="listNameInputRow">\n\t\t\t\t\t\t<input type="text" class="wsInput listNameInput" data-dojo-attach-point="listNameInput" data-dojo-attach-event="onkeypress: onKeyPress"/>\n\t\t\t\t\t\t<div data-dojo-attach-point="error" class="error"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr data-dojo-attach-point="errorRow">\n\t\t\t\t\t<td valign="top" class="error" data-dojo-attach-point="errorMsg">\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td valign="top">\n\t\t\t\t\t\t<div class="listContacts" data-dojo-attach-point="listContacts"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div data-dojo-attach-point="okToolBar" data-dojo-type="ws/widget/WSToolbar" vizType="Bare">\n\t\t\t\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-point="createListButton" data-dojo-attach-event="onClick: checkRequiredFields" data-dojo-props="toolbarPosition: \'left\'">${Create}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>\n\t\t<div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="listCreated"  class="listCreated">\n\t\t\t<div class="listCreatedText"><span>${ListCreated}</span></div>\n\t\t\t<div data-dojo-type="ws/widget/WSToolbar" data-dojo-attach-point="listCreatedTB" vizType="Bare">\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick:closeCard" data-dojo-props="toolbarPosition: \'center\'">${OK}</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>',
"url:ws/mail/SendConfirmationCard.css":""}});define("ws/mail/SendConfirmationCard","dojo/_base/declare,dojo/text!ws/mail/SendConfirmationCard.html,dojo/text!ws/mail/SendConfirmationCard.css,dojo,dijit,dijit/_Widget,dijit/_TemplatedMixin,dijit/_WidgetsInTemplateMixin,ws/address/AddressModel,ws/widget/Checkbox,ws/html,ws/lang,ws/widget/Dialogs,ws/widget/Pane,ws/widget/util,ws/widget/Button,ws/widget/WSToolbar".split(","),function(q,n,j,a,d,g,p,k,m,l){return q([g,p,k],{templateString:n,css:{templateString:j},
_earlyTemplatedStartup:!0,confirmationWidget:null,model:null,from:null,addresses:null,maxEmailsToDisplay:10,startup:function(){this.addressModel=new m},fillOutList:function(g,d,m){this.createListPane.show();this.creatingList.show();this.listCreated.hide();this.createListButton.enable();this.domNode.className="createListPane";this.addresses=[];for(this.addresses=g.concat(d,m);this.listContacts.childNodes.length;)a._destroyElement(this.listContacts.firstChild);this.errorMsg.innerHTML="";this.errorRow.style.display=
"none";a.style(this.listContacts,{overflow:"visible",maxHeight:"none",height:"auto",width:"auto"});this.listNameInput.style.width="auto";this.createListTable.style.width="auto";this.show();ws.widget.fixFFCursor(this.createListPane);for(g=0;g<this.addresses.length;g++)this["listItem"+g]=new l({label:this.addresses[g],checked:!0}),this["listItem"+g].startup(),this.listContacts.appendChild(this["listItem"+g].domNode);this.listNameInput.value=Config.Strings.EnterListName;ws.lang.setTimeout(this,function(){if(this.addresses.length>
this.maxEmailsToDisplay-1){var c=a._getMarginSize(this.listItem0.domNode).h*this.maxEmailsToDisplay;this.listContacts.style.height=c+"px";var f=a._getMarginSize(this.listContacts).w;a.style(this.listContacts,{overflow:"auto",maxHeight:c+"px",height:c+"px",width:f+20+"px"});this.listNameInput.style.width=f+16+"px";this.createListTable.style.width=f+20+"px"}else this.listNameInput.style.width=a._getMarginSize(this.listContacts).w+"px",this.createListTable.style.width=a._getMarginSize(this.listContacts).w+
"px";this.listNameInput.select();this.okToolBar.layout()},0)},onKeyPress:function(g){if("none"!=this.errorRow.style.display)this.errorMsg.innerHTML="",this.errorRow.style.display="none";g.keyCode==a.keys.ENTER&&this.checkRequiredFields();g.stopPropagation()},checkRequiredFields:function(){var a=this.listNameInput.value,a=a.replace(/^\s+/,"");(a=a.replace(/\s+$/,""))&&a!=Config.Strings.EnterListName?this.saveDistributionList(a):(this.errorMsg.innerHTML=Config.Strings.NameDistList,this.errorRow.style.display=
"block")},saveDistributionList:function(g){for(var d=[],m=0;m<this.addresses.length;m++)this["listItem"+m].checked&&d.push(this.addresses[m]);0==d.length?(this.errorMsg.innerHTML=Config.Strings.IncludeEmailDistList,this.errorRow.style.display="block"):null!=this.addressModel.searchDLName(g)?(this.errorMsg.innerHTML=Config.Strings.DuplicateDistributionList,this.errorRow.style.display="block"):(this.createListButton.disable(),this.addressModel.createOrModifyDistributionList({uid:0,name:g,contactUids:[],
addresses:d,load:a.hitch(this,function(){this.creatingList.hide();this.listCreated.show();ws.lang.setTimeout(this,function(){this.listCreatedTB.layout()})},0),error:a.hitch(this,function(c){this.createListButton.enable();window.ws_ErrLgr&&!c&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for addressModel.createOrModifyDistributionList-saveDistributionList file:SendConfirmationCard.js");ws.widget.Dialogs.ok(c||Config.Strings.ErrorSavingDistList)})}))},closeCard:function(){this.creatingList.hide();
this.listCreated.hide();this.createListPane.hide();this.hide();ws.widget.popup.close(this)}})})},"url:ws/mail/ComposeMessageWidget.css":"","url:ws/pictures/PictureEditControl.html":'<div class="pictureEditControl" style="display: none;">\n    <div class="bkgndLayer" data-dojo-attach-point="bkgndLayerNode"></div>\n\t\t<div class="buttons" data-dojo-attach-point="buttons">\n\t\t\t<a href="#" data-dojo-attach-point="optionsBtn" class="mainSprite options" data-dojo-attach-event="onclick: showMenu"></a>\n\t\t\t<a href="#" class="mainSprite delete" data-dojo-attach-point="deleteButton"></a>\n\t\t</div>\n</div>\n\n',
"ws/pictures/PictureEditor":function(){define("ws/pictures/PictureEditor","dojo/_base/declare,dojo,ws/widget/SpellCheckEditor,ws/widget/DropDownButton,ws/pictures/PictureEditControl,ws/reporting,ws/widget/util,ws/widget/popup".split(","),function(q,n,j,a,d){return q([j],{hasAccessTokenToPicturePlugin:!1,startup:function(){this.composeForm=null;this.inherited(arguments);this.imageIdMap={};this.phUrl=Config.BaseImagesURL+"common/progressAnimation_lg.gif";this.maxMessageSize=parseInt(Config.MaxMessageSize)},
setContent:function(a,d,k,m,l,h){this.inherited(arguments);this.richMode&&this.createInsertPicsBtn(k)},convertPicturesInMail:function(){for(var a=this.doc().getElementsByTagName("img"),p=0;p<a.length;p++)if(a[p].id&&-1!=a[p].id.indexOf("AOLP")){var k=a[p].id,m=a[p].src;this.imageIdMap[k]={id:k,placeholder:!1,altText:a[p].alt,srcUrl:m,smallUrl:m,mediumUrl:m,largeUrl:m}}if(a.length&&!this.editControl)this.editControl=new d({editor:this}),this._supportingWidgets.push(this.editControl),n.body().appendChild(this.editControl.domNode),
this.editControl.startup()},getPartRegEx:RegExp(/webmail\/getPart\?uid=([^&]*)&partId=([^&]*)/),updateImageUrlsAfterSave:function(a,d){if(a)for(var k=this.doc().getElementsByTagName("img"),m=k.length,l=a.length,h=0;h<m;h++){var j=k[h];if(j.src)if(j.id&&-1!==j.id.indexOf("AOLP"))for(var o=0;o<l;o++){var c=a[o];if(j.id===c.contentId&&""!==c.url){j.src=c.url;j.className="AOLInlineImage";break}}else if((o=j.src.match(this.getPartRegEx))&&3===o.length)for(var c=o[1],f=o[2],o=0;o<l;o++){var e=a[o];if(f===
e.origPartId){j.src=j.src.replace("uid="+c,"uid="+d).replace("partId="+f,"partId="+e.id);break}}}},cleanUpFormAfterSave:function(a,d,k,m){if(a)for(var l=0;l<a.length;l++){var h=n.query('[name="'+a[l].contentId+'"]',this.composeForm)[0];h&&h.parentNode.removeChild(h)}for(var a=n.query('[name^="AOLP."]',this.composeForm),j=[],o=this.getRichContent(),l=0;l<a.length;l++)h=a[l],d?(this.handleFailedInlineImage(h.name),h.parentNode.removeChild(h)):-1==o.indexOf(h.name)?h.parentNode.removeChild(h):j.push(h);
if(d){d="";if(a&&a.length&&0<a.length&&a[0].files)d=a[0].files[0].name;this.showFailedInlineImgError(k,m,d)}else 0<j.length&&this.autoSaveMessage(!0)},showFailedInlineImgError:function(a,d,k){var m="";a?m=a:d&&"ERR607"==d.toUpperCase()?m=ws.string.substituteParams(Config.Strings.AttachSizeExceeds,this.maxMessageSize/1048576):d&&"ERR608"==d.toUpperCase()?(m=Config.Strings.ImageEmbed_PostNotImage,k&&(m=k+": "+m)):m=Config.Strings.InlineAttachUploadFailed;ws.widget.Dialogs.ok(m)},createInsertPicsBtn:function(){if(Config.EnablePictures&&
!(Settings.UserHash<Config.UserHashThresholds.pictures)&&!this.insertPicsBtn)this.insertPicsBtn=n.create("div",{title:Config.Strings.YGP_OpenPickerTooltip,className:"attachInlineBtn"}),n.place(this.insertPicsBtn,this.attachButton,"after"),this.constructEmbedImageFormHolder()},constructEmbedImageFormHolder:function(){this.embedImageFormHolder=document.createElement("div");this.insertPicsBtn.appendChild(this.embedImageFormHolder);this.embedImageFormHolder.style.position="relative";this.embedImageFormHolder.style.zIndex=
997;this.connect(this.embedImageFormHolder,"onmouseover","redirectInsertPicsEvent");this.connect(this.embedImageFormHolder,"onmouseout","redirectInsertPicsEvent");this.connect(this.embedImageFormHolder,"onmouseenter","redirectInsertPicsEvent");this.connect(this.embedImageFormHolder,"onmouseleave","redirectInsertPicsEvent");this.constructEmbedImageForm()},redirectInsertPicsEvent:function(a){var d=this.insertPicsBtn;if(n.isIE){var k=document.createEventObject();k.altKey=a.altKey;k.altLeft=a.altLeft;
k.button=a.button;k.clientX=a.clientX;k.clientY=a.clientY;k.ctrlKey=a.ctrlKey;k.ctrlLeft=a.ctrlLeft;k.dataFld=a.dataFld;k.offsetX=a.offsetX;k.offsetY=a.offsetY;k.reason=a.reason;k.repeat=a.repeat;k.screenX=a.screenX;k.screenY=a.screenY;k.shiftKey=a.shiftKey;k.shiftLeft=a.shiftLeft;k.type=a.type;k.x=a.x;k.y=a.y;d.fireEvent("on"+a.type,k)}else k=document.createEvent("MouseEvents"),k.initMouseEvent(a.type,a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,!1,!1,!1,!1,a.button,
a.relatedTarget),d.dispatchEvent(k)},onClickPicturesBtn:function(){},hideFileInput:function(){this.embedImageFormHolder.style.clip="rect(0px 0px 0px 0px)";return!1},onSelectFile:function(){ws.reporting.reportDLAction("Mail-Compose-InsertPic");var a=this.embedImageFileInput;if(a&&a.files&&a.files.length){var d=a.files[0];if((d.fileSize||d.size)>this.maxMessageSize){d=ws.string.substituteParams(Config.Strings.AttachSizeExceeds,this.maxMessageSize/1048576);ws.widget.Dialogs.ok(d);a.parentNode.removeChild(a);
this.constructEmbedImageForm();return}var k=d.type;if(k&&(-1==k.toLowerCase().indexOf("image")||"image/tiff"==k.toLowerCase())){d=d.name+": "+Config.Strings.ImageEmbed_PostNotImage;ws.widget.Dialogs.ok(d);a.parentNode.removeChild(a);this.constructEmbedImageForm();return}}if(""!=this.embedImageFileInput.value){a=this.embedImageFileInput.value;a=this.getFileName(a);d="AOLP."+(new Date).getTime()%1E6;try{this.insertEmbeddedImage(d,!0,a,"",!0)}catch(m){}this.embedImageFileInput.name=d;n.publish("InlineImageInserted");
this.autoSaveMessage(!0);this.constructEmbedImageForm()}},constructEmbedImageForm:function(){if(this.embedImageFileInput)this.embedImageFileInput.style.display="none";this.embedImageFileInput=n.create("input",{type:"file",className:"trueEmbedFileInput"},this.embedImageFormHolder);this.connect(this.embedImageFileInput,"onchange","onSelectFile")},replaceImgSrcsWithCID:function(){var a=this.getRichContent(),d=a,k=document.createElement("DIV");k.innerHTML=a;a=k.getElementsByTagName("img");for(k=0;k<a.length;k++)if(a[k].src.toLowerCase()==
this.phUrl.toLowerCase())var m=a[k].outerHTML.replace(a[k].src,"cid:"+a[k].id),m=m.replace(a[k].className,"AOLInlineImage"),d=d.replace(a[k].outerHTML,m);return d},insertEmbeddedImage:function(a,j,k,m,l){var h='<div class="envelope" align="left" style="float: none;"><img src="%{0}" width="'+Config.InsertedPictureLongestEdge+'" id="%{1}" style="%{2}" alt="%{3}" class="%{4}" title="%{3}"></div><div><span></span></div>';if(!this.editControl)this.editControl=new d({editor:this}),n.body().appendChild(this.editControl.domNode),
this.editControl.startup();this.imageIdMap[a]={id:a,placeholder:j,altText:k,srcUrl:m,smallUrl:m,mediumUrl:m,largeUrl:m};if(j)this.insertHTML(ws.string.substituteParams(h,this.phUrl,a,"margin: 5px; vertical-align: middle;",k,"wsPlaceholder"),!0,!0);else if((a=this.doc().getElementById(a))&&l)a.src=m,a.className="AOLInlineImage",a.style.border="";this.editControl.installEventHandlers(!0);this.callWhenReadyForSaveOrSend(this.sendReadyCallback)},handleFailedInlineImage:function(a){this.editControl&&(this.editControl.removeEventHandlers(a),
this.editControl.closeControls());var d=this.doc().getElementById(a);n.isWebKit?n.query('[id="'+a+'"]',this.doc()).orphan():d.parentNode.parentNode.removeChild(d.parentNode);delete this.imageIdMap[a];this.editControl.installEventHandlers(!0);this.callWhenReadyForSaveOrSend(this.sendReadyCallback)},insertImage:function(a){var j='<div class="envelope" align="left" style="float: none;"><img src="%{0}" width="'+Config.InsertedPictureLongestEdge+'" id="%{1}" style="%{2}" _viewlink="%{3}" class="%{4}" title="%{5}"></div><div><span></span></div>';
if(a.placeholder)a.id&&(this.imageIdMap[a.id]=a,a=ws.string.substituteParams(j,this.phUrl,a.id,"margin: 5px; vertical-align: middle; border: 1px solid #0066CC;","","wsPlaceholder","Your image is being uploaded"),this.insertHTML(a));else if(a.id){if(this.imageIdMap[a.id])this.imageIdMap[a.id]=a,(j=this.doc().getElementById(a.id))?a.mediumUrl?(j.src=a.mediumUrl,j.className="AOLInlineImage",j.setAttribute("_viewlink",a.largeUrl),j.setAttribute("title",ws.string.escapeXml(a.caption||"")),j.parentNode.href=
a.largeUrl?a.largeUrl:a.mediumUrl):(j.parentNode.parentNode.removeChild(j.parentNode),delete this.imageIdMap[a.id],j="Upload failed, please try again later",a.caption&&(j=ws.string.substituteParams("File size for {0} exceeds the allowed limit and will not be uploaded",a.caption)),ws.widget.Dialogs.ok(j)):delete this.imageIdMap[a.id]}else a.id="AOLP."+(new Date).getTime()%1E5,this.imageIdMap[a.id]=a,a=ws.string.substituteParams(j,a.mediumUrl,a.id,"margin: 5px; vertical-align: middle; border: 1px solid #0066CC;",
a.largeUrl,"AOLInlineImage",ws.string.escapeXml(a.caption||"")),this.insertHTML(a);if(!this.editControl)this.editControl=new d({editor:this}),n.body().appendChild(this.editControl.domNode),this.editControl.startup();this.editControl.installEventHandlers(!0)},isReadyForSend:function(){for(var a in this.imageIdMap)if(this.imageIdMap[a].placeholder&&this.doc().getElementById(a))return!1;return!0},callWhenReadyForSaveOrSend:function(a){if((this.sendReadyCallback=a)&&this.isReadyForSend())this.sendReadyCallback(),
this.sendReadyCallback=null},cancelCallWhenReadyForSaveOrSend:function(){this.sendReadyCallback=null},messageHasEmbeddedImages:function(){return 0<n.query('img[class="AOLInlineImage"]',this.win().document.body).length?!0:!1},refetchMissingImages:function(a){if(a)for(var d=0;d<a.length;++d){var k=a[d].replace(/^AOLP/,"TIE");if(k=this.doc().getElementById(k))k.removeAttribute("alt"),k.src=""}},prepareForSaveOrSend:function(a){if(a)for(var d in this.imageIdMap)if(0<=d.indexOf("AOLP")&&(a=this.doc().getElementById(d)))if(a.id=
a.id.replace(/^AOLP/,"TIE"),a.getAttribute("_viewlink")){var k=a.ownerDocument.createElement("a");k.setAttribute("target","_blank");k.href=a.getAttribute("_viewlink");k.appendChild(n.clone(a));a.parentNode.replaceChild(k,a)}},getFileName:function(a){return-1<a.indexOf("/")?a.substring(a.lastIndexOf("/")+1):a.substring(a.lastIndexOf("\\")+1)},notifyUploadCompletions:function(a){this.tornEditor=a},cleanUp:function(){this.editControl&&this.editControl.closeControls();this.sendReadyCallback=null},containsInlineImage:function(){for(var a=
this.doc().getElementsByTagName("img"),d=0;d<a.length;d++)if(a[d].id&&-1!=a[d].id.indexOf("AOLP")&&n.hasClass(a[d],"AOLInlineImage"))return!0;return!1},clean:function(){if(this.editControl)this.editControl.destroy(),this.editControl=null}})})},"url:ws/widget/WSEditor.css":"","ws/mail/ComposeMessageWidget":function(){require({cache:{"url:ws/mail/ComposeMessageWidget.html":'<div data-dojo-attach-event="onkeydown: onKeyPressInputField">\n\t<div data-dojo-type="dijit/layout/StackContainer" class="composeMessage" data-dojo-attach-point="stackWidget">\n\t\t<div data-dojo-type="dijit/layout/BorderContainer" data-dojo-attach-point="layoutWidget" id="composeLayout" class="composeLayout">\n\t\t\t<div data-dojo-type="ws/widget/WSToolbar" data-dojo-props="region:\'top\'" data-dojo-attach-point="toolbar" vizType="Controls">\n\t\t\t\t<\!-- the id on this button is for Oasis scripting --\>\n\t\t\t\t<div id="sendButton" data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick:sendMessage" data-dojo-attach-point="sendButton" tip="${ComposeSendButton}" iconClassName="sendIcon">${Button_Label_Send}</div>\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick:saveMessage" data-dojo-attach-point="saveDraftButton" title="${SaveDraftTip}" tip="${ComposeSaveAsDraftButton}" iconClassName="draftIcon">${Save}</div>\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick:spellCheck" data-dojo-attach-point="spellCheckButton" iconClassName="spellIcon">${ComposeSpellingButton}</div>\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick:deleteDraft" data-dojo-attach-point="deleteDraftButton" iconClassName="delIcon">${ComposeDeleteDraftButton}</div>\n\n                <div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick:cancel" data-dojo-attach-point="cancelButton" title="${Cancel}" iconClassName="cancelIcon" data-dojo-props="toolbarPosition: \'right\'"></div>\n                <div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick:onClickNewWindow" data-dojo-attach-point="newWindowLink" title="${NewWindowTip}" iconClassName="newWindowIcon" data-dojo-props="toolbarPosition: \'right\'">${NewWindow}</div>\n\t\t\t</div>\n\t\t\t\n\t\t\t<div data-dojo-type="ws/widget/Pane" data-dojo-props="region:\'top\'" class="header" data-dojo-attach-point="headerWidget">\n                <div style="padding-right: 0;" class="field">\n                    <div style="display:none" data-dojo-attach-point="fromAddressEditBoxDiv">\n                        <div data-dojo-type="ws/widget/DefaultTextbox" data-dojo-attach-point="fromAddressEditBox" data-dojo-attach-event="onKeyPress:processEditBoxKeyPress, onBlur:saveFriendlyName" style="width:20%;float:left;padding:5px;" tabindex="99"></div>\n                    </div>\n                    <div>\n                        <a href="#" class="fnameA" data-dojo-attach-event="onclick:fromAddressEdit" data-dojo-attach-point="fromAddressSpan" >${friendlyFromName}</a>\n                        <div data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="fromSelect" size="byValue"></div>\n                    </div>\n                    <div class="emailEntryLinks">\n                        <span data-dojo-attach-event="onclick:showCc" class="bccLink" data-dojo-attach-point="showCcLink"\n                              title="${ShowCcTip}">${Cc}</span>&nbsp;\n                        <span data-dojo-attach-event="onclick:showBcc" class="ccLink" data-dojo-attach-point="showBccLink"\n                              title="${ShowBccTip}">${Bcc}</span>\n                    </div>\n\t\t\t\t\t<div class="feedback" data-dojo-attach-point="feedbackNode"><span class="feedbackSpin" data-dojo-attach-point="feedbackSpin" data-dojo-attach-point="feedbackSpin"></span><span class="feedbackMsg" data-dojo-attach-point="feedbackMsg"></span></div>\n                   <span class="newWindowLink" data-dojo-attach-event="onclick:onClickNewWindow" data-dojo-attach-point="newWindowLink" title="${NewWindowTip}"></span>\n               </div>\n                <div ghostText="${To}" class="toField" data-dojo-type="ws/address/ComposeAddressField" data-dojo-attach-point="toField"\n                     lineHeight="14" data-dojo-props="tabindex: 100"></div>\n                <div ghostText="${Cc}" class="ccField" data-dojo-type="ws/address/ComposeAddressField" data-dojo-attach-point="ccField"\n                     lineHeight="14" style="display:none" data-dojo-props="tabindex: 101"></div>\n                <div ghostText="${Bcc}" class="bccField" data-dojo-type="ws/address/ComposeAddressField" data-dojo-attach-point="bccField"\n                     lineHeight="14" style="display:none" data-dojo-props="tabindex: 102"></div>\n                <div class="subjectContainer field wsInput">\n                    <div class="subjectLabel">${Subject}:</div>\n                    <div style="overflow: hidden;"><input class="subject" type="text" name="Subject" id="subjectField" data-dojo-attach-point="subjectInput" tabindex="103" /></div>\n                </div>\n                <div data-dojo-attach-point="attachmentRow" style="display:none; position: relative;">\n                    <div class="attachmentContainer">\n                        <span data-dojo-attach-point="attachmentDisplay"></span>\n                    </div>\n                </div>\n\t\t\t</div>\n\t\t\t<div data-dojo-type="ws/pictures/PictureEditor" id="editor" data-dojo-props="region:\'center\'" data-dojo-attach-point="editor" showAttachFile="true" data-dojo-props="tabindex: 104"></div>\n\t\t</div>\n\t</div>\n    <input data-dojo-attach-point="focusInput" type="text" style="position:absolute;width:0;height:0;border:none;outline:none;padding: 0;margin: 0;" />\n</div>\n',
"url:ws/mail/ComposeMessageWidget.css":""}});define("ws/mail/ComposeMessageWidget","dojo/_base/declare,dojo/text!ws/mail/ComposeMessageWidget.html,dojo/text!ws/mail/ComposeMessageWidget.css,dojo,dijit,dijit/_Widget,dijit/_TemplatedMixin,dijit/_WidgetsInTemplateMixin,ws/mail/SendConfirmationPage,ws/Spinner,ws/widget/Button,ws/address/AddressModel,ws/mail/MailModel,dijit/layout/BorderContainer,dijit/layout/StackContainer,ws/address/ComposeAddressField,ws/address/PeoplePicker,ws/widget/DefaultTextbox,ws/browser,ws/html,ws/io,ws/pictures/PictureEditor,ws/presence,ws/reporting,ws/settings,ws/string,ws/UserContext,ws/widget/Dialogs,ws/widget/Pane,ws/widget/util,ws/widget/WSSelect,ws/widget/WSToolbar".split(","),
function(q,n,j,a,d,g,p,k,m,l,h,r,o){return q([g,p,k],{templateString:n,css:{templateString:j},_earlyTemplatedStartup:!0,showNewWindowLink:!0,model:null,picturesModel:null,backToString:"setFolder",backToStringOverride:"",inTransition:!1,beaconSuffix:"",isStandAlone:!1,isPopup:!1,callBackTimeout:100,mk:1,nextCid:1,kidTeenAccount:"Y"==ws.UserContext.ParentalControls||"K"==ws.UserContext.ParentalControls,preventDomainlessAddressFix:!1,topContactSuggest:null,fromAddr:"",attachUploadDispId:0,attachUploadDispRefObjs:{},
attachUploadDispNodes:{},attachUploadFilenameMap:{},attachListDirty:!1,friendlyFromName:Settings.FromDisplayName,identity:null,reportingDLreqID:null,autoSaveDraftSubInterval:null,autoSaveIntervalCounter:0,autoSaveCharCount:0,deletedWhenSavingAttachIDs:{},deletedWhenSavingAttachNames:null,fileAttachSizeEncodeRatio:0.7285714174371669,startup:function(){this.DLreport=this.isPopup&&_ws_isOpenerWS()?opener.ws.reporting.DL:ws.reporting.DL;this.addressModel=new r;this.connect(this.editor,"picturesClick",
"picturesClick");this.connect(this.editor,"enableRichText","enableRichText");this.connect(this.editor,"positionAttachFileButton","positionAttachFileButton");this.connect(this.editor,"positionRichTextButton","positionRichTextButton");this.connect(this.editor,"onPerfectSpelling","onPerfectSpelling");this.connect(this.editor,"onImperfectSpelling","onImperfectSpelling");this.connect(this.editor,"onEndSpellCheck","onEndSpellCheck");this.connect(this.editor,"autoSaveMessage","autoSaveMessage");this.connect(this.editor,
"sendMessage","sendMessage");this.connect(this.editor,"cancel","cancel");this.connect(this.editor,"updateToolbar","updateToolbar");this.model instanceof o&&this.connect(this.model,"infoUpdated","infoUpdated");Config.EnableSaveAsDraft||this.saveDraftButton.hide();Config.EnableSpellCheck||this.spellCheckButton.hide();if(!this.showNewWindowLink||!ws.settings.allowPopups()||this.isPopup)this.newWindowLink.domNode.style.display="none";this.isPopup&&a.addClass(this.domNode,"composeMessagePopup");this.connect(this.toField,
"onResizedSelf","layoutSoon");this.connect(this.ccField,"onResizedSelf","layoutSoon");this.connect(this.bccField,"onResizedSelf","layoutSoon");this.connect(this.editor.toolbarPane,"onclick","layoutSoon");this.toField.field.id="toInputField";this.connect(a.global,"onresize","layoutSoon");Config.FixDomainlessAddresses&&0<Config.FixDomainlessAddresses.length&&(this.connect(this.toField,"onBlur",a.hitch(this,"fixDomainlessAddresses",this.toField)),this.connect(this.ccField,"onBlur",a.hitch(this,"fixDomainlessAddresses",
this.ccField)),this.connect(this.bccField,"onBlur",a.hitch(this,"fixDomainlessAddresses",this.bccField)),this.connect(this.toField.peoplePicker,"onOpen",function(){this.preventDomainlessAddressFix=!0}),this.connect(this.toField.peoplePicker,"onClose",function(){this.preventDomainlessAddressFix=!1}));this.editor.picturesModel=this.picturesModel;if(Config.EnableStationery&&2!=a.isFF&&!(Settings.UserHash<Config.UserHashThresholds.stationery))this.editor.initStationery(),this.isPopup||this.editor.createStationeryBtn(),
this.stationeryEnabled=!0;this.isStandAlone||ws.browser.addOnBeforeUnload(this,"onBeforeUnload");this.sendAttachAsLinks=!1;this.subscribe("AddressFieldFocusChange",function(c){this.onFocusAddressField=c});this.subscribe("WSEditor/focus","onEditorFocus");this.subscribe("Suite/onKeyOnPress","onKeyPress");this.subscribe("InlineImageRemoved","removedInlineImage");this.subscribe("InlineImageInserted","addedInlineImage");this.subscribe("friendlyNameUpdated","updateDisplayName");this.subscribe("stationery/select",
"selectStationery");this.subscribe("stationery/clear","clearStationery");var c=a.isMac?Config.Strings.CtrlReturnKey:Config.Strings.CtrlEnterKey;this.sendButton.setTip(Config.Strings.ComposeSendButton+" <span>("+c+")</span>");a.attr(this.sendButton,"title",Config.Strings.ComposeSendButton+" ("+c+")");c=a.isMac?Config.Strings.OptKey:Config.Strings.AltKey;this.spellCheckButton.setTip(Config.Strings.CheckSpelling+" <span>("+c+" =)</span>");a.attr(this.spellCheckButton,"title",Config.Strings.CheckSpelling+
" ("+c+" =)");a.attr(this.toField,"title",Config.Strings.SelectToRecipients+" ("+c+" [)");a.attr(this.ccField,"title",Config.Strings.SelectCcRecipients+" ("+c+" ])");a.attr(this.bccField,"title",Config.Strings.SelectBccRecipients+" ("+c+" \\)");ws.lang.setTimeout(this,function(){this.editor.resizeToolBar()},1);(this.isPopup||this.isStandAlone)&&a.addClass(this.domNode,"popupWin");this.model&&this.model.idleMonitor?this.idleMonitorStarted():a.subscribe("IdleMonitor/started",this,"idleMonitorStarted")},
setAddressFieldValue:function(c,a){a?c.setValue(a.replace("@unknown.domain",""),null,!0):c.setValue("")},selectStationery:function(c,a,e,d){this.editor.insertStationery({url:a,name:c.label,swatchUrl:d,id:c.id})},clearStationery:function(){this.editor.insertStationery({url:"",name:"",swatchUrl:""})},picturesClick:function(){},openAttachFileDialog:function(){},enableRichText:function(){var c=this.draftMessage&&this.draftMessage.uid;c&&this.model.composeSettingsChanged();if(c||this.isResponse||this.isDirty())this.checkForAttachments(a.hitch(this,
function(){var c={to:this.toField.getValue(),cc:this.ccField.getValue(),bcc:this.bccField.getValue(),subject:this.subjectInput.value,originalMessage:this.originalMessage,draftMessage:this.draftMessage,composeType:this.composeType,preloadAttachments:this.preloadAttachments,sourceAttachments:this.sourceAttachments,isDirty:this.isDirty()},a=this.editor.getContent();c.body=a.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>").replace(/\r/g,"<br>");c.bodyIsCurrentMsg=!0;this._enableRichText(c,null)}));else{var c=
{},f=this.editor.getContent();null!=f&&(c={to:this.toField.getValue(),subject:this.subjectInput.value,body:f.replace(/\r\n/g,"<br>").replace(/\n/g,"<br>").replace(/\r/g,"<br>"),bodyIsCurrentMsg:!0});this._enableRichText(c,null)}},_enableRichText:function(c,f){var e=c||{};e.skipComposeBeacon=!0;ws.settings.save({UseRichEditor:!0},{load:a.hitch(this,function(){Settings.UseRichEditor=!0;this.reset(e,f);ws.lang.setTimeout(this,function(){this.editor.resizeToolBar(!0)},1)}),error:function(c){window.ws_ErrLgr&&
!c&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for settings.save-_enableRichText file:ComposeMessageWidget.js");ws.widget.Dialogs.ok(c||Config.Strings.Settings_SaveError)}})},handleAttachDialogCancel:function(){},handleAttachDialogDone:function(){},createBaseAttachUploadForm:function(){9>a.isIE?this.form=document.createElement("<form method='post' enctype='multipart/form-data'>"):(this.form=document.createElement("form"),this.form.method="post",this.form.enctype=
"multipart/form-data");a.addClass(this.form,"fileIputForm");this.editor.composeForm=this.form},undo:function(){},onHide:function(){this.cleanupAttachments();this.editor.clean();if(this.autoSaveDraftSubInterval)clearInterval(this.autoSaveDraftSubInterval),this.autoSaveDraftSubInterval=null},cleanupAttachments:function(){for(var c=[],a=0;a<this.preloadAttachments.length;a++)c.push(this.preloadAttachments[a].id);0<c.length&&this.model.deleteAttachments(c)},moveUploadForm:function(){},setModel:function(c){this.model=
c},setPicturesModel:function(c){this.picturesModel=c;this.editor.setPicturesModel(c)},showHideField:function(c,a){var e=this[c.toLowerCase()+"Field"],d=this["show"+c+"Link"];ws.html.setShowing(e.domNode,a);ws.html.setShowing(d,!a);a&&e.focus();this.layoutSoon()},showCc:function(){this.showHideField("Cc",!0);this.showCcLink.style.display="none"},showBcc:function(){this.showHideField("Bcc",!0);this.showBccLink.style.display="none"},layoutSoon:function(){ws.lang.defer(this,"layout",0,this.id+"Layout")},
layout:function(){this.layoutWidget&&this.layoutWidget.resize()},onKeyPressInputField:function(c){if(65<=c.keyCode&&90>=c.keyCode)c.keyChar=String.fromCharCode(c.keyCode);this.handleKey(c)},onKeyPress:function(c){this.isShowing()&&this.handleKey(c)},handleKey:function(c){var f=!1,c=ws.html.fixKeyForMac(c);if(Config.EnableKeyboardShortcuts&&c.altKey&&c.keyChar)switch(c.keyChar.toLowerCase()){case Config.Strings.KeyComposeClose:c.preventDefault(),c.stopPropagation(),ws.lang.setTimeout(this,"cancel",
150),f=!0}else if(Config.EnableKeyboardShortcuts&&c.ctrlKey)switch(ws.html.fixKeyCodeForMac(c)){case a.keys.ENTER:this.sendMessage(),f=!0}else if(Config.EnableKeyboardShortcuts&&c.altKey)if(219==c.keyCode)ws.lang.setTimeout(this.toField,"togglePeoplePicker",100),f=!0;else if(221==c.keyCode)this.showCc(),ws.lang.setTimeout(this.ccField,"togglePeoplePicker",100),f=!0;else if(220==c.keyCode)this.showBcc(),ws.lang.setTimeout(this.bccField,"togglePeoplePicker",100),f=!0;else if(187==c.keyCode||61==c.keyCode&&
a.isMoz||107==c.keyCode&&5<=a.isMoz)this.spellCheck(),f=!0;f&&a.stopEvent(c)},onResized:function(){this.positionRichTextButton();this.inherited(arguments)},onEditorFocus:function(){this.onFocusAddressField=null},addEmail:function(c,a){if(!this.onFocusAddressField)this.onFocusAddressField=this.toField;var e=this.onFocusAddressField;if(a)if("to"==a)e=this.toField;else if("cc"==a)e=this.ccField,this.showCc();else if("bcc"==a)e=this.bccField,this.showBcc();var d=e.getValue(c),d=d.replace(/^\s+/,""),d=
(d=d.replace(/\s+$/,""))?";"==d.charAt(d.length-1)||","==d.charAt(d.length-1)?d+(" "+c+","):d+(", "+c+","):c+",";e.focus();e.setValue(d)},isSendConfirmationOnShow:function(){var c=!1;if(this.sendConfirmation){var f=this.stackWidget.getChildren();-1!=a.indexOf(f,this.sendConfirmation)&&(c=!0)}return c},reset:function(c,f){this.domNode.style.display="block";if(this.sendConfirmation){var e=this.stackWidget.getChildren();-1!=a.indexOf(e,this.sendConfirmation)&&this.stackWidget.removeChild(this.sendConfirmation);
this.stackWidget.resize()}this.layoutWidget!=this.stackWidget.selectedChildWidget&&this.stackWidget.selectChild(this.layoutWidget);c=c||{};e="";this.model.sendAddresses&&this.model.sendAddresses.length&&(e=this.model.sendAddresses[0][1]);ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr=c.from||ws.WebSuite.cmpseMsgWidPersist.lastSelFromAddr||e;this.setupFromAddress();if(c.to&&0==c.to.indexOf("mailto:")&&(e=c.to.substr(7,c.to.length),e=e.split("?"),e.length&&(c.to=e[0],e[1])))for(var e=e[1].split("&"),
d=0;e&&d<e.length;d++){var h=e[d].split("=");if(h&&h[0]&&h[1]){if("cc"==h[0].toLowerCase())c.cc=decodeURIComponent(h[1]);if("bcc"==h[0].toLowerCase())c.bcc=decodeURIComponent(h[1]);if("subject"==h[0].toLowerCase())c.subject=decodeURIComponent(h[1]);if("body"==h[0].toLowerCase())c.body=decodeURIComponent(h[1])}}if(this.isStandAlone&&!c.composeType&&!c.cid){if(c.subject)c.subject=ws.string.sanitize(c.subject);if(c.body)c.body=ws.string.sanitize(c.body)}this.showHideField("Cc",!!c.cc);this.showHideField("Bcc",
!!c.bcc);this.setAddressFieldValue(this.toField,c.to);this.setAddressFieldValue(this.ccField,c.cc);this.setAddressFieldValue(this.bccField,c.bcc);this.subjectInput.value=c.subject||"";this.draftMessage=ws.lang.shallowCopy(c.draftMessage||{},!0);this.originalMessage=ws.lang.shallowCopy(c.originalMessage||{},!0);this.composeType=c.composeType||"";this.initAttachments(c.preloadAttachments,c.sourceAttachments,!0);this.missingAttachmentWarningShown=!1;this.editor.isStationeryMode=!!c.isStationeryMode;
this.editor.stationeryState=c.stationeryState;this.resetStationery();this.stationeryEnabled&&ws.bubbleConfig.showPinBubble("Stationery",this.editor.stationaryItem,!0);this.showFeedback();this.sendAttachAsLinks=this.spellCheckFailure=this.sendAfterSpellCheck=!1;this.topContactSuggest=this.lastSavedMsgUID=this.inSaveOrSend=null;this.editor.endSpellCheck();this.forceReadSavedMsg=this.autoSaveMsgInProgress=!1;this.toggleButtonState(!0);this.layoutSoon();var m=this.beaconSuffix;if(!this.isPopup&&c.beaconSuffix)m=
c.beaconSuffix;e=c.dontAddSignature;this.model.standAloneMailModel&&(e=!0);this.initBody(c.body,c.quote,e,c.isPopOut,c.bodyIsCurrentMsg,a.hitch(this,function(){3.6<=a.isFF&&(this.editor.htmlModeClick(),this.editor.htmlModeClick());f&&f();c.skipComposeBeacon||ws.reporting.report("Compose Message - "+m,"Mail");this.editor.isStationeryMode?this.editor.fixEditorForStationery():this.editor.resetStationeryState();this.editor.reset(null,c.body);this.focusField();this.editor.convertPicturesInMail();this.editor.editControl&&
this.editor.editControl.installEventHandlers(!0);c.isDirty?this.setDirty():this.resetDirty();this.attachListDirty=!1}));if(c.backToString&&this.model)this.backToButtonString="setFolder"==c.backToString?ws.string.substituteParams(Config.Strings.BackToFolder,ws.string.summary(this.model.getCurrentFolder().displayName,17)):c.backToString;c.isPopOut&&a.addOnUnload(this,"cleanupAttachments");!this.isPopup&&!this.isStandAlone&&ws.WebSuite.Navigation.updateNavCollapser(!0);if(Settings.UserHash>=Config.AutoSaveToDraftsThreshold&&
Settings.EnableAutoSave&&(e=Config.AutoSaveToDraftsInterval,null!=e&&-1!=e))this.autoSaveMsgInProgress=!1,this.autoSaveIntervalCounter=0,this.autoSaveDraftSubInterval&&clearInterval(this.autoSaveDraftSubInterval),this.autoSaveDraftSubInterval=setInterval(a.hitch(this,"autoSaveMessage"),1E3*Config.AutoSaveToDraftsSubInterval),this.lastSaved=null;ws.lang.setTimeout(this,function(){this.editor.resizeToolBar()},1)},resetStationery:function(){ws.WebSuite.SidePanel&&(ws.WebSuite.SidePanel.resetStationery(),
ws.WebSuite.SidePanel.handleMainStackSelect());this.editor.resetStationeryState();this.editor.fixEditorForStationery()},infoUpdated:function(){if(this.model.standAloneMailModel){if(this.model.sendAddresses&&this.model.sendAddresses.length)ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr=this.model.sendAddresses[0][1];this.setupFromAddress();this.model.getSignature()&&(this.setBodyContent(this.editor.getContent()),this.resetDirty())}},getSigHTML:function(c){return"<div style='clear:both'>"+c+"</div>"},
setBodyContent:function(c,f,e,d,h,m){var l=this.editor.useRichMode(),k=a.isMac?"helvetica,arial":"arial,helvetica";c&&l&&(c="<div style='font-family:"+k+";font-size:10pt;color:black'>"+c+"</div>");var c=c||"",g=0==this.composeType.indexOf("reply")||"forward"==this.composeType;this.isResponse=g;var j=l?this.model.getSignature(!0):this.model.getSignature(!1);(e=j&&!e)&&l&&(j=this.getSigHTML(j));var o=this.editor.getBlankLine();f&&l&&(f="<div style='font-family:"+k+";font-size:10pt;color:black'>"+f+
"</div>");f=f?o+f:"";k=e?j:"";!d&&!h&&(g&&e?c=f+o+o+k+o+o+c:g?c=f+o+o+o+c:e?(f&&(f=f+o+o),c=f+c+o+o+k):f&&(c=f));f=!1;this.draftMessage.isDraft&&!l&&(f=!0);this.editor.setContent(c,m,d,f,null,!!this.draftMessage.isDraft)},initBody:function(c,a,e,d,h,m){this.setBodyContent(c,a,e,d,h,m);Settings.ShowCcField&&this.showCc();Settings.ShowBccField&&this.showBcc();this.focusField()},updateToolbar:function(c,a,e){e||a&&this.focusField()},focusField:function(){window.focus();this.toField.getValue()?this.subjectInput.value?
this.editor.focus():this.subjectInput.focus():this.toField.focus()},saveFriendlyName:function(){if("none"!=this.fromAddressEditBoxDiv.style.display)this.model.saveDisplayName(ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr,this.fromAddressEditBox.getValue()),this.fromAddressEditBoxDiv.style.display="none",this.setupFromAddress()},cancelFriendlyEdit:function(){if("none"!=this.fromAddressEditBoxDiv.style.display)this.fromAddressEditBoxDiv.style.display="none",this.setupFromAddress()},updateDisplayName:function(){this.setupFromAddress()},
processEditBoxKeyPress:function(c){switch(c.keyCode){case a.keys.ENTER:this.saveFriendlyName();break;case a.keys.ESCAPE:this.cancelFriendlyEdit()}},fromAddressEdit:function(){if(Config.FriendlyNameInCompose)this.fromAddressSpan.style.display="none",this.fromAddressSpan.innerHTML="",this.fromAddressEditBoxDiv.style.display="",this.fromAddressEditBox.setValue(this.getFromDisplay(this.fromSelect.currentValue)),this.fromAddressEditBox.textbox.focus(),ws.html.selectInputText(this.fromAddressEditBox.textbox),
this.fromAddressEditBox.textbox.style.color="#000"},setupFromAddress:function(){for(var c=this.model.sendAddresses,a=[],e=0,d=0;d<c.length;d++){ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr&&-1!=ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr.indexOf(c[d][1])&&(e=d);var h=ws.string.escapeXml(c[d][1]),h="";Config.FriendlyNameInCompose&&(h="<span class='fromA'>"+ws.string.escapeXml(this.getFromDisplay(c[d][1]))+"</span>");h=h+"<span class='fromB'>"+ws.string.escapeXml(c[d][1])+"</span>";a.push({display:h,
value:c[d][1],selected:!1})}if(a.length)a[e].selected=!0;this.fromSelect.setOptions(a);if(Config.FriendlyNameInCompose){this.fromAddressSpan.style.display="";c=this.getFromDisplay(c[e][1]);if(!c)c=Config.Strings.AddName;this.fromAddressSpan.innerHTML=ws.string.escapeXml(c)}else this.fromAddressSpan.style.display="none",this.fromAddressSpan.innerHTML="";if(this.fromSelect.currentValue)this.fromSelect.currentValueNode.innerHTML=ws.string.escapeXml(this.fromSelect.currentValue);this.fromSelect.sizeMyself();
this.connect(this.fromSelect,"valueChanged","handleChange")},handleChange:function(){ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr=this.fromSelect.currentValue;ws.WebSuite.cmpseMsgWidPersist.lastSelFromAddr=this.fromSelect.currentValue;var c=this.getFromDisplay(ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr);if(!c)c=Config.Strings.AddName;this.fromAddressSpan.innerHTML=ws.string.escapeXml(c);this.fromSelect.currentValueNode.innerHTML=ws.string.escapeXml(ws.WebSuite.cmpseMsgWidPersist.selectedFromAddr);
this.fromSelect.sizeMyself()},getFromDisplay:function(c){var a=null,e=this.model.getIdentities();if(c)for(var d=0;d<e.length;d++)-1!=c.indexOf(e[d][1])&&(a=e[d]);return a?a[2]:Settings.FromDisplayName},confirmClose:function(c){this.abortSend();a.isIE&&(a.doc.body.focus(),this.focusInput.focus());this.inTransition?ws.widget.Dialogs.show(Config.Strings.MessageNotSent+"<br>"+Config.Strings.MsgNotSentNavigateAway,[Config.Strings.Yes,Config.Strings.No],a.hitch(this,function(a){if(0==a&&c)this.DLreport.removeEvent(this.reportingDLreqID),
this.reportingDLreqID=null,ws.lang.setTimeout(c,this.callBackTimeout)})):this.isDirty()?Config.EnableSaveAsDraft?ws.widget.Dialogs.show("<b>"+Config.Strings.DirtyMessageSent+"</b><br>"+Config.Strings.DirtyMessage5+"<br><br>",[Config.Strings.SaveAsDraft,Config.Strings.KeepWriting,Config.Strings.Discard],a.hitch(this,function(f){0==f?(this.isPopup&&c?a.subscribe("WSDoneSyncingAfterSave",a.hitch(this,function(){ws.lang.setTimeout(c,this.callBackTimeout)})):c&&ws.lang.setTimeout(c,this.callBackTimeout),
this.saveMessage()):2==f&&c&&ws.lang.setTimeout(c,this.callBackTimeout)}),{width:390}):!this.isStandAlone&&this.showNewWindowLink&&ws.settings.allowPopups()?ws.widget.Dialogs.show(Config.Strings.DirtyMessageSent+"<br><br>"+Config.Strings.DirtyMessage2,[Config.Strings.Yes,Config.Strings.KeepWriting,Config.Strings.No],a.hitch(this,function(a){0==a?this.popOut():2==a&&c&&ws.lang.setTimeout(c,this.callBackTimeout)})):ws.widget.Dialogs.okCancel(Config.Strings.DirtyMessageSent+"<br><br>"+Config.Strings.DirtyMessage3,
a.hitch(this,function(a){a&&c&&ws.lang.setTimeout(c,this.callBackTimeout)})):c&&ws.lang.setTimeout(c,this.callBackTimeout)},onSessionExpired:function(c){this.isDirty()?ws.widget.Dialogs.yesNo(Config.Strings.AuthTimeoutMain+"<br><br>"+Config.Strings.DirtyMessage2,a.hitch(this,function(a){a?(this.resetDirty(),this.popOut(!0,c,!0)):(this.resetDirty(),c&&c())})):c&&c()},onBeforeUnload:function(){return this.isShowing()&&this.isDirty()?Config.EnableSaveAsDraft?Config.Strings.DirtyMessageSaveOrSent:Config.Strings.DirtyMessageSent:
null},isDirty:function(){return this.getCurrentStateHash().contentVal!=this.initialStateHash||this.editor.isAuxDirty()||this.attachListDirty},isSubIntervalDirty:function(){return Math.abs(this.getCurrentStateHash().bodyLength-this.autoSaveCharCount)>=Config.AutoSaveToDraftsCharDelta},setDirty:function(){this.autoSaveCharCount=-Config.AutoSaveToDraftsCharDelta;this.initialStateHash=this.getCurrentStateHash().contentVal+"x"},resetDirty:function(){this.editor.setAuxDirty(!1);var c=this.getCurrentStateHash();
this.initialStateHash=c.contentVal;this.autoSaveCharCount=c.bodyLength;this.autoSaveIntervalCounter=0},getCurrentStateHash:function(){var c=!1;if(a.isWebKit||a.isFF)c=!0;var c=this.editor.getPlainContent(c),f=c.length;return{contentVal:this.toField.getValue()+this.ccField.getValue()+this.bccField.getValue()+this.subjectInput.value+c+this.getAttachmentsHash(),bodyLength:f}},getAttachmentsHash:function(){var c="",a=null;if(this.sourceAttachments)for(i=0;i<this.sourceAttachments.length;i++)(a=this.addRefObj(this.sourceAttachments[i]))&&
(c+=a.key);if(this.filledFileInputs)for(i=0;i<this.filledFileInputs.length;i++)(a=this.addRefObj(this.filledFileInputs[i]))&&(c+=a.key);return c},getConcatenatedAddressDisplayForm:function(c){for(var a="",e=0;e<c.length;e++)a+=c[e].userInputForm,e<c.length-1&&(a+="; ");return a},openDraft:function(c,f){this.model.getMessage({folder:c,uid:f,load:a.hitch(this,function(c){var f=this.getConcatenatedAddressDisplayForm(c.to),d=this.getConcatenatedAddressDisplayForm(c.cc),h=this.getConcatenatedAddressDisplayForm(c.bcc);
this.reset({dontAddSignature:!0,draftMessage:c,composeType:"draft",to:f,cc:d,bcc:h,subject:c.subject,body:c.body,backToString:this.backToString,from:c.inputFrom},a.hitch(this,function(){this.editor.handleFeaturesDraft();this.resetDirty()}))})})},syncAftersave:function(c){this.forceReadSavedMsg=!1;this.composeType="draft";this.draftMessage=ws.lang.shallowCopy(c||{},!0);this.originalMessage={};this.initAttachments(null,null,!1);this.editor.updateImageUrlsAfterSave(c.inlines,c.savedMsgUID);this.editor.cleanUpFormAfterSave(c.inlines,
!1);this.editor.handleFeaturesDraft();this.resetDirty();a.publish("WSDoneSyncingAfterSave")},deleteDraft:function(){this.draftMessage&&this.draftMessage.uid?this.confirmClose(a.hitch(this,function(){this.model.deleteMessages({folder:Config.DraftsFolderName,uids:[this.draftMessage.uid],reason:"deldrft",load:a.hitch(this,function(){this.cancel()}),error:a.hitch(this,function(c){window.ws_ErrLgr&&!c&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.deleteMessages-deleteDraft file:ComposeMessageWidget.js");
ws.widget.Dialogs.ok(c||Config.Strings.ErrorDeletingDraft);this.cancel()})});this.resetDirty()}),"draftDeleted"):this.cancel()},deleteAutoSaveDraft:function(){this.model.deleteMessages({folder:Config.DraftsFolderName,uids:[this.draftMessage.uid],reason:"deldrft",error:function(){}});this.resetDirty()},toggleButtonState:function(c){this.sendButton.setEnabled(c);this.spellCheckButton.setEnabled(c);this.saveDraftButton.setEnabled(c);this.deleteDraftButton.setEnabled(c);this.cancelButton.setEnabled(c);
this.newWindowLink.setEnabled(c)},sendMessage:function(){this._sendMessage()||this.toggleButtonState(!0)},_sendMessage:function(){this.toggleButtonState(!1);Config.FixDomainlessAddresses&&0<Config.FixDomainlessAddresses.length&&this.fixDomainlessAddresses();if(Config.ValidateEmailFormat&&this.checkEmailFields()||this.showBccParenWarning()||this.showMissingAttachmentWarning())return!1;if(!this.sendAfterSpellCheck&&Settings.SpellCheckBeforeSend&&Config.EnableSpellCheck)return this.editor.endSpellCheck(),
this.sendAfterSpellCheck=!0,this.editor.spellCheck(!0),!1;this.spellCheckFailure=!1;if(this.editor.processBeforeSend())return!1;if(this.editor.isReadyForSend())return this.continueSending(!1);a.publish("WSFeedbackStart",[Config.Strings.ImageEmbed_UploadThenSend,!1,a.hitch(this,"abortSend"),null,Config.Strings.ImageEmbed_StopSend]);this.editor.callWhenReadyForSaveOrSend(a.hitch(this,"continueSending",!0));return!0},abortSend:function(){this.editor.cancelCallWhenReadyForSaveOrSend();this.toggleButtonState(!0)},
continueSending:function(c){c&&a.publish("WSFeedbackEnd",[Config.Strings.ImageEmbed_UploadThenSend]);a.publish("WSFeedbackStart",[Config.Strings.SendingProgress]);this.inTransition=!0;this.reportingDLreqID=this.DLreport.startEvent(0<this.filledFileInputs.length?this.isPopup?"send_pop_att":"send_mail_att":this.isPopup?"send_pop":"send_mail");this.DLreport.setData(this.reportingDLreqID,{msgSize:this.editor.getPlainContent().length,op1:this.isPopup?"popup":"inline"});var f=a.hitch(this,function(c,f,
e){this.model.trackdl("-CMW.CSb",this.reportingDLreqID);f="fail";if(e&&("550:13045"==e||"500:13052"==e||e==Config.Strings.ErrorSendingAttachTooLarge2||e==Config.Strings.ErrorSendingAttachTooLarge))f="userErr";if(c&&(c==Config.Strings.ErrorSendingAttachTooLarge2||c==Config.Strings.ErrorSendingAttachTooLarge||c==Config.Strings.ErrorNoValidRecipient))f="userErr";this.model.trackdl("-CMW.CSc",this.reportingDLreqID);this.DLreport.endEvent(this.reportingDLreqID,{opResult:f,errType:"api",errCode:e||c});
ws.widget.Dialogs.ok(c||Config.Strings.ErrorSending);a.publish("WSFeedbackEnd",[Config.Strings.SendingProgress]);this.toggleButtonState(!0);this.inTransition=!1;this.inSaveOrSend=null;this.editor.cleanUp()}),e="unknown",d="api",h="fail";this.model.trackdl("-CMW.CSa",this.reportingDLreqID);this.saveOrSendMessage({action:"sendMessage",load:a.hitch(this,function(c){this.model.trackdl("-CMW.CSe",this.reportingDLreqID);var m=!1;if(c&&c.CaptchaRefId)this.model.trackdl("-CMW.CSeXC",this.reportingDLreqID),
require(["ws/suite/CaptchaDialog"],a.hitch(this,function(f){var e=a.hitch(this,function(){if(c.simulate)this.subjectInput.value=this.subjectInput.value.substr(0,32);this.sendMessage()});(new f({refId:c.CaptchaRefId,passedCB:e})).startup(c.CaptchaRefId)})),a.publish("WSFeedbackEnd",[Config.Strings.SendingProgress]),this.toggleButtonState(!0),this.inTransition=!1,this.inSaveOrSend=null,this.editor.cleanUp();else{if(c.attachmentFailure)this.model.trackdl("-CMW.CSeA",this.reportingDLreqID),m=!0,this.handleFailedAttachment(c,
"_sendMessage"),e="attachmentFailure",d="app";else{if(c.attachTooLarge){this.model.trackdl("-CMW.CSeB",this.reportingDLreqID);m=!0;f(c.errorMsg);e="attachmentTooLarge";d="app";h="userErr";return}if(c.missingImages)this.model.trackdl("-CMW.CSeC",this.reportingDLreqID),m=!0,this.handleMissingTmpImages(c),e="missingImages",d="app";else{this.model.trackdl("-CMW.CSeD",this.reportingDLreqID);if(this.stationeryEnabled){var l=this.editor.stationeryState;if(l&&l.id&&l.name){this.model.trackdl("-CMW.CSeE",
this.reportingDLreqID);ws.reporting.reportDLAction("Mail-Stationery-MailSent-"+l.id);if("unknown"!=typeof Settings.StationeryDefaults&&"unknown"!=typeof Settings.StationeryDefaults.id&&(Settings.StationeryDefaults.id!=l.id||Settings.StationeryDefaults.name!=l.name))Settings.StationeryDefaults={id:l.id,name:l.name,swatchUrl:l.swatchUrl},ws.settings.saveNow({StationeryDefaults:Settings.StationeryDefaults});this.editor.resetStationeryState()}}if(this.autoSaveDraftSubInterval)clearInterval(this.autoSaveDraftSubInterval),
this.autoSaveDraftSubInterval=null;!m&&this.editor.messageHasEmbeddedImages()&&ws.reporting.reportDLAction("Mail-Sent-ImageEmbedded");if(c.topContactSuggest)this.topContactSuggest=c.topContactSuggest;Settings.AutoAddOnSend&&this.checkForNewlyAdded();var k=l=!1,g=ws.io.getQueryParameter("noSendConf");g&&"1"===g&&this.isStandAlone?(this.model.trackdl("-CMW.CSeF",this.reportingDLreqID),l=!0):("all"==Config.EnableShowSendConfPageSetting||"premium"==Config.EnableShowSendConfPageSetting&&"1"==Settings.IsPaying)&&
!Settings.ShowSendConfPage?(this.model.trackdl("-CMW.CSeG",this.reportingDLreqID),k=!0):(this.model.trackdl("-CMW.CSeH",this.reportingDLreqID),this.setupSendConfirmation(),a.isMac&&3==a.isFF&&(this.stackWidget.selectChild(this.layoutWidget),this.stackWidget.selectChild(this.sendConfirmation)),!this.isPopup&&!this.isStandAlone&&ws.WebSuite.Navigation.updateNavCollapser(!1))}}a.publish("WSFeedbackEnd",[Config.Strings.SendingProgress]);this.model.trackdl("-CMW.CSeJ",this.reportingDLreqID);this.toggleButtonState(!0);
this.inTransition=!1;m?(this.model.trackdl("-CMW.CSg",this.reportingDLreqID),this.DLreport.endEvent(this.reportingDLreqID,{opResult:h,errType:d,errCode:e})):(c.isForward&&this.model.forwardMessages({uids:[c.forwardUid]}),this.resetDirty(),this.onShowSendConfirmation(),this.model.trackdl("-CMW.CSf",this.reportingDLreqID),this.DLreport.endEvent(this.reportingDLreqID,{opResult:"success"}));this.inSaveOrSend=null;this.editor.cleanUp();if(l){ws.reporting.reportDLAction("Mail-PopOutSent-SCoff");try{window.close()}catch(j){}}else k&&
(ws.reporting.reportDLAction("Mail-Sent-SendConfOff"),this.isPopup&&_ws_isOpenerWS()?window.opener.ws&&window.opener.ws.WebSuite&&window.opener.ws.WebSuite.msgSentFeedbackFromPopout&&window.opener.ws.WebSuite.msgSentFeedbackFromPopout():a.publish("WSFeedbackStart",[Config.Strings.ComposeSentTitle,!0]),this.isResponse&&"display"==ws.WebSuite.composeSrc?this.closeAfterSuccess(!0):this.closeAfterSuccess())}}),error:f});this.model.trackdl("-CMW.CSz",this.reportingDLreqID);return!0},checkForNewlyAdded:function(){var c=
null,a=this.addressListToArray(this.toField),e=this.addressListToArray(this.ccField),d=this.addressListToArray(this.bccField),a=a.concat(e,d);if(!this.addressModel)this.addressModel=new r;for(e=0;e<a.length&&!((c=this.addressModel.getRecordByEmail(a[e]))||(c=this.addressModel.getRecordByScreenName(a[e])),!c);e++);c||ws.lang.setTimeout(this,function(){this.addressModel.core.loadData()},5E3)},addressListToArray:function(c){f=[];if(c.getValue())for(var f=c.getValue().split(/[\s,;]/),c=0;c<f.length;c++)a.trim(f[c])||
f.splice(c--,1);return f},handleFailedAttachment:function(c,a){var e=!1,d="";if(c.bgAttach)for(var h=0;h<this.preloadAttachments.length;h++)if(this.preloadAttachments[h].id==c.bgAttach)e=!0,d=this.preloadAttachments[h].name,this.preloadAttachments.splice(h,1);e?(e=ws.string.substituteParams(Config.Strings.AttachFailure,d),this.updateAttachmentRow()):e=Config.Strings.ErrorSending;null!=a&&ws.widget.Dialogs.ok(e)},handleMissingTmpImages:function(c){c.missingImages&&this.editor.refetchMissingImages(c.missingImages);
c.errorMsg&&ws.widget.Dialogs.ok(c.errorMsg)},onShowSendConfirmation:function(){},draftHasAttachmentsOrInlines:function(){if(this.draftMessage){var c=!this.draftMessage.uid&&this.originalMessage.uid?this.originalMessage:this.draftMessage;return c.hasAttachments||c.hasInlines||c.hasImages||c.inlineImgIds&&0<c.inlineImgIds.length}return!1},saveMessage:function(){this.toggleButtonState(!1);Config.FixDomainlessAddresses&&0<Config.FixDomainlessAddresses.length&&this.fixDomainlessAddresses();a.publish("WSFeedbackStart",
[Config.Strings.SavingProgress]);this.showFeedback();var c=a.hitch(this,function(c){ws.widget.Dialogs.ok(c||Config.Strings.ErrorSaving);this.toggleButtonState(!0);this.inSaveOrSend=null});this.saveOrSendMessage({action:"saveMessage",load:a.hitch(this,function(f){var e=!1;if(f.attachmentFailure)e=!0,this.handleFailedAttachment(f,"saveMessage");else{if(f.attachTooLarge){c(f.errorMsg);return}f.missingImages&&(e=!0,this.handleMissingTmpImages(f))}this.editor&&(this.forceReadSavedMsg||this.draftHasAttachmentsOrInlines())&&
this.syncAftersave(f);if(f.savedMsgUID)this.draftMessage.uid=this.lastSavedMsgUID=f.savedMsgUID;a.publish("WSFeedbackEnd",[Config.Strings.SavingProgress]);e||a.publish("WSFeedbackStart",[Config.Strings.MessageSaved,!0]);this.sendButton&&this.toggleButtonState(!0);e||this.editor&&this.resetDirty();this.toolbar&&this.toolbar.layout();this.inSaveOrSend=null}),error:c})},autoSaveMessage:function(c){if(!(!0==this.autoSaveMsgInProgress||null!=this.inSaveOrSend||this.editor.isSpellCheckRunning()||0<this.preloadAttachments.length&&
this.hasInflightAttachments())){if(!c)if(this.autoSaveIntervalCounter+=Config.AutoSaveToDraftsSubInterval,this.autoSaveIntervalCounter>=Config.AutoSaveToDraftsInterval){if(this.autoSaveIntervalCounter=0,!this.isDirty())return}else if(!this.isSubIntervalDirty())return;this.toggleButtonState(!1);this.autoSaveMsgInProgress=!0;this.showFeedback(Config.Strings.SavingProgress,!0);var f=a.hitch(this,function(a,f,d){if(c)this.editor.cleanUpFormAfterSave(null,!0,a,d),this.autoSaveMsgInProgress=!1;null!=this.lastSavedMsgUID&&
this.deleteAutoSaveDraft();this.toggleButtonState(!0);this.showFeedback()});this.doAutoSaveMessage({action:"saveMessage",isInlineAutoSave:c,load:a.hitch(this,function(c){var a=this.autoSaveMsgInProgress=!1;if(c.attachmentFailure||c.attachTooLarge)f(c.error,!1,c.errCode);else{c.missingImages&&(a=!0,this.handleMissingTmpImages(c));if(c.savedMsgUID)this.draftMessage.uid=this.lastSavedMsgUID=c.savedMsgUID;this.editor&&(this.forceReadSavedMsg||this.draftHasAttachmentsOrInlines())&&this.syncAftersave(c);
if(!a){var c=new Date,d=Config.Strings.MessageSaved;null!=c&&(d=ws.string.substituteParams(Config.Strings.AutoSavedDrafts,ws.date.formatTime(c,"h:mma")));this.showFeedback(d);this.lastSaved=c}this.toggleButtonState(!0);a||this.resetDirty()}}),error:f})}},hasInflightAttachments:function(){var c;a:{c=this.preloadAttachments;for(var a=0;a<c.length;a++)if(c[a].inflight&&!c[a].cancelled){c=!0;break a}c=!1}return c},cancelInfightAttachments:function(){for(var c=this.preloadAttachments,a=0;a<c.length;a++)if(c[a].inflight)c[a].cancelled=
!0},handlePendingSaveOrSend:function(c){if(c)null!=this.pendingSaveOrSendArgs&&!this.hasInflightAttachments()&&this.saveOrSendMessage(this.pendingSaveOrSendArgs);else if(this.pendingSaveOrSendArgs)this.inSaveOrSend=this.pendingSaveOrSendArgs=null,this.toggleButtonState(!0)},ffiTooLarge:function(){for(var c=0;c<this.filledFileInputs.length;c++)if(this.filledFileInputs[c].tooLarge)return!0;return!1},saveOrSendMessage:function(c){this.inSaveOrSend=c.action;this.editor.endSpellCheck();if(this.hasInflightAttachments())this.pendingSaveOrSendArgs=
c,this.model.trackdl("-CMW.SOSa",this.reportingDLreqID);else{this.pendingSaveOrSendArgs=null;this.editor.prepareForSaveOrSend("sendMessage"==this.inSaveOrSend);for(e=0;e<this.filledFileInputs.length;e++)this.filledFileInputs[e].savedAttach=!0;this.deletedWhenSavingAttachIDs={};this.deletedWhenSavingAttachNames={};this.attachListDirty=!1;for(var f=[],e=0,e=0;e<this.sourceAttachments.length;e++)f.push(this.sourceAttachments[e].id),this.deletedWhenSavingAttachIDs[this.sourceAttachments[e].id]=!1;for(var d=
[],e=0;e<this.preloadAttachments.length;e++)d.push({id:this.preloadAttachments[e].id,name:this.preloadAttachments[e].name,size:this.preloadAttachments[e].size});e=this.draftMessage.inReplyTo||this.originalMessage.messageID;this.mk=Math.random().toString(16).substring(2);this.model.trackdl("-CMW.SOSb",this.reportingDLreqID);this.model[c.action]({content:{From:this.fromSelect.currentValue,To:this.toField.getValue(),Cc:this.ccField.getValue(),Bcc:this.bccField.getValue(),Subject:this.subjectInput.value,
RichBody:this.editor.richMode?this.editor.getRichContent():null,PlainBody:this.editor.getPlainContent(),RichEdit:this.editor.richMode,ParentMessageID:e,ParentReferences:this.originalMessage.references,ParentInReplyTo:this.originalMessage.inReplyTo,AnswerUID:-1!=this.composeType.indexOf("reply")?this.originalMessage.uid:null,AnswerFolder:-1!=this.composeType.indexOf("reply")?this.originalMessage.folder:null,DraftMsgFolder:this.lastSavedMsgUID?Config.DraftsFolderName:this.draftMessage.folder,DraftMsgUID:this.lastSavedMsgUID||
this.draftMessage.uid,SourceMsgUID:this.originalMessage.uid||this.lastSavedMsgUID||this.draftMessage.uid,SourceMsgFolder:this.originalMessage.folder||(this.lastSavedMsgUID?Config.DraftsFolderName:this.draftMessage.folder),SourceAttachmentIDs:f,PreloadAttachmentIDs:d,SendAttachAsLinks:this.sendAttachAsLinks,ComposeType:this.composeType},mk:this.mk,formNode:this.form,load:a.hitch(this,function(a){a.isForward=!1;if("forward"==this.composeType)a.isForward=!0,a.forwardUid=this.originalMessage.uid||this.lastSavedMsgUID||
this.draftMessage.uid;c.load(a)}),error:c.error})}},doAutoSaveMessage:function(c){for(e=0;e<this.filledFileInputs.length;e++)this.filledFileInputs[e].savedAttach=!0;this.deletedWhenSavingAttachIDs={};this.deletedWhenSavingAttachNames={};this.attachListDirty=!1;for(var a=[],e=0,e=0;e<this.sourceAttachments.length;e++)a.push(this.sourceAttachments[e].id),this.deletedWhenSavingAttachIDs[this.sourceAttachments[e].id]=!1;for(var d=[],e=0;e<this.preloadAttachments.length;e++)d.push({id:this.preloadAttachments[e].id,
name:this.preloadAttachments[e].name,size:this.preloadAttachments[e].size});e=this.draftMessage.inReplyTo||this.originalMessage.messageID;this.mk=Math.random().toString(16).substring(2);var h=null;c.isInlineAutoSave?h=this.editor.replaceImgSrcsWithCID():this.editor.richMode&&(h=this.editor.getRichContent());this.model.saveMessage({content:{From:this.fromSelect.currentValue,To:this.toField.getValue(),Cc:this.ccField.getValue(),Bcc:this.bccField.getValue(),Subject:this.subjectInput.value,RichBody:h,
PlainBody:this.editor.getPlainContent(),RichEdit:this.editor.richMode,ParentMessageID:e,ParentReferences:this.originalMessage.references,ParentInReplyTo:this.originalMessage.inReplyTo,AnswerUID:-1!=this.composeType.indexOf("reply")?this.originalMessage.uid:null,AnswerFolder:-1!=this.composeType.indexOf("reply")?this.originalMessage.folder:null,DraftMsgFolder:this.lastSavedMsgUID?Config.DraftsFolderName:this.draftMessage.folder,DraftMsgUID:this.lastSavedMsgUID||this.draftMessage.uid,SourceMsgUID:this.originalMessage.uid||
this.lastSavedMsgUID||this.draftMessage.uid,SourceMsgFolder:this.originalMessage.folder||(this.lastSavedMsgUID?Config.DraftsFolderName:this.draftMessage.folder),SourceAttachmentIDs:a,PreloadAttachmentIDs:d,SendAttachAsLinks:this.sendAttachAsLinks,ComposeType:this.composeType},mk:this.mk,formNode:this.form,load:c.load,error:c.error})},spellCheck:function(){this.editor.spellChecking?ws.reporting.reportDLAction("Mail-Compose-SpellcheckUncheck"):a.publish("WSFeedbackStart",[Config.Strings.SpellCheckProgress]);
this.editor.toggleSpellCheck()},onEndSpellCheck:function(){this.spellCheckButton.setHighlight(!1);this.sendAfterSpellCheck&&this.spellCheckFailure&&(a.doc.documentElement.focus(),ws.widget.Dialogs.okCancel(Config.Strings.SendConfirmationPrompt,a.hitch(this,function(c){c&&this.sendMessage();this.sendAfterSpellCheck=!1})))},onPerfectSpelling:function(){ws.reporting.reportDLAction("Mail-Compose-SpellCheck");this.spellCheckFailure=!1;a.publish("WSFeedbackEnd",[Config.Strings.SpellCheckProgress]);this.sendAfterSpellCheck&&
this.sendMessage()},onImperfectSpelling:function(){ws.reporting.reportDLAction("Mail-Compose-SpellCheck");this.spellCheckFailure=!0;a.publish("WSFeedbackEnd",[Config.Strings.SpellCheckProgress]);this.spellCheckButton.setHighlight(!0);this.sendAfterSpellCheck&&ws.widget.Dialogs.show(Config.Strings.SpellingErrorsFound,[Config.Strings.SendNow,Config.Strings.ReviewErrors],a.hitch(this,function(c){if(0==c)this.spellCheckFailure=!1,this.sendMessage()}),!0)},cancel:function(){this.cancelCB&&this.cancelCB()},
closeAfterSuccess:function(c){c?this.cancel():this.cancelCB&&this.cancelCB(null,!0,!0)},onClickNewWindow:function(){this.popOut()},popOut:function(c,f,e){this.checkForAttachments(a.hitch(this,"_popOut",e),c,f)},_popOut:function(c){window.composeContext={model:this.model,picturesModel:this.picturesModel,callback:a.hitch(this,"popOutComplete")};ws.io.openWindow(Config.BaseMailPagesURL+"ComposeMessage?ws_popup=true&ws_suite=true","","status=yes,resizable=yes,left=5,top=5,width=885,height=606",c)},popOutComplete:function(c){var f=
{to:this.toField.getValue(),cc:this.ccField.getValue(),bcc:this.bccField.getValue(),subject:this.subjectInput.value,body:a.isWebKit&&this.editor.isEmpty()?"":this.editor.getContent(),originalMessage:this.originalMessage,draftMessage:this.draftMessage,composeType:this.composeType,dontAddSignature:!0,isDirty:this.isDirty(),preloadAttachments:this.preloadAttachments,sourceAttachments:this.sourceAttachments,isPopOut:!0,isStationeryMode:this.editor.isStationeryMode,stationeryState:this.editor.stationeryState};
this.preloadAttachments=[];this.editor.notifyUploadCompletions(c.editor);c.reset(f,a.hitch(this,function(){this.resetDirty();this.cancelCB&&this.cancelCB()}))},checkForAttachments:function(c,f,e){if(0<this.filledFileInputs.length||this.hasInflightAttachments())ws.widget.Dialogs[f?"ok":"okCancel"](Config.Strings.PopOutWithAttachedFilesWarning,a.hitch(this,function(a){if(f||a)this.cancelInfightAttachments(),c();e&&e()}));else c(),e&&e()},initAttachments:function(c,f,e){this.fileInputCounter=0;this.maxMessageSize=
parseInt(Config.MaxMessageSize);this.preloadAttachments=[];this.attachUploadDispId=0;this.attachUploadDispRefObjs={};this.attachUploadDispNodes={};this.attachUploadFilenameMap={};if(f)this.sourceAttachments=ws.lang.shallowCopy(f,!0);else if(this.sourceAttachments=[],(f=this.draftMessage.attachments||this.originalMessage.attachments)&&("forward"==this.composeType||"draft"==this.composeType))for(c=0;c<f.length;c++){var d=!0;!0===this.deletedWhenSavingAttachIDs[f[c].id]&&(d=!1);this.deletedWhenSavingAttachNames&&
this.deletedWhenSavingAttachNames[f[c].name]&&"undefined"==typeof this.deletedWhenSavingAttachIDs[f[c].id]&&(d=!1);d?this.sourceAttachments.push(f[c]):this.attachListDirty=!0}this.filledFileInputs=[];this.deletedWhenSavingAttachIDs={};this.deletedWhenSavingAttachNames=null;f=!1;if(!Config.EnableFlashFileUploader){d=!0;if(this.form&&this.form.length){d=!1;for(c=this.form.length-1;0<=c;c--)if("trueEmbedFileInput"!=this.form[c].className)if(e||this.form[c].savedAttach)try{a._destroyElement(this.form[c])}catch(h){}else this.form[c].emptyAttach?
f=!0:(this.attachListDirty=!0,this.filledFileInputs.push(this.form[c]))}if(d)this.form=null,this.createBaseAttachUploadForm(),this.form.appendChild(this.editor.attachButton),this.editor.toolbarPane.firstChild?this.editor.toolbarPane.insertBefore(this.form,this.editor.toolbarPane.firstChild):this.editor.toolbarPane.appendChild(this.form);this.form&&!f&&this.createEmptyFileInput();for(e=this.attachmentDisplay;null!=e.lastChild;)e.removeChild(e.lastChild);this.updateAttachmentRow()}},createEmptyFileInput:function(){this.emptyFileInput=
a.create("input",{type:"file",name:"file"+this.fileInputCounter++,emptyAttach:!0,savedAttach:!1,className:"fileIputElement"},this.editor.attachButton);this.connect(this.emptyFileInput,"onchange","onSelectFile")},onSelectFile:function(){var c=this.emptyFileInput;if(c&&c.files&&c.files.length&&this.attachFileExceedsLimit(c)){var f=ws.string.substituteParams(Config.Strings.AttachSizeExceeds,this.maxMessageSize/1048576);ws.widget.Dialogs.ok(f);a._destroyElement(c);this.createEmptyFileInput()}else if(""!=
c.value)c.style.top="-10000px",c.style.left="-10000px",c.emptyAttach=!1,this.filledFileInputs.push(c),this.createEmptyFileInput(),this.updateAttachmentRow()},attachFileExceedsLimit:function(c){for(var a=0,e=0;e<this.sourceAttachments.length;e++)this.sourceAttachments[e].size&&(a+=this.sourceAttachments[e].size*this.fileAttachSizeEncodeRatio);for(e=0;e<this.filledFileInputs.length;e++){var d=this.getClientFileSize(this.filledFileInputs[e]);null!=d&&(a+=d)}c=this.getClientFileSize(c);null!=c&&(a+=c);
return a>this.maxMessageSize?!0:!1},findRefObjKey:function(c){var a=null,e;for(e in this.attachUploadDispRefObjs)if(c===this.attachUploadDispRefObjs[e]){a=e;break}return a},addRefObj:function(c){var a=this.findRefObjKey(c),e=!1;a||(a="dispId"+this.attachUploadDispId++,this.attachUploadDispRefObjs[a]=c,e=!0);return{key:a,isNew:e}},addedInlineImage:function(){this.forceReadSavedMsg=!0},removedInlineImage:function(){this.forceReadSavedMsg=this.draftMessage&&"undefined"!=typeof this.draftMessage.hasInlines?
this.draftMessage.hasInlines:!0},getClientFileSize:function(c){var a=null;c&&c.files&&c.files.length&&(c=c.files[0],a=c.fileSize||c.size);return a},getSizeLabeled:function(c){var a=c+" B";1024<Number(c)&&(a=(c/1024).toFixed(0)+" KB");1048576<Number(c)&&(a=(c/1048576).toFixed(1)+" MB");return a},updateAttachmentRow:function(){var c={},f,e;this.forceReadSavedMsg=this.draftMessage&&"undefined"!=typeof this.draftMessage.hasAttachments?this.draftMessage.hasAttachments:!0;var d=a.hitch(this,function(c,
f,e,d){var m=c,l="";if(30<=c.length){var k=c.lastIndexOf(".");-1!=k&&(l=c.substring(k+1));c=c.substring(0,27)+"..."+l}"number"==typeof f&&(c+=" ("+this.getSizeLabeled(f)+")");c=new h({label:c,title:m,showArrow:!0,fixSize:!0});a.addClass(c.domNode,"attachmentBtn");a.addClass(c.arrowImg,"deleteBtn");a.style(c.domNode,{cursor:"default"});a.style(c.arrowImg,{cursor:"pointer"});this.attachmentDisplay.appendChild(c.domNode);c.startup();this.connect(c.arrowImg,"onclick",e);this.attachUploadDispNodes[d]=
c.domNode});for(e=0;e<this.sourceAttachments.length;e++)if(f=this.addRefObj(this.sourceAttachments[e]),c[f.key]=this.attachUploadDispRefObjs[f.key],f.isNew){var m=this.sourceAttachments[e].size?Math.round(this.sourceAttachments[e].size*this.fileAttachSizeEncodeRatio):null;d(this.sourceAttachments[e].name,m,a.hitch(this,"deleteSourceAttachment",f.key),f.key,!1)}for(e=0;e<this.filledFileInputs.length;e++)f=this.addRefObj(this.filledFileInputs[e]),c[f.key]=this.attachUploadDispRefObjs[f.key],f.isNew&&
(m=this.getClientFileSize(this.filledFileInputs[e]),d(this.getFileName(this.filledFileInputs[e].value),m,a.hitch(this,"deleteFileAttachment",f.key),f.key,!1));for(e=0;e<this.preloadAttachments.length;e++)if(f=this.addRefObj(this.preloadAttachments[e]),c[f.key]=this.attachUploadDispRefObjs[f.key],f.isNew){var l=this.preloadAttachments[e].name,m=null;if(!this.preloadAttachments[e].inflight&&0<this.preloadAttachments[e].size)m=this.preloadAttachments[e].size;d(l,m,a.hitch(this,"deletePreloadAttachment",
this.preloadAttachments[e].clientId),f.key,!0)}this.attachUploadDispRefObjs=c;var c=0,k;for(k in this.attachUploadDispNodes)this.attachUploadDispRefObjs[k]?c++:(this.attachmentDisplay.removeChild(this.attachUploadDispNodes[k]),delete this.attachUploadDispNodes[k]);ws.html.setShowing(this.attachmentRow,0<c);this.layoutSoon()},getFileName:function(c){return-1<c.indexOf("/")?c.substring(c.lastIndexOf("/")+1):c.substring(c.lastIndexOf("\\")+1)},deleteSourceAttachment:function(c){for(var a=0;a<this.sourceAttachments.length;a++)if(this.sourceAttachments[a]===
this.attachUploadDispRefObjs[c]){var e=this.sourceAttachments[a].id;"boolean"==typeof this.deletedWhenSavingAttachIDs[e]&&(this.deletedWhenSavingAttachIDs[e]=!0);this.sourceAttachments.splice(a,1);this.updateAttachmentRow()}},deleteFileAttachment:function(c){for(var f=0;f<this.filledFileInputs.length;f++)if(this.filledFileInputs[f]===this.attachUploadDispRefObjs[c]){if(this.deletedWhenSavingAttachNames){var e=this.getFileName(this.filledFileInputs[f].value),e=e.replace(RegExp("\\x5c|\\x2f|\\x3a|\\x2a|\\x3f|\\x22|<|>|\\x7c|\\x20|\n|\r",
"g"),"_");this.deletedWhenSavingAttachNames[e]=!0}a._destroyElement(this.filledFileInputs[f]);this.filledFileInputs.splice(f,1);this.updateAttachmentRow()}},deletePreloadAttachment:function(c){for(var a=0,e=null,d=0;d<this.preloadAttachments.length;d++)if(this.preloadAttachments[d].clientId==c){e=this.preloadAttachments[d];a=d;break}if(e){this.preloadAttachments.splice(a,1);this.updateAttachmentRow();if(this.uploadIoHandle)this.uploadIoHandle.abort(),this.uploadIoHandle=null;if(e.inflight)e.cancelled=
!0,this.handlePendingSaveOrSend(!0)}},createFlashFileUploder:function(){if(!this.flashFileUploder){var c=encodeURIComponent("?user="+ws.io.getUserUid()+"&a=ComposeMessageImageStore&l="+ws.io.getL7Id()+"&r="+Math.random()),c=Config.BaseRpcPagesURL+c,f=a.create("div",{style:{visibility:"hidden",position:"absolute",top:"0px",left:"0px",width:"35px",height:"24px"}}),e=a.create("div",{style:{position:"relative",width:"35px",height:"24px"}});e.innerHTML=".";this.editor.attachButton.appendChild(f);f.appendChild(e);
this.flashFileUploder=new dojox.form.FileUploader({deferredUploading:1,uploadUrl:c,uploadOnChange:!1,selectMultipleFiles:!0,fileMask:["All Files","*.*"],force:"flash",skipServerCheck:!0,serverTimeout:6E4,devMode:!0,isDebug:!0,useFileReferenceUpload:a.isIE?!0:!1},e);this._supportingWidgets.push(this.flashFileUploder);this.connect(this.flashFileUploder,"onReady",function(){this.flashFileUploder.insideNode.firstChild&&(a.style(this.flashFileUploder.insideNode.firstChild,"opacity",0.01),a.style(f,"visibility",
"visible"))});this.connect(this.flashFileUploder,"onChange","onFlashUploadFileSelect");this.connect(this.flashFileUploder,"onProgress","onFlashUploadProgress");this.connect(this.flashFileUploder,"onComplete","onFlashUploadComplete")}},onFlashUploadFileSelect:function(c){var a;if("undefined"==typeof this.sourceAttachmentsSize)for(a=this.sourceAttachmentsSize=0;a<this.sourceAttachments.length;a++)this.sourceAttachmentsSize+=this.sourceAttachments[a].size;var e=this.sourceAttachmentsSize;for(a=0;a<this.preloadAttachments.length;a++)this.preloadAttachments[a].cancelled||
(e+=this.preloadAttachments[a].size);for(a=0;a<c.length;a++){if(e+c[a].size>this.maxMessageSize){c=ws.string.substituteParams(Config.Strings.AttachTooLarge,this.maxMessageSize/1024/1024);ws.widget.Dialogs.ok(c);break}e+=c[a].size;this.preloadAttachments.push({id:"file"+this.fileInputCounter++,clientId:this.nextCid++,name:c[a].name,size:c[a].size,type:c[a].type,inflight:!0,cancelled:!1})}this.updateAttachmentRow();ws.lang.setTimeout(this,function(){this.flashFileUploder.upload({requests:'[{"id":"ATCH","action":"ComposeMessageImageStore"}]'})},
500)},onFlashUploadProgress:function(){},onFlashUploadComplete:function(c){for(var a=0;a<c.length;a++){var e=this.attachUploadFilenameMap[c[a].name];if(e){var d=c[a].serverResp,h=null;if(d){var h=d,d=null,m=h.indexOf("id=ATCH.");0<=m&&(d="ATCH."+/[0-9]+/.exec(h.substr(m+8)));h=d}if(h&&(e=this.attachUploadDispRefObjs[e]))e.id=h,e.inflight=!1}}},positionAttachFileButton:function(){Config.EnableFlashFileUploader&&!this.flashFileUploder&&(a.require("ws.layers.FileUploader"),a.addOnLoad(this,"createFlashFileUploder"))},
positionRichTextButton:function(){this.editor.richTextButton.style.display=a.isIE&&ws.browser.ns8||Settings.UseRichEditor||"en-us"!=Config.PageLocale?"none":""},fetchAndRespond:function(c,f,e){this.model.getMessage({folder:c,uid:f,load:a.hitch(this,function(c){this[e](c)})})},reply:function(c){this.checkAndRestoreImageOrLinks(c);var f;c.containsHchat&&(f=c.to[0].userInputForm.replace(/\@unknown\.domain/i,""));this.composeResponse(c,"reply",Config.Strings.ReplyPrefix,f||c.replyToAddrs);if(a.isFF&&
!this.editor.htmlMode)try{this.editor.textarea.setSelectionRange(0,0)}catch(e){}},containsSenderAddress:function(c,a){if(c&&0<c.length&&a&&0<a.length)for(var e=0;e<a.length;e++)for(var d=a[e][1].toLowerCase(),h=0;h<c.length;h++)if(ret=-1!=c[h].userInputForm.toLowerCase().indexOf(d))return!0;return!1},replyAll:function(c){this.checkAndRestoreImageOrLinks(c);var f=!1;if("Inbox"==c.folderType||"NewMail"==c.folderType||"OldMail"==c.folderType||"Personal"==c.folderType||"Saved"==c.folderType||"AutoSavedRead"==
c.folderType)var f=this.containsSenderAddress(c.to,this.model.sendAddresses),e=this.containsSenderAddress(c.cc,this.model.sendAddresses),d=this.containsSenderAddress(c.from,this.model.sendAddresses),f=!f&&!e&&!d&&!c.isLikelyForward;var h;c.containsHchat&&(h=c.to[0].userInputForm.replace(/\@unknown\.domain/i,""));this.composeResponse(c,"reply-all",Config.Strings.ReplyPrefix,h||c.replyAllAddrs,c.replyAllCcAddrs);f&&(a.publish("peoplepicker/close"),window.clearTimeout(this.focusBodyTimer),ws.reporting.reportDLAction("Mail-Compose-BCCWarning"),
c=ws.widget.Dialogs.okCancel(Config.Strings.BccReplyConfirm,a.hitch(this,function(c){c?this.focusField():(this.resetDirty(),this.cancel())}),!0),setTimeout(a.hitch(c,"focus"),250));if(a.isFF&&!this.editor.htmlMode)try{this.editor.textarea.setSelectionRange(0,0)}catch(m){}},isImageRemoved:function(c){var a=c.stripImagesKey&&-1!=c.body.indexOf(c.stripImagesKey);if(a&&(!Settings.DisplayImageWarning||this.addressModel.getRecordByEmail(c.from[0].userInputForm)))a=!1;return a},isLinkRemoved:function(c){var a=
c.stripLinksKey&&-1!=c.body.indexOf(c.stripLinksKey);if(a&&(!Settings.DisplayLinkWarning||this.addressModel.getRecordByEmail(c.from[0].userInputForm)))a=!1;return a},checkAndRestoreImageOrLinks:function(c){ws.WebSuite.isDispMessageSafe(c.uid)&&this._restoreImages(c);ws.WebSuite.isDispMessageSafe(c.uid,!0)&&this._restoreLinks(c)},restoreImagesAndLinks:function(c){this._restoreImages(c);this._restoreLinks(c)},_restoreImages:function(c){c.body=c.body.replace(RegExp(c.stripImagesKey,"g"),"");c.stripImagesKey=
null;ws.WebSuite.setDispMessageSafe(c.uid)},_restoreLinks:function(c){re=RegExp(c.stripLinksKey,"g");c.body=c.body.replace(re,"");c.stripLinksKey=null;ws.WebSuite.setDispMessageSafe(c.uid,!0)},forward:function(c){this.checkAndRestoreImageOrLinks(c);var f=null;if(this.isImageRemoved(c)&&this.isLinkRemoved(c))f=Config.Strings.ShowImagesAndEnableLinksBeforeSending;else if(this.isImageRemoved(c))f=Config.Strings.ShowImagesBeforeSending;else if(this.isLinkRemoved(c))f=Config.Strings.EnableLinksBeforeSending;
null!=f?ws.widget.Dialogs.okCancel(f,a.hitch(this,function(a){a&&this.restoreImagesAndLinks(c);this.composeResponse(c,"forward",Config.Strings.ForwardPrefix)})):this.composeResponse(c,"forward",Config.Strings.ForwardPrefix);if(a.isFF&&!this.editor.htmlMode)try{this.editor.textarea.setSelectionRange(0,0)}catch(e){}},composeResponse:function(c,f,e,d,h){var m=c.selectedText?"<blockquote style='border-left: 2px solid blue; padding-left: 3px;'>"+c.selectedText+"</blockquote>":"",l=this.buildOrigMessageBodyHeader(c),
k=c.body.replace(RegExp("<div[^>]+AOLImageAttachmentHeader[^\n]+\n\r\n","gi"),""),k=k.replace(RegExp(/<div id="AOLMsgImgInlineRenderPart[\s\S]*?--\>/gim),""),g=[c.displayTo,c.displayCc,c.displayBcc,c.displayFrom].join(";"),j=this.model.getUidData(c.uid);Settings.HasAggregatedAccount&&j&&(g=this.model.identities[j[this.model.columns.Account]][1]);j=null;this.isPopup||(j="Inline Response");this.reset({from:g,to:d,cc:h,subject:e+" "+this.model.getBaseSubject(c.subject),quote:m,body:l+k,originalMessage:c,
composeType:f,backToString:this.backToString,beaconSuffix:j,isStationeryMode:!1},a.hitch(this,function(){this.editor.richMode&&this.editor.getFunmail().finalizeTemplate()}))},buildOrigMessageBodyHeader:function(c){var a=Config.Strings.OriginalMessage+"\n";c.displayFrom&&(a+=Config.Strings.From+": "+c.displayFrom+"\n");if(c.displayTo)var e=c.displayTo.replace(/\@unknown\.domain/i,""),a=a+(Config.Strings.To+": "+e+"\n");c.displayCc&&(a+=Config.Strings.Cc+": "+c.displayCc+"\n");a+=Config.Strings.SentOn+
": "+ws.date.formatDateTime(new Date(c.receivedTime),Config.Strings.MsgViewDateFormat)+"\n";null!=c.subject&&""!=c.subject&&(a+=Config.Strings.Subject+": ",a+=c.subject,a+="\n");a=ws.string.escapeXml(a+"\n");return a=a.replace(/\n/g,"<br>")},showFeedback:function(c,a){c?ws.html.setShowing(this.feedbackNode,!0):(ws.html.setShowing(this.feedbackNode,!1),this.spinner&&this.spinner.stop());if(a){if(!this.spinner)this.spinner=new l("AutoSave",this.feedbackSpin);this.spinner.spin()}else this.spinner&&this.spinner.stop();
ws.html.setInnerText(this.feedbackMsg,c||"")},checkEmailFields:function(){var c=this.toField.getValue(),a=this.ccField.getValue(),e=this.bccField.getValue();if((!c||""==c)&&(!a||""==a)&&(!e||""==e))return ws.widget.Dialogs.ok(Config.Strings.ErrorNoValidRecipient),!0;var d="";if(this.preventDomainlessAddressFix){if(d=this.isEmailAddress(c))return ws.widget.Dialogs.ok(ws.string.substituteParams(Config.Strings.InvalidAddressInField,d,Config.Strings.To)),!0;if(d=this.isEmailAddress(a))return ws.widget.Dialogs.ok(ws.string.substituteParams(Config.Strings.InvalidAddressInField,
d,Config.Strings.Cc)),!0;if(d=this.isEmailAddress(e))return ws.widget.Dialogs.ok(ws.string.substituteParams(Config.Strings.InvalidAddressInField,d,Config.Strings.Bcc)),!0}else{var h=this.isEmailAddress(c),c=0;h&&""!=h&&(d+="<br/><span style='font-weight:bold'>"+Config.Strings.To+"</span>: "+h+"\n",c++);if((a=this.isEmailAddress(a))&&""!=a)d+="<br/><span style='font-weight:bold'>"+Config.Strings.Cc+"</span>: "+a+"\n",c++;if((e=this.isEmailAddress(e))&&""!=e)d+="<br/><span style='font-weight:bold'>"+
Config.Strings.Bcc+"</span>: "+e+"\n",c++;e=!1;if(d&&(d.match(",")||1<c))e=!0;c="";if(d&&""!=d)return c=e?Config.Strings.WrongEmailAddresses:Config.Strings.WrongEmailAddress,c+=d+ws.string.substituteParams(Config.Strings.CorrectFormat,"<span style='font-style:italic'>","</span>"),ws.widget.Dialogs.ok(c),!0}return!1},isEmailAddress:function(c){var a="";if(c)for(var c=c.split(/[,;]/),e=0;e<c.length;e++){var d=c[e].match(/(.+)@(.+)\.(.+)/);null!=d&&4==d.length||(a&&""!=c[e]&&(a+=","),a+=c[e])}return a},
fixDomainlessAddresses:function(c){if(!this.preventDomainlessAddressFix&&Config.FixDomainlessAddresses&&0<Config.FixDomainlessAddresses.length){var d=ws.UserContext.UserAddress.split("@");if(!(d&&2!=d.length)){var e=d[1],d=Config.FixDomainlessAddresses.toLowerCase().split(",");0>a.indexOf(d,e.toLowerCase())||(d=a.hitch(this,function(c){var d=c.getValue();if(""!=d){for(var d=d.split(/[,;]/),f=0;f<d.length;f++){var h=a.trim(d[f]);if(""!=h){var m=this.addressModel.searchDLName(h);null!=m&&null!=m.composeValue?
h=m.composeValue:1>h.indexOf("@")&&(h=h.replace(/\s+/g,"")+"@"+e)}d[f]=h}c.setValue(d.join(", "))}}),c?d(c):(d(this.toField),d(this.ccField),d(this.bccField)))}}},showBccParenWarning:function(){var c=this.toField.getValue()+this.ccField.getValue()+this.bccField.getValue();return-1!=c.indexOf("(")||-1!=c.indexOf(")")?(ws.widget.Dialogs.ok(Config.Strings.ProductName+Config.Strings.BccParenthesesWarning,a.hitch(this,"showBcc")),!0):!1},showMissingAttachmentWarning:function(){if(!ws.lang.isEmptyArray(this.sourceAttachments)||
!ws.lang.isEmptyArray(this.filledFileInputs)||!ws.lang.isEmptyArray(this.preloadAttachments)||this.missingAttachmentWarningShown)return!1;for(var c=this.editor.getPlainContent().toLowerCase(),d=c.indexOf(Config.Strings.OriginalMessage.toLowerCase()),c=-1==d?this.subjectInput.value+" "+c:c.substring(0,d),d=Config.Strings.attachmentWordList.split(","),e=0;e<d.length;e++)if(-1!=c.indexOf(d[e].toLowerCase()))return ws.widget.Dialogs.okCancel(ws.string.substituteParams(Config.Strings.MissingAttachmentWarning,
"<br><br>",d[e]),a.hitch(this,function(c){c&&this.sendMessage()}),!0),this.missingAttachmentWarningShown=!0;return!1},setupSendConfirmation:function(){if(this.sendConfirmation){var c=this.stackWidget.getChildren();-1==a.indexOf(c,this.sendConfirmation)&&this.stackWidget.addChild(this.sendConfirmation)}else this.sendConfirmation=new m({composeWidget:this,cancelCB:a.hitch(this,"closeAfterSuccess")}),this.stackWidget.addChild(this.sendConfirmation);c=this.backToStringOverride||this.backToButtonString||
Config.Strings.Back;this.backToButtonString=null;var d=ws.string.escapeXml(this.subjectInput.value||"");this.stackWidget.selectChild(this.sendConfirmation);this.sendConfirmation.setupSendConfirmation(c,d,this.isResponse,this.topContactSuggest);this.resetStationery()},sendIM:function(c){ws.presence._launchIM(c,!1)},launchStationery:function(c){this.stationeryEnabled&&ws.WebSuite.SidePanel&&(ws.WebSuite.SidePanel.showStationery(!0),ws.WebSuite.SidePanel.stationeryWidget&&(a.isIE?setTimeout(a.hitch(this,
function(){ws.WebSuite.SidePanel.stationeryWidget.selectStationery(c,!0)}),500):ws.WebSuite.SidePanel.stationeryWidget.selectStationery(c,!0)))},setField:function(c,a){var e=a.replace(/^\s+/,"").replace(/\s+$/,"");if(""!=e){var d=this[c.toLowerCase()+"Field"],h=d.getValue().replace(/^\s+/,"").replace(/\s+$/,"");"cc"==c.toLowerCase()?this.showCc():"bcc"==c.toLowerCase()&&this.showBcc();h=h?";"==h.charAt(h.length-1)||","==h.charAt(h.length-1)?h+(" "+e+","):h+(", "+e+","):e+",";d.setValue(h)}},uninitialize:function(){this.sendConfirmation&&
this.sendConfirmation.destroyRecursive()},idleMonitorStarted:function(){var c;c=this.isPopup&&_ws_isOpenerWS()?function(){opener.dojo.publish("IdleMonitor/activityDetected")}:function(){a.publish("IdleMonitor/activityDetected")};var d=a.hitch(this,function(a){this.connect(a,"scroll",c);this.connect(a,"resize",c);this.connect(a.document,"mousemove",c);this.connect(a.document,"keydown",c)});this.isPopup&&_ws_isOpenerWS()&&d(window);d(this.editor.iframe.contentWindow)}})})},"ws/pictures/PictureEditControl":function(){require({cache:{"url:ws/pictures/PictureEditControl.html":'<div class="pictureEditControl" style="display: none;">\n    <div class="bkgndLayer" data-dojo-attach-point="bkgndLayerNode"></div>\n\t\t<div class="buttons" data-dojo-attach-point="buttons">\n\t\t\t<a href="#" data-dojo-attach-point="optionsBtn" class="mainSprite options" data-dojo-attach-event="onclick: showMenu"></a>\n\t\t\t<a href="#" class="mainSprite delete" data-dojo-attach-point="deleteButton"></a>\n\t\t</div>\n</div>\n\n',
"url:ws/pictures/PictureEditControl.css":""}});define("ws/pictures/PictureEditControl","dojo/_base/declare,dojo/text!ws/pictures/PictureEditControl.html,dojo/text!ws/pictures/PictureEditControl.css,dojo,dijit,dijit/_Widget,dijit/_TemplatedMixin,ws/widget/WSSelect,ws/html,ws/widget/util".split(","),function(q,n,j,a,d,g,p,k){return q([g,p],{templateString:n,css:{templateString:j},editor:null,hoveredImage:null,bkgndLayerNode:null,imageConnections:null,options:[{value:"small",display:Config.Strings.Compose_small,
action:"size"},{value:"medium",display:Config.Strings.Compose_medium,action:"size"},{value:"large",display:Config.Strings.Compose_large,action:"size"},{isSeparator:!0},{value:"right",display:Config.Strings.Compose_alignRight,action:"align"},{value:"center",display:Config.Strings.Compose_alignCenter,action:"align"},{value:"left",display:Config.Strings.Compose_alignLeft,action:"align"},{isSeparator:!0},{value:"none",display:Config.Strings.Compose_noWrap,action:"wrap"},{value:"right",display:Config.Strings.Compose_wrapRight,
action:"wrap"},{value:"left",display:Config.Strings.Compose_wrapLeft,action:"wrap"}],startup:function(d,l){this.inherited(arguments);this.imageConnections={};this.createMenu();this.connect(this.optionsMenu.menu,"onMouseDown","setSelectedOption");this.handledImages=[];this.connect(this.deleteButton,"onclick",a.hitch(this,"execCommand","remove"));var h=this.editor.doc(),h=9>a.isIE?h.body:h;this.keyupConnectHnd=this.connect(h,"onkeyup","handleKeyLayoutEvent");this.mouseupConnectHnd=this.connect(h,"onmouseup",
"handleMouseLayoutEvent");this.scrollConnectHnd=this.connect(h,"onscroll","handleScrollLayoutEvent")},destroy:function(){try{this.disconnect(this.keyupConnectHnd)}catch(a){}try{this.disconnect(this.mouseupConnectHnd)}catch(d){}try{this.disconnect(this.scrollConnectHnd)}catch(h){}try{this.inherited(arguments)}catch(k){}},closeControls:function(){this.closeMenu();this.domNode.style.display="none";this.bkgndLayerNode.style.display="none";this.hoveredImage=null},setSelectedOption:function(a){if(a.target&&
(a=d.getEnclosingWidget(a.target),a.caption))for(var l in this.options)a.caption==this.options[l].display&&this.execCommand(this.options[l].action,this.options[l].value)},createMenu:function(){if(!this.optionsMenu)this.optionsMenu=new k({options:this.options}),this.optionsMenu.startup(),this.optionsMenu.getMenu()},openMenu:function(){this.optionsMenu.menu.open(this.optionsBtn)},closeMenu:function(){this.optionsMenu.menu&&this.optionsMenu.menu.close()},removeEventHandlers:function(a,d){var h=this.imageConnections[a];
h&&(d&&h[d]?this.disconnect(h[d]):(h.onmouseover&&this.disconnect(h.onmouseover),h.onmouseout&&this.disconnect(h.onmouseout),h.onload&&this.disconnect(h.onload),delete this.imageConnections[a]))},installEventHandlers:function(d){if(d){for(var l in this.imageConnections)this.removeEventHandlers(l);this.handledImages=[]}d=this.editor.doc().getElementsByTagName("img");for(l=0;l<d.length;l++)if(d[l].id&&-1!=d[l].id.indexOf("AOLP")&&this.editor.imageIdMap[d[l].id]&&-1==a.indexOf(this.handledImages,d[l]))this.imageConnections[d[l].id]=
this.imageConnections[d[l].id]||{},this.imageConnections[d[l].id].onmouseover=this.connect(d[l],"onmouseover",a.hitch(this,"onMouseOverImage",d[l])),this.imageConnections[d[l].id].onmouseout=this.connect(d[l],"onmouseout",a.hitch(this,"onMouseOutImage",d[l])),this.imageConnections[d[l].id].onload=this.connect(d[l],"onload",a.hitch(this,"onImageLoaded",d[l])),this.handledImages.push(d[l]);if(this.hoveredImage&&!this.hoveredImage.parentNode)this.domNode.style.display="none",this.bkgndLayerNode.style.display=
"none",this.hoveredImage=null},onImageLoaded:function(d){if(d&&(this.removeEventHandlers(d.id,"onload"),this.bkgndLayerNode&&"none"!=a.style(this.bkgndLayerNode,"display")))this.onMouseOverImage(d)},onMouseOverImage:function(a){this.updateImageEditCtlLoc(a);this.hoveredImage=a},handleKeyLayoutEvent:function(){for(var a=0;a<this.handledImages.length;a++)if(this.handledImages[a]&&!this.handledImages[a].parentNode){this.installEventHandlers(!0);break}this.hoveredImage&&this.updateImageEditCtlLoc(this.hoveredImage)},
handleMouseLayoutEvent:function(){for(var a=0;a<this.handledImages.length;a++)if(this.handledImages[a]&&!this.handledImages[a].parentNode){this.installEventHandlers(!0);break}this.hoveredImage&&this.updateImageEditCtlLoc(this.hoveredImage)},handleScrollLayoutEvent:function(){this.hoveredImage&&this.updateImageEditCtlLoc(this.hoveredImage)},updateImageEditCtlLoc:function(d){var l=a.contentBox(d).w;a.contentBox(d);var h=a.position(this.editor.iframe),k=this.editor.doc().body.clientWidth;this.editor.doc();
d=a.position(d);d.x+=h.x;d.y+=h.y;if(d.x<h.x)l-=h.x-d.x,d.x=h.x;d.x+l>h.x+k&&(l=h.x+k-d.x);if(d.y<h.y)d.y=h.y;this.domNode.style.display="";h=d&&"number"==typeof d.x&&0<d.x?d.x:0;this.domNode.style.left=d.x+(7==a.isIE?2:0)+"px";h=d&&"number"==typeof d.y&&0<d.y?d.y:0;this.domNode.style.top=h+(7==a.isIE?2:0)+"px";h="number"==typeof l&&0<l?l:0;this.domNode.style.width=h+"px";this.bkgndLayerNode.style.width=h+"px";this.bkgndLayerNode.style.display="block";this.buttons.style.width=h+"px"},onMouseOutImage:function(a,
d){(!this.hoveredImage||!ws.html.overElement(this.hoveredImage,d))&&this.closeControls()},onMouseOver:function(){this.domNode.style.display=""},showMenu:function(){this.updateMenuState(this.hoveredImage);this.openMenu()},execCommand:function(a,d){this.bkgndLayerNode.style.display="none";this.domNode.style.display="none";var h=this.hoveredImage;switch(a){case "size":this.setSize(h,d);break;case "align":this.setAlign(h,d);break;case "wrap":this.setWrap(h,d);break;case "remove":this.removeImage(h)}},
sizes:{small:Config.InsertedPictureLongestEdge,medium:600,large:1200},setSize:function(a,d){var h=this.editor.imageIdMap[a.id];if("small"==d)a.src=h.smallUrl;else if("medium"==d)a.src=h.mediumUrl;else if("large"==d)a.src=h.largeUrl;a.width=this.sizes[d];a.style.height="";a.style.width=""},setAlign:function(a,d){var h=this.envelopImage(a);h.align=d;ws.html.setFloat(h,"none")},setWrap:function(a,d){var h={left:"right",right:"left",none:"none"}[d],k=this.envelopImage(a);ws.html.setFloat(k,h);if("none"==
d)k.align="left"},removeImage:function(d){this.removeEventHandlers(d.id);d.parentNode.removeChild(d);a.isMoz&&this.editor.insertHTML("<span></span>");this.installEventHandlers();a.publish("InlineImageRemoved")},envelopImage:function(a){var d=this.getEnvelope(a);if(d)return d;d=this.editor.doc().createElement("div");d.className="envelope";var h=a.cloneNode(!1);d.appendChild(h);a.parentNode.replaceChild(d,a);this.installEventHandlers(!0);return d},getEnvelope:function(a){return(a=a.parentNode)&&"envelope"==
a.className&&1==a.childNodes.length?a:null},updateMenuState:function(d){var k=this.getEnvelope(d),d=a.contentBox(d),h=k?k.align:"left",k=k?ws.html.getFloat(k):"none",g="left"!=k&&"right"!=k,d={sizesmall:d.w==this.sizes.small,sizemedium:d.w==this.sizes.medium,sizelarge:d.w==this.sizes.large,alignleft:g&&("left"==h||""==h),aligncenter:g&&"center"==h,alignright:g&&"right"==h,wrapright:"left"==k,wrapleft:"right"==k,wrapnone:g};this.optionsMenu.menu||this.createMenu();h=this.optionsMenu.menu.getChildren();
for(k=0;k<h.length;k++)h[k].isSeparator||h[k].setChecked(d[this.options[k].action+this.options[k].value])}})})},"url:ws/pictures/PictureEditControl.css":"","url:ws/mail/SendConfirmationPage.css":"","ws/mail/funmail":function(){define("ws/mail/funmail",["dojo/_base/declare","dojo","dijit"],function(q,n){function j(){this.init()}j.prototype.init=function(){this._type=this._document=null;this._xmlHttp=new XmlHttp;this._savedContentMap=null};j.prototype.setDocument=function(a){this._document=a};j.prototype.setStationery=
function(a){this._xmlHttp.fetchAsynchronous(a,this.createDelegate(this,this.stationeryHandler))};j.prototype.setPostcard=function(a){this._xmlHttp.fetchAsynchronous(a,this.createDelegate(this,this.postcardHandler))};j.prototype.setPhotoAlbum=function(a){this._xmlHttp.fetchAsynchronous(a,this.createDelegate(this,this.photoAlbumHandler))};j.prototype.getFinalizedDocument=function(){var a=null;this._document&&(a=this._document.cloneNode(!0))&&this.finalizeNode(a.body);return a};j.prototype.finalizeNode=
function(a){if(a){var d=a.id;if(d&&(d=d.toLowerCase(),0==d.search(/^role_/)||0==d.search(/^rolx_/)))a.removeAttribute("contentEditable"),a.removeAttribute("id"),this.isContentVolatile(a)&&(a.removeAttribute("comp_state"),a.removeAttribute("comp_original_text"));for(d=0;d<a.childNodes.length;d++){var g=a.childNodes[d];g&&this.finalizeNode(g)}}};j.prototype.createDelegate=function(a,d){return function(){return d.apply(a,arguments)}};j.prototype.cleanupRoleAttributes=function(a){try{a.removeAttribute("comp_role")}catch(d){}for(var g=
0;g<a.childNodes.length;g++){var j=a.childNodes[g];j&&this.cleanupRoleAttributes(j)}};j.prototype.loadTemplateForDocument=function(a,d,g){if(a&&(a=a.body,this.loadTemplateForNode(a,g),1==d)){this.cleanupRoleAttributes(a);for(var j in g){var d=g[j],a=d.getAttribute("contentEditable"),k=this.innerText(d);null!=a&&"true"==a.toLowerCase()&&""!=k&&(d.setAttribute("comp_state","volatile"),d.setAttribute("comp_original_text",k))}}};j.prototype.loadTemplateForNode=function(a,d){if(a&&!(3==a.nodeType||8==
a.nodeType)){var g=a.getAttribute("comp_role"),j=null;if(g)j="role_"+g,a.id=j,a.removeAttribute("comp_role");if("role_ornament"!=j)if(j&&"role_layout"!=j)d[j]=a;else for(g=0;g<a.childNodes.length;g++)(j=a.childNodes[g])&&this.loadTemplateForNode(j,d)}};j.prototype.stationeryHandler=function(a){this.applyTemplate(a,0)};j.prototype.postcardHandler=function(a){this.applyTemplate(a,1)};j.prototype.saveContentForNode=function(a,d){if(a){var g=a.id?a.id.toLowerCase():"";if(-1!=g.search(/^role_/)){if("role_ornament"==
g||"role_document"==g||"role_title"==g)return;if("role_layout"!=g&&"role_document"!=g){var j=a.innerHTML;j&&this.isContentVolatile(a)&&!this.isContentModified(a)&&(j="<DIV>&nbsp;</DIV>");d[g]=j;return}}for(g=0;g<a.childNodes.length;g++)(j=a.childNodes[g])&&this.saveContentForNode(j,d)}};j.prototype.saveContentForDocument=function(a,d){if(a){this.saveContentForNode(a.body,d);var g=!1;for(key in d){g=!0;break}if(!g)d.role_body=a.body.innerHTML}};j.prototype.applyTemplate=function(a,d){this._savedContentMap=
[];this.saveContentForDocument(this._document,this._savedContentMap);if(a)a=a.replace(/(\r|\n)/g,""),a=a.replace(/.*<body[^>]*>/i,""),a=a.replace(/<\/body>.*/i,""),this._document.body.innerHTML=a;this._document.body.setAttribute("contentEditable","false");this._document.body.setAttribute("unselectable","on");var g=[];this.loadTemplateForDocument(this._document,d,g);if("undefined"!=typeof g.role_body)g.role_body.innerHTML=1!=d?"<DIV>&nbsp;</DIV>":"",this.moveContent(this._savedContentMap,g),g=n.isIE?
400:0,ws.lang.setTimeout(n.hitch(this,function(){this.moveCursorToBodyRole(this._document);if(n.isIE)this._document.body.scrollTop=0}),g)};j.prototype.moveContent=function(a,d){for(toElementId in d)if(!("role_ornament"==toElementId||"role_layout"==toElementId)&&"undefined"!=typeof a[toElementId]&&""!=a[toElementId]){var g=d[toElementId].innerHTML;d[toElementId].innerHTML=a[toElementId];this.isWhitespace(this.innerText(d[toElementId]))&&0==d[toElementId].getElementsByTagName("img").length?d[toElementId].innerHTML=
g:(d[toElementId].removeAttribute("comp_state"),d[toElementId].removeAttribute("comp_original_text"))}};j.prototype.moveCursorToBodyRole=function(a,d,g){if(a){var d=!!d,j=a.getElementById("role_body");if(j)if("undefined"!=typeof window&&window.getSelection)j.focus(),this.isContentVolatile(j)&&!this.isWhitespace(this.innerText(j))?(g=a.defaultView?a.defaultView.getSelection():a.parentWindow.getSelection(),a=a.createRange(),a.selectNodeContents(j),g.removeAllRanges(),g.addRange(a)):(g=a.defaultView?
a.defaultView.getSelection():a.parentWindow.getSelection(),g.collapseToStart());else{d||a.selection.empty();a=a.body.createTextRange();a.moveToElementText(j);g?a.collapse(!1):this.isContentVolatile(j)&&!this.isWhitespace(this.innerText(j))?a.select():a.collapse(!0);try{j.focus()}catch(k){if(0<j.childNodes.length)try{j.childNodes[0].focus()}catch(m){}}}}};j.prototype.isContentVolatile=function(a){return!a?!1:"volatile"==a.getAttribute("comp_state")};j.prototype.isContentModified=function(a){if(!a)return!0;
var d=a.getAttribute("comp_original_text");return this.innerText(a)!=d};j.prototype.isWhitespace=function(a){return 0==a.search(/^(\s|\xA0)*$/)};j.prototype.cleanupDocument=function(){};j.prototype.innerText=function(a){return"undefined"!=typeof a.innerHTML?a.innerHTML:null};return q([j],{init:function(){this._savedContentMap=this._type=this._document=null},loadTemplateForNode:function(){this.inherited(arguments);n.query("div",this._document.body).forEach(function(a){a.style.outline="none"})},finalizeTemplate:function(){this.finalizeNode(this._document.body)}})})},
"url:ws/widget/LinkEditor.html":'<div class="wsMenu" style="background:#fff;width:290px;padding:8px 5px">\n  <img src="${spacer}" class="mainSprite wsCloseBtn" data-dojo-attach-event="onclick: handleCloseX">\n  <div class="contentDiv" data-dojo-attach-point="contentDiv">\n\t<table data-dojo-attach-point="inputTable">\n\t  <tbody>\n\t\t<tr>\n\t\t  <td>${LinkText}</td>\n\t\t</tr>\n\t\t<tr>\n\t\t  <td><div data-dojo-type="ws/widget/DefaultTextbox" maxlength="255" fieldWidth="250px" data-dojo-attach-point="linkText" tabindex="232"></div></td>\n\t\t</tr>\n\t\t<tr>\n\t\t  <td>${LinkTo}:&nbsp;<br style="display:none">\n\t\t\t<input name="scheme" value="${WebSite}" tabindex="233" type="radio" checked>&nbsp;${WebSite}\n\t\t\t<input name="scheme" value="${EmailAddress}" tabindex="234" type="radio">&nbsp;${EmailAddress}\n\t\t  </td>\n\t  </tr>\n\t\t<tr>\n\t\t  <td><div data-dojo-type="ws/widget/DefaultTextbox" maxlength="1024" fieldWidth="250px" data-dojo-attach-point="link" tabindex="235"></div></td>\n\t\t</tr>\n\t\t<tr>\n\t\t  <td style="margin-top:2px"><div data-dojo-type="ws/widget/Button" data-dojo-props="toolbarPosition: \'right\'" style="float: right;" tabindex="236" data-dojo-attach-point="okButton">${OK}</div></td>\n\t\t</tr>\n\t  </tbody>\n\t</table>\n  </div>\n</div>\n\n',
"url:ws/widget/WSEditor.html":'<div style="height:100%;width:100%;">\n<div class="wsEditor" data-dojo-type="dijit/layout/BorderContainer" data-dojo-attach-point="layoutWidget">\n    <div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="toolbarPaneParent" data-dojo-props="region:\'top\'" class="toolbarContainer">\n        <div class="toolbar" data-dojo-attach-point="toolbarPane">\n            <\!-- we need to use &nbsp; as innerHTML for the anchor tags otherwise, IE8/7 will show the text overlayed on top of the icons. Using transparent css color\n            for the text does not work neither --\>\n            <a href="#" class="attachBtn" data-dojo-attach-point="attachButton" title="${ChooseFileTooltip}" data-dojo-attach-event="onClick: openAttachFileDialog"></a>\n            <\!-- Insert Pictures button is dynamically inserted here, by PictureEditor.js --\>\n            <a href="#" class="wsLink enableRTE" data-dojo-attach-point="richTextButton" title="${Basic_SwitchToRichEditor}" data-dojo-attach-event="onclick: enableRichText"><span class="wsLink">${Basic_SwitchToRichEditor}</span></a>\n            <a href="#" data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="fontPicker" disableMouseStates="true" title="${FontType}" data-dojo-props="\'class\': \'fontfamilyIcon\'" >&nbsp;</a>\n            <a href="#" data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="fontSizePicker" disableMouseStates="true" title="${FontSize}" data-dojo-props="\'class\': \'fontsizeIcon\'" >&nbsp;</a>\n            <a href="#" data-dojo-attach-point="boldItem" title="${Bold}" data-dojo-attach-event="onclick: boldClick" class="boldIcon">&nbsp;</a>\n            <a href="#" data-dojo-attach-point="italicItem" title="${Italic}" data-dojo-attach-event="onclick: italicClick" class="italicIcon">&nbsp;</a>\n            <a href="#" data-dojo-attach-point="underlineItem" title="${Underline}" data-dojo-attach-event="onclick: underlineClick" class="underlineIcon">&nbsp;</a>\n            <a href="#" data-dojo-attach-point="forecolorItem" title="${FontColor}" data-dojo-attach-event="onclick: fontColorClick" class="forecolorIcon" data-dojo-attach-point="forecolorButton">&nbsp;</a>\n            <a href="#" data-dojo-attach-point="hilitecolorItem" title="${BackgroundColor}" data-dojo-attach-event="onclick: backgroundColorClick" class="hilitecolorIcon">&nbsp;</a>\n            <a href="#" data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="justifyPicker" disableMouseStates="true" title="${Alignment}" data-dojo-props="\'class\': \'justifyIcon\'" >&nbsp;</a>\n            <a href="#" data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="listPicker" disableMouseStates="true" title="${Lists}" data-dojo-props="\'class\': \'insertListIcon\'" >&nbsp;</a>\n            <a href="#" data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="indentPicker" disableMouseStates="true" title="${Indentation}" data-dojo-props="\'class\': \'indentPickerIcon\'" >&nbsp;</a>\n            <a href="#" title="${HorizontalRule}" data-dojo-attach-event="onclick: horizontalRuleClick" class="insertHorizontalRuleIcon">&nbsp;</a>\n            <a href="#" title="${InsertSmiley}" data-dojo-attach-event="onclick: smileyClick" class="smileyIcon" data-dojo-attach-point="smileyButton">&nbsp;</a>\n            <a href="#" title="${InsertLink}" data-dojo-attach-event="onclick: linkClick" class="linkIcon" data-dojo-attach-point="linkButton">&nbsp;</a>\n            <\!-- Stationery button is dynamically inserted here, by WSEditor.js --\>\n            <a href="#" data-dojo-attach-point="htmlmodeItem" title="${ViewHTMLSource}" data-dojo-attach-event="onclick: htmlModeClick" class="htmlmodeIcon">&nbsp;</a>\n        </div>\n    </div>\n\t<div class="wsInput iframePane" data-dojo-type="ws/widget/Pane" data-dojo-props="region:\'center\'" data-dojo-attach-point="iframePane">\n\t\t<iframe border="none" frameBorder="0" data-dojo-attach-point="iframe" width="100%" height="100%" src="about:blank" tabindex="${tabindex}" name="${id}_body" allowtransparency="true" data-dojo-attach-event="onload: onIframeLoaded"></iframe>\n\t</div>\n\t<div class="wsInput textareaPane" data-dojo-type="ws/widget/Pane" data-dojo-props="region:\'center\'" data-dojo-attach-point="textareaPane" style="display: none; overflow: hidden;">\n\t\t<textarea class="wsInputBare" data-dojo-attach-point="textarea" tabindex="105"></textarea>\n\t</div>\n</div>\n</div>\n',
"url:ws/mail/SendConfirmationPage.html":'<div>\n\t<div data-dojo-type="dijit/layout/BorderContainer" class="sendConfirmation" data-dojo-attach-point="layoutWidget">\n\t\t<div data-dojo-type="ws/widget/Pane" class="confirmationHeader" data-dojo-props="region:\'top\'">\n\t\t\t<div data-dojo-type="ws/widget/Pane"  class="searchInfo" data-dojo-props="region:\'top\'" >\n\t\t\t\t<span class="confirmMessage"><img src="${spacer}" class="mainSprite iconSent" />${ComposeSentConf}</span>\n\t\t\t\t<div class="hrule"></div>\n\n\t\t\t\t<div class="backLine">\n\t\t\t\t\t<span data-dojo-attach-event="onclick: cancel" class="linkButton">\n\t\t\t\t\t\t<img src="${spacer}" class="mainSprite iconBack"><span data-dojo-attach-point="backToButtonLabel"></span>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<img data-dojo-attach-point="backToMessagePipe" src="${spacer}" class="mainSprite pipe" style="display:none" />\n\t\t\t\t\t<span data-dojo-attach-point="backToMessage" data-dojo-attach-event="onclick: cancelToMessage" class="linkButton" style="display:none">\n\t\t\t\t\t\t<img src="${spacer}" class="mainSprite iconBack">${BackToMessageBtn}\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<img data-dojo-attach-point="createDistPipe" src="${spacer}" class="mainSprite pipe" style="display:none"/>\n\t\t\t\t\t<span data-dojo-attach-point="createDistributionListButton" title="${CreateListFromRecipsTip}" data-dojo-attach-event="onclick: createDistributionList" class="linkButton" style="display:none">\n\t\t\t\t\t\t<img src="${spacer}" class="mainSprite iconCreate">${CreateDistListButton}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="AddToTopContacts" data-dojo-props="region:\'top\'" class="confirmationHeader">\n\t\t\t\t<div class="confirmAddTopContactsText">\n\t\t\t\t\t${TopContacts_AddToTopContacts}<span data-dojo-attach-point="addTopContactSuggest"></span>\n\t\t\t\t</div>\n\t\t\t\t<div data-dojo-type="ws/widget/Button" type="Alt3" data-dojo-attach-point="addToTopContactsButton" data-dojo-attach-event="onClick: addSuggestionToTopContacts">\n\t\t\t\t\t${Add}</div>\n\t\t\t\t<div data-dojo-type="ws/widget/Button" type="Alt3" data-dojo-attach-point="addNegativeToTopContactsButton" data-dojo-attach-event="onClick: addNegativeToTopContacts">\n\t\t\t\t\t${NoThanks}</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<\!-- End of header, start content variants --\>\n\t\t<div data-dojo-type="dijit/layout/StackContainer" data-dojo-attach-point="sendConfPages" data-dojo-props="region:\'center\'" style="overflow:hidden">\n\t\t\t<div data-dojo-type="dijit/layout/BorderContainer" data-dojo-attach-point="emptyPage">\n\t\t\t</div>\n\t\t\t<div data-dojo-type="dijit/layout/BorderContainer" data-dojo-attach-point="sendConfHistoric">\n\t\t\t\t<div data-dojo-type="ws/widget/Advertisement" data-dojo-props="region:\'bottom\'" adtype="sendconfirmtext" data-dojo-attach-point="confirmationTxtAdvertisement">\n\t\t\t\t</div>\n\t\t\t\t<div data-dojo-type="ws/widget/Pane" class="feedbackPane" data-dojo-props="region:\'left\'" data-dojo-attach-point="feedbackPane">\n\t\t\t\t\t<div data-dojo-attach-point="sendConfirmationPane">\n\t\t\t\t\t\t<iframe src="about:blank" frameborder="0" scrolling="no" style="width: 340px; height: 270px;"></iframe>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div data-dojo-type="ws/widget/Advertisement" data-dojo-props="region:\'center\'" adtype="sendconfirm" data-dojo-attach-point="confirmationAdvertisement">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div data-dojo-type="dijit/layout/BorderContainer" data-dojo-attach-point="fullSendConfirmationPage">\n\t\t\t\t<div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="fullSendConfirmationPane" data-dojo-props="region:\'center\'">\n\t\t\t\t\t<iframe data-dojo-attach-point="fullSendConfirmationPaneFrame" src="about:blank" frameborder="0" style="width: 100%; height: 100%;"></iframe>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n',
"ws/widget/LinkEditor":function(){require({cache:{"url:ws/widget/LinkEditor.html":'<div class="wsMenu" style="background:#fff;width:290px;padding:8px 5px">\n  <img src="${spacer}" class="mainSprite wsCloseBtn" data-dojo-attach-event="onclick: handleCloseX">\n  <div class="contentDiv" data-dojo-attach-point="contentDiv">\n\t<table data-dojo-attach-point="inputTable">\n\t  <tbody>\n\t\t<tr>\n\t\t  <td>${LinkText}</td>\n\t\t</tr>\n\t\t<tr>\n\t\t  <td><div data-dojo-type="ws/widget/DefaultTextbox" maxlength="255" fieldWidth="250px" data-dojo-attach-point="linkText" tabindex="232"></div></td>\n\t\t</tr>\n\t\t<tr>\n\t\t  <td>${LinkTo}:&nbsp;<br style="display:none">\n\t\t\t<input name="scheme" value="${WebSite}" tabindex="233" type="radio" checked>&nbsp;${WebSite}\n\t\t\t<input name="scheme" value="${EmailAddress}" tabindex="234" type="radio">&nbsp;${EmailAddress}\n\t\t  </td>\n\t  </tr>\n\t\t<tr>\n\t\t  <td><div data-dojo-type="ws/widget/DefaultTextbox" maxlength="1024" fieldWidth="250px" data-dojo-attach-point="link" tabindex="235"></div></td>\n\t\t</tr>\n\t\t<tr>\n\t\t  <td style="margin-top:2px"><div data-dojo-type="ws/widget/Button" data-dojo-props="toolbarPosition: \'right\'" style="float: right;" tabindex="236" data-dojo-attach-point="okButton">${OK}</div></td>\n\t\t</tr>\n\t  </tbody>\n\t</table>\n  </div>\n</div>\n\n'}});
define("ws/widget/LinkEditor","dojo/_base/declare,dojo/text!ws/widget/LinkEditor.html,dojo,dijit,dijit/_Widget,dijit/_TemplatedMixin,dijit/_WidgetsInTemplateMixin,ws/widget/popup,ws/widget/Button".split(","),function(q,n,j,a,d,g,p){return q([d,g,p],{templateString:n,_earlyTemplatedStartup:!0,callbackFunc:null,startup:function(a){this.bookmark=a;j.toggleClass(this.linkText.textbox,"wsInputDefault",!1);this.linkText.textbox.style.paddingLeft="2px";this.linkText._updateClass=function(){};this.linkText._onFocus=
function(){};j.toggleClass(this.link.textbox,"wsInputDefault",!1);this.link.textbox.style.paddingLeft="2px";this.link._updateClass=function(){};this.link._onFocus=function(){}},show:function(a,d){this.destroyOnClose=!0;this.editorWindow=a;j.isWebKit&&a.focus();this.editorDoc=a.document;this.selection=j.isIE?this.editorDoc.selection:this.editorWindow.getSelection();this.range=this.createRange();this.schemes=j.query('[name="scheme"]',this.domNode);this.schemes.every(j.hitch(this,function(a){j.connect(a,
"onclick",j.hitch(this,"schemeChosen"));return!0}));this.url=this.email="";var g=null,g=j.isIE?"Control"==this.selection.type?"":this.range.text:this.range.toString();this.linkText.textbox.value=g;this.currentScheme=0;var h=this.findAnchorNode();if(h){this.link.textbox.value=h.href;if(h.href.match(/mailto:/i)&&this.schemes)this.schemes[1].checked=!0,this.currentScheme=1;if(""==g)this.linkText.textbox.value=j.isIE?h.innerText:h.textContent}ws.widget.popup({popup:this,around:d,padding:[0,0]});("fi-fi"==
Config.PageLocale||"ru-ru"==Config.PageLocale)&&j.query("br",this.domNode).style("display","block");g?this.link.textbox.focus():this.linkText.textbox.focus();this.link.connect(this.link,"onKeyPress",j.hitch(this,"keyPressed",h));this.okButton.connect(this.okButton.domNode,"ondijitclick",j.hitch(this,"createOrCancelLink",h,1));j.publish("popup/open",[])},schemeChosen:function(){if(this.schemes[0].checked){if(1==this.currentScheme)this.currentScheme=0,this.email=this.link.textbox.value,this.link.textbox.value=
"",this.link.textbox.value=this.url}else if(0==this.currentScheme)this.currentScheme=1,this.url=this.link.textbox.value,this.link.textbox.value="",this.link.textbox.value=this.email;this.link.textbox.focus()},keyPressed:function(a,d){13==d.keyCode&&this.createOrCancelLink(a,1)},onClose:function(){this.destroyRecursive()},close:function(a){ws.widget.popup.close(this);this.callbackFunc&&this.callbackFunc(a)},handleCloseX:function(){j.isIE&&this.range&&this.range.select();this.close(!0)},createOrCancelLink:function(a,
d){switch(d){case 1:var g=this.link.textbox.value;if(""==g){this.createOrCancelLink(a,2);this.close();break}!this.schemes||this.schemes[0].checked?g.match(/^https*:/i)||(g="http://"+g):g.match(/^mailto:/i)||(g="mailto:"+g);if(a)a.href=g;var h=this.linkText.textbox.value;""==h&&"Control"!=this.selection.type&&(h=g,h.match(/^mailto:/)&&(h=h.replace(/^mailto:/,"")));if(j.isIE){if("Control"==this.editorWindow.lastSelType)this.range.execCommand("createlink",!1,g);else if(""!=h)if(this.range.text==h)this.range.execCommand("createlink",
!1,g);else if(this.range.text)a?a.innerHTML=h:(this.range.text=h,this.range.moveStart("character",-h.length),this.range.select(),this.range.execCommand("createlink",!1,g),this.range.collapse(!1),this.range.select());else{if(!this.editorWindow.lastSelRange)this.bookmark?(this.range=this.editorDoc.body.createTextRange(),this.range.moveToBookmark(this.bookmark)):(this.editorWindow.focus(),this.range=this.editorDoc.selection.createRange());this.range.text=h;this.range.moveStart("character",-h.length);
this.range.select();this.range.execCommand("createlink",!1,g)}"Control"!=this.editorWindow.lastSelType&&(this.range.collapse(!1),this.range.select())}else h==this.range.toString()?a||(this.editorDoc.execCommand("createlink",!1,g),this.selection.collapseToEnd()):a?a.innerHTML=h:(a=this.editorWindow.document.createElement("a"),a.href=g,this.range.deleteContents(),g=this.editorDoc.createTextNode(h),a.appendChild(g),this.range.insertNode(a)),a&&this.selection.selectAllChildren(a),this.selection.collapseToEnd(),
this.range.detach(),this.editorDoc.execCommand("unlink",!1,null);this.close();break;case 2:if(a)if(j.isIE)this.range.select(),this.editorDoc.execCommand("unlink"),this.editorDoc.execCommand("unselect"),"Control"!=this.selection.type&&(this.range.collapse(!1),this.range.select());else try{for(var g=a.childNodes.length,h=a.parentNode,n=0;n<g;n++)h.insertBefore(a.firstChild,a);h.removeChild(a)}catch(o){}}},createRange:function(){if(!this.selection)return null;var a;if(j.isIE)a=this.editorWindow.lastSelRange?
this.editorWindow.lastSelRange:this.selection.createRange();else try{a=this.selection.getRangeAt(0)}catch(d){a=this.editorDoc.createRange()}return a},findAnchorNode:function(){var a=null;if(j.isIE)if("None"==this.editorWindow.lastSelType){if(a=this.detectAnchorAtPoint())this.range.moveToElementText(a),this.range.select()}else if("Control"==this.editorWindow.lastSelType)a=this.editorWindow.lastSelNode.parentNode,a.href||(a=null);else{if("Text"==this.editorWindow.lastSelType){var d=this.range.htmlText.match(/href="(.+?)"/i);
d&&1<d.length&&this.range.findText(this.range.text,0,0);this.range.collapse(!0);a=this.detectAnchorAtPoint();if(!a)this.range=this.selection.createRange(),this.range.collapse(!1),a=this.detectAnchorAtPoint();this.range=this.selection.createRange()}}else{var d=this.editorDoc.body,g=this.range.startContainer;do if("a"==g.nodeName.toLowerCase()){a=g;break}while(g!=d&&(g=g.parentNode));if(!a&&!this.range.collapsed){g=this.range.endContainer;do if("a"==g.nodeName.toLowerCase()){a=g;break}while(g!=d&&(g=
g.parentNode))}!a&&!this.range.collapsed&&0<this.range.commonAncestorContainer.childNodes.length&&j.query("a",this.range.commonAncestorContainer).every(j.hitch(this,function(d){return this.selection.containsNode(d,!0)?(a=d,!1):!0}))}return a},detectAnchorAtPoint:function(){var a=null;this.range.pasteHTML('<span id="le:tmp.id"></span>');var d=j.byId("le:tmp.id",this.editorDoc);if(d){a=d.parentNode;for(d.parentNode.removeChild(d);a&&"a"!=a.tagName.toLowerCase();)a="body"==a.tagName.toLowerCase()?null:
a.parentNode}return a}})})},"ws/widget/SpellCheckEditor":function(){require({cache:{"url:ws/widget/SpellCheckEditor.css":""}});define("ws/widget/SpellCheckEditor","dojo/_base/declare,dojo/text!ws/widget/SpellCheckEditor.css,dojo,dijit,dojo/_base/window,dijit/_Widget,dijit/_TemplatedMixin,ws/widget/WSEditor,ws/widget/WSMenu,ws/widget/WSMenuItem,ws/widget/WSMenuSeparator,ws/widget/Pane,ws/dom,ws/html,ws/io,ws/widget/Dialogs".split(","),function(q,n,j,a,d,g,p,k,m,l,h,r){return q([g,p,k],{css:{templateString:n},
spellNodeCount:0,misspellings:0,spellChecking:!1,startup:function(){this.inherited(arguments);j.addClass(this.domNode,"spellCheckEditor")},_enableDesignMode:function(a){this.inherited(arguments);this.connect(this.doc(),"onkeypress","endSpellCheck")},toggleSpellCheck:function(){this.spellChecking?this.endSpellCheck():this.spellCheck()},spellCheck:function(a){var c=this.richMode?ws.html.renderedTextContent(this.doc().body):this.textarea.value;ws.io.rpc({action:"SpellCheck",content:{check:c},error:function(a){window.ws_ErrLgr&&
!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for SpellCheck-spellCheck file:SpellCheckEditor.js");ws.widget.Dialogs.ok(a||Config.Strings.ErrorSpellChecking)},load:j.hitch(this,"handleSpellCheckResult",a)})},handleSpellCheckResult:function(a,c){if(ws.lang.isEmptyObject(c.sets))a||ws.widget.Dialogs.ok(Config.Strings.PerfectSpelling),this.onPerfectSpelling();else{this.onImperfectSpelling();this.spellChecking=!0;this.misspellings=this.spellNodeCount=0;this.sets=c.sets;
if(this.richMode){if(this.iframe.style.backgroundColor="#FDF6E4",this.spellDoc=this.doc(),this.spellWin=this.win(),this.spellBody=this.doc().body,j.isIE&&"<"!=this.spellBody.innerHTML.charAt(0))this.spellBody.innerHTML="<wbr>"+this.spellBody.innerHTML}else{if(!this.spellBodyPane)this.spellBodyPane=new r({layoutAlign:"client"}),this.spellBodyPane.domNode.className="spellBody wsInput",this.spellBodyPane.hide(),this.layoutWidget.addChild(this.spellBodyPane);var d=this.textarea.value.replace(/&/g,"&amp;").replace(/</g,
"&lt;"),d=d.replace(/\r?\n/g,"<br />\n");this.spellBodyPane.domNode.innerHTML=d;this.textareaPane.hide();this.spellBodyPane.show();this.layoutWidget.resize();this.spellDoc=document;this.spellWin=window;this.spellBody=this.spellBodyPane.domNode;j.isSafari&&(this.hide(),ws.lang.setTimeout(this,"show",0))}this.highlightErrors()}},onPerfectSpelling:function(){},onImperfectSpelling:function(){},highlightErrors:function(){var a=[],c;for(c in this.sets)a.push(c);var d=RegExp("\\b("+a.join("|")+")\\b");ws.dom.forEachNode(this.spellBody,
null,j.hitch(this,function(a){if(3!=a.nodeType||null!=a.parentNode.id&&"sp-"==a.parentNode.id.substr(0,3))return 0;for(var c=0,h=d.exec(a.nodeValue);h;){var g=h[0],k=this.sets[g],a=a.splitText(h.index),h=a.splitText(g.length),g=this.spellDoc.createElement("a");g.href="#";g.id="sp-"+this.spellNodeCount;g.title=k.length?Config.Strings.ClickToReplaceWith+(j.isIE?"\n":"")+k.join(", "):Config.Strings.NoSpellingSuggestions;g.className="spell";this.connect(g,"onclick","showSpellMenu");a.parentNode.replaceChild(g,
a);g.appendChild(a);a=h;this.spellNodeCount++;this.misspellings++;c+=2;h=null;try{h=d.exec(a.nodeValue)}catch(l){}}return c}))},closeSpellMenu:function(){this.spellMenu&&this.spellMenu.isShowing()&&this.spellMenu.close()},showSpellMenu:function(a){var a=j.fixEvent(a||this.spellWin.event),c=a.target,f=this.sets[c.childNodes[0].nodeValue];this.spellMenu?(this.spellMenu.close(),j.forEach(this.spellMenu.getChildren(),function(a){a.destroy()})):(this.spellMenu=new m,this.spellMenu.startup());for(var e=
j.hitch(this,function(a,c){var d=new l({caption:a});d.onClick=c;this.spellMenu.addChild(d)}),g=0;g<f.length;g++)e(f[g],j.hitch(this,"correctWord",c,f[g]));0<f.length&&this.spellMenu.addChild(new h);e(f.length?Config.Strings.IgnoreWord:Config.Strings.NoSuggestions,j.hitch(this,"ignoreWord",c));e(Config.Strings.IgnoreAll,j.hitch(this,"ignoreAll",c));this.richMode?(e=j.position(this.iframe),f=d.withGlobal(this.win(),"position",j,[c])):(e={x:0,y:0},f={x:a.clientX,y:a.clientY});c=j.contentBox(c);this.spellMenu.open(e.x+
f.x,e.y+f.y+c.h);a.stopPropagation()},changeWord:function(a,c){if(null==c)if(a&&a.childNodes[0]){var d=a.childNodes[0];(c=d.nodeValue)||(c=j.isIE?d.innerText:d.textContent)}else c="";d=this.spellDoc.createTextNode(c);j.place(d,a,"before");j._destroyElement(a)},correctWord:function(a,c){this.changeWord(a,c);this.misspellings--;0==this.misspellings&&this.endSpellCheck()},ignoreWord:function(a){this.correctWord(a,null)},ignoreAll:function(a){for(var a=a.childNodes[0].nodeValue.toLowerCase(),c=0;c<this.spellNodeCount;c++){var d=
this.spellDoc.getElementById("sp-"+c);d&&1==d.childNodes.length&&3==d.childNodes[0].nodeType&&d.childNodes[0].nodeValue.toLowerCase()==a&&this.correctWord(d,null)}},isSpellCheckRunning:function(){return this.spellChecking},endSpellCheck:function(){if(this.spellChecking){for(var a=0;a<this.spellNodeCount;a++){var c=this.spellDoc.getElementById("sp-"+a);c&&""!=c.innerHTML&&this.changeWord(c,null)}this.spellMenu&&this.spellMenu.hide();if(this.richMode)this.iframe.style.backgroundColor="white";else{this.textarea.value=
ws.html.renderedTextContent(this.spellBody);this.spellBodyPane.hide();this.textareaPane.show();a=j._getPadBorderExtents(this.textarea);with(this.textarea.style)width=parseInt(this.textareaPane.domNode.style.width)-a.w+"px",height=parseInt(this.textareaPane.domNode.style.height)-a.h+"px"}this.spellChecking=!1;this.onEndSpellCheck()}},onEndSpellCheck:function(){}})})},"url:ws/mail/SendConfirmationCard.html":'<div>\n\t<\!--\n\t<div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="invitePane" style="display: none;">\n\t\t<table class="sendConfirmationTable" border="0" cellpadding="4" cellspacing="1">\n\t\t\t<tr>\n\t\t\t\t<td colspan="10"><span class="inputLabels">${To}: </span></td>\n\t\t\t\t<td colspan="40"><input type="text" class="wsInput regularInput" data-dojo-attach-point="toInput" /></td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td colspan="10"><span class="inputLabels">${Subject}: </span></td>\n\t\t\t\t<td colspan="40"><input type="text" class="wsInput regularInput" data-dojo-attach-point="subjectInput" /></td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td colspan="50">\n\t\t\t\t\t<textarea class="contentText" data-dojo-attach-point="inviteContent" rows="5" wrap="virtual"></textarea>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td colspan="25" align="right">\n\t\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: sendInvite">${Invite}</div>\n\t\t\t\t</td>\n\t\t\t\t<td colspan="25" align="left">\n\t\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: hide">${Cancel}</div>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t</div>\n\t--\>\n\t<div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="createListPane" style="display: none; overflow: auto;">\n\t\t<div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="creatingList" class="creatingList" style="display:none">\n\t\t\t<img src="${spacer}" class="mainSprite wsCloseBtn" data-dojo-attach-event="onclick: closeCard">\n\t\t\t<table class="createListTable" data-dojo-attach-point="createListTable">\n\t\t\t\t<tr>\n\t\t\t\t\t<td valign="top" data-dojo-attach-point="listNameInputRow">\n\t\t\t\t\t\t<input type="text" class="wsInput listNameInput" data-dojo-attach-point="listNameInput" data-dojo-attach-event="onkeypress: onKeyPress"/>\n\t\t\t\t\t\t<div data-dojo-attach-point="error" class="error"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr data-dojo-attach-point="errorRow">\n\t\t\t\t\t<td valign="top" class="error" data-dojo-attach-point="errorMsg">\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td valign="top">\n\t\t\t\t\t\t<div class="listContacts" data-dojo-attach-point="listContacts"></div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t\t<tr>\n\t\t\t\t\t<td>\n\t\t\t\t\t\t<div data-dojo-attach-point="okToolBar" data-dojo-type="ws/widget/WSToolbar" vizType="Bare">\n\t\t\t\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-point="createListButton" data-dojo-attach-event="onClick: checkRequiredFields" data-dojo-props="toolbarPosition: \'left\'">${Create}</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t</table>\n\t\t</div>\n\t\t<div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="listCreated"  class="listCreated">\n\t\t\t<div class="listCreatedText"><span>${ListCreated}</span></div>\n\t\t\t<div data-dojo-type="ws/widget/WSToolbar" data-dojo-attach-point="listCreatedTB" vizType="Bare">\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick:closeCard" data-dojo-props="toolbarPosition: \'center\'">${OK}</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>',
"ws/mail/SendConfirmationPage":function(){require({cache:{"url:ws/mail/SendConfirmationPage.html":'<div>\n\t<div data-dojo-type="dijit/layout/BorderContainer" class="sendConfirmation" data-dojo-attach-point="layoutWidget">\n\t\t<div data-dojo-type="ws/widget/Pane" class="confirmationHeader" data-dojo-props="region:\'top\'">\n\t\t\t<div data-dojo-type="ws/widget/Pane"  class="searchInfo" data-dojo-props="region:\'top\'" >\n\t\t\t\t<span class="confirmMessage"><img src="${spacer}" class="mainSprite iconSent" />${ComposeSentConf}</span>\n\t\t\t\t<div class="hrule"></div>\n\n\t\t\t\t<div class="backLine">\n\t\t\t\t\t<span data-dojo-attach-event="onclick: cancel" class="linkButton">\n\t\t\t\t\t\t<img src="${spacer}" class="mainSprite iconBack"><span data-dojo-attach-point="backToButtonLabel"></span>\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<img data-dojo-attach-point="backToMessagePipe" src="${spacer}" class="mainSprite pipe" style="display:none" />\n\t\t\t\t\t<span data-dojo-attach-point="backToMessage" data-dojo-attach-event="onclick: cancelToMessage" class="linkButton" style="display:none">\n\t\t\t\t\t\t<img src="${spacer}" class="mainSprite iconBack">${BackToMessageBtn}\n\t\t\t\t\t</span>\n\n\t\t\t\t\t<img data-dojo-attach-point="createDistPipe" src="${spacer}" class="mainSprite pipe" style="display:none"/>\n\t\t\t\t\t<span data-dojo-attach-point="createDistributionListButton" title="${CreateListFromRecipsTip}" data-dojo-attach-event="onclick: createDistributionList" class="linkButton" style="display:none">\n\t\t\t\t\t\t<img src="${spacer}" class="mainSprite iconCreate">${CreateDistListButton}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="AddToTopContacts" data-dojo-props="region:\'top\'" class="confirmationHeader">\n\t\t\t\t<div class="confirmAddTopContactsText">\n\t\t\t\t\t${TopContacts_AddToTopContacts}<span data-dojo-attach-point="addTopContactSuggest"></span>\n\t\t\t\t</div>\n\t\t\t\t<div data-dojo-type="ws/widget/Button" type="Alt3" data-dojo-attach-point="addToTopContactsButton" data-dojo-attach-event="onClick: addSuggestionToTopContacts">\n\t\t\t\t\t${Add}</div>\n\t\t\t\t<div data-dojo-type="ws/widget/Button" type="Alt3" data-dojo-attach-point="addNegativeToTopContactsButton" data-dojo-attach-event="onClick: addNegativeToTopContacts">\n\t\t\t\t\t${NoThanks}</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<\!-- End of header, start content variants --\>\n\t\t<div data-dojo-type="dijit/layout/StackContainer" data-dojo-attach-point="sendConfPages" data-dojo-props="region:\'center\'" style="overflow:hidden">\n\t\t\t<div data-dojo-type="dijit/layout/BorderContainer" data-dojo-attach-point="emptyPage">\n\t\t\t</div>\n\t\t\t<div data-dojo-type="dijit/layout/BorderContainer" data-dojo-attach-point="sendConfHistoric">\n\t\t\t\t<div data-dojo-type="ws/widget/Advertisement" data-dojo-props="region:\'bottom\'" adtype="sendconfirmtext" data-dojo-attach-point="confirmationTxtAdvertisement">\n\t\t\t\t</div>\n\t\t\t\t<div data-dojo-type="ws/widget/Pane" class="feedbackPane" data-dojo-props="region:\'left\'" data-dojo-attach-point="feedbackPane">\n\t\t\t\t\t<div data-dojo-attach-point="sendConfirmationPane">\n\t\t\t\t\t\t<iframe src="about:blank" frameborder="0" scrolling="no" style="width: 340px; height: 270px;"></iframe>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div data-dojo-type="ws/widget/Advertisement" data-dojo-props="region:\'center\'" adtype="sendconfirm" data-dojo-attach-point="confirmationAdvertisement">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t\t<div data-dojo-type="dijit/layout/BorderContainer" data-dojo-attach-point="fullSendConfirmationPage">\n\t\t\t\t<div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="fullSendConfirmationPane" data-dojo-props="region:\'center\'">\n\t\t\t\t\t<iframe data-dojo-attach-point="fullSendConfirmationPaneFrame" src="about:blank" frameborder="0" style="width: 100%; height: 100%;"></iframe>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n',
"url:ws/mail/SendConfirmationPage.css":""}});define("ws/mail/SendConfirmationPage","dojo/_base/declare,dojo/text!ws/mail/SendConfirmationPage.html,dojo/text!ws/mail/SendConfirmationPage.css,dojo,dijit,dijit/_Widget,dijit/_TemplatedMixin,dijit/_WidgetsInTemplateMixin,ws/mail/SendConfirmationCard,ws/address/AddressModel,dijit/layout/BorderContainer,ws/html,ws/lang,ws/string,ws/widget/Advertisement,ws/widget/Pane,ws/widget/util,ws/widget/Button,ws/widget/DefaultTextbox,ws/widget/Dialogs,ws/WebSuite".split(","),
function(q,n,j,a,d,g,p,k,m,l){return q([g,p,k],{templateString:n,css:{templateString:j},_earlyTemplatedStartup:!0,composeWidget:null,defaultSendConf:null,enabledPluginsToggle:!1,openSidePanelAfterSendConf:!1,_isShowing:!1,startup:function(){this.subscribe("Theme/Change","updateFullSendConfirmationIFrame");this.subscribe(this.composeWidget.stackWidget.id+"-selectChild","handleComposeStackSelect");this.subscribe("ws_view-selectChild","handleComposeStackSelect");if(Config.EnableFullSendConfirmationPage){this.defaultSendConf=
this.fullSendConfirmationPage;if(this.confirmationTxtAdvertisement)this.confirmationTxtAdvertisement.destroy(),this.confirmationTxtAdvertisement=null;if(this.confirmationAdvertisement)this.confirmationAdvertisement.destroy(),this.confirmationAdvertisement=null}else this.defaultSendConf=this.sendConfHistoric,this.confirmationTxtAdvertisement.domNode.style.height=a.isMozilla?"45px":"25px",Config.AdFeedbackURL&&0<Config.AdFeedbackURL.length&&0!=Settings.SendConfirmAdMagic&&this.confirmationAdvertisement.addAdFeedBack(Config.AdFeedbackURL)},
trackSendConf:function(a){this.composeWidget&&this.composeWidget.model&&this.composeWidget.reportingDLreqID&&this.composeWidget.model.trackdl(a,this.composeWidget.reportingDLreqID)},setupSendConfirmation:function(a,d,g,c){this.sendConfPages.selectedChildWidget!=this.emptyPage&&this.sendConfPages.selectChild(this.emptyPage);this.layoutWidget.layout();this.toAddresses=[];this.ccAddresses=[];this.bccAddresses=[];d=!this.composeWidget.isPopup&&!this.composeWidget.isStandAlone;g=g&&"display"==ws.WebSuite.composeSrc&&
d?!0:!1;ws.html.setShowing(this.backToMessage,g);ws.html.setShowing(this.backToMessagePipe,g);this.topContactSuggest=c||null;g=null;c&&(c.isEmail?g="&nbsp;("+c.email1+")"||null:(c.firstName&&c.lastName?g="&quot;"+c.firstName+"&nbsp;"+c.lastName+"&quot;":c.screenName&&(g="&quot;"+c.screenName+"&quot;"),c.email1?g=(g?g:"")+"&nbsp;("+c.email1+")":c.email2&&(g=(g?g:"")+"&nbsp;("+c.email2+")")));g?(this.addTopContactSuggest.innerHTML="&nbsp;"+g,this.AddToTopContacts.domNode.style.display=""):this.AddToTopContacts.domNode.style.display=
"none";this.backToButtonLabel.innerHTML=a;this.toAddresses=this.composeWidget.addressListToArray(this.composeWidget.toField);this.ccAddresses=this.composeWidget.addressListToArray(this.composeWidget.ccField);this.bccAddresses=this.composeWidget.addressListToArray(this.composeWidget.bccField);g=1<this.toAddresses.length+this.ccAddresses.length+this.bccAddresses.length?!0:!1;ws.html.setShowing(this.createDistributionListButton,g);ws.html.setShowing(this.createDistPipe,g);this.isFullSendConfirmationShwowing=
!1;this.sendConfPages.selectedChildWidget!=this.defaultSendConf&&this.sendConfPages.selectChild(this.defaultSendConf);this.show();this._isShowing=!0;this.trackSendConf("-SC.SUa");this.setDefaultPage()},updateFullSendConfirmationIFrame:function(){if(this._isShowing&&this.isFullSendConfirmationShwowing){var d=0<Settings.MailboxTier.length?Config.SendConfirmationLinkPremium:Config.SendConfirmationLink||Config.BaseResourcesURL+"SendConfirmation.htm";if(Config.SendConfPageIsRichContent&&!this.composeWidget.isPopup&&
!this.composeWidget.isStandAlone&&ws.WebSuite.SidePanel&&!ws.WebSuite.SidePanel.isClosed())this.enabledPluginsToggle=!0,ws.WebSuite.SidePanel.hide(),this.openSidePanelAfterSendConf=!0;Config.SendConfPageIsAdMagic&&(d="");if(Config.SendConfPageIsRichContent){var g=-1==d.indexOf("?")?"?":"&",d=d+(g+"ts="+encodeURIComponent(a.date.stamp.toISOString(new Date)));document.location.host&&(d+="&retHst="+encodeURIComponent(document.location.host))}Config.EnableThemes&&(d+=(0<=d.indexOf("?")?"&":"?")+this._getThemeColor());
window._g_WS_WebFont&&window._g_WS_WebFont.fontMode&&(d+=(0<=d.indexOf("?")?"&":"?")+"fontCss="+window._g_WS_WebFont.webFontsMap[window._g_WS_WebFont.fontMode]);d+=(0<=d.indexOf("?")?"&":"?")+"ssl=true";if(Config.SendConfPageIsAdMagic)if(g=d,Config.EnableInPageIFrameAds)2==window._g_WS_adsWrapperLoadingState?this.setSendConfAsAdMagic(g):_ws.makeAdsWrpperCalls("SendConfAsAdMagic",a.hitch(this,this.setSendConfAsAdMagic,g));else{var j=this.getMagicMultiSizes(),g=j.magic,j=j.sizes,c=Config.AdsWrapperJsURL.lastIndexOf("/");
c&&(c=Config.AdsWrapperJsURL.substr(0,c+1),d=this.getOtherATParams(d),d=c+ws.string.substituteParams("adsLoader.html?mn={0}&ms={1}&awu={2}&op={3}",g,encodeURIComponent(j),encodeURIComponent(c),encodeURIComponent(d)),ws.html.recreateIframe(this.fullSendConfirmationPane.domNode,d))}else ws.html.recreateIframe(this.fullSendConfirmationPane.domNode,d)}},getOtherATParams:function(a){Config.SendConfPageIsAdMagicXtraQSParam&&(a+="&"+Config.SendConfPageIsAdMagicXtraQSParam);a=a.replace(/\?/g,"");return a=
a.replace(/&/g,";")},getMagicMultiSizes:function(){var a="1200x800,800x400",d=Config.SendConfPageIsAdMagic,g="0";-1<Config.SendConfPageIsAdMagic.indexOf("|")&&(a=Config.SendConfPageIsAdMagic.split("|"),2<a.length?(d=a[0],g=a[1],a=a[2]):(d=a[0],a=a[1]));return{magic:d,sslMagic:g,sizes:a}},setSendConfAsAdMagic:function(d){d=this.getOtherATParams(d);window.adSetOthAT(d);if(this.alreadyShownAds)window.adsReloadAd(this.fullSendConfirmationPane.domNode);else{this.alreadyShownAds=!0;var g=this.getMagicMultiSizes(),
d=g.sslMagic,g=g.sizes;this.fullSendConfirmationPane.domNode.innerHTML="";window.htmlAdWHDyn(d,g,"IFRAME",this.fullSendConfirmationPane.domNode)}(d=a.query("iframe",this.fullSendConfirmationPane.domNode))&&d.length?(d[0].style.width="100%",d[0].style.height="100%",d[0].setAttribute("scrolling","auto")):window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,"SendConfPageIsAdMagic - cant find ad iframe. file:SendConfirmationPage.js");this.trackSendConf("-SC.AMa")},setDefaultPage:function(){ws.reporting.report("Send_Confirmation",
"Mail");this.layoutWidget.layout();this.openSidePanelAfterSendConf=!1;if(Config.EnableFullSendConfirmationPage)this.isFullSendConfirmationShwowing=!0,this.updateFullSendConfirmationIFrame(),this.trackSendConf("-SC.DPa");else{var d=0<Settings.MailboxTier.length?Config.SendConfirmationLinkPremium:Config.SendConfirmationLink||Config.BaseResourcesURL+"SendConfirmation.htm";this.enabledPluginsToggle=!1;if("about:blank"==d)this.feedbackPane.domNode.style.display="none",this.layoutWidget.layout();this.confirmationAdvertisement&&
this.confirmationAdvertisement.domNode&&(a.addClass(this.confirmationAdvertisement.domNode,"confirmationAdvertisement"),this.confirmationAdvertisement.block(!1,!0));this.confirmationTxtAdvertisement&&this.confirmationTxtAdvertisement.domNode&&this.confirmationTxtAdvertisement.block(!1,!0);ws.html.recreateIframe(this.sendConfirmationPane,d);this.trackSendConf("-SC.DPb")}},_getThemeColor:function(){this.themeColorsDone=!0;var a=window._ws_theme.getThemeColorQueryString(!1,!1);a||(a="tcb=39a4d1&tca=7cb311");
return a},createCard:function(){if(!this.sendConfirmationCard)this.sendConfirmationCard=new m({confirmationWidget:this,model:this.composeWidget.model}),this._supportingWidgets.push(this.sendConfirmationCard),this.sendConfirmationCard.startup()},createDistributionList:function(){this.createCard();ws.widget.popup.closeAllPopups();ws.widget.popup({popup:this.sendConfirmationCard,around:this.createDistributionListButton,padding:[60,ws.widget.pointerHeight]});this.sendConfirmationCard.fillOutList(this.toAddresses,
this.ccAddresses,this.bccAddresses);ws.widget.pointer({node:this.sendConfirmationCard.domNode,side:"top",target:this.createDistributionListButton})},handleComposeStackSelect:function(a){a&&a.id&&a.id!=this.id&&this._onHide();this.testShowConfirmationAd(a)},testShowConfirmationAd:function(a){this.confirmationAdvertisement&&a&&a.id&&(a.id==this.id?this.confirmationAdvertisement.blocked&&this.confirmationAdvertisement.block(!1):this.confirmationAdvertisement.blocked||this.confirmationAdvertisement.block(!0))},
addSuggestionToTopContacts:function(){if(this.topContactSuggest){if(!this.addressModel)this.addressModel=new l;this.topContactSuggest.isEmail&&this.topContactSuggest.email?this.addressModel.addAddressToTopContacts({address:this.topContactSuggest.email,load:a.hitch(this,function(d){d.tcdluid?(this.AddToTopContacts.domNode.style.display="none",this.topContactSuggest=null,ws.WebSuite.theMailModel.resetCachedLists(),a.publish("WSFeedbackStart",[Config.Strings.TopContacts_AddressAdded,!0])):ws.widget.Dialogs.ok(Config.Strings.TopContacts_AddressNotAdded)}),
error:a.hitch(this,function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for addressModel.addAddressToTopContacts-addSuggestionToTopContacts file:SendConfirmationCard.js");ws.widget.Dialogs.ok(a||Config.Strings.TopContacts_AddressNotAdded)})}):!this.topContactSuggest.isEmail&&this.topContactSuggest.uid?this.addressModel.addContactToTopContacts({uid:this.topContactSuggest.uid,load:a.hitch(this,function(d){d.tcdluid?(this.AddToTopContacts.domNode.style.display=
"none",this.topContactSuggest=null,ws.WebSuite.theMailModel.resetCachedLists(),a.publish("WSFeedbackStart",[Config.Strings.TopContacts_ContactAdded,!0])):ws.widget.Dialogs.ok(Config.Strings.TopContacts_ContactNotAdded)}),error:a.hitch(this,function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for addressModel.addContactToTopContacts-addSuggestionToTopContacts file:SendConfirmationCard.js");ws.widget.Dialogs.ok(a||Config.Strings.TopContacts_ContactNotAdded)})}):
(this.AddToTopContacts.domNode.style.display="none",this.topContactSuggest=null)}},addNegativeToTopContacts:function(){if(this.topContactSuggest){if(!this.addressModel)this.addressModel=new l;this.topContactSuggest.isEmail&&this.topContactSuggest.email?this.addressModel.addAddressToNegativeTopContacts({address:this.topContactSuggest.email,load:a.hitch(this,function(){this.AddToTopContacts.domNode.style.display="none";this.topContactSuggest=null}),error:a.hitch(this,function(){this.AddToTopContacts.domNode.style.display=
"none";this.topContactSuggest=null})}):!this.topContactSuggest.isEmail&&this.topContactSuggest.uid?this.addressModel.addContactToNegativeTopContacts({uid:this.topContactSuggest.uid,load:a.hitch(this,function(){this.AddToTopContacts.domNode.style.display="none";this.topContactSuggest=null}),error:a.hitch(this,function(){this.AddToTopContacts.domNode.style.display="none";this.topContactSuggest=null})}):(this.AddToTopContacts.domNode.style.display="none",this.topContactSuggest=null)}},cancel:function(){this.cancelCB&&
this.cancelCB()},cancelToMessage:function(){this.cancelCB&&this.cancelCB(!0)},onShow:function(){this.inherited(arguments);a.publish("SendConf/show");this._isShowing=!0},_onHide:function(){if(this._isShowing)this._isShowing=!1,a.publish("SendConf/hide"),Config.SendConfPageIsRichContent&&ws.html.recreateIframe(this.fullSendConfirmationPane.domNode,"about:blank"),this.sendConfPages.selectedChildWidget!=this.emptyPage&&this.sendConfPages.selectChild(this.emptyPage)}})})},"url:ws/mail/SendConfirmationCard.css":"",
"url:ws/widget/SpellCheckEditor.css":""}});define("release/ComposeMessage",[],1);