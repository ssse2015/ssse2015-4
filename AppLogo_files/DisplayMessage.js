//>>built
require({cache:{"url:ws/mail/AddTaskCard.css":"","ws/mail/DisplayMessageWidget":function(){require({cache:{"url:ws/mail/DisplayMessageWidget.html":'<div>\n\t<div data-dojo-type="dijit/layout/BorderContainer" class="displayMessage" data-dojo-attach-point="layoutWidget">\n\t\t<div data-dojo-props="region:\'top\'" data-dojo-type="ws/widget/WSToolbar" data-dojo-attach-point="toolbar" viztype="Controls">\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: backToInbox" data-dojo-attach-point="backToMail" title="${BackToMail}" iconClassName="iconInbox" style="display: none">${BackToMail}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: reportNotSpam" data-dojo-attach-point="notSpamButton" iconClassName="notSpamIcon" title="${NotSpamButton}" style="display:none">${NotSpamButton}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: markUnread" data-dojo-attach-point="keepNewButton" iconClassName="keepNewIcon" style="display:none" tip="${KeepAsNewActionLabel}">${KeepAsNewActionLabel}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: reply, onMouseDown: saveSelection" iconClassName="replyIcon" title="${DisplayReply} (${KeyMailReply})" tip="${DisplayReply} <span>(${KeyMailReply})</span>">${DisplayReply}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: replyAll, onMouseDown: saveSelection" iconClassName="replyAllIcon" title="${DisplayReplyAll} (${KeyMailReplyAll})" tip="${DisplayReplyAll} <span>(${KeyMailReplyAll})</span>">${DisplayReplyAll}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: forward, onMouseDown: saveSelection" iconClassName="forwardIcon" title="${DisplayForward} (${KeyMailForward})" tip="${DisplayForward} <span>(${KeyMailForward})</span>">${DisplayForward}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: restartIM" iconClassName="iconIM" data-dojo-attach-point="restartIMButton" title="${DisplayIM}" style="display:none">${DisplayIM}</div>\n\t\t\t<div data-dojo-type="ws/widget/DropDownButton" data-dojo-attach-point="actionButton" iconClassName="actionIcon" title="${ActionButtonTip}">${ActionButton}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: deleteMessage" iconClassName="delIcon" title="${DeleteButton} (${DeleteKey})" tip="${DeleteButton} <span>(${DeleteKey})</span>">${DeleteButton}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: restoreMessage" data-dojo-attach-point="restoreButton" iconClassName="restoreIcon" style="display:none" title="${RestoreButton}">${RestoreButton}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: reportSpam" data-dojo-attach-point="spamButton" iconClassName="spamIcon" title="${ReportSpamTooltip}" style="display:none">${ReportSpamButton}</div>\n\t\t\t<div data-dojo-props="toolbarPosition: \'right\'" data-dojo-type="ws/widget/Pane" style="white-space: nowrap">\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: nextMessage" data-dojo-attach-point="nextButtonNode" iconClassName="nextButton"></div>\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: prevMessage" data-dojo-attach-point="prevButtonNode" iconClassName="prevButton"></div>\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: backToList" data-dojo-attach-point="backButton" iconClassName="cancelIcon"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div data-dojo-type="ws/widget/Pane" class="messageArea" data-dojo-props="region:\'center\'" data-dojo-attach-point="messageArea">\n\t\t\t<div class="iframeContainer" data-dojo-attach-point="bodyPane">\n\t\t\t\t<iframe name="bodyFrame" data-dojo-attach-point="bodyFrame" class="msgBody" src="about:blank" frameborder="no"></iframe>\n\t\t\t</div>\n\n\t\t\t<div class="headerArea" data-dojo-attach-point="headerArea">\n\t\t\t\t<div data-dojo-type="ws/widget/Pane" class="searchInfo" data-dojo-attach-point="searchInfoPane" style="display: none">\n\t\t\t\t\t<div class="searchData">\n\t\t\t\t\t\t<div data-dojo-attach-point="searchInfoLink" data-dojo-attach-event="onclick: backToList">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="clrFlt">\n\t\t\t\t</div>\n\t\t\t\t<div data-dojo-attach-point="infoStrips">\n\t\t\t\t</div>\n\t\t\t\t<div class="header" data-dojo-attach-point="headerNode">\n\t\t\t\t\t<div class="main" data-dojo-attach-point="mainHeaderNode">\n\t\t\t\t\t\t<div class="headerLinksNode" data-dojo-attach-point="headerLinksNode">\n\t\t\t\t\t\t\t<img src="${spacer}" data-dojo-attach-event="onclick: print,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point="printLink" class="mainSprite printIcon">\n\t\t\t\t\t\t\t<span data-dojo-attach-point="addToLinksNode">\n\t\t\t\t\t\t\t\t<img src="${spacer}" data-dojo-attach-event="onclick: addToCalendar, onmousedown: saveSelection,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point="createEventLink" class="mainSprite calendarIcon">\n\t\t\t\t\t\t\t\t<img src="${spacer}" data-dojo-attach-event="onclick: addToTask, onmousedown: saveSelection,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point="addToTaskLink" class="mainSprite toDoIcon">\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<img src="${spacer}" class="mainSprite newWindowIcon" data-dojo-attach-event="onclick: popOut,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point="newWindowLink">\n\t\t\t\t\t\t\t<img src="${spacer}" class="mainSprite fullMessageIcon" data-dojo-attach-event="onclick: showFullMessage,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point="fullMessageLink" title="${FullMessage}">\n\t\t\t\t\t\t\t<div data-dojo-attach-point="fullDateNode" class="dateField">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div data-dojo-attach-point="subjectContainer" class="subjectContainer">\n\t\t\t\t\t\t\t<span data-dojo-attach-point="editDraft" style="display: none" class="wsLink editDraft" data-dojo-attach-event="onclick: openDraft">${EditDraft}</span> <span class="subject" data-dojo-attach-point="subjectNode"></span>\n\t\t\t\t\t\t\t<img src="${spacer}" class="mainSprite flag" data-dojo-attach-point="flagIcon" data-dojo-attach-event="onclick: toggleFlag">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div data-dojo-attach-point="shortHeaderContainer" class="shortHeader">\n\t\t\t\t\t\t\t<span data-dojo-attach-point="shortHeaderNode"></span><span data-dojo-attach-event="onclick: showFullHeader"><span class="wsLink moreLessLink" title="${MoreInfoTip}">${showDetails}</span><img src="${spacer}" class="mainSprite moreLinkArrw"></span><span data-dojo-attach-point="showSlideShowLnk" data-dojo-attach-event="onclick: showImageSlideshow" class="wsLink showSlideShow" title="${showSlideShowTip}">${showSlideShow}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<table data-dojo-attach-point="fullFromTable" class="fullFromTable" style="display: none">\n\t\t\t\t\t\t\t<tr data-dojo-attach-point="fromRow" class="fieldRow" style="display: none">\n\t\t\t\t\t\t\t\t<td class="label">\n\t\t\t\t\t\t\t\t\t${From}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td data-dojo-attach-point="fullFromNode">\n\t\t\t\t\t\t\t\t\t<span data-dojo-attach-point="fullFromNode"></span><span data-dojo-attach-event="onclick: showShortHeader"><span class="wsLink moreLessLink" title="${HideDetailsTip}">${hideDetails}</span><img src="${spacer}" class="mainSprite lessLinkArrw"></span>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr data-dojo-attach-point="toRow" class="fieldRow" style="display: none">\n\t\t\t\t\t\t\t\t<td class="label">\n\t\t\t\t\t\t\t\t\t${To}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td data-dojo-attach-point="fullToNode">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr data-dojo-attach-point="ccRow" class="fieldRow" style="display: none">\n\t\t\t\t\t\t\t\t<td class="label">\n\t\t\t\t\t\t\t\t\t${Cc}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td data-dojo-attach-point="fullCcNode">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr data-dojo-attach-point="bccRow" class="fieldRow" style="display: none">\n\t\t\t\t\t\t\t\t<td class="label">\n\t\t\t\t\t\t\t\t\t${Bcc}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td data-dojo-attach-point="fullBccNode">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr data-dojo-attach-point="slideShowRow" class="fieldRow" style="display: none">\n\t\t\t\t\t\t\t\t<td data-dojo-attach-point="slideShowShowLink" colspan="2">\n\t\t\t\t\t\t\t\t\t<span data-dojo-attach-event="onclick: showImageSlideshow" class="wsLink" title="${showSlideShowTip}">${showSlideShow}</span>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div data-dojo-attach-point="attachmentsRow" class="attachmentsRow" style="display: none">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div data-dojo-type="ws/widget/Pane" data-dojo-props="region:\'center\'" class="bodyPrompt" style="display: none" data-dojo-attach-point="bodyPromptPane">\n\t\t</div>\n\t\t<div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="bottomPane" data-dojo-props="region:\'bottom\'">\n\t\t\t<div data-dojo-attach-point="adsPane" class="ads" style="display: none">\n\t\t\t\t<div data-dojo-type="ws/widget/Advertisement" adtype="displaymessagetext" data-dojo-attach-point="displayMessageAd">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n',
"url:ws/mail/DisplayMessageWidget.css":""}});define("ws/mail/DisplayMessageWidget","dojo/_base/declare,dojo/text!ws/mail/DisplayMessageWidget.html,dojo/text!ws/mail/DisplayMessageWidget.css,dojo,dijit,dojo/window,dojo/on,dojo/mouse,dijit/_Widget,dijit/_TemplatedMixin,dijit/_WidgetsInTemplateMixin,ws/address/AddressModel,ws/address/AddContactCard,ws/mail/AddTaskCard,ws/widget/Button,dojo/request/iframe,ws/pictures/PictureViewControl,ws/widget/WSMenu,ws/widget/WSMenuItem,ws/widget/WSMenuSeparator,ws/widget/WSInputableMenuItem,ws/calendar/CalendarViewModel,ws/calendar/AddEventDialog,ws/mail/MessageStatusDialog,dojo/dom-attr,ws/Spinner,ws/widget/popup,dijit/_editor/selection,dijit/layout/BorderContainer,ws/calendar/CalendarViewModel,ws/html,ws/io,ws/lang,ws/reporting,ws/string,ws/widget/Dialogs,ws/widget/Pane,ws/widget/util,ws/widget/WSToolbar,ws/im/wim,ws/presence".split(","),
function(n,j,q,a,l,m,e,h,b,d,i,g,p,u,t,s,x,F,v,z,A,y,B,C,D,E){return n([b,d,i],{templateString:j,css:{templateString:q},widgetsInTemplate:!0,_earlyTemplatedStartup:!0,model:null,picturesModel:null,msgInfo:null,addEditDialog:null,calendarModel:null,extraBodyHtml:"<style>.AOLWebSuite .AOLAttachedImage {max-width:"+Config.InsertedPictureLongestEdge+"px; max-height:"+Config.InsertedPictureLongestEdge+"px;} .AOLWebSuite .AOLPicturesFullSizeLink { height: 1px; width: 1px; overflow: hidden; } .AOLWebSuite a {color:blue; text-decoration: underline; cursor: pointer} .AOLWebSuite a.hsSig {cursor: default} .AOLWebSuiteM1 {margin: 10px 20px;} .AOLWebSuiteM2 {margin: 5px;} .AOLWebSuiteM3 {margin: 10px;} .dmItemSelected {padding: 2px !important;text-decoration: none !important;color:#fff !important;background-color: #656565 !important;border-radius: 2px;}</style>",
microFormatStyles:"<link rel='stylesheet' type='text/css' href='"+Config.BaseCssURL+"microformat.css'/>",pictureViewControls:[],showNewWindowLink:!0,showFullMessageLink:!1,showSearchItems:!0,showToolbar:!0,beaconSuffix:"",isPopup:!1,isPreviewPane:!1,enableNextPrev:!0,enableFilters:!0,enableAddressActionMenu:!0,hideFeedbackDelay:7E3,enableBackToMail:!1,isStandAlone:!1,undoFeedbackCB:null,msgMarkedUp:!1,imagesRemoved:!1,linksRemoved:!1,foldersOK:!1,kidTeenAccount:"Y"==ws.UserContext.ParentalControls||
"K"==ws.UserContext.ParentalControls,lastDispMsgTime:0,previewPaneUidBucket:{},addrMap:{},presenceCount:0,_handlers:[],bodyId:0,startup:function(){this.addressModel=new g({fetchDataOnInit:!0,sortable:!0});this.DLreport=this.isPopup&&_ws_isOpenerWS()?opener.ws.reporting.DL:ws.reporting.DL;this.actionButton.menu=this.actionMenu;this.showToolbar?this.connect(this.toolbar,"wrap","wrapToolbar"):this.toolbar.hide();this.updateToolbarState();var c=this.showNewWindowLink&&ws.settings.allowPopups();ws.html.setShowing(this.newWindowLink,
c);ws.html.setShowing(this.fullMessageLink,this.showFullMessageLink);this.defineActionMenu();this.connect(this.actionButton,"updateMenu","updateActionMenu");this.connect(this.headerArea,a.isFF?"DOMMouseScroll":"onmousewheel","wheelScrollOnHeader");this.model&&!this.isPopup&&(this.connect(this.model,"folderListChanged","updateFolderFlag"),this.connect(this.model,"moveListChanged","updateFolderFlag"));this.backToMail.setShowing(this.enableBackToMail);this.restartIMButton.setShowing(!this.isStandAlone&&
Config.EnableAIMPanel);a.subscribe("Suite/onKeyOnPress",this,"_suiteOnKeyPress");a.subscribe("MessageList/flagMessage",this,"onMsgListFlagMessage");a.isIE&&this.isPreviewPane&&(a.subscribe("SplitContainer/BeginSizing",a.hitch(this,"addSizingHandlers")),a.subscribe("SplitContainer/EndSizing",a.hitch(this,"removeSizingHandlers")));if("0"!=Settings.DisplayMessageTextAdMagic&&!this.isPreviewPane)this.adsPane.style.display="";if(!Config.PrintingSupported)this.printLink.style.display="none";c=this.isPreviewPane?
"":" <span>("+Config.Strings.KeyMailPrint+")</span>";this.printLink.setAttribute("title",Config.Strings.PrintMessage+c);c=this.isPreviewPane?"":" <span>("+Config.Strings.KeyMailAddToCalendar+")</span>";this.createEventLink.setAttribute("title",Config.Strings.CreateEvent+c);c=this.isPreviewPane?"":" <span>("+Config.Strings.KeyMailAddToToDo+")</span>";this.addToTaskLink.setAttribute("title",Config.Strings.CreateTodo+c);c=this.isPreviewPane?"":" <span>("+Config.Strings.KeyMailPopout+")</span>";this.newWindowLink.setAttribute("title",
Config.Strings.NewWindowTip+c);this.nextButtonNode.setTip(Config.Strings.NextMessage+" <span>("+Config.Strings.KeyMailNext+")</span>");this.prevButtonNode.setTip(Config.Strings.PreviousMessage+" <span>("+Config.Strings.KeyMailPrevious+")</span>");this.backButton.setTip(Config.Strings.MessageCloseTip+" <span>("+Config.Strings.KeyMailClose+")</span>");!this.isPopup&&!this.isStandAlone?ws.WebSuite.SidePanel.setupAdScroll(this.bodyPromptPane.domNode,"preview"):a.addClass(this.domNode,"popupWin");this.primeIframe(this.bodyFrame);
this.model&&this.model.idleMonitor?this.idleMonitorStarted():a.subscribe("IdleMonitor/started",this,"idleMonitorStarted")},postCreate:function(){this.isPreviewPane&&this.displayMessageAd&&this.displayMessageAd.block(!0)},primeIframe:function(c){c=s.doc(c);c.open();c.write("<html><body><div>empty</div></body></html>");c.close()},setModel:function(c){this.model=c;if(this.statusDialog)this.statusDialog.model=c},setPicturesModel:function(c){this.picturesModel=c;a.forEach(this.pictureViewControls,function(f){f.picturesModel=
c})},onHide:function(){this.hidePopups();this.displayMessageAd&&this.displayMessageAd.block(!0);if(this.updateBtnsTimer)window.clearInterval(this.updateBtnsTimer),this.updateBtnsTimer=null},hidePopups:function(){this.taskView&&this.taskView.close()},scheduleDisplayMessage:function(c,f){this.folder=c;this.uid=f;this.scheduleDisplayMessageHandle=this.connect(this.model,"modelUpdated","_scheduleDisplayMessage")},_scheduleDisplayMessage:function(){this.disconnect(this.scheduleDisplayMessageHandle);0==
this.model.folders.length?this.scheduleDisplayMessageHandle=this.connect(this.model,"folderListChanged","_scheduleDisplayMessage"):this.displayMessage()},displayMessage:function(c,f,b,d,r,k){this.model.trackdl("-DMW.DMv",f);var c=c||this.folder,f=f||this.uid,e=(new Date).getTime(),i=e-this.lastDispMsgTime;if(this.lastFolder==c&&this.lastUid==f&&400>i)this.model.trackdl("-DMW.DMw",f);else{ws.WebSuite.setLastReadMsg(c,f);this.readReportDone=!1;this.skipPreviewReportingOnRet=k;var g=f;this.DLreport.hasEvent(f)||
(k=this.model.getUidData(f),g=this.DLreport.startEvent(null!=k&&k[this.model.columns.Attachment]?this.isPopup?"read_pop_att":"read_mail_att":this.isPopup?"read_pop":"read_mail",f,{opData:f,op1:this.isPopup?"popup":this.isPreviewPane?"preview":"inline"}),this.model.trackdl("-DMW.DMa",f));if(ws.bubbleConfig.isShowable("DM_OPENED_BUBBLE")&&!this.isPopup&&!this.isStandAlone&&ws.bubbleConfig.pinBubblesEnabled&&ws.widget.bubbleManager&&(k=ws.widget.bubbleManager.getPinByName("MiniNavNub"))&&k.isShowing()&&
k.pinned)ws.bubbleConfig.saveAsSeen("DM_OPENED_BUBBLE"),k.expandTip();var h="";this.lastDispMsgTime=e;"Drafts"==c?(ws.html.setShowing(this.addToLinksNode,!1),ws.html.setShowing(this.editDraft,!0)):(ws.html.setShowing(this.addToLinksNode,!0),ws.html.setShowing(this.editDraft,!1));this.lastFolder=c;this.lastUid=f;e=this.model.screenName;this.folder=c;this.uid=f;this.recipSNs=[];if(e==ws.UserContext.ActiveScreenName)if(!Settings.ViewNewOld&&("NewMail"==this.folder||"OldMail"==this.folder))this.folder=
"Inbox";else if(Settings.ViewNewOld&&"Inbox"==this.folder)this.folder="NewMail";a.publish("WSFeedbackStart",[Config.Strings.MessageLoading]);this.model.trackdl("-DMW.DMb",this.uid);this.headerArea.style.visibility="hidden";this.bodyFrame.style.visibility="hidden";this.fullHeaderState=Settings.DisplayFullHeader;this.savedScrollLeft=this.savedScrollTop=0;if(!this.updateBtnsTimer)this.updateBtnsTimer=window.setInterval(a.hitch(this,"updateNextPrevButtons"),2E3);this.model.getMessage({folder:this.folder,
uid:this.uid,screenName:e,peek:d,isPreviewPane:r,load:a.hitch(this,function(c){this.model.trackdl("-DMW.DMc",this.uid);this.previewPaneUidBucket[f]&&delete this.previewPaneUidBucket[f];var d=!1;Config.UseOMS?"Drafts"==c.folderType&&"Drafts"!=this.folder&&(this.model.trackdl("-DMW.DMf",this.uid),this.getComposeCB(a.hitch(this,function(c){this.setToolbarEnabled(!0);ws.WebSuite.composeSrc="displayDraft";c.openDraft("Drafts",this.uid)})),d=!0,this.model.trackdl("-DMW.DMg",this.uid)):this.model.trackdl("-DMW.notOMS",
this.uid);if(!d){this.model.trackdl("-DMW.DMh",this.uid);this.messageReceived(this.uid,c);if(null!=c&&null!=c.body)h=c.body.length;(this.msgInfo.isOfficialMail||this.msgInfo.isCertifiedMail||this.msgInfo.isVoicemail)&&ws.html.setShowing(this.addToLinksNode,!1)}a.publish("WSFeedbackEnd",[Config.Strings.MessageLoading]);this.show();this.model.trackdl("-DMW.DMi",this.uid);d||b&&b(f);this.model.trackdl("-DMW.DMe",this.uid);this.DLreport.endEvent(g,{opResult:"success",msgSize:h})}),error:a.hitch(this,
function(c,b,o){this.model.trackdl("-DMW.DMd",this.uid);this.DLreport.endEvent(g,{opResult:"fail",errType:"api",errCode:o||c,sessionID:Settings.SessionID});a.publish("WSFeedbackEnd",[Config.Strings.MessageLoading]);this.show();this.previewPaneUidBucket[f]?delete this.previewPaneUidBucket[f]:(window.ws_ErrLgr&&!c&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.getMessage-displayMessage file:DisplayMessageWidget.js"),ws.widget.Dialogs.ok(c||Config.Strings.ErrorLoadingMessage,
this.isPreviewPane?a.hitch(this,function(){this.messageArea.hide();this.bodyPromptPane.show();this.layoutWidget.resize()}):a.hitch(this,"backToList")))})})}},messageReceived:function(c,f){if(c==this.uid){for(;0<this._handlers.length;)try{a.disconnect(this._handlers.pop())}catch(b){}this.hidePopups();this.msgInfo=ws.lang.shallowCopy(f,!0);null==this.msgInfo&&this.model.trackdl("-DMW.MRn",c);if(a.isWebKit&&this.bodyFrame&&this.bodyFrame.contentWindow)try{this.bodyFrame.contentWindow.stop()}catch(d){}this.bodyPromptPane.hide();
this.messageArea.show();this.addrMap={};this.presenceCount=0;this.fromMe=ws.UserContext.UserAddress==this.msgInfo.from[0].userInputForm;this.imagesRemoved=this.linksRemoved=!1;this.setupShortHeader();this.setupFullHeader();this.setFullHeader(this.fullHeaderState);if(!this.msgInfo.subject)this.msgInfo.subject="";this.model.trackdl("-DMW.MRp",c);try{this.model.getSearchString()&&Config.HighlightSeachTermInMessageRead?(subject=this.markupSearchString(this.msgInfo.subject),this.subjectNode.innerHTML=
subject||Config.Strings.NoSubject):ws.html.setInnerText(this.subjectNode,this.msgInfo.subject||Config.Strings.NoSubject)}catch(r){window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.ProgErr,r.message?r.message:"*","DisplayMessageWidget.js: exception Msg Headers innerHTML")}a.toggleClass(this.flagIcon,"flagged",!!this.msgInfo.isFlagged);this.checkForLinksAndImageBlock(!0);this.updateInfoStrips();this.updateAttachments();this.bodyWritten=this.bodySetupDone=!1;this.model.trackdl("-DMW.MRq",c);this.writeBody(c);
this.isPreviewPane||this.updateSearchInfo();this.setToolbarEnabled(!0);this.updateToolbarState();this.updateMargins();this.layout();this.headerArea.style.visibility="inherit";this.bodyFrame.style.visibility="inherit";this.getPresence()}},onMouseUp:function(){if(a.isIE&&(this.mouseDownOnBody=!1,this.isPreviewPane)){var c=l.byId("messageList");c&&c.splitContainer&&this._sizingCtor&&c.splitContainer.endSizing()}},onMouseDown:function(c){if(9==a.isIE&&this.bodyFrame.contentWindow&&c&&(c=this.bodyFrame.contentWindow.event,
this.msgBodyWidth&&c.clientX<this.msgBodyWidth&&this.bodyFrame.contentWindow.document.body))if(this.bodyFrame.contentWindow.document.body.scrollWidth>this.msgBodyWidth){var f=Math.max(0,this.bodyFrame.contentWindow.innerHeight-ws.html.getScrollbarWidth());if(c.clientY<f)this.mouseDownOnBody=!0,this.ie9ScrollWhenSelecting()}else this.mouseDownOnBody=!0,this.ie9ScrollWhenSelecting()},ie9ScrollWhenSelecting:function(){if(!this._sizingCtor&&9==a.isIE&&this.mouseDownOnBody){var c=0,f=this.iframeDoc();
if(f&&f.body&&"undefined"!=typeof this.lastMsgBdyY){var b=a.coords(this.messageArea.domNode).h;50<b&&(this.lastMsgBdyY>b-10?c=20:10>this.lastMsgBdyY&&(c=-20));c&&(f.body.scrollTop+=c)}setTimeout(a.hitch(this,this.ie9ScrollWhenSelecting),50)}},addSizingHandlers:function(){document.onselectstart=function(){return!1};var c=s.doc(this.bodyFrame);c.onselectstart=function(){return!1};this._sizingCtor=a.connect(c.body,"onmousemove",a.hitch(this,"onMouseMove"))},removeSizingHandlers:function(){a.disconnect(this._sizingCtor);
this._sizingCtor=null;s.doc(this.bodyFrame).onselectstart=null;document.onselectstart=null},onMouseMove:function(c){var f=l.byId("messageList");if(f&&f.splitContainer){var b=a.position(this.bodyFrame);f.splitContainer.changeSizing(c,c.pageX+b.x,c.pageY+b.y)}},writeBody:function(c){if(this.msgInfo&&"none"!=this.domNode.style.display&&!this.bodyWritten){this.bodyWritten=!0;var f=this.msgInfo.body;if("Drafts"==this.folder&&!Settings.UseRichEditor)f=this.msgInfo.richBody;this.model.trackdl("-DMW.WBr",
c);var b=-1!=f.search(/<div class=.hChat/i),d=0;try{d=a.coords(this.headerArea).h}catch(r){}this.bodyId++;this.onDomReadyRetries=this.onBodyLoadedRetries=1;var k=['<body wsbdid="',this.bodyId,'" onload="if (parent && parent.dijit && parent.dijit.byId) parent.dijit.byId(\'',this.id,'\').onBodyLoaded();" style="'];d&&(k.push("padding-top:"),k.push(d),k.push("px; "));k.push('background-color: white;font-family: Arial,sans-serif;font-size: 10pt;border: 0px;" class="AOLWebSuite">');k.push(this.extraBodyHtml);
b&&k.push(this.microFormatStyles);f=-1!=f.indexOf("<body")?f.replace(/(<body[^>]*>)/i,k.join("")):k.join("")+f+"</body>";ws.widget.popup.unregisterWin(this.bodyFrame.contentWindow);this.model.trackdl("-DMW.WBs",c);c=s.doc(this.bodyFrame);c.body||this.primeIframe(this.bodyFrame);a.isIE?c.documentElement.scrollTop=0:c.body.scrollTop=0;c.body.innerHTML="";10>a.isIE?(c.body.innerHTML=f,D.set(c.body,{wsbdid:this.bodyId,style:"background-color: white;font-family: Arial,sans-serif;font-size: 10pt;border: 0px;"})):
c.body.outerHTML=f;this.watchBodyDomReady();if(!this.readReportDone)this.readReportDone=!0,c=0,f=!1,Settings.PreviewPaneVisible&&Settings.PreviewPaneVisible&&!Settings.ReadInPopup&&(c=1E3,f=!0),b="Read Message - "+this.beaconSuffix,ws.lang.setTimeout(this,a.hitch(this,function(c,f,a){f=ws.WebSuite.getCurrentViewId();if(!this.skipPreviewReporting||!a||!("displayMessage"==f||"composeMessage"==f))this.skipPreviewReportingOnRet||ws.reporting.report(c,"Mail")}),c,b,this.skipPreviewReporting,f)}},iframeDoc:function(){var c=
null;try{c=s.doc(this.bodyFrame)}catch(f){}return c},watchBodyDomReady:function(){var c=this.iframeDoc();if(c&&c.body&&c.body.getAttribute("wsbdid")==this.bodyId)this.onBodyDomReady();else this.onDomReadyRetries&&10>=this.onDomReadyRetries&&(c=10*Math.pow(this.onDomReadyRetries,3),window.setTimeout(a.hitch(this,this.watchBodyDomReady),c),this.onDomReadyRetries++)},onBodyDomReady:function(){this.bodySetupDone||this.bodyReadySetup();this.setHeaderWidth();this.focusBody();this.initializeImages();this.scrollPosReset();
a.isFF&&setTimeout(a.hitch(this,function(){this.iframeDoc().body.scrollTop=0}),100)},onBodyLoaded:function(){var c=this.iframeDoc();c&&c.body&&c.body.getAttribute("wsbdid")==this.bodyId?this._onBodyLoaded():this.onBodyLoadedRetries&&4>=this.onBodyLoadedRetries&&(c=10*Math.pow(this.onBodyLoadedRetries,4),window.setTimeout(a.hitch(this,this.onBodyLoaded),c),this.onBodyLoadedRetries++)},_onBodyLoaded:function(){this.bodySetupDone||this.bodyReadySetup();this.setHeaderWidth();this.focusBody();this.initializeImages();
this.scrollPosReset()},bodyReadySetup:function(){this.bodySetupDone=!0;var c=this.iframeDoc(),f=9>a.isIE?c.body:c;this._handlers.push(a.connect(f,"onscroll",a.hitch(this,"onBodyScroll")));this._handlers.push(a.connect(f,a.isFF?"DOMMouseScroll":"onmousewheel",a.hitch(this,"handleWheel")));this._handlers.push(a.connect(f,"onclick",a.hitch(this,"onMailBodyClick",c)));this._handlers.push(a.connect(f,"onkeypress",a.hitch(this,function(c){this._suiteOnKeyPress(c)})));a.isIE&&this._handlers.push(a.connect(f,
"onmouseup",a.hitch(this,"onMouseUp",c)));9==a.isIE&&(this._handlers.push(a.connect(c,"onmousedown",a.hitch(this,"onMouseDown"))),this._handlers.push(a.connect(c,"onmousemove",a.hitch(this,function(){if(this.bodyFrame.contentWindow&&this.bodyFrame.contentWindow.event){var c=this.bodyFrame.contentWindow.event;if(this.msgBodyWidth&&c.clientX<this.msgBodyWidth)this.lastMsgBdyY=c.clientY;this.lastMsgBdyY=c.clientY;this.mouseDownOnBody=0==c.button?!1:!0}}))));f=this.bodyFrame.contentWindow;if(!f)f=c.parentWindow;
f&&ws.widget.popup.registerWin(f);this.enableNextPrev&&Config.EnableClientSideMessagePrefetch&&ws.lang.setTimeout(this,"_prefetchAdjacentMessages",2E3)},onShow:function(){this.inherited(arguments);this.domNode.style.display="";a.isIE&&this.focusBody();this.displayMessageAd&&!this.isPreviewPane&&this.displayMessageAd.block(!1);!this.isStandAlone&&this.model.getSearchString()&&ws.WebSuite.Navigation.showMnSearch(!0)},onBodyScroll:function(){this.layoutHeaderArea();if(this.slideShowBtn)this.slideShowBtn.domNode.style.display=
"none";var c=this.iframeDoc();c&&((!this.isPreviewPane||this.isPopup)&&ws&&ws.WebSuite&&ws.WebSuite.Navigation&&ws.WebSuite.Navigation.showMnSearch(0==c.body.scrollTop),!this.isPopup&&!this.isStandAlone&&ws.WebSuite.SidePanel.handleScroll({currentTarget:c.body}));this.clearOpenMenus()},wheelScrollOnHeader:function(c){var f=this.iframeDoc();f&&f.body&&(a.isFF?c.axis==c.VERTICAL_AXIS&&(f.body.scrollTop+=20*(c.detail/3)):f.body.scrollTop+=-20*(c.wheelDelta/120))},handleWheel:function(c){if(!this.isPopup&&
!this.isStandAlone){var f=this.iframeDoc();ws.WebSuite.SidePanel.handleWheel(c,null,f.body)}},scrollPosReset:function(){var c=0,f=0;if(this.savedScrollTop)c=Math.abs(this.savedScrollTop),f=this.savedScrollLeft;var a=this.iframeDoc();if(a&&a.body)a.body.scrollTop=c,a.body.scrollLeft=f,0<this.savedScrollTop?this.savedScrollTop=-this.savedScrollTop:this.savedScrollLeft=this.savedScrollTop=0},focusBody:function(){if(!this.isPreviewPane)try{var c=this.iframeDoc();c.body.tabIndex="-1";c.body.focus()}catch(f){}},
_prefetchAdjacentMessages:function(){this.model.prefetchAdjacentMessages(this.msgInfo.uid)},showBodyPrompt:function(c){this.bodyPromptPane.domNode.innerHTML=c;this.messageArea.hide();this.bodyPromptPane.show();"none"!=this.domNode.style.display?this.layoutWidget.resize():this.height=this.width=0},onResized:function(){if(this.isShowing())this.inherited(arguments),this.resizeJamTimer&&clearTimeout(this.resizeJamTimer),this.resizeJamTimer=setTimeout(a.hitch(this,function(){this.updateMargins();this.layout();
a.forEach(this.pictureViewControls,function(c){c.positionSelf()});this.imageSlideshow&&this.imageSlideshow.images&&this.imageSlideshow.images.length&&this.setImageSlideshow(0)}),50)},marginClasses:["AOLWebSuiteM2","AOLWebSuiteM2","AOLWebSuiteM3","AOLWebSuiteM1"],updateMargins:function(){var c=this.iframeDoc();if(c&&c.body)c.body.className="AOLWebSuite "+this.marginClasses[ws.WebSuite.widthMode-1]},setHeaderWidth:function(){var c=this.iframeDoc();if(c&&c.body){var f=c.body.clientWidth;if(9==a.isIE)f=
function(c,f){if(c&&c.currentStyle&&c.currentStyle[f]){var a=c.currentStyle[f];if(0<a.indexOf("px"))return parseInt(a)}return 0},this.msgBodyWidth=f=c.body.clientWidth+f(c.body,"marginLeft")+f(c.body,"marginRight");this.headerArea.style.width=f+"px"}},layoutHeaderArea:function(){var c=this.iframeDoc(),f=0;c&&c.body&&c.body.scrollTop&&0<c.body.scrollTop&&(f=-c.body.scrollTop);this.headerArea.style.top=f+"px";this.setHeaderWidth()},setBodyHeaderPad:function(){var c=this.iframeDoc();if(c&&c.body){var f=
a.coords(this.headerArea);c.body.style.paddingTop=f.h+"px";if(7>=a.isIE)this.bodyFrame.style.height=this.messageArea.h+"px"}},layout:function(){this.isShowing()&&(this.layoutWidget.resize(),this.toolbar.layout(),this.layoutHeaderArea(),this.setBodyHeaderPad(),this.setHeaderWidth(),setTimeout(a.hitch(this,function(){this.setBodyHeaderPad();this.setHeaderWidth()},5)))},popoutLayout:function(){if(this.layoutWidget._contentBox.h<a._getMarginSize(this.toolbar.domNode).h+a._getMarginSize(this.messageArea.domNode).h)this.onResized()},
updateToolbarState:function(){if(this.model){var c=this.model.getFolderByName(this.folder);if(c){var f=c.name.toLowerCase();this.buttonViz=a.map((f in Config.FolderButtons?Config.FolderButtons[f]:Config.FolderButtons.other).split(","),function(c){return"true"==a.trim(c)});if(this.msgInfo)this.msgInfo.containsHchat=-1!=this.msgInfo.body.search(/<div class=.hChat/i);this.isStandAlone||this.restartIMButton.setShowing(this.msgInfo.containsHchat&&Config.EnableAIMPanel);this.spamButton.setShowing(this.buttonViz[4]&&
Config.EnableSpamButton);this.notSpamButton.setShowing(this.buttonViz[5]&&Config.EnableSpamButton);this.restoreButton.setShowing(this.buttonViz[8]||"Deleted"==c.type&&Settings.ViewNewOld);this.keepNewButton.setShowing(this.buttonViz[12]&&Settings.ViewNewOld);this.updateNextPrevButtons()}}},updateNextPrevButtons:function(){if(this.updateBtnsTimer&&(!this.domNode||"none"==this.domNode.style.display))window.clearInterval(this.updateBtnsTimer),this.updateBtnsTimer=null;var c=this.model&&this.model.activeCachedList&&
this.msgInfo&&this.enableNextPrev;this.nextButtonNode&&this.nextButtonNode.domNode&&a.toggleClass(this.nextButtonNode.domNode,"btnDisabled",!c||null==this.model.getAdjacentMessageUid(this.msgInfo.uid,1));this.prevButtonNode&&this.prevButtonNode.domNode&&a.toggleClass(this.prevButtonNode.domNode,"btnDisabled",!c||null==this.model.getAdjacentMessageUid(this.msgInfo.uid,-1))},setToolbarEnabled:function(c){a.forEach(this.toolbar.getChildren(),function(f){f.enable&&f.setEnabled(c)});a.addClass(this.nextButtonNode.domNode,
"btnDisabled");a.addClass(this.prevButtonNode.domNode,"btnDisabled")},updateSearchInfo:function(){var c=this.searchInfoPane.domNode;this.model.getSearchString()?(this.searchInfoLink.innerHTML=Config.UseOMS&&Config.CrossFolderSearch?"<span class='mainSprite wsArrowLeft'></span> "+this.model.getDisplayableSearchHeaderStr(!0):"<span class='mainSprite wsArrowLeft'></span> "+this.model.getDisplayableSearchHeaderStr(),c.style.display="block",ws.WebSuite.Navigation&&!this.isPopup&&ws.WebSuite.Navigation.searchActive(!0,
this.searchInfoPane)):(c.style.display="none",ws.WebSuite.Navigation&&!this.isPopup&&ws.WebSuite.Navigation.searchActive(!1,this.searchInfoPane))},showFullHeader:function(){this.fullHeaderState=!0;this.setFullHeader(this.fullHeaderState);this.layout()},showShortHeader:function(){this.fullHeaderState=!1;this.setFullHeader(this.fullHeaderState);this.layout()},setFullHeader:function(c){a.toggleClass(this.subjectContainer,"subjectShort",!c);ws.html.setShowing(this.shortHeaderContainer,!c);this.fullDateNode.innerHTML=
c?ws.date.formatDateTime(new Date(this.msgInfo.receivedTime),Config.Strings.MsgViewDateFormat):"<span class='time' title='"+ws.date.formatDateTime(new Date(this.msgInfo.receivedTime),Config.Strings.MsgViewDateFormat)+"'>"+ws.date.timeAgo(this.msgInfo.receivedTime)+"</span>";ws.html.setShowing(this.hideLink,c);ws.html.setShowing(this.fullFromTable,c);ws.html.setShowing(this.fromRow,c);ws.html.setShowing(this.toRow,c&&this.msgInfo.displayTo);ws.html.setShowing(this.ccRow,c&&this.msgInfo.displayCc);
ws.html.setShowing(this.bccRow,c&&this.msgInfo.displayBcc)},createHdrAddress:function(c,f,b,d,r,k){var e=document.createElement("span");a.addClass(e,"addressItem");k&&k.appendChild(e);if(Config.EnableAIMPanel&&Config.ShowPresenceIcon&&this.presenceCount<Config.ReadMsgPresCap){this.presenceCount++;k=document.createElement("img");k.src=Config.SpacerImageURL;a.addClass(k,"presIconEmpty");var i=ws.presence.getScreenNameForAddress(c)||c;this.addrMap[i]||(this.addrMap[i]=[]);this.addrMap[i].push(k);e.appendChild(k)}k=
document.createElement("span");e.appendChild(k);if(this.enableAddressActionMenu)k.onclick=a.hitch(this,this.onAddressSelect,c,k),a.addClass(k,"address wsItem"),ws.html.addHoverClass(k,"wsItemHover");c=document.createElement("span");c.innerHTML=f;a.addClass(c,"addressDispForm");k.appendChild(c);d&&(k.appendChild(document.createTextNode(" ")),document.createElement("span"),r&&(b+=","),k.appendChild(document.createTextNode(b)));return e},getPresence:function(){var c=[];this.aimStates=null;for(var f in this.addrMap)c.push(f);
c={users:c,load:a.hitch(this,function(c){if(c&&c.response&&c.response.statusCode&&200==c.response.statusCode&&c.response.data&&c.response.data.users&&c.response.data.users.length){this.aimStates=c.response.data.users;for(var f=0;f<c.response.data.users.length;f++){var b=c.response.data.users[f];if(this.addrMap[b.aimId])for(var d=this.addrMap[b.aimId],e=0;e<d.length;e++)if(this.updateUserPresence(d[e],b.state))d[e].onclick=a.hitch(this,this.launchIM,b.aimId,!1,!0),d[e].style.cursor="pointer"}}}),timeout:1E3};
ws.presence.getPresence(c)},launchIM:function(c,f,a){try{ws.presence.launchIM(c,!0,f)}catch(b){}a&&ws.reporting.reportDLAction("Mail-ReadMessage-AIMPresenceDot")},handleAddContact:function(){this.addContactCard?this.addContactCard.reset():(this.addContactCard=new p({addressModel:this.addressModel,isPopup:this.isPopup}),this.addContactCard.startup());this.currentScreenNameOrEmail?this.addContactCard.setData(null,null,this.currentScreenNameOrEmail,null,null):this.addContactCard.reset();var c=a.position(this.currentAddressItemNode);
this.addContactCard.open({x:c.x,y:c.y});this.addContactCard.popupNode.style.zIndex="998"},handleViewContact:function(){this.currentContact&&(this.isPopup&&_ws_isOpenerWS()?opener.ws.WebSuite.showContactDetails(this.currentContact):ws.WebSuite.showContactDetails(this.currentContact))},onAddressSelect:function(c,f){a.addClass(f,"itemSelected");this.openAddrActionMenu(c,f)},getContactInfo:function(c){var f=this.addressModel.getRecordByEmail(c);!f&&-1==c.indexOf("@")&&(f=this.addressModel.getRecordByScreenName(c));
return{contact:f,snOrEmail:f&&f.screenName?f.screenName:c}},openAddrActionMenu:function(c,f){if(!this.addrActionMenu){var b=[];b.push({emailItem:!0,caption:Config.Strings.AddrAction_Email,iconClass:"mainSprite AddrActionMenuIcon AddrEmail",onClick:a.hitch(this,function(){ws.WebSuite.getCompose(null,a.hitch(this,function(c){c.reset({to:this.currentScreenNameOrEmail||"",backToString:"setFolder"})}))})});Config.EnableAIMPanel&&(b.push({chatItem:!0,caption:Config.Strings.AddrAction_Chat,iconClass:"mainSprite AddrActionMenuIcon AddrChat",
disabled:e,onClick:a.hitch(this,function(){this.launchIM(this.currentScreenNameOrEmail,!1,!1)})}),Config.ShowMobileIcon&&b.push({caption:Config.Strings.AddrAction_Text,iconClass:"mainSprite AddrActionMenuIcon AddrText",onClick:a.hitch(this,function(){this.launchIM(this.currentScreenNameOrEmail,!0,!1)})}));b.push({addItem:!0,caption:Config.Strings.AddrAction_Add,iconClass:"mainSprite AddrActionMenuIcon AddrAdd",onClick:a.hitch(this,function(){this.handleAddContact()})});b.push({viewItem:!0,caption:Config.Strings.AddrAction_Veiw,
iconClass:"mainSprite AddrActionMenuIcon AddrView",onClick:a.hitch(this,function(){this.handleViewContact()})});this.addrActionMenu=ws.widget.createMenu(b);this.connect(this.addrActionMenu,"onClose","clearAddrActionMenu")}var d=this.getContactInfo(c);this.currentScreenNameOrEmail=d.snOrEmail;this.currentContact=d.contact;this.currentAddressItemNode=f;var e=!0,b=ws.presence.getScreenNameForAddress(c)||c;if(this.aimStates&&this.aimStates.length)for(var k=0;k<this.aimStates.length;k++)if(b==this.aimStates[k].aimId){e=
"offline"==this.aimStates[k].state;break}for(var b=d.contact?"none":"",d=d.contact?"":"none",k=this.addrActionMenu.getChildren(),i=0;i<k.length;i++){if(k[i].chatItem)k[i].disabled=e,k[i].updateDisabled();if(k[i].addItem)k[i].domNode.style.display=b;if(k[i].viewItem)k[i].domNode.style.display=d}this.addrActionMenu.bindDomNode(f,null,!0);this.addrActionMenu.openMyself()},clearAddrActionMenu:function(){try{a.removeClass(this.addrActionMenu.boundNode,"itemSelected")}catch(c){}},updateUserPresence:function(c,
f){var a=!1,b="presIconEmpty";switch(f){case "online":case "idle":case "invisible":case "away":case "mobile":b="mainSprite presIcon status-"+f,a=!0}c.className=b;return a},addFullDisplayAddress:function(c,f){if(!c)return"";f.innerHTML="";for(var a=0;a<c.length;a++){var b=c[a].userInputForm.replace("@unknown.domain",""),d=ws.string.escapeXml(b),e=ws.string.escapeXml(c[a].shorterDisplayForm),i=a<c.length-1;this.createHdrAddress(b,e,d,!0,i,f);i&&f.appendChild(document.createTextNode(" "))}return""},
setupFullHeader:function(){this.addFullDisplayAddress(this.msgInfo.from,this.fullFromNode);this.addFullDisplayAddress(this.msgInfo.to,this.fullToNode);this.addFullDisplayAddress(this.msgInfo.cc,this.fullCcNode);this.addFullDisplayAddress(this.msgInfo.bcc,this.fullBccNode)},setupShortHeader:function(){if(this.msgInfo){var c=ws.string.substituteParams(Config.Strings.FromSomeoneTo,"")+" ";this.shortHeaderNode.innerHTML="";var a=this.msgInfo.from[0].userInputForm.replace("@unknown.domain",""),b=ws.string.escapeXml(this.msgInfo.from[0].shorterDisplayForm);
this.model.getSearchString()&&Config.HighlightSeachTermInMessageRead&&(b=this.markupSearchString(b));this.createHdrAddress(a,b,null,!1,!1,this.shortHeaderNode);var d,a=Config.Strings.ToYou;if("Drafts"==this.folder||"Sent"==this.folder)if(this.shortHeaderNode.appendChild(document.createTextNode(c)),this.msgInfo.to.length){if(a=this.msgInfo.to[0].userInputForm,c=[["",a]],d=this.findMoreCount(c),b=ws.string.escapeXml(this.msgInfo.to[0].shorterDisplayForm),this.createHdrAddress(a,b,null,!1,!1,this.shortHeaderNode),
d)c=" "+ws.string.substituteParams(Config.Strings.plusMore,d),a=document.createElement("span"),this.shortHeaderNode.appendChild(a),a.innerHTML=c}else this.shortHeaderNode.appendChild(document.createTextNode(Config.Strings.None));else if(b=ws.UserContext.UserAddress,d=this.isBCCorDistro(),d.isDistro){if(this.shortHeaderNode.appendChild(document.createTextNode(c)),a=this.msgInfo.distroListId,c=[["",a]],d=this.findMoreCount(c),c=a.indexOf("@"),b=-1!=c?a.substr(0,c):a,this.createHdrAddress(a,b,null,!1,
!1,this.shortHeaderNode),d)a=document.createElement("span"),this.shortHeaderNode.appendChild(a),a.innerHTML=" "+ws.string.substituteParams(Config.Strings.plusMore,d)}else d.isBCC&&(a+=" ("+Config.Strings.Bcc+")"),d=this.findMoreCount(this.model.sendAddresses),b=(Settings.HasAggregatedAccount?ws.string.substituteParams("<span class='recipIcon iconS%{0}' title='%{1}'></span>",this.model.getAcctType(b),this.getTipForAddr(b)):"")+ws.string.substituteParams("<span title='%{0}'>%{1}</span>",b,a),b+=0<d?
" "+ws.string.substituteParams(Config.Strings.plusMore,d):"",a=document.createElement("span"),this.shortHeaderNode.appendChild(a),a.innerHTML=c+b}},findMoreCount:function(c){var a=0,b=this.msgInfo.to.concat(this.msgInfo.cc);this.msgInfo.displayBcc&&(b=b.concat(this.msgInfo.bcc));for(var d=0;d<b.length;d++){var e=b[d].userInputForm.toLowerCase(),i=!1;if(-1==e.indexOf("@")&&-1!=e.indexOf("undisclosed")&&-1!=e.indexOf("recipients"))i=!0;else for(var g=0;g<c.length;g++)if(e==c[g][1].toLowerCase()){i=
!0;break}i||a++}return a},isBCCorDistro:function(){var c={isBCC:!1,isDistro:!1},a=this.msgInfo.to.concat(this.msgInfo.cc);this.msgInfo.displayBcc&&(a=a.concat(this.msgInfo.bcc));for(var b=!1,d=this.model.sendAddresses,e=0;e<a.length;e++){for(var i=a[e].userInputForm.toLowerCase(),g=0;g<d.length;g++)if(i==d[g][1].toLowerCase()){b=!0;break}if(b)break}if(!b)this.msgInfo.distroListId?c.isDistro=!0:c.isBCC=!0;return c},updateInfoStrips:function(){var c=function(){var c=document.createElement("div");a.addClass(c,
"bar");var b=document.createElement("div");b.style.cssFloat="left";b.style.styleFloat="left";c.appendChild(b);var f=document.createElement("img");f.src=Config.SpacerImageURL;a.addClass(f,"mainSprite");b.appendChild(f);var d=document.createElement("div");a.addClass(d,"barRightBlock");d.style.cssFloat="right";d.style.styleFloat="right";d.style.marginRight="7px";c.appendChild(d);var o=document.createElement("div");a.addClass(o,"barRight");o.style.display="block";o.style.marginLeft="auto";o.style.marginRight=
"auto";o.style.whiteSpace="nowrap";o.style.overflow="hidden";o.style.textOverflow="ellipsis";c.appendChild(o);var e=document.createElement("div");e.style.clear="both";c.appendChild(e);return{bar:c,barLeft:b,barRight:o,barIcon:f,barAction:d}};this.infoStrips.innerHTML="";for(var f,b,d,e,i=["chrome","spf","virus","images","spam"],g=0;g<i.length;g++)switch(i[g]){case "chrome":a.forEach([["isOfficialMail","official","AOLOfficialMail"],["isCertifiedMail","certified","AOLCertifiedMail"],["isVoicemail",
"official","AOLVoiceMail"]],function(b){if(this.msgInfo[b[0]]){f=c();this.infoStrips.appendChild(f.bar);var d="isCertifiedMail"==b[0],o=Config.Strings[b[2]],i=d?Config.Strings.AOLCertifiedMailMsg:Config.Strings.AOLOfficialMailMsg,b=b[1];a.addClass(f.barLeft,b+"Left");a.addClass(f.bar,b+"Bar");a.addClass(f.barIcon,b+"Icon");f.barLeft.appendChild(document.createTextNode(o));f.barRight.appendChild(document.createTextNode(i+" "));e=document.createElement("a");e.href=d?Config.LearnMoreCertifiedMailURL:
Config.LearnMoreOfficialMailURL;e.target="_blank";e.appendChild(document.createTextNode(Config.Strings.dm_LearnMore));a.addClass(e,"wsLink");a.addClass(e,b+"Link");f.barRight.appendChild(e)}},this);break;case "spf":this.msgInfo.hasFailedSpfCheck&&(f=c(),this.infoStrips.appendChild(f.bar),a.addClass(f.barLeft,"alertLeft"),a.addClass(f.bar,"alertBar"),a.addClass(f.barIcon,"dmAlertIcon"),f.barLeft.appendChild(document.createTextNode(Config.Strings.dm_SpfCheckTitle)),d=ws.string.escapeXml(this.msgInfo.from[0].shorterDisplayForm+
" "+this.msgInfo.from[0].userInputForm),d=ws.string.substituteParams(Config.Strings.dm_SpfCheckMsg,d),f.barRight.appendChild(document.createTextNode(d)));break;case "virus":if(this.msgInfo.hasAttachments)if(!this.msgInfo.isVirusScanned&&!("Drafts"==this.folder||"Sent"==this.folder))f=c(),this.infoStrips.appendChild(f.bar),a.addClass(f.barLeft,"alertLeft"),a.addClass(f.bar,"alertBar"),a.addClass(f.barIcon,"dmAlertIcon"),f.barLeft.appendChild(document.createTextNode(Config.Strings.dm_NotScannedTitle)),
f.barRight.appendChild(document.createTextNode(Config.Strings.dm_NotScannedMsg+" ")),e=document.createElement("a"),e.href=Config.LearnMoreVirusURL,e.target="_blank",e.appendChild(document.createTextNode(Config.Strings.dm_LearnMore)),a.addClass(e,"wsLink alertLink"),f.barRight.appendChild(e);else if(this.msgInfo.isVirusRepaired)f=c(),this.infoStrips.appendChild(f.bar),a.addClass(f.barLeft,"confirmLeft"),a.addClass(f.bar,"confirmBar"),a.addClass(f.barIcon,"confirmIcon"),f.barLeft.appendChild(document.createTextNode(Config.Strings.dm_VirusRemovedTitle)),
f.barRight.appendChild(document.createTextNode(Config.Strings.dm_VirusRemovedMsg+" ")),e=document.createElement("a"),e.href=Config.LearnMoreVirusURL,e.target="_blank",e.appendChild(document.createTextNode(Config.Strings.dm_LearnMore)),a.addClass(e,"wsLink confirmLink"),f.barRight.appendChild(e);break;case "images":if(this.imagesRemoved&&(f=c(),this.imagesRemovedBar=f.bar,a.addClass(f.barLeft,"alertLeft"),a.addClass(f.bar,"alertBar"),a.addClass(f.barIcon,"dmAlertIcon"),f.barLeft.appendChild(document.createTextNode(Config.Strings.dm_ImageBlockedTitle)),
this.infoStrips.appendChild(f.bar),d=document.createElement("span"),f.barRight.appendChild(d),d.appendChild(document.createTextNode(Config.Strings.dm_ImageEnable)),a.addClass(d,"wsLink blockBarLink alertLink"),d.onclick=a.hitch(this,this.restoreImages),b=document.createElement("span"),a.addClass(b,"barPipe"),b.innerHTML="&nbsp;&nbsp;|&nbsp;&nbsp;",f.barRight.appendChild(b),d=document.createElement("span"),f.barRight.appendChild(d),d.appendChild(document.createTextNode(Config.Strings.dm_ImageEnable4Sender)),
a.addClass(d,"wsLink blockBarLink alertLink"),d.onclick=a.hitch(this,this.restoreImagesAddContact),Config.TurnOffLinkAndImageBlockingInSettings))d=document.createElement("span"),f.barAction.appendChild(d),d.appendChild(document.createTextNode(Config.Strings.dm_ImageOffBlocking)),a.addClass(d,"wsLink blockBarRightLink alertLink"),d.onclick=a.hitch(this,this.restoreImagesUpdateSettings);break;case "spam":if(Settings.UserHash>=Config.SpamDispositionThreshold){var h="Spam"===this.model.currentFolder,
p=ws.WebSuite.spamReasonUpdater(this.msgInfo.spamReason,h,this.msgInfo.isSpam,this.model),j=Config.Strings["SD_"+p+"ActPrmy"],m=this.msgInfo.spamReasonDetail,q="";d="";"spamfltroff"==p?(d=Config.Strings.dm_WeThinkSpam+" ",q=Config.Strings.SD_spamfltroffGen+" "):(d=Config.Strings.dm_WhySpam+" ",q=("string"==typeof m&&m.length&&-1!=this.msgInfo.spamReasonMsg.indexOf("{0}")?ws.string.substituteParams(this.msgInfo.spamReasonMsg,m):this.msgInfo.spamReasonMsg)+" ");if(ws.WebSuite.spamReasonShouldBeShown(p,
h)){f=c();this.spamReasonBar=f.bar;a.addClass(f.barLeft,"alertLeft");a.addClass(f.bar,"alertBar");a.addClass(f.barIcon,"dmAlertIcon");f.barLeft.appendChild(document.createTextNode(d));this.infoStrips.appendChild(f.bar);d=document.createElement("img");d.src=Config.SpacerImageURL;a.addClass(d,"mainSprite displayMessage infoIcon");var n=document.createElement("a");n.href=ws.string.substituteParams(Config.spamLearnMoreUrl,Config[p+"LearnMoreId"]);n.target="_blank";n.appendChild(d);a.addClass(n,"wsLink blockBarRightLink alertLink");
var t=a.hitch(this,function(c){ws.WebSuite.spamDLreport(p,"s",c?"g":null);f.barRight.appendChild(document.createTextNode(q));var d=document.createAttribute("title");d.nodeValue=q;f.barRight.attributes.setNamedItem(d);var e=document.createElement("span");e.appendChild(document.createTextNode(j));a.addClass(e,"wsLink blockBarRightLink alertLink");b=document.createElement("span");a.addClass(b,"barPipe");b.innerHTML="&nbsp;&nbsp;|&nbsp;&nbsp;";f.barAction.appendChild(e);if("spamfltroff"==p)f.barAction.appendChild(b),
d=document.createElement("span"),d.appendChild(document.createTextNode(Config.Strings.SD_DontShowAgain)),a.addClass(d,"wsLink blockBarRightLink alertLink"),f.barAction.appendChild(d),d.onclick=a.hitch(this,function(){a.addClass(l.byId("messageList").layoutWidget.domNode,"msgListHiddenSDicon");this.spamReasonBar.style.display="none";this.layout();ws.settings.saveNow({EnableSpamDisposition:!1});Settings.EnableSpamDisposition=!1});f.barAction.appendChild(n);if("permitlist"===p&&""!==this.msgInfo.inputFrom)m=
this.msgInfo.inputFrom;e.onclick=a.hitch(this,function(){ws.WebSuite.spamDLreport(p,"s",c?"g":null,c?"v":"m");c?ws.WebSuite.openSettings("filterSettings"):ws.WebSuite.spmFltrFixIt(p,{load:a.hitch(this,function(){ws.WebSuite.theMailModel.reportSpamMessages({checkUndo:!h,uids:[this.msgInfo.uid],isSpam:!h,load:a.hitch(this,function(){if("spamfltroff"===p)this.spamReasonBar.style.display="none",this.layout(),a.publish("WSFeedbackStart",[Config.Strings.SD_spamfltroffFdbk,!0,null]);else{var c=Config.Strings.SD_stngChgdFdbk;
ws.WebSuite.sdTip&&ws.WebSuite.sdTip.hide();if("userrule"===p)e.innerHTML=Config.Strings.SD_userruleActView,e.onclick=function(){ws.WebSuite.openSettings("filterSettings")},c=Config.Strings.SD_fltrDelFdbk;a.publish("WSFeedbackStart",[c,!0])}}),error:function(c){window.ws_ErrLgr&&!c&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.reportSpamMessages-spamAction file:MessageListView.js");ws.widget.Dialogs.ok(c||Config.Strings.ReportSpamError)}})}),error:function(){}},
m)})});if("userrule"===p){d=a.hitch(this,function(){t()});var u=a.hitch(this,function(){q=Config.Strings.SD_userruleUnclr+" ";j=Config.Strings.SD_userruleActView;n.href=ws.string.substituteParams(Config.spamLearnMoreUrl,Config.userruleNoFixLearnMoreId);t(!0)});ws.WebSuite.canFixBadFltr(m,d,u)}else t()}}break;case "links":if(this.linksRemoved&&(f=c(),this.linksRemovedBar=f.bar,a.addClass(f.barLeft,"alertLeft"),a.addClass(f.bar,"alertBar"),a.addClass(f.barIcon,"dmAlertIcon"),f.barLeft.appendChild(document.createTextNode(Config.Strings.dm_LinkBlockedTitle)),
this.infoStrips.appendChild(f.bar),d=document.createElement("span"),f.barRight.appendChild(d),d.appendChild(document.createTextNode(Config.Strings.dm_LinkEnable)),a.addClass(d,"wsLink blockBarLink alertLink"),d.onclick=a.hitch(this,this.restoreLinks),b=document.createElement("span"),a.addClass(b,"barPipe"),b.innerHTML="&nbsp;&nbsp;|&nbsp;&nbsp;",f.barRight.appendChild(b),d=document.createElement("span"),f.barRight.appendChild(d),d.appendChild(document.createTextNode(Config.Strings.dm_LinkEnable4Sender)),
a.addClass(d,"wsLink blockBarLink  alertLink"),d.onclick=a.hitch(this,this.restoreLinksAddContact),Config.TurnOffLinkAndImageBlockingInSettings))d=document.createElement("span"),f.barAction.appendChild(d),d.appendChild(document.createTextNode(Config.Strings.dm_LinkOffBlocking)),a.addClass(d,"wsLink blockBarRightLink  alertLink"),d.onclick=a.hitch(this,this.restoreLinkUpdateSettings)}},checkForLinksAndImageBlock:function(c){var a=!!this.msgInfo.stripImagesKey&&-1!=this.msgInfo.body.indexOf(this.msgInfo.stripImagesKey.toLowerCase()),
b=!!this.msgInfo.stripLinksKey&&-1!=this.msgInfo.body.indexOf(this.msgInfo.stripLinksKey.toLowerCase()),d=this.addressModel.getRecordByEmail(this.msgInfo.from[0].userInputForm);if(a&&(!Settings.DisplayImageWarning||this.fromMe||d||ws.WebSuite.isDispMessageSafe(this.uid)))this._restoreImages(c),a=!1;if(b&&(!Settings.DisplayLinkWarning||this.fromMe||d||ws.WebSuite.isDispMessageSafe(this.uid,!0)))this._restoreLinks(c),b=!1;this.linksRemoved=b;this.imagesRemoved=a},_restoreImages:function(c){this.msgInfo.body=
this.msgInfo.body.replace(RegExp(this.msgInfo.stripImagesKey,"gi"),"");this.msgInfo.stripImagesKey=null;ws.WebSuite.setDispMessageSafe(this.uid);c||this.messageReceived(this.uid,this.msgInfo)},_restoreLinks:function(c){this.msgInfo.body=this.msgInfo.body.replace(RegExp(this.msgInfo.stripLinksKey,"gi"),"");this.msgInfo.stripLinksKey=null;ws.WebSuite.setDispMessageSafe(this.uid,!0);if(!c){if((c=this.iframeDoc())&&c.body)this.savedScrollTop=c.body.scrollTop,this.savedScrollLeft=c.body.scrollLeft;this.messageReceived(this.uid,
this.msgInfo)}},_addContact:function(){this.addressModel.createOrModifyContact({uid:0,category:"Auto-Added",email1:this.msgInfo.from[0].userInputForm,load:a.hitch(this,function(){a.publish("WSFeedbackStart",[Config.Strings.SenderAdded,!0])})})},restoreImages:function(){if(this.imagesRemoved)this._restoreImages(),this.imagesRemoved=!1},restoreLinks:function(){if(this.linksRemoved)this._restoreLinks(),this.linksRemoved=!1},restoreImagesAddContact:function(){if(this.imagesRemoved)this._restoreImages(),
this._addContact(),this.imagesRemoved=!1},restoreLinksAddContact:function(){if(this.linksRemoved)this._restoreLinks(),this._addContact(),this.linksRemoved=!1},restoreImagesUpdateSettings:function(){if(this.imagesRemoved){this._restoreImages();this.messageReceived(this.uid,this.msgInfo);ws.settings.saveNow({DisplayImageWarning:!1});Settings.DisplayImageWarning=!1;var c=l.byId("GeneralSettings");if(c&&c.DisplayImageWarning.checked)c.DisplayImageWarning.checked=!1;this.imagesRemoved=!1}},restoreLinkUpdateSettings:function(){if(this.linksRemoved){this._restoreLinks();
this.messageReceived(this.uid,this.msgInfo);ws.settings.saveNow({DisplayLinkWarning:!1});Settings.DisplayLinkWarning=!1;var c=l.byId("GeneralSettings");if(c&&c.DisplayLinkWarning.checked)c.DisplayLinkWarning.checked=!1;this.linksRemoved=!1}},restartIM:function(){var c=this.msgInfo.body.search(/<div class=.hChat/i);if(-1!=c){var c=this.msgInfo.body.search(/<div id=.AOLMsg/i),a=this.msgInfo.body.lastIndexOf("</div>"),b=!1;-1!=a&&(a+=6,this.isPopup&&_ws_isOpenerWS()?(opener.ws.presence.launchAIMPanel("",
!1,!0),b=opener.ws.im.wim.restoreConversation(this.msgInfo.to[0].shorterDisplayForm,this.msgInfo.body.substr(c,a-c)),opener.focus()):(ws.presence.launchAIMPanel("",!1,!0),b=ws.im.wim.restoreConversation(this.msgInfo.to[0].shorterDisplayForm,this.msgInfo.body.substr(c,a-c))));b||ws.widget.Dialogs.ok(Config.Strings.ChatError_Restore);ws.reporting.reportDLAction("Mail-Aim-SavedIMRestarted")}},getTipForAddr:function(c){if(c)for(var a=this.model.getIdentities(),b=0;b<a.length;b++)if(c.toLowerCase()==a[b][1])return a[b][0]==
a[b][1]?a[b][1]:a[b][0]+"  "+a[b][1];return c},reply:function(){this.composeResponse("reply")},replyAll:function(){this.composeResponse("replyAll")},forward:function(){this.composeResponse("forward")},composeResponse:function(c){if(this.getComposeCB)this.msgInfo.selectedText=this.selectedHtml,this.getComposeCB(a.hitch(this,function(a){a.isStandAlone=this.isStandAlone;a[c](this.msgInfo)}))},openDraft:function(){this.getComposeCB(a.hitch(this,function(c){c.openDraft(this.model.currentFolder,this.uid)}))},
onMsgListFlagMessage:function(c,b,d){if(this.isPreviewPane&&c==this.folder){for(var c=0,e=!1;c<b.length;){if(b[c]==this.msgInfo.uid){e=!0;break}c++}if(e)this.msgInfo.isFlagged=d,a.toggleClass(this.flagIcon,"flagged",d)}},toggleFlag:function(){var c=!this.msgInfo.isFlagged;this.msgInfo.isFlagged=c;a.toggleClass(this.flagIcon,"flagged",c);this.model.flagMessages({folder:this.folder,uids:[this.msgInfo.uid],flag:c,fromDisplayMessage:!0,load:a.hitch(this,function(){a.publish("WSFeedbackStart",[c?Config.Strings.MessageFlagged:
Config.Strings.MessageUnflagged,!0])}),error:function(c){window.ws_ErrLgr&&!c&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.flagMessages-toggleFlag file:DisplayMessageWidget.js");ws.widget.Dialogs.ok(c||Config.Strings.ErrorSettingFlag)}})},markRead:function(){this.changeReadState(!0)},markUnread:function(){this.changeReadState(!1)},changeReadState:function(c){var b=this.getNextUid();this.model.changeMessagesReadState({msgInfos:[this.msgInfo],folder:this.folder,
uids:[this.msgInfo.uid],read:c,load:a.hitch(this,function(){a.publish("WSFeedbackStart",[c?Config.Strings.MessageMarkedRead:Config.Strings.MessageMarkedNew,!0])}),error:function(c){window.ws_ErrLgr&&!c&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.changeMessagesReadState-changeReadState file:DisplayMessageWidget.js");ws.widget.Dialogs.ok(c||Config.Strings.MarkReadError)}});var d=this.model.getFolderByName(this.folder).type;(c&&Config.EnableMoveForMarkSeen&&
"NewMail"==d||!c&&Config.EnableMoveForMarkUnseen&&"OldMail"==d)&&this.showNextOrList(b)},deleteMessage:function(){var c=this.model.getFolderByName(this.folder);if("Deleted"==c.type||"Spam"==c.type)ws.widget.Dialogs.okCancel(Config.Strings.PermDeleteConfirmation,a.hitch(this,function(c){c&&this.deleteMessageHelper()}));else return this.deleteMessageHelper();return""},deleteMessageHelper:function(c){var b=this.getNextUid(),d="",d=!c||"string"!=typeof c?Config.Strings.MessageDeleted:ws.string.substituteParams(Config.Strings.MessageMoved,
c);this.setToolbarEnabled(!1);var e=this.msgInfo.uid;this.model.deleteMessages({folder:this.folder,uids:[e],checkUndo:!0,reason:c?"movread":"delread",skipRefetchCounts:!0,load:a.hitch(this,function(c){if(this.isPopup)Settings.GotoNextOnDelete?this.showNextOrList(b,a.hitch(this,function(){this._undoLastAction=!Config.UseOMS&&(Config.EnableRestoreButton||Settings.ViewNewOld)?c.canUndo?a.hitch(this,"_restoreMessage",e):null:c.responseUIDs?c.canUndo?a.hitch(this,"_undoMoveMessages",c.responseUIDs,Config.DeletedItemsFolderName,
this.folder):null:null;a.publish("WSFeedbackStart",[d,!0,this._undoLastAction])})):(this.undoFeedbackCB&&this.undoFeedbackCB("Delete",c,d,[e],this.folder),this.showNextOrList(b));else{var i=null,i=!Config.UseOMS&&(Config.EnableRestoreButton||Settings.ViewNewOld)?c.canUndo?a.hitch(this,"_restoreMessage",e):null:c.canUndo?a.hitch(this.model,"undoMoveMessages",c.responseUIDs,Config.DeletedItemsFolderName,this.folder):null;a.publish("WSFeedbackStart",[d,!0,i])}}),error:function(c){window.ws_ErrLgr&&!c&&
ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.deleteMessages-deleteMessageHelper file:DisplayMessageWidget.js");ws.widget.Dialogs.ok(c||Config.Strings.DeleteMessageError)}});this.isPopup||this.showNextOrList(b)},_undoReportSpamMessages:function(c){this.model.undoReportSpamMessages(c)},_undoMoveMessages:function(c,a,b){this.model.undoMoveMessages(c,a,b)},restoreMessage:function(){this._restoreMessage()},_restoreMessage:function(c){var b=this.getNextUid();this.setToolbarEnabled(!1);
this.model.restoreMessages({folder:Config.DeletedItemsFolderName,uids:c?[c]:[this.msgInfo.uid],load:a.hitch(this,function(d){c&&(b=c);this.isPopup?Settings.GotoNextOnDelete?this.showNextOrList(b,a.hitch(this,function(){this.model.refetchFolderIndex(this.model.currentFolder);a.publish("WSFeedbackStart",[Config.Strings.MessageRestored,!0])})):(this.undoFeedbackCB&&this.undoFeedbackCB("None",d,Config.Strings.MessageRestored),this.showNextOrList(b)):(this.model.refetchFolderIndex(this.model.currentFolder),
c&&this.showNextOrList(b),a.publish("WSFeedbackStart",[Config.Strings.MessageRestored,!0]))}),error:function(c){window.ws_ErrLgr&&!c&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.restoreMessages-_restoreMessage file:DisplayMessageWidget.js");ws.widget.Dialogs.ok(c||Config.Strings.RestoreMessageError)}});!this.isPopup&&!c&&this.showNextOrList(b)},moveMessage:function(c,b){var d=this.getNextUid();"Deleted"!=this.model.getFolderByName(this.folder).type&&c==
Config.DeletedItemsFolderName?this.deleteMessageHelper(b):c==Config.SpamFolderName?this.spamAction(!0):(this.setToolbarEnabled(!1),this.model.moveMessages({folder:this.folder,destFolder:c,uids:[this.msgInfo.uid],checkUndo:!0,skipRefetchCounts:!0,load:a.hitch(this,function(e){if(this.isPopup)Settings.GotoNextOnDelete?this.showNextOrList(d,a.hitch(this,function(){this._undoLastAction=e.canUndo?a.hitch(this,"_undoMoveMessages",e.responseUIDs,c,this.folder):null;a.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.MessageMoved,
b),!0,this._undoLastAction])})):(this.undoFeedbackCB&&this.undoFeedbackCB("Move",e,ws.string.substituteParams(Config.Strings.MessageMoved,b),c,this.folder),this.showNextOrList(d));else{var i=e.canUndo?a.hitch(this.model,"undoMoveMessages",e.responseUIDs,c,this.folder):null;a.publish("WSFeedbackStart",[ws.string.substituteParams(Config.Strings.MessageMoved,b),!0,i])}}),error:function(c){window.ws_ErrLgr&&!c&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.moveMessages-moveMessage file:DisplayMessageWidget.js");
ws.widget.Dialogs.ok(c||Config.Strings.MoveMessageError)}}),this.isPopup||this.showNextOrList(d))},backToInbox:function(){ws.reporting.reportDLAction("Mail-ReadMessage-BackToInbox");this.backToList(!0)},reportSpam:function(){this.spamAction(!0)},reportNotSpam:function(){this.spamAction(!1)},spamAction:function(c){var b=a.hitch(this,function(b,f,d,e,o){var i=this.getNextUid();this.setToolbarEnabled(!1);var h;this.model.reportSpamMessages({checkUndo:c&&!d,folder:this.folder,uids:[this.msgInfo.uid],
isSpam:c,skipRefetchCounts:!0,unsubscribe:d?d:null,load:a.hitch(this,function(w){var r=a.hitch(this,function(b,i){if(c)if(w._showSpamOffAlert&&!d){var r=Settings&&"Off"==Settings.PersonalAdaptiveSpamFilterLevel?d?ws.string.substituteParams(Config.Strings.UnsubConfirm,null!=o?o:e):Config.Strings.MessageMarkedSpam:Config.Strings.SD_spamfltroffMrkSpmFdbk;a.publish("WSFeedbackStart",[ws.string.unescapeXml(r),!0,null])}else this.isPopup?Settings.GotoNextOnDelete?this.showNextOrList(i,a.hitch(this,function(){h=
this.model.isInboxNewOld(this.model.currentFolder)?a.hitch(this,"_undoReportSpamMessages",b.responseUIDs):a.hitch(this,"_undoMoveMessages",b.responseUIDs,Config.SpamFolderName);this._undoLastAction=b.canUndo?h:null;a.publish("WSFeedbackStart",[ws.string.unescapeXml(d?ws.string.substituteParams(Config.Strings.UnsubConfirm,null!=o?o:e):Config.Strings.MessageMarkedSpam),!0,this._undoLastAction])})):(this.undoFeedbackCB&&(this.model.isInboxNewOld(this.model.currentFolder)?this.undoFeedbackCB("Spam",b,
d?ws.string.substituteParams(Config.Strings.UnsubConfirm,null!=o?o:e):Config.Strings.MessageMarkedSpam):this.undoFeedbackCB("Move",b,Config.Strings.MessageMarkedSpam,Config.SpamFolderName,this.folder)),this.showNextOrList(i)):(h=this.model.isInboxNewOld(this.model.currentFolder)?a.hitch(this.model,"undoReportSpamMessages",b.responseUIDs):a.hitch(this.model,"undoMoveMessages",b.responseUIDs,Config.SpamFolderName),r=b.canUndo?h:null,a.publish("WSFeedbackStart",[ws.string.unescapeXml(d?ws.string.substituteParams(Config.Strings.UnsubConfirm,
null!=o?o:e):Config.Strings.MessageMarkedSpam),!0,r]));else r=f&&"userrule"===g?Config.Strings.SD_fltrDelFdbk:f?Config.Strings.SD_stngChgdFdbk:Config.Strings.MessageMarkedNotSpam,a.publish("WSFeedbackStart",[ws.string.unescapeXml(r),!0,null])},w,i);w._showSpamOffAlert&&"nonSDdlg"===b?ws.widget.Dialogs.showSpamOffAlert(r):r()}),error:function(c){window.ws_ErrLgr&&!c&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.reportSpamMessages-spamAction file:DisplayMessageWidget.js");
ws.widget.Dialogs.ok((d?ws.string.substituteParams(Config.Strings.UnsubError,null!=o?o:e):c)||Config.Strings.ReportSpamError)}});(!this.isPopup||!c)&&this.showNextOrList(i)}),d=this.model.getUidData(this.msgInfo.uid);if(c&&Settings.EnableUnsubscribing&&d[this.model.columns.canUnsubscribe]){var e=d[this.model.columns.FromToAddress]||Config.Strings.None,i=null;Config.UseOMS&&Config.FriendlyName&&null!=d[this.model.columns.Description]&&""!=d[this.model.columns.Description]&&!0==Settings.ShowSenderDisplayName&&
(i=ws.string.escapeXml(d[this.model.columns.Description]));ws.widget.Dialogs.showUnsubDialog([this.msgInfo.uid],e,i,b)}else if(Settings.UserHash>=Config.SpamDispositionThreshold){var e={},i="Spam"===this.model.currentFolder,g=ws.WebSuite.spamReasonUpdater(this.msgInfo.spamReason,i,d[this.model.columns.isSpam],this.model),d=this.msgInfo.spamReasonDetail;ws.WebSuite.spamReasonShouldBeShown(g,i)&&("spamfltroff"===g?e={}:e[g]?""!==d&&-1===e[g].indexOf(d)&&e[g].push(d):e[g]=""!==d?[d]:[]);ws.lang.isEmptyObject(e)?
b("nonSDdlg"):ws.widget.Dialogs.showSpamDisp(e,[this.msgInfo.uid],!0,i,b)}else b("nonSDdlg")},nextMessage:function(){a.hasClass(this.nextButtonNode.domNode,"btnDisabled")||this.nextPrevMessage(1)},prevMessage:function(){a.hasClass(this.prevButtonNode.domNode,"btnDisabled")||this.nextPrevMessage(-1)},nextPrevMessage:function(c){if(c=this.model.getAdjacentMessageUid(this.msgInfo.uid,c))this.setToolbarEnabled(!1),this.displayMessage(this.folder,c)},getNextUid:function(){var c=this.msgInfo.uid;return this.model.getAdjacentMessageUid(c,
1)||this.model.getAdjacentMessageUid(c,-1)},showNextOrList:function(c,a){Settings.GotoNextOnDelete&&c&&this.enableNextPrev?this.displayMessage(this.folder,c,a):ws.lang.setTimeout(this,"backToList",100,!1,c)},backToList:function(c,b,d){if(this.backToListCB){"boolean"!=typeof c&&(c=null);if(!b)b=this.uid;var e=this.model.activeCachedList.GetAvailableRowsForUIDs([b]);this.backToListCB(c,1==e.length?e[0]:-1,b,d);a.publish("ccgRefresh",[!0])}else ws.io.closeWindow()},defineActionMenu:function(){this.actionButton.menuDefinition=
[{caption:Config.Strings.MarkReadActionLabel,onClick:a.hitch(this,"markRead")},{caption:Settings.ViewNewOld?Config.Strings.KeepAsNewActionLabel:Config.Strings.MarkUnreadActionLabel,onClick:a.hitch(this,"markUnread")},{caption:Config.Strings.FlagForFollowUp,onClick:a.hitch(this,"toggleFlag")},{caption:Config.Strings.ClearFlag,onClick:a.hitch(this,"toggleFlag")},{caption:Config.Strings.MailFilter_CreateFilter,onClick:a.hitch(this,"onClickCreateFilter")},{separator:!0},{caption:Config.Strings.SearchForSubject,
onClick:a.hitch(this,"searchForSubject")},{caption:Config.Strings.SearchForSender,onClick:a.hitch(this,"searchForSender")},{separator:!0},{caption:Config.Strings.PrintMessage,onClick:a.hitch(this,"print")},{caption:Config.Strings.ShowMessageStatus,onClick:a.hitch(this,"viewStatus")},{caption:Config.Strings.ViewMessageSource,onClick:a.hitch(this,"viewSource")},{separator:!0}]},updateActionMenu:function(){var c=this.actionButton.menu;if(c){var a=c.getChildren();if(!("initialChildCount"in c))c.initialChildCount=
a.length;var b=a[0],d=a[1],e=a[2],i=a[3],g=a[4],c=a[5],h=a[6],p=a[7],l=a[9],m=a[10],j=this.buttonViz&&this.buttonViz[7]&&this.model.canChangeMessageReadState(this.msgInfo.folder);b.setShowing(j&&!this.msgInfo.isSeen);d.setShowing(j&&this.msgInfo.isSeen);g.setShowing(this.enableFilters&&Config.EnableFiltersSettings);b=this.msgInfo?!!this.msgInfo.isFlagged:!1;e.setShowing(!b);i.setShowing(b);e=this.showSearchItems&&"Sent"!=this.model.getFolderByName(this.msgInfo.folder).type&&"SavedIMs"!=this.model.getFolderByName(this.msgInfo.folder).type;
h.setShowing(this.showSearchItems);p.setShowing(e);c.setShowing(e);l.setShowing(Config.PrintingSupported);m.setShowing("ANGELIA"==ws.UserContext.MailboxType?Config.ShowMessageStatus&&Config.UseOMS:Config.ShowMessageStatus);(this.isPopup||!this.foldersOK)&&this.updateActionFolders();this.model.getSearchString()&&Config.UseOMS&&Config.CrossFolderSearch&&a[7].setCaption(Config.Strings.SearchForFromTo)}},updateActionFolders:function(){var c=this.actionButton.menu;if(c){for(var b=c.getChildren(),d,e=0<
this.model.getFoldersCanMoveTo().length,i=b.length-1;i>=c.initialChildCount;i--)d=b[i],c.removeChild(d),d!=this.newFolderSeparator&&d!=this.newFolderMenu&&d!=this.newFolderInputMenu&&d.destroyRecursive();if(e){d=new v({caption:Config.Strings.MoveActionLabel,isLabel:!0});d.setShowing(e);c.addChild(d);a.forEach(this.model.folders,a.hitch(this,function(b){if(-1!=a.indexOf(this.model.getFoldersCanMoveTo(),b.name)){var f=this.getDisplayName(b);d=new v({caption:f});d.onClick=a.hitch(this,"moveMessage",
b.name,b.displayName);c.addChild(d);d.startup()}}));if(!this.newFolderSeparator)this.newFolderSeparator=new z,this.newFolderSeparator.startup(),this.newFolderMenu=new v({caption:Config.Strings.NewFolder}),this.newFolderMenu._onClick=a.hitch(this,"newFolder"),this.newFolderMenu.startup();c.addChild(this.newFolderSeparator);c.addChild(this.newFolderMenu);if(!c._setAboutToShow)c.aboutToShow=a.hitch(this,function(){if(this.newFolderInputMenu){var c=this.actionButton.menu;if(c)c._setAboutToShow=!0;this.newFolderInputMenu.restore()}})}}},
getDisplayName:function(c){var a=c.displayName,b=Config.ImapStoreFolderDepthStartAt;if(Config.EnableIMAPFolderHierarchy){var a=Config.FolderHierarchyDelimiter,d="",e;for(e=b;e<c.depth;e++)d+="&nbsp;";for(e=b;e<c.depth;e++)d+=a;a=d+c.displayName}return ws.string.escapeXml(a)},updateFolderFlag:function(){this.foldersOK=!1},newFolder:function(c){c&&c.stopPropagation();var b=this.actionButton.menu;if(b){this.newFolderMenu.hide();if(!this.newFolderInputMenu)this.newFolderInputMenu=new A({okCB:a.hitch(this,
"moveToNewFolder"),defaultValue:Config.Strings.NewFolder,originalMenuItem:this.newFolderMenu,maxlength:ws.mail.folderName.MaxLength});ws.lang.setTimeout(this,function(){b.addChild(this.newFolderInputMenu);this.newFolderInputMenu.show();this.newFolderInputMenu.initializeText(Config.Strings.NewFolder);m.scrollIntoView(this.newFolderInputMenu.domNode)},0)}},moveToNewFolder:function(c){if(c&&c.newName){var b=a.hitch(this,"moveMessage");this.model.createFolder({newName:c.newName,load:a.hitch(this,function(d){a.publish("WSFeedbackStart",
[Config.Strings.FolderCreated,!0]);b("ANGELIA"==ws.UserContext.MailboxType?d.iName:Config.NewFolderPrefix+c.newName,c.newName)}),error:function(a){window.ws_ErrLgr&&!a&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,"Dialogs.ok shown - Error Handler for model.createFolder-moveToNewFolder file:DisplayMessageWidget.js");ws.widget.Dialogs.ok(a?a:ws.string.substituteParams(Config.Strings.ErrorCreatingFolder,c.newName))}})}},popOut:function(){window.openerContext={model:this.model,picturesModel:this.picturesModel,
folder:this.folder,uid:this.msgInfo.uid,Settings:Settings,undoFeedbackPopup:this.undoFeedbackCB,callback:a.hitch(this,"backToList",!0,null,!0),calendarDataUpdated:a.hitch(ws.WebSuite,"calendarDataUpdated"),webSuite:ws.WebSuite};ws.io.openWindow(Config.BaseMailPagesURL+"DisplayMessage?ws_popup=true&ws_suite=true","","status=yes,resizable=yes,left=5,top=5,width=885,height=606")},showFullMessage:function(){"Drafts"==this.folder?this.getComposeCB(a.hitch(this,function(c){c.openDraft(this.model.currentFolder,
this.uid)})):this.showFullMessageCB&&this.showFullMessageCB(this.folder,this.uid)},searchForSubject:function(){this.model.search(this.model.getBaseSubject(this.msgInfo.subject),"subject");this.backToList()},searchForSender:function(){this.model.search(this.msgInfo.from[0].userInputForm,"from");this.backToList()},getLinkHandler:function(c){try{if(0==c.indexOf("mailto:"))return a.hitch(this,"onMailtoClick",c);if(c.match(this.presenceIconRE))return a.hitch(this,"onPresenceIconClick",c)}catch(b){}return null},
onMailtoClick:function(c,b){var d=c.match(/mailto:([^?]+)(\?(.*))?/i),e={to:decodeURIComponent(d[1])};if(d=d[3])for(var i=["subject","cc","bcc","body"],d=d.split("&"),g=0;g<d.length;g++){var h=d[g].split("=");h[0]&&-1!=a.indexOf(i,h[0].toLowerCase())&&(e[h[0].toLowerCase()]=decodeURIComponent(h[1]))}this.getComposeCB(a.hitch(this,function(c){if(!this.isPopup)e.beaconSuffix="Inline Response";c.reset(e)}));b&&b.preventDefault()},presenceIconRE:/IM\/\?sn=([^&]*)&locale=([^&]*)&pd=(0|1)$/,onPresenceIconClick:function(c,
a){var b=c.match(this.presenceIconRE);ws.presence.launchIM(b[1],"1"==b[3]);a&&a.preventDefault()},viewSource:function(){var c=ws.string.substituteParams("%{0}viewSource?user=%{1}&uid=%{2}",Config.BaseJASUrl,encodeURIComponent(ws.io.getUserUid()),encodeURIComponent(this.msgInfo.uid));setTimeout(function(){ws.io.openWindow(c,"","status=yes,resizable=yes,menubar=yes,scrollbars=yes")},100);ws.reporting.report("Message Source","Mail")},viewStatus:function(){if(!this.statusDialog)this.statusDialog=new C({model:this.model}),
a.body().appendChild(this.statusDialog.domNode),this.statusDialog.startup();this.statusDialog.show(this.msgInfo.folder,[this.msgInfo.uid]);ws.reporting.reportDLAction("Mail-ReadMessage-MsgStatus")},print:function(){window.printContext=this.msgInfo;ws.io.openWindow(Config.BaseMailPagesURL+"PrintMessage",null,"")},getSizeLabeled:function(c){var a=c+" B";1024<Number(c)&&(a=(c/1024).toFixed(0)+" KB");1048576<Number(c)&&(a=(c/1048576).toFixed(1)+" MB");return a},makeAttachmentsLabel:function(c,a){var b=
this.getSizeLabeled(a),d=c.lastIndexOf("."),e=c.substr(d+1);-1==d?30<c.length&&(c=c.substr(0,30)+"..."):30<d?c=4<e.length?c.substr(0,30)+"...":c.substr(0,30)+"..."+e:30<d+e.length&&(c=c.substr(0,30)+"...");return c+" ("+b+")"},updateAttachments:function(){var c=this.msgInfo.attachments||[];this.attachmentsRow.innerHTML="";for(var b=0;b<c.length;b++){var d=c[b],e=ws.string.escapeXml(d.name),i=d.url,g=new t({fixSize:!0});g.startup();g.setLabel(this.makeAttachmentsLabel(e,d.size));this.msgInfo.isVirusScanned&&
!("Drafts"==this.folder||"Sent"==this.folder)&&g.setTip("("+this.getSizeLabeled(d.size)+") "+Config.Strings.NoVirusesFound);g.onClick=a.hitch(this,"getAttachment",i);a.addClass(g.domNode,"attBtn");this.attachmentsRow.appendChild(g.domNode)}ws.html.setShowing(this.attachmentsRow,0<c.length)},getAttachment:function(c){var b=a.hitch(this,function(){var c=a.byId("attachFrame");if(c&&(c=a.io.iframe.doc(c).getElementById("ErrorCodeSpan")))c=c.innerHTML,window.ws_ErrLgr&&ws_ErrLgr.logError(ws_ErrLgr.cat.UserVisErr,
"Dialogs.ok shown - ("+c+") Error Handler for getAttachment file:DisplayMessageWidget.js"),ws.widget.Dialogs.ok(Config.Strings.Error_15_Title+"<p>"+Config.Strings.Error_15_Message+"</p>")}),d=a.byId("attachFrame");d&&a.destroy(d);d=a.create("iframe",{id:"attachFrame",src:c,style:"left:-10000px;position:absolute;"},document.body);d.attachEvent?d.attachEvent("onload",b):d.onload=b},fullScreenOp:function(c,a){if(!this.imageSlideshow)return null;if(!this.imageSlideshow.fullScrAPI&&-1!==this.imageSlideshow.fullScrAPI){this.imageSlideshow.fullScrAPI=
-1;for(var b=[{req:"requestFullscreen",xit:"exitFullscreen",elm:"fullscreenElement",hnl:"fullscreenchange"},{req:"webkitRequestFullscreen",xit:"webkitExitFullscreen",elm:"webkitFullscreenElement",hnl:"webkitfullscreenchange"},{req:"webkitRequestFullScreen",xit:"webkitCancelFullScreen",elm:"webkitCurrentFullScreenElement",hnl:"webkitfullscreenchange"},{req:"mozRequestFullScreen",xit:"mozCancelFullScreen",elm:"mozFullScreenElement",hnl:"mozfullscreenchange"},{req:"msRequestFullscreen",xit:"msExitFullscreen",
elm:"msFullscreenElement",hnl:"MSFullscreenChange"}],d=0;d<b.length;d++)if("undefined"!=typeof document[b[d].xit]){this.imageSlideshow.fullScrAPI=b[d];break}}if(-1===this.imageSlideshow.fullScrAPI)return null;switch(c){case "hasAPI":return!0;case "reqFS":b=this.imageSlideshow.fullScrAPI.req;if(a&&b&&a[b])a[b]();break;case "exitFS":if((b=this.imageSlideshow.fullScrAPI.xit)&&document[b])document[b]();break;case "isInFS":return!!document[this.imageSlideshow.fullScrAPI.elm];case "FSchangeHandler":return this.imageSlideshow.fullScrAPI.hnl}return null},
launchIntoFullscreen:function(c){if(this.fullScreenOp("hasAPI")&&this.imageSlideshow.fullScrBtn)a.addClass(this.imageSlideshow.fullScrBtn,"dmss_fullScreenExit"),this.imageSlideshow.fullScrBtn.title=Config.Strings.slideShowTipExitFS,this.fullScreenOp("reqFS",c)},exitFullscreen:function(){if(this.fullScreenOp("hasAPI")&&this.imageSlideshow.fullScrBtn)a.removeClass(this.imageSlideshow.fullScrBtn,"dmss_fullScreenExit"),this.imageSlideshow.fullScrBtn.title=Config.Strings.slideShowTipFS,this.fullScreenOp("exitFS")},
showSlideShowBtn:function(c){if(!this.slideShowBtn){var b=new t;b.setLabel("show image slideshow");b.onClick=a.hitch(this,this.showImageSlideshow);b.domNode.style.position="absolute";this.messageArea.domNode.appendChild(b.domNode);b.onClick=a.hitch(this,"showImageSlideshow");b.startup();this.slideShowBtn=b}b=this.slideShowBtn;if(c&&c.currentTarget){c=c.currentTarget;this.slideShowCurrentImg=c.src;b.domNode.style.display="block";var c=a.position(c,!0),d=a.position(b.domNode,!0),d=c.x+Math.max(2,c.w/
2-d.w/2);b.domNode.style.top=c.y+3+"px";b.domNode.style.left=d+"px"}},hideSlideShowBtn:function(c){if(this.slideShowBtn&&c&&c.currentTarget){var b=this.slideShowBtn,d=a.position(c.currentTarget,!0),e=c.clientX,c=c.clientY,i=d.y+d.h,g=d.x,h=d.x+d.w;if(!(c>d.y&&c<i&&e>g&&e<h))b.domNode.style.display="none"}},hideImageSlideshow:function(){this.exitFullscreen();this.imageSlideshow.bgDiv.style.display="none";this.resetImageSlideshow();a.publish("DspMsgSlideShow/end")},resetImageSlideshow:function(){if(this.imageSlideshow&&
this.imageSlideshow.imgInit){this.imageSlideshow.spinDiv.style.visibility="hidden";this.imageSlideshow.spinner.stop();this.imageSlideshow.imgInit=!1;if(this.imageSlideshow.img&&this.imageSlideshow.img.length)this.imageSlideshow.img[0].src=Config.SpacerImageURL,this.imageSlideshow.img[1].src=Config.SpacerImageURL,this.imageSlideshow.img[0].style.visibility="hidden",this.imageSlideshow.img[1].style.visibility="hidden";this.imageSlideshow.imgIndx=0}},imageSlideshowLoadHndlr:function(){if(this.imageSlideshow.imgInit){this.imageSlideshow.spinDiv.style.visibility=
"hidden";this.imageSlideshow.spinner.stop();var c=this.imageSlideshow.img[this.imageSlideshow.imgIndx];c.style.visibility="hidden";c=(this.imageSlideshow.imgIndx+1)%2;this.imageSlideshow.imgIndx=c;c=this.imageSlideshow.img[c];c.style.visibility="visible"}},imageSlideshowStartLoad:function(c){this.imageSlideshow.spinDiv.style.visibility="visible";this.imageSlideshow.spinner.spin();var b=this.imageSlideshow.img[(this.imageSlideshow.imgIndx+1)%2];b.src=c;this.imageSlideshow.imgInit=!0;return b},showImageSlideshow:function(){if(!this.imageSlideshow){this.imageSlideshow=
{curIdx:0,images:null,fullScreen:!1};var c=document.createElement("div");this.imageSlideshow.bgDiv=c;a.addClass(c,"displayMessage_slideShowDiv");this.imageSlideshow.bgDiv.style.display="none";e(document,"keyup",a.hitch(this,function(c){27==c.keyCode?this.hideImageSlideshow():39==c.keyCode&&"none"!=this.imageSlideshow.bgDiv.style.display?this.setImageSlideshow(1):37==c.keyCode&&"none"!=this.imageSlideshow.bgDiv.style.display&&this.setImageSlideshow(-1)}));a.subscribe("NotifyExpiredSession",this,"hideImageSlideshow");
var b=document.createElement("div");a.addClass(b,"displayMessage_slideShowContent");this.imageSlideshow.cntDiv=b;var d=document.createElement("img");d.src=Config.SpacerImageURL;a.addClass(d,"displayMessage_slideShowImg");b.appendChild(d);e(d,"load",a.hitch(this,this.imageSlideshowLoadHndlr));var i=document.createElement("img");i.src=Config.SpacerImageURL;a.addClass(i,"displayMessage_slideShowImg");b.appendChild(i);e(i,"load",a.hitch(this,this.imageSlideshowLoadHndlr));this.imageSlideshow.img=[d,i];
this.imageSlideshow.imgIndx=0;d=document.createElement("div");a.addClass(d,"displayMessage_spinDiv");this.imageSlideshow.spinDiv=d;b.appendChild(d);c.appendChild(b);this.imageSlideshow.spinner=new E("SlideShow",d);b="";document.addEventListener&&this.fullScreenOp("hasAPI")&&(b='<img src="'+Config.SpacerImageURL+'"class="mainSprite dmss_Icon dmss_fullScreen" title="'+Config.Strings.slideShowTipFS+'">',d=a.hitch(this,function(){setTimeout(a.hitch(this,this.setImageSlideshow,0),15)}),(i=this.fullScreenOp("FSchangeHandler"))&&
document.addEventListener(i,d,!1));d=document.createElement("div");a.addClass(d,"displayMessage_slideShowToolbar");d.innerHTML=['<img src="'+Config.SpacerImageURL+'" class="mainSprite dmss_Icon dmss_left" title="'+Config.Strings.slideShowTipPrev+'">','<span class="dmssIndex"></span>','<img src="'+Config.SpacerImageURL+'"class="mainSprite dmss_Icon dmss_right" title="'+Config.Strings.slideShowTipNext+'">','<img src="'+Config.SpacerImageURL+'"class="mainSprite dmss_Icon dmss_rotate" title="'+Config.Strings.slideShowTipRotate+
'">',b,'<img src="'+Config.SpacerImageURL+'"class="mainSprite dmss_Icon dmss_download" title="'+Config.Strings.slideShowTipDownload+'">','<img src="'+Config.SpacerImageURL+'"class="mainSprite dmss_Icon dmss_close" title="'+Config.Strings.slideShowTipExit+'">'].join("");c.appendChild(d);this.imageSlideshow.toolbar=d;document.body.appendChild(c);e(a.query(".dmss_left",this.imageSlideshow.toolbar)[0],"click",a.hitch(this,function(){this.setImageSlideshow(-1)}));e(a.query(".dmss_right",this.imageSlideshow.toolbar)[0],
"click",a.hitch(this,function(){this.setImageSlideshow(1)}));e(a.query(".dmss_close",this.imageSlideshow.toolbar)[0],"click",a.hitch(this,function(){this.hideImageSlideshow()}));this.imageSlideshow.fullScrBtn=a.query(".dmss_fullScreen",this.imageSlideshow.toolbar)[0];this.imageSlideshow.fullScrBtn&&e(this.imageSlideshow.fullScrBtn,"click",a.hitch(this,function(){if(!this.imageSlideshow.reportFS)this.imageSlideshow.reportFS=!0,ws.reporting.reportDLAction("Mail-ReadMessage-Slideshow-fullscreen");this.fullScreenOp("isInFS")?
this.exitFullscreen():this.launchIntoFullscreen(this.imageSlideshow.bgDiv)}));e(a.query(".dmss_rotate",this.imageSlideshow.toolbar)[0],"click",a.hitch(this,function(){if(!this.imageSlideshow.reportRotate)this.imageSlideshow.reportRotate=!0,ws.reporting.reportDLAction("Mail-ReadMessage-Slideshow-rotate");var c=this.imageSlideshow.images[this.imageSlideshow.curIdx].rotate;c++;3<c&&(c=0);this.imageSlideshow.images[this.imageSlideshow.curIdx].rotate=c;setTimeout(a.hitch(this,this.setImageSlideshow,0),
5)}));e(a.query(".dmss_download",this.imageSlideshow.toolbar)[0],"click",a.hitch(this,function(){if(!this.imageSlideshow.reportDownload)this.imageSlideshow.reportDownload=!0,ws.reporting.reportDLAction("Mail-ReadMessage-Slideshow-download");this.getAttachment(this.imageSlideshow.images[this.imageSlideshow.curIdx].src)}))}if(null==this.imageSlideshow.images){this.imageSlideshow.images=[];c=s.doc(this.bodyFrame).getElementsByTagName("img");for(b=0;b<c.length;b++)this.isImageGoodForShow(c[b])&&(d=a.contentBox(c[b]),
this.imageSlideshow.images.push({src:c[b].src,rotate:0,size:d}))}if(this.imageSlideshow&&this.imageSlideshow.images&&this.imageSlideshow.images.length){this.resetImageSlideshow();this.imageSlideshow.bgDiv.style.display="block";a.publish("DspMsgSlideShow/start");this.imageSlideshow.curIdx=0;if(this.slideShowCurrentImg){ws.reporting.reportDLAction("Mail-ReadMessage-Slideshow-hoverStart");for(b=0;b<this.imageSlideshow.images.length;b++)if(this.imageSlideshow.images[b].src==this.slideShowCurrentImg){this.slideShowCurrentImg=
null;this.imageSlideshow.curIdx=b;break}}else ws.reporting.reportDLAction("Mail-ReadMessage-Slideshow-start");setTimeout(a.hitch(this,this.setImageSlideshow,0),100)}},setImageSlideshow:function(c){if(this.imageSlideshow&&this.imageSlideshow.images&&this.imageSlideshow.images.length){var b=["translate(-50%, -50%) rotate(0deg)","translate(-50%, -50%) rotate(90deg)","translate(-50%, -50%) rotate(180deg)","translate(-50%, -50%) rotate(270deg)"];this.imageSlideshow.curIdx+=c;if(0>this.imageSlideshow.curIdx)this.imageSlideshow.curIdx=
this.imageSlideshow.images.length-1;else if(this.imageSlideshow.curIdx>=this.imageSlideshow.images.length)this.imageSlideshow.curIdx=0;ws.html.setInnerText(a.query(".dmssIndex",this.imageSlideshow.toolbar)[0],this.imageSlideshow.curIdx+1+" "+Config.Strings.Of+" "+this.imageSlideshow.images.length);var d=this.imageSlideshow.images[this.imageSlideshow.curIdx],c=this.imageSlideshowStartLoad(d.src),b=["translate(-50%, -50%) rotate(0deg)","translate(-50%, -50%) rotate(90deg)","translate(-50%, -50%) rotate(180deg)",
"translate(-50%, -50%) rotate(270deg)"];c.style.transform=b[d.rotate];c.style.webkitTransform=b[d.rotate];c.style.mozTransform=b[d.rotate];c.style.msTransform=b[d.rotate];var e=d.size.w,i=d.size.h,g=a.contentBox(this.imageSlideshow.cntDiv),b=g.w/g.h,h=g.h,g=g.w;0==d.rotate||2==d.rotate?(d=e/i,c.style.height=b>d?h+"px":"auto",c.style.width=b>d?"auto":g+"px"):(d=i/e,c.style.width=b>d?h+"px":"auto",c.style.height=b>d?"auto":g+"px")}},isImageGoodForShow:function(c){var b=a.hasClass(c,"AOLAttachedImage"),
d=a.hasClass(c,"AOLInlineImage");return c.src&&(b||d||-1!=c.src.indexOf("/webmail/getPart?uid"))},initializeImages:function(){var c=s.doc(this.bodyFrame).getElementsByTagName("img");this.pictureViewControls=[];for(var b=!1,d=0;d<c.length;d++){if(a.hasClass(c[d],"AOLAttachedImage")&&9>a.isIE){var i=a.contentBox(c[d]),g=Config.InsertedPictureLongestEdge,p=i.w<i.h;p&&i.h>g?a.contentBox(c[d],{h:g,w:Math.round(i.w*(g/i.h))}):!p&&i.w>g&&a.contentBox(c[d],{w:g,h:Math.round(i.h*(g/i.w))});c[d].style.visibility=
"visible"}if(this.imageSlideshow)this.imageSlideshow.images=null,this.imageSlideshow.curIdx=0;if(Settings.UserHash>=Config.DspMsgImgSlideShowThreshold&&(!a.isIE||9<=a.isIE)&&this.isImageGoodForShow(c[d]))e(c[d],h.enter,a.hitch(this,function(c){this.showSlideShowBtn(c)})),e(c[d],h.leave,a.hitch(this,function(c){this.hideSlideShowBtn(c)})),b=!0}this.showSlideShowLnk.style.display=b?"":"none";this.slideShowRow.style.display=b?"":"none"},saveSelection:function(){var c=!1,b="",d="";try{var e=this.bodyFrame.contentWindow,
c=a.withGlobal(e,function(){return l._editor.selection.getAncestorElement("pre")}),b=a.withGlobal(e,l._editor.selection.getSelectedHtml),d=a.withGlobal(e,l._editor.selection.getSelectedText);9>a.isIE&&"None"==e.document.selection.type&&""==d&&(b="")}catch(i){}c&&b&&(b="<pre><tt>"+b+"</tt></pre>");this.selectedHtml=b;this.selectedText=d},addToCalendar:function(){if(!this.model.standAloneMailModel){var c=this.selectedText;c||(c=a.string.trim(ws.html.renderedTextContent(s.doc(this.bodyFrame).body)));
this.getAddEditWidgetCB(a.hitch(this,function(b){if(null==b){if(!this.calendarModel)this.calendarModel=new y({modelType:"event"});if(!this.addEditDialog)this.addEditDialog=new B({model:this.calendarModel}),this.addEditDialog.startup(),this.addEditDialog.setModel(this.calendarModel),this.addEditDialog.hide(),a.body().appendChild(this.addEditDialog.domNode);b=this.addEditDialog}b.onSavedCB=this.calendarDataUpdatedCB;if(this.calendarModel.isModelFetchedOnce)b.show(2,{summary:this.msgInfo.subject,notes:c});
else{this.calendarModel.getData();var d=a.connect(b,"update",a.hitch(this,function(){a.disconnect(d);b.show(2,{summary:this.msgInfo.subject,notes:c})}))}ws.reporting.reportDLAction("Mail-ReadMessage-Calendar")}))}},addToTask:function(){if(!this.model.standAloneMailModel){if(!this.taskModel)this.taskModel=new y({modelType:"todo"});if(!this.taskView)this.taskView=new u({isPopup:this.isPopup,isStandAlone:this.isStandAlone}),this.taskView.onSavedCB=a.hitch(this,function(){this.calendarDataUpdatedCB&&
this.calendarDataUpdatedCB(this.taskModel)}),this.taskView.startup(),this.taskView.setModel(this.taskModel);var c=[-100,6];200>m.getBox().w-a.position(this.addToTaskLink).x&&(c=[-180,6]);this.taskView.open(this.msgInfo.subject,this.addToTaskLink,{BL:"TL"},c,"top",6);this.hideTip(this.addToTaskLink);ws.reporting.reportDLAction("Mail-ReadMessage-ToDo")}},_suiteOnKeyPress:function(c){if(this.domNode&&!("none"==this.domNode.style.display||a.hasClass(this.domNode,"dijitHidden")||!Config.EnableKeyboardShortcuts)){var b=
null;if(c.keyChar&&a.isString(c.keyChar)&&!c.ctrlKey&&!c.altKey&&!c.metaKey)switch(c.keyChar.toLowerCase()){case Config.Strings.KeyMailReply:this.saveSelection();b=this.reply;break;case Config.Strings.KeyMailReplyAll:this.saveSelection();b=this.replyAll;break;case Config.Strings.KeyMailForward:this.saveSelection();b=this.forward;break;case Config.Strings.KeyMailPopout:if(ws.settings.allowPopups()&&!this.isPopup&&!this.isStandAlone&&!this.isPreviewPane)b=this.popOut;break;case Config.Strings.KeyMailNext:if(this.enableNextPrev&&
!this.isPreviewPane)b=this.nextMessage;break;case Config.Strings.KeyMailPrevious:if(this.enableNextPrev&&!this.isPreviewPane)b=this.prevMessage;break;case Config.Strings.KeyMailPrint:if(!this.isPreviewPane)b=this.print;break;case Config.Strings.KeyMailClose:b=this.backToList;break;case Config.Strings.KeyMailAddToCalendar:if(!this.isPreviewPane)this.saveSelection(),b=this.addToCalendar;break;case Config.Strings.KeyMailAddToToDo:if(!this.isPreviewPane)this.saveSelection(),b=this.addToTask}else switch(ws.html.fixKeyCodeForMac(c)){case a.keys.DELETE:if(!this.isPreviewPane)b=
this.deleteMessage;break;case a.keys.BACKSPACE:c.preventDefault()}c.stopPropagation();b&&setTimeout(a.hitch(this,b),10)}},nodeOrParentLinkTag:function(c){for(var b=null;c;)if(c.nodeName&&"a"==c.nodeName.toLowerCase()){b=c;break}else c=c.parentNode;return b},onMailBodyClick:function(c,b){var d=!0;"undefined"!=typeof b.which&&1!=b.which&&(d=!1);if(b.target&&b.target.nodeName&&d&&(d=this.nodeOrParentLinkTag(b.target))){var e=d.href,i=document.location.href;if(e&&0==e.indexOf(i)){if((d=e.substring(i.length))&&
1<d.length){0==d.indexOf("#")&&(d=d.substring(1));e=c.body.getElementsByTagName("a");i=null;if(e)for(var g=0;g<e.length;g++)if(e[g].name==d){i=e[g];break}i&&m.scrollIntoView(i)}b.preventDefault();b.stopPropagation()}else this.showEnableLinkWidget(b,d)}a.publish("DisplayMessage/BodyClick");this.isPopup&&a.publish("WSFeedbackHide")},createEnableLinkWidget:function(){var b=[{caption:Config.Strings.dm_LinkEnable,onClick:a.hitch(this,this.restoreLinks)},{caption:Config.Strings.dm_LinkEnable4Sender,onClick:a.hitch(this,
this.restoreLinksAddContact)}];Config.TurnOffLinkAndImageBlockingInSettings&&b.push({caption:Config.Strings.dm_LinkOffBlocking,onClick:a.hitch(this,this.restoreLinkUpdateSettings)});this.enableLinkWidget=ws.widget.createMenu(b);this.connect(this.enableLinkWidget,"onClose","clearOpenLinkMenu");this.positionOpenLinkMenu()},clearOpenMenus:function(){this.enableLinkWidget&&(this.enableLinkWidget.close(),this.clearOpenLinkMenu());this.addrActionMenu&&(this.addrActionMenu.close(),this.clearAddrActionMenu())},
clearOpenLinkMenu:function(){if(this.currentLinkNode)try{a.removeClass(this.currentLinkNode,"dmItemSelected")}catch(b){}},positionOpenLinkMenu:function(){if(this.currentLinkNode){a.addClass(this.currentLinkNode,"dmItemSelected");var b=a.position(this.bodyFrame,!0),d=a.position(this.currentLinkNode,!0);ws.widget.popup({popup:this.enableLinkWidget,x:b.x+d.x,y:b.y+d.y,padding:8>=a.isIE?7>=a.isIE?[2,20]:[0,20]:[0,17],shadow:!1})}},showEnableLinkWidget:function(b,d){if(this.isShowing()&&this.msgInfo)if(this.msgInfo.stripLinksKey&&
-1!=this.msgInfo.body.indexOf(this.msgInfo.stripLinksKey))a.position(this.bodyFrame,!0),a.position(d,!0),this.currentLinkNode=d,this.enableLinkWidget?this.positionOpenLinkMenu():setTimeout(a.hitch(this,this.createEnableLinkWidget),0);else{var e=d.getAttribute("href");if(e){var i=this.getLinkHandler(e);i?i():ws.io.openWindow(e,"","")}b.preventDefault();b.stopPropagation()}},onClickCreateFilter:function(){require(["ws/mail/MailFilterModalPane"],a.hitch(this,function(b){b=new b({mailModel:this.model,
from:this.msgInfo.from[0].userInputForm});a.body().appendChild(b.domNode);b.startup()}))},markupSearchString:function(b){var b=ws.string.escapeXml(b),a=this.model.getSearchString(),d=this.model.getSearchIn();if(a&&"alltext"==d&&(a=ws.string.escapeXml(a),-1!=b.toLowerCase().indexOf(a.toLowerCase()))){for(var d=b.toLowerCase(),e=a.length,a=a.toLowerCase(),i=[],g=d.indexOf(a);-1!=g;)i.push(b.substr(0,g)),i.push("<span class='searchTerm'>",b.substr(g,e),"</span>"),b=b.substr(g+e),d=d.substr(g+e),g=d.indexOf(a);
i.push(b);b=i.join("")}this.msgMarkedUp=!0;return b},isMessageMarkedUp:function(){return this.msgMarkedUp},wrapToolbar:function(){this.toolbar.skipLayout=!0;this.layoutWidget.resize()},showTip:function(b){ws.widget.showInstatip(b.target)},hideTip:function(b){ws.widget.hideInstatip(b.target)},idleMonitorStarted:function(){var b;b=this.isPopup&&_ws_isOpenerWS()?function(){opener.dojo.publish("IdleMonitor/activityDetected")}:function(){a.publish("IdleMonitor/activityDetected")};var d=a.hitch(this,function(a){this.connect(a,
"scroll",b);this.connect(a,"resize",b);this.connect(a.document,"mousemove",b);this.connect(a.document,"keydown",b)});this.isPopup&&_ws_isOpenerWS()&&d(window);d(this.bodyFrame.contentWindow)}})})},"url:ws/address/PeoplePanel.css":"","url:ws/mail/AddTaskCard.html":'<div class="addTaskCard">\n\t<div class="todoPanelLabelDiv" data-dojo-attach-point="todoPanelLabelDiv">\n\t\t<span class="todoPanelLabel">${Panel_TodoLabel}</span>\n\t\t<div class="mainSprite wsSmallCloseBtn" data-dojo-attach-event="onclick:close"></div>\n\t</div>\n\t<div class="wsInput addTaskInput">\n\t\t<input type="text" data-dojo-attach-point="addTaskInputNode" maxlength="100" data-dojo-attach-event="onfocus: onFocus, onblur: onBlur, onkeypress: onAddTaskKeyPress" class="default wsInputBare"/>\n\t\t<div title="${EnterTask}" class="wsSmallAddButton" data-dojo-attach-point="addTaskImage" data-dojo-attach-event="onclick:onClickAddFromInput"></div>\n\t</div>\n</div>\n',
"url:ws/mail/DisplayMessageWidget.css":"","url:ws/calendar/AddEventDialog.css":"","ws/calendar/AddEventDialog":function(){require({cache:{"url:ws/calendar/AddEventDialog.html":'<div class="addEditEvent WSModalPane" data-dojo-attach-point="addDialogWidget">\n\t<div style="overflow: hidden;" data-dojo-attach-event="onkeypress:onKeyPress,onkeydown:onKeyPress">\n\t\t<div class="WSModalPaneInner">\n\t\t\t<img src="${spacer}" class="mainSprite wsCloseBtn" data-dojo-attach-event="onclick:hide">\n\t\t\t<div class="modalContainer" data-dojo-attach-point="modalContainer">\n\t\t\t\t<div data-dojo-attach-point="dlgTitleDiv">\n\t\t\t\t\t<div data-dojo-attach-point="dlgTitleAdd" class="dlgTitle">${AddEventBtn}</div>\n\t\t\t\t\t<div data-dojo-attach-point="dlgTitleEdit" class="dlgTitle" style="display:none">${EditEvent}</div>\n\t\t\t\t</div>\n\t\t\t\t<div data-dojo-attach-point="contentPane" class="inputData">\n                    <input type="text" class="wsInput summaryInput" maxlength="100" data-dojo-attach-point="summaryInput" data-dojo-attach-event="onclick:summaryTextClick,onblur:summaryTextBlur,onkeypress:summaryKeyPress" />\n                    <div class="dateTimeDiv">\n                        <input type="text" class="wsInput dateInputField" data-dojo-attach-point="startDateInput" />\n                        <input type="text" class="wsInput timeInputField" data-dojo-attach-point="startTimeInput" />\n                        <span style="padding-bottom:2px" data-dojo-attach-point="toSpan" style="display:none">${CalTo}</span>\n                        <input type="text" class="wsInput timeInputField" data-dojo-attach-point="endTimeInput" />\n                        <input type="text" class="wsInput dateInputField" data-dojo-attach-point="endDateInput" style="display:none" />\n\n                    </div>\n\n                    <div class="allDayDiv">\n                        <div data-dojo-type="ws/widget/Checkbox" data-dojo-attach-event="onClick:checkBoxChange" data-dojo-attach-point="allDayBox" label="${AllDay}" uncheckedClass="checkBoxNotChecked"></div>\n                    </div>\n\n                    <div class="menuDivs">\n                        <div class="mainSprite iconDiv iconCalendar"></div>\n                        <div data-dojo-type="ws/calendar/CalendarSelect" data-dojo-attach-point="calendarMenu" class="calendarList"></div>\n                    </div>\n\n                    <div class="separator"></div>\n\n                    <div data-dojo-attach-point="repeatDiv" class="menuDivs">\n                        <div class="mainSprite iconDiv iconRepeat"></div>\n                        <ul data-dojo-type="ws/widget/WSSelect" data-dojo-props="\'class\': \'selectMenu\'" data-dojo-attach-point="repeatMenu" size="byValue">\n                            <li value="doesNotRepeat">${DoesNotRepeat}</li>\n                            <li value="everyDay">${EveryDay}</li>\n                            <li value="everyWeek">${EveryWeek}</li>\n                            <li value="everyMonth">${EveryMonth}</li>\n                            <li value="everyYear">${EveryYear}</li>\n                            <li value="customRepeat">${CustomRepeat}</li>\n                        </ul>\n\n                        <div class="customDialog" data-dojo-attach-point="repeatDialog" style="display:none;overflow: auto;">\n                            <div style="clear:both;overflow: auto;">\n                                <span class="spanText">${Every}&nbsp;</span>\n                                <input type="text" class="wsInput everyInput" data-dojo-attach-point="repeatEveryInput" />\n                                <ul data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="repeatEveryMenu" data-dojo-props="\'class\': \'repeatOption\'" size="byValue">\n                                    <li value="repeatEveryDay">${day}</li>\n                                    <li value="repeatEveryWeek">${week}</li>\n                                    <li value="repeatEveryMonth">${month}</li>\n                                    <li value="repeatEveryYear">${year}</li>\n                                </ul>\n                            </div>\n                            <div data-dojo-attach-point="dayIntervalSelect" class="dayIntervalSelect" style="overflow: hidden;">\n                                <span class="spanText" data-dojo-attach-point="onTextSpan">${CalendarOn}:</span>\n                                <span class="pickDaySpan" data-dojo-attach-point="day0Span"></span>\n                                <span class="pickDaySpan" data-dojo-attach-point="day1Span"></span>\n                                <span class="pickDaySpan" data-dojo-attach-point="day2Span"></span>\n                                <span class="pickDaySpan" data-dojo-attach-point="day3Span"></span>\n                                <span class="pickDaySpan" data-dojo-attach-point="day4Span"></span>\n                                <span class="pickDaySpan" data-dojo-attach-point="day5Span"></span>\n                                <span class="pickDaySpan" data-dojo-attach-point="day6Span"></span>\n                            </div>\n                            <div data-dojo-attach-point="monthIntervalSelect" class="monthIntervalSelect" style="display:none">\n                                <input name="monthSelect" type="radio" data-dojo-attach-event="onchange:monthButtonChange" data-dojo-attach-point="customMonthDateButton" />\n                                <span data-dojo-attach-point="customMonthDate">on the 15th&nbsp;</span>\n                                <input name="monthSelect" type="radio" data-dojo-attach-event="onchange:monthButtonChange" data-dojo-attach-point="customMonthDayButton" />\n                                <span data-dojo-attach-point="customMonthDay">on the fourth Monday</span>\n                            </div>\n                            <div class="endMenuRow">\n                                <ul data-dojo-type="ws/widget/WSSelect" data-dojo-props="\'class\': \'zeroMarginLeft\'" data-dojo-attach-point="endDateMenu" size="byValue">\n                                    <li value="noEndDate">${NoEndDate}</li>\n                                    <li value="repeatUntil">${RepeatUntil}</li>\n                                </ul>\n                                <input type="text" data-dojo-attach-point="endRepeatDateInput" class="wsInput dateInputField" />\n                            </div>\n                        </div>\n                        <div data-dojo-attach-point="repeatCustomSummary" class="customSummaryDiv" style="display:none">\n                            <span data-dojo-attach-point="repeatEverySummarySpan"></span>\n                        </div>\n                    </div>\n\n                    <div class="separator"></div>\n\n                    <div data-dojo-attach-point="remindRow" class="menuDivs">\n                        <div class="mainSprite iconReminder iconDiv"></div>\n                        <ul data-dojo-type="ws/widget/WSSelect" data-dojo-props="\'class\': \'selectMenu\'" data-dojo-attach-point="reminderMenu" size="byValue"></ul>\n                        <div data-dojo-attach-point="remindDialog" class="customDialog" style="display:none">\n                            <table data-dojo-attach-point="repeatTable" border="0" style="width:100%">\n                                <tr>\n                                    <td width="14" align="left">\n                                        <input type="text" data-dojo-attach-point="remindInput" class="wsInput remindAt" />\n                                    </td>\n                                    <td align="left">\n                                        <ul data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="customRemindMenu" data-dojo-props="\'class\': \'customReminderMenu\'" size="byValue"></ul>\n                                        <span data-dojo-attach-point="customRemindBeforeSpan" class="remindBeforeSpan" style="display:none">${Before}</span>\n                                        <input type="text" class="wsInput dateInputField remindBeforeInput" data-dojo-attach-point="remindAtEndInput" style="display:none" />\n                                    </td>\n                                </tr>\n                            </table>\n                        </div>\n                     </div>\n\n                    <div data-dojo-attach-point="remindSummaryRow" style="display:none" class="customSummaryDiv">\n                        <span data-dojo-attach-point="remindSummarySpan"></span>\n                    </div>\n                    <div class="separator"></div>\n                    <div data-dojo-attach-point="locationRow" class="menuDivs">\n                        <div class="mainSprite iconDiv iconLocation"></div>\n                        <input type="text" class="wsInput addLocationInputShowNew" data-dojo-attach-event="onclick:locationTextType" data-dojo-attach-point="addLocationInputArea" />\n                        <span class="ctrl wsLink" data-dojo-attach-point="mapLink" data-dojo-attach-event="onclick:showMapLink">${ShowMapLink}</span>\n                    </div>\n                    <div class="separator"></div>\n                    <div class="menuDivs">\n                        <div class="mainSprite iconDiv iconNotes"></div>\n                        <div class="notesDiv">\n                            <div defaultValue="${AddNoteHere}" class="addNotesInputShow" data-dojo-attach-point="addNotesInput" data-dojo-type="ws/widget/DefaultTextarea"></div>\n                        </div>\n                    </div>\n                    \n                    <div data-dojo-type="ws/widget/WSToolbar" data-dojo-attach-point="toolbar" data-dojo-props="region:\'top\'" vizType="Bare">\n                        <div data-dojo-type="ws/widget/Button" data-dojo-attach-point="saveButton" data-dojo-attach-event="onClick:saveAndClose" data-dojo-props="toolbarPosition: \'right\'">${AddEventBtn}</div>\n                    </div>\n\n    \t\t\t</div>\n                <div data-dojo-type="ws/widget/PopupDatePicker" data-dojo-attach-point="eventDatePopupPicker" hidePickerOnSetDate="true" closeOnMouseOut="true"></div>\n                <div data-dojo-type="ws/widget/PopupTimePicker" data-dojo-attach-point="eventTimePopupPicker" hidePickerOnSetTime="true" closeOnMouseOut="true"></div>\n            </div>\n\t\t</div>\n\t</div>\n</div>\n',
"url:ws/calendar/AddEventDialog.css":""}});define("ws/calendar/AddEventDialog","dojo/_base/declare,dojo/text!ws/calendar/AddEventDialog.html,dojo/text!ws/calendar/AddEventDialog.css,dojo,dijit,ws/widget/WSModalPane,dijit/_TemplatedMixin,dijit/_WidgetsInTemplateMixin,dijit/layout/BorderContainer,dijit/layout/StackContainer,ws/calendar/calutil,ws/calendar/CalendarSelect,ws/date,ws/widget/DefaultTextbox,ws/widget/DefaultTextarea,ws/widget/Dialogs,ws/widget/PopupDatePicker,ws/widget/PopupTimePicker,ws/widget/WSSelect".split(","),
function(n,j,q,a,l,m,e,h){return n([m,e,h],{templateString:j,css:{templateString:q},destroyOnClose:!1,hasPrevLocationValue:!1,textValues:["summary","startDate","startTime","endDate","endTime"],daySpanValues:"day0,day1,day2,day3,day4,day5,day6".split(","),startup:function(){this.dateFormat=Config.Strings.DateYear;this.timeFormat=Config.Strings.CalTimeFormatRange1;this.timeFormatShort=Config.Strings.CalTimeFormatRange2;this.eventInfo=this.model=this.dateInputField=null;this.selectedDays={};this.customSelectUnit=
null;this.sortedDays=[];this.editEvent=!1;this.targetDate=this.showIndexCB=null;this.inherited(arguments);this.connect(this.startDateInput,"onclick",a.hitch(this,"showPicker",this.startDateInput));this.connect(this.endRepeatDateInput,"onclick",a.hitch(this,"showPicker",this.endRepeatDateInput));this.connect(this.remindAtEndInput,"onclick",a.hitch(this,"showPicker",this.remindAtEndInput));this.connect(this.startTimeInput,"onclick",a.hitch(this,"showTimePicker",this.startTimeInput));this.connect(this.endTimeInput,
"onclick",a.hitch(this,"showTimePicker",this.endTimeInput));this.setupPickDaySpans();if(!Config.ShowReminderEvent)this.remindRow.style.display="none",this.remindSummaryRow.style.display="none";if(!Config.EnableCalendarMapLink)this.mapLink.style.display="none";this.connect(this.eventDatePopupPicker.datePicker,"selectDateConnect","fillInDateField");this.connect(this.eventTimePopupPicker.timePicker,"selectTimeConnect","fillInTimeField");this.connect(this.repeatMenu,"valueChanged","handleRepeat");this.connect(this.reminderMenu,
"valueChanged","handleReminder");this.connect(this.repeatEveryMenu,"valueChanged","handleCustomRepeat");this.connect(this.endDateMenu,"valueChanged","handleEndDate");this.connect(this.customRemindMenu,"valueChanged","handleCustomRemind");this.modelUpdatedHandler=a.connect(this.model,"modelUpdated",this,"update");this.subscribe("Suite/onKeyOnPress","_suiteOnKeyPress")},uninitialize:function(){this.modelUpdatedHandler&&a.disconnect(this.modelUpdatedHandler)},update:function(){this.calendarMenu.buildList();
this.calendarMenu.selectCalendar();this.saveButton.setEnabled(!0)},setupPickDaySpans:function(){for(var b=0;b<this.daySpanValues.length;b++)this[this.daySpanValues[b]+"Span"].innerHTML=b+ws.date.firstDayOfWeek<ws.date.abbrevDays.length?ws.date.abbrevDays[b+ws.date.firstDayOfWeek]:ws.date.abbrevDays[b+ws.date.firstDayOfWeek-ws.date.abbrevDays.length],this[this.daySpanValues[b]+"Span"].title=b+ws.date.firstDayOfWeek<ws.date.days.length?ws.date.days[b+ws.date.firstDayOfWeek]:ws.date.days[b+ws.date.firstDayOfWeek-
ws.date.days.length],this[this.daySpanValues[b]+"Span"].value=b,this[this.daySpanValues[b]+"Span"].onmouseover=a.hitch(this,"onMouseOverSpan",this[this.daySpanValues[b]+"Span"]),this[this.daySpanValues[b]+"Span"].onmouseout=a.hitch(this,"onMouseOutSpan",this[this.daySpanValues[b]+"Span"]),this[this.daySpanValues[b]+"Span"].onclick=a.hitch(this,"onClickSpan",this[this.daySpanValues[b]+"Span"])},handleRepeat:function(){if(null==this.eventInfo)this.hideRepeat();else{switch(this.repeatMenu.currentValue){case "doesNotRepeat":this.repeatEverySummarySpan.innerHTML=
"";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.eventInfo.recurType="0";this.hideRepeat();break;case "everyDay":this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.eventInfo.recurType="1";this.eventInfo.frequency=1;this.hideRepeat();break;case "everyWeek":this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.eventInfo.recurType="2";this.eventInfo.frequency=
1;this.hideRepeat();break;case "everyMonth":this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.eventInfo.recurType="5";this.eventInfo.frequency=1;this.hideRepeat();break;case "everyYear":this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.customSelectUnit=null;this.eventInfo.recurType="6";this.eventInfo.frequency=1;this.hideRepeat();break;case "customRepeat":this.dayIntervalSelect.style.display=
"",this.monthIntervalSelect.style.display="none",this.repeatEveryInput.value="1",this.customSelectUnit="repeatEveryWeek",this.onTextSpan.style.display="",this.repeatEveryMenu.setOption(1,!0),this.endDateMenu.setOption(0,!0),this.customMonthDateButton.checked=!0,this.eventInfo.recurType="2",this.repeatDialog.style.display="",this.repeatEveryMenu.sizeMyself(),this.endDateMenu.sizeMyself()}this.checkSize()}},handleReminder:function(){if(null==this.eventInfo)this.hideRemind();else{this.remindInput.style.display=
"";switch(this.reminderMenu.currentValue){case "noReminder":this.remindSummarySpan.innerHTML="";this.remindSummaryRow.style.display="none";this.eventInfo.reminderEnabled=!1;"reminderLeadTime"in this.eventInfo&&delete this.eventInfo.reminderLeadTime;this.hideRemind();break;case "remindAt":this.remindInput.style.display="none";this.remindInput.parentNode.setAttribute("width","14");a.replaceClass(this.remindInput,"remindAt","everyInput");this.customRemindMenu.setOption(0,!0);this.remindDialog.style.display=
"";break;case "timeOfEvent":case "min15Before":case "min30Before":case "hour1Before":this.remindSummarySpan.innerHTML="";this.remindSummaryRow.style.display="none";this.eventInfo.reminderEnabled=!0;this.eventInfo.reminderLeadTime=this.getLeadTimeInMinutes(this.reminderMenu.currentValue);this.hideRemind();break;case "customReminder":this.remindInput.parentNode.setAttribute("width","28"),a.replaceClass(this.remindInput,"everyInput","remindAt"),this.customRemindMenu.setOption(0,!0),this.remindInput.value=
"15",this.remindDialog.style.display=""}this.customRemindMenu.sizeMyself();this.checkSize()}},handleCustomRepeat:function(){if("none"!=this.repeatCustomSummary.style.display)this.repeatEverySummarySpan.innerHTML="",this.repeatCustomSummary.style.display="none";switch(this.repeatEveryMenu.currentValue){case "repeatEveryDay":this.dayIntervalSelect.style.display="none";this.monthIntervalSelect.style.display="none";this.onTextSpan.style.display="none";this.eventInfo.recurType="1";break;case "repeatEveryWeek":this.dayIntervalSelect.style.display=
"";this.monthIntervalSelect.style.display="none";this.onTextSpan.style.display="";var b=Config.Strings.CalDateParseFormat,b=ws.date.ParseDateFromFormat(this.startDateInput.value,b);if(null!=b){var d=b.getDay()-ws.date.firstDayOfWeek;0>d&&(d+=7);this.selectedDays[this[this.daySpanValues[d]+"Span"].value]=!0;a.addClass(this[this.daySpanValues[d]+"Span"],"pickDaySpanOnHover")}this.eventInfo.recurType="2";break;case "repeatEveryMonth":d=[Config.Strings.Sunday,Config.Strings.Monday,Config.Strings.Tuesday,
Config.Strings.Wednesday,Config.Strings.Thursday,Config.Strings.Friday,Config.Strings.Saturday];b=Config.Strings.CalDateParseFormat;b=ws.date.ParseDateFromFormat(this.startDateInput.value,b);if(null!=b){this.customMonthDate.innerHTML=ws.string.substituteParams(Config.Strings.onTheDate,b.getDate());var e="",e=8>b.getDate()?Config.Strings.First:7<b.getDate()&&15>b.getDate()?Config.Strings.Second:14<b.getDate()&&22>b.getDate()?Config.Strings.Third:21<b.getDate()&&29>b.getDate()?Config.Strings.Fourth:
Config.Strings.Last;this.customMonthDay.innerHTML=ws.string.substituteParams(Config.Strings.onTheDay,e,d[b.getDay()]);this.dayIntervalSelect.style.display="none";this.monthIntervalSelect.style.display="";this.onTextSpan.style.display="none";this.eventInfo.recurType="5"}break;case "repeatEveryYear":this.dayIntervalSelect.style.display="none",this.monthIntervalSelect.style.display="none",this.onTextSpan.style.display="none",this.eventInfo.recurType="6"}this.customSelectUnit=this.repeatEveryMenu.currentValue;
this.checkSize()},handleCustomRemind:function(){switch(this.customRemindMenu.currentValue){case "onThisDate":this.remindAtEndInput.style.display="";this.remindAtEndInput.value=ws.date.formatDateTime(new Date,this.dateFormat);break;case "dayOfEvent":case "oneDayBefore":case "twoDaysBefore":case "oneWeekBefore":case "remindMinutes":case "remindHours":case "remindDays":case "remindWeeks":this.remindAtEndInput.style.display="none"}},handleEndDate:function(){switch(this.endDateMenu.currentValue){case "noEndDate":this.endRepeatDateInput.style.display=
"none";break;case "repeatUntil":var b=ws.date.add(new Date,ws.date.dateParts.DAY,7);this.endRepeatDateInput.value=ws.date.formatDateTime(b,this.dateFormat);this.endRepeatDateInput.style.display=""}this.customRemindMenu.sizeMyself()},onMouseOverSpan:function(b){a.addClass(b,"pickDaySpanOnHover")},onMouseOutSpan:function(b){this.selectedDays[b.value]||a.removeClass(b,"pickDaySpanOnHover")},onClickSpan:function(b){b.value in this.selectedDays?(delete this.selectedDays[b.value],a.removeClass(b,"pickDaySpanOnHover")):
(this.selectedDays[b.value]=!0,a.addClass(b,"pickDaySpanOnHover"))},addLocation:function(){this.addLocationInputArea.className="wsInput addLocationInputShowNew";this.addLocationInputArea.value=Config.Strings.AddLocationHere;this.checkSize()},locationTextType:function(){if(!a.hasClass(this.addLocationInputArea,"addLocationInputShow"))this.addLocationInputArea.value="",this.addLocationInputArea.className="wsInput addLocationInputShow"},showMapLink:function(){ws.calendar.calutil.showMapLink(this.addLocationInputArea.value,
!1)},setModel:function(b){this.model&&this.modelUpdatedHandler&&a.disconnect(this.modelUpdatedHandler);this.model=b;this.modelUpdatedHandler=a.connect(this.model,"modelUpdated",this,"update");this.calendarMenu.setModel(b);this.saveButton.setEnabled(this.model.isModelFetchedOnce)},saveAndClose:function(){if((null==this.eventInfo||null==this.eventInfo.dtstart)&&null!=this.model){var b=this.model.getDefaultComponentArgs();this.eventInfo.dtstart=b.dtstart;this.eventInfo.dtend=b.dtend}b=this.checkAndGetInfo();
null===b?(this.eventInfo.index=!0,this.isSelectedEventRecurring()?(this.addDialogWidget.style.display="none",ws.calendar.calutil.showConfirmRecurDialog("edit",a.hitch(this,function(b,a){b?(this.saveComponentCallback(a),this.resetSearch()):(this.addDialogWidget.style.display="",this.cancelSave())}))):(this.saveComponentCallback(),this.resetSearch())):(this.addDialogWidget.style.display="none",ws.widget.Dialogs.ok(b,a.hitch(this,function(){this.addDialogWidget.style.display=""})))},resetSearch:function(){this.model&&
this.model.getSearchString()&&this.model.refreshSearchResult()},isSelectedEventRecurring:function(){var b=!1,a=this.eventInfo;a&&a.rid&&(b=0<a.rid.length);return b},cancelSave:function(){},saveComponentCallback:function(b){b||(b="CHANGE_CURRENT");this.eventInfo.recurChangeMode=b;this.eventInfo.loadCallback=a.hitch(this,function(){this.setDate(this.targetDate);if(this.onSavedCB)this.onSavedCB(),this.onSavedCB=null;this.selectCalendar(this.eventInfo.calid)});b=!1;if(this.showIndexCB)b=this.showIndexCB;
this.model.saveComponent(this.eventInfo,b);this.hide()},selectCalendar:function(b){var b=this.model.calendars[b],a=this.model.calendarEnum;if(b&&!b[a.selected])b=this.model.getCalendarArgs(b,!1),b.selected=!0,this.model.saveCalendar(b)},setDate:function(){},checkAndGetInfo:function(){var b=null,d=b=null,e=ws.string.sanitize(this.summaryInput.value);if(""==e||a.hasClass(this.summaryInput,"summaryInputNew"))return Config.Strings.AddTitleToEvent;var g=Config.Strings.CalDateParseFormat,b=ws.date.ParseDateFromFormat(this.startDateInput.value,
g),d=ws.date.ParseDateFromFormat(this.startDateInput.value,g);if(null==b||null==d)return Config.Strings.InvalidDateOnCreate;if(!this.allDayBox.checked){g=ws.date.ParseHourMinTextField(this.startTimeInput.value,this.timeFormat,this.timeFormatShort);if(null==g)return b=Config.Strings.Calendar_AddEvent_InvalidStart;b.setHours(g.hr,g.min,0,0);var h=ws.date.ParseHourMinTextField(this.endTimeInput.value,this.timeFormat,this.timeFormatShort);if(null==h)return b=Config.Strings.Calendar_AddEvent_InvalidEnd;
if(b.getDate()==d.getDate()&&(h.hr<g.hr||h.hr==g.hr&&h.min<g.min))d=ws.date.add(d,ws.date.dateParts.HOUR,24);d.setHours(h.hr,h.min,0,0)}if(b>d)return b=Config.Strings.Calendar_AddEvent_InvalidStartAfterEnd;d.getTime()>=b.getTime()+864E5&&(d=ws.date.add(d,ws.date.dateParts.HOUR,-24));if(this.eventInfo.recurType){if("customRepeat"==this.repeatMenu.currentValue){g=!1;if(""!=this.repeatEveryInput.value&&"NaN"!=Number(this.repeatEveryInput.value).toString()){this.eventInfo.frequency=Number(this.repeatEveryInput.value);
this.eventInfo.frequency=Math.floor(this.eventInfo.frequency);if(1>this.eventInfo.frequency)this.eventInfo.frequency=1;1E4<this.eventInfo.frequency&&(g=!0)}else g=!0;if(g)return b=Config.Strings.Calendar_AddEvent_InvalidNumberCustomRepeat}if("repeatEveryWeek"==this.customSelectUnit){if(this.sortSelectedDays(),this.sortedDays.length)this.eventInfo.occursOn=this.getOccursOnDay(this.sortedDays,!0)}else if("repeatEveryMonth"==this.customSelectUnit)if(this.customMonthDayButton.checked)this.eventInfo.occursOn=
8>b.getDate()?b.getDay():7<b.getDate()&&15>b.getDate()?b.getDay()+7:14<b.getDate()&&22>b.getDate()?b.getDay()+14:21<b.getDate()&&29>b.getDate()?b.getDay()+21:b.getDay()+28;else if(this.customMonthDateButton.checked)this.eventInfo.occursOn=b.getDate();else return b=Config.Strings.Calendar_AddEvent_InvalidCustomMonth;else"2"==this.eventInfo.recurType?(g=[],h=b.getDay(),g.push(h),this.eventInfo.occursOn=this.getOccursOnDay(g,!1)):this.eventInfo.occursOn="5"==this.eventInfo.recurType?b.getDate():0;if("customRepeat"==
this.repeatMenu.currentValue&&"repeatUntil"==this.endDateMenu.currentValue)if(h=null,g=Config.Strings.CalDateParseFormat,h=this.endRepeatDateInput.value,h=ws.date.ParseDateFromFormat(h,g),null!=h){if(ws.date.ParseDateFromFormat(this.startDateInput.value,g)>h)return b=Config.Strings.Calendar_AddEvent_InvalidStartAfterEnd;this.eventInfo.recurEnd=ws.date.formatISO8601(h)}else return b=ws.string.substituteParams(Config.Strings.ErrorDateNotValidFormat,Config.Strings.EventRepeatEndDate,Config.Strings.CalDateFormat);
else this.eventInfo.recurEnd&&delete this.eventInfo.recurEnd}if("noReminder"!=this.reminderMenu.currentValue){this.eventInfo.reminderEnabled=!0;g=null;if("customReminder"==this.reminderMenu.currentValue||"remindAt"==this.reminderMenu.currentValue){if(g="remindAt"==this.reminderMenu.currentValue?this.calculateLeadTimeInMinutes(this.customRemindMenu.currentValue,"12:00am",b):this.calculateLeadTimeInMinutes(this.customRemindMenu.currentValue,this.remindInput.value,b),"string"==typeof g)return g}else g=
this.getLeadTimeInMinutes(this.reminderMenu.currentValue);this.eventInfo.reminderLeadTime=g;g=60*this.eventInfo.reminderLeadTime;g=b.getTime()/1E3-g;if(0<g&&(h=this.model.currentServerTime,g=((new Date(1E3*g)).getTime()-h.getTime())/1E3,this.allDayBox.checked&&(g-=3600),1>g))return b=Config.Strings.InvalidReminderDateInPastOnCreate}this.targetDate=b;g=ws.string.sanitize(this.addNotesInput.getValue());0<g.length?this.eventInfo.description=g:delete this.eventInfo.description;""==this.addLocationInputArea.value||
a.hasClass(this.addLocationInputArea,"addLocationInputShowNew")?this.hasPrevLocationValue?this.eventInfo.location="":delete this.eventInfo.location:this.eventInfo.location=ws.string.sanitize(this.addLocationInputArea.value);this.eventInfo.summary=e;this.eventInfo.start=ws.date.formatISO8601(b);this.eventInfo.end=ws.date.formatISO8601(d);this.eventInfo.allDay=this.allDayBox.checked;if("string"==typeof this.calendarMenu.getValue())this.eventInfo.calid=this.calendarMenu.getValue();return null},getOccursOnDay:function(b,
a){for(var e=0,g=null,h=0,g=0;g<b.length;g++)switch(h=a?7>b[g]+ws.date.firstDayOfWeek?b[g]+ws.date.firstDayOfWeek:b[g]+ws.date.firstDayOfWeek-7:b[g],h){case 0:e+=1;break;case 1:e+=2;break;case 2:e+=4;break;case 3:e+=8;break;case 4:e+=16;break;case 5:e+=32;break;case 6:e+=64}return e},decodeSelectedDays:function(){for(var b=this.eventInfo.occursOn,a=[Config.Strings.Sunday,Config.Strings.Monday,Config.Strings.Tuesday,Config.Strings.Wednesday,Config.Strings.Thursday,Config.Strings.Friday,Config.Strings.Saturday],
e=[],g=[],h=1,l=0;7>l;l++){var j=l+ws.date.firstDayOfWeek;7<=j&&(j-=7);h=Math.pow(2,j);b&h&&(e.push(a[j]),g.push(0>j-ws.date.firstDayOfWeek?j-ws.date.firstDayOfWeek+7:j-ws.date.firstDayOfWeek))}return{days:e,daysValues:g}},getCustomMonthly:function(b,a){var e=null,e=[Config.Strings.Sunday,Config.Strings.Monday,Config.Strings.Tuesday,Config.Strings.Wednesday,Config.Strings.Thursday,Config.Strings.Friday,Config.Strings.Saturday];if(b){this.customMonthDayButton.checked=!0;var g=Math.floor(this.eventInfo.occursOn/
7),h=this.eventInfo.occursOn%7,g=0==g?Config.Strings.First:1==g?Config.Strings.Second:2==g?Config.Strings.Third:3==g?Config.Strings.Fourth:Config.Strings.Last,e=1==a?ws.string.substituteParams(Config.Strings.onTheDayOfEveryMonth,g,e[h],Config.Strings.month):ws.string.substituteParams(Config.Strings.onTheDayOfEveryFreqMonth,g,e[h],a,Config.Strings.Months)}else this.customMonthDateButton.checked=!0,e=1==a?ws.string.substituteParams(Config.Strings.onTheDateOfEveryMonth,this.eventInfo.occursOn,Config.Strings.month):
ws.string.substituteParams(Config.Strings.onTheDateOfEveryFreqMonth,this.eventInfo.occursOn,a,Config.Strings.Months);return e},buildReminderMenu:function(b){var a=[];b?(a.push({display:Config.Strings.NoReminder,value:"noReminder",selected:!0}),a.push({display:Config.Strings.RemindMeAt2,value:"remindAt"})):(a.push({display:Config.Strings.NoReminder,value:"noReminder",selected:!0}),a.push({display:Config.Strings.ReminderAtDateAndTimeAbove,value:"timeOfEvent"}),a.push({display:"15 "+Config.Strings.RemindMinsBefore,
value:"min15Before"}),a.push({display:"30 "+Config.Strings.RemindMinsBefore,value:"min30Before"}),a.push({display:"1 "+Config.Strings.HourBefore,value:"hour1Before"}),a.push({display:Config.Strings.CustomReminder,value:"customReminder"}));this.reminderMenu.setOptions(a)},buildCustomReminderMenu:function(b){var a=[];b?(a.push({display:Config.Strings.DayOfEvent,value:"dayOfEvent",selected:!0}),a.push({display:Config.Strings.OneDayBefore,value:"oneDayBefore"}),a.push({display:Config.Strings.TwoDaysBefore,
value:"twoDaysBefore"}),a.push({display:Config.Strings.OneWeekBefore,value:"oneWeekBefore"}),a.push({display:Config.Strings.OnThisDate,value:"onThisDate"})):(a.push({display:Config.Strings.Minutes,value:"remindMinutes",selected:!0}),a.push({display:Config.Strings.Hours,value:"remindHours"}),a.push({display:Config.Strings.Days,value:"remindDays"}),a.push({display:Config.Strings.Weeks,value:"remindWeeks"}));this.customRemindMenu.setOptions(a)},clearForm:function(){for(var b=0;b<this.textValues.length;b++)this[this.textValues[b]+
"Input"].value="";this.allDayBox.setChecked(!0);this.startTimeInput.style.display="none";this.endTimeInput.style.display="none";this.toSpan.style.display="none"},defaultPopulateForm:function(){var b=new Date;this.editEvent=!1;a.replaceClass(this.summaryInput,"summaryInputNew","summaryInput");b=ws.calendar.calutil.GetNext30MinuteIncrement(b);this.startDateInput.value=ws.date.formatDateTime(b,this.dateFormat);this.startTimeInput.value=ws.date.formatDateTime(b,this.timeFormat);b=ws.date.add(b,ws.date.dateParts.MINUTE,
30);this.endDateInput.value=ws.date.formatDateTime(b,this.dateFormat);this.endTimeInput.value=ws.date.formatDateTime(b,this.timeFormat);this.allDayBox.setChecked(!0);this.buildReminderMenu(!0);this.buildCustomReminderMenu(!0);this.startTimeInput.style.display="none";this.endTimeInput.style.display="none";this.toSpan.style.display="none";this.repeatMenu.setOption(0,!0);this.reminderMenu.setOption(0,!0);this.calendarMenu.setOption(0,!0);this.repeatEveryMenu.setOption(1);this.customRemindMenu.setOption(0,
!0);this.endDateMenu.setOption(0,!0);b.setHours(18,0);this.remindInput.value=ws.date.formatDateTime(b,this.timeFormat);this.reminderInputPrevValue="1";this.addNotesInput.setValue();this.addLocationInputArea.value="";this.addLocation()},populateForm:function(b){this.editEvent=!0;a.replaceClass(this.summaryInput,"summaryInput","summaryInputNew");this.eventInfo.calid&&this.calendarMenu.setValue(this.eventInfo.calid);var d=this.eventInfo.summary;null!=b&&4==b&&d==Config.Strings.AddEventName?a.replaceClass(this.summaryInput,
"summaryInputNew","summaryInput"):d=ws.calendar.calutil.DecodeHTMLEntities(d);this.summaryInput.value=d;this.startDateInput.value=ws.date.formatDateTime(this.eventInfo.start,this.dateFormat);this.startTimeInput.value=ws.date.formatDateTime(this.eventInfo.start,this.timeFormat);this.endDateInput.value=ws.date.formatDateTime(this.eventInfo.end,this.dateFormat);this.endTimeInput.value=ws.date.formatDateTime(this.eventInfo.end,this.timeFormat);this.allDayBox.setChecked(this.eventInfo.allDay);this.checkBoxChange();
if(this.eventInfo.rid){var e=b=null;if(this.eventInfo.frequency)e=1==this.eventInfo.frequency?!0:!1;else return;switch(this.eventInfo.recurType){case "1":e&&null==this.eventInfo.recurEnd?(this.repeatEverySummarySpan.innerHTML="",this.repeatMenu.setOption(1,!0)):(this.repeatMenu.setOption(5,!0),this.repeatDialog.style.display="",this.repeatEveryInput.value=this.eventInfo.frequency,this.repeatEveryMenu.setOption(0),this.handleCustomRepeat(),b=Config.Strings.Every+" "+this.eventInfo.frequency+" "+Config.Strings.Days);
break;case "2":d=this.decodeSelectedDays();if(d.days.length){b=e?Config.Strings.EveryWeekOn+" ":Config.Strings.Every+" "+this.eventInfo.frequency+" "+Config.Strings.WeeksOn;if(1<d.days.length){for(e=0;e<d.days.length-1;e++)b=e<d.days.length-2?b+(d.days[e]+", "):b+d.days[e];b+=" "+Config.Strings.And+" "+d.days[e]}else b+=d.days[0];this.repeatMenu.setOption(5);this.repeatDialog.style.display="";this.repeatEveryInput.value=this.eventInfo.frequency;this.repeatEveryMenu.setOption(1);this.handleCustomRepeat();
for(e=0;e<d.daysValues.length;e++)this.selectedDays[d.daysValues[e]]=!0;this.setupDaySpans()}else this.repeatMenu.setOption(2);break;case "4":this.repeatMenu.setOption(5,!0);this.repeatDialog.style.display="";this.repeatEveryInput.value=this.eventInfo.frequency;this.repeatEveryMenu.setOption(2,!0);this.handleCustomRepeat();this.eventInfo.recurType="4";b=this.getCustomMonthly(!0,this.eventInfo.frequency);break;case "5":e&&null==this.eventInfo.recurEnd?this.repeatMenu.setOption(3,!0):(this.repeatMenu.setOption(5,
!0),this.repeatDialog.style.display="",this.repeatEveryInput.value=this.eventInfo.frequency,this.repeatEveryMenu.setOption(2,!0),this.handleCustomRepeat(),b=this.getCustomMonthly(!1,this.eventInfo.frequency));break;case "6":this.repeatMenu.setOption(5,!0),this.repeatDialog.style.display="",this.repeatEveryInput.value=this.eventInfo.frequency,this.repeatEveryMenu.setOption(3,!0),this.handleCustomRepeat(),b=e?Config.Strings.EveryYear:Config.Strings.Every+" "+this.eventInfo.frequency+" "+Config.Strings.Years}this.eventInfo.recurEnd?
(this.endDateMenu.setOption(1,!0),d=8<=this.eventInfo.recurEnd.length?this.eventInfo.recurEnd.substring(0,8):this.eventInfo.recurEnd,d=ws.date.ParseDateFromFormat(d,ws.date.RFC2445),this.endRepeatDateInput.value=ws.date.formatDateTime(d,Config.Strings.CalDateFormat),this.endRepeatDateInput.style.display=""):this.endDateMenu.setOption(0,!0);if(b)this.repeatCustomSummary.style.display="",this.repeatEverySummarySpan.innerHTML=b}else this.repeatMenu.setOption(0,!0);this.buildReminderMenu(this.eventInfo.allDay);
this.buildCustomReminderMenu(this.eventInfo.allDay);this.remindInput.style.display="";this.eventInfo.reminderEnabled&&this.eventInfo.allDay?(this.reminderMenu.setOption(1,!0),this._populateCustomReminder(this.eventInfo.reminderLeadTime,!0,this.eventInfo.start),this.remindInput.style.display="none"):this.eventInfo.reminderEnabled?(b=this.getReminderLeadTime(this.eventInfo.reminderLeadTime),"number"==typeof b?this.reminderMenu.setOption(b,!0):(this.reminderMenu.setOption(5,!0),this._populateCustomReminder(this.eventInfo.reminderLeadTime))):
(this.reminderMenu.setOption(0,!0),b=new Date,b.setHours(18,0),this.remindInput.value=ws.date.formatDateTime(b,this.timeFormat),this.reminderInputPrevValue="1");this.eventInfo.description?(b=this.eventInfo.description,b=ws.calendar.calutil.DecodeHTMLEntities(b),this.addNotesInput.setValue(b)):this.addNotesInput.setValue();this.eventInfo.location&&!(null==this.eventInfo.location||""==this.eventInfo.location)?(b=this.eventInfo.location,b=ws.calendar.calutil.DecodeHTMLEntities(b),this.addLocationInputArea.className=
"wsInput addLocationInputShow",this.addLocationInputArea.value=b,this.hasPrevLocationValue=!0):(this.addLocationInputArea.value="",this.addLocation())},_populateCustomReminder:function(b,a,e){if(a){var a=new Date,g=0,h=0;if(1440>=b)e=1,0==b?(a.setHours(0,0),e=0):1440==b?a.setHours(0,0):(g=Math.ceil(b/60),h=b%60,a.setHours(0==g?0:24-g,0==h?0:60-h)),this.remindInput.value=ws.date.formatDateTime(a,this.timeFormat),this.customRemindMenu.setOption(e,!0);else if(2880>=b)2880==b?a.setHours(0,0):(g=Math.ceil((b-
1440)/60),h=(b-1440)%60,a.setHours(24-g,0==h?0:60-h)),this.remindInput.value=ws.date.formatDateTime(a,this.timeFormat),this.customRemindMenu.setOption(2,!0);else{var l=Math.ceil(b/1440),b=b%(1440*(l-1)),g=Math.ceil(b/60),h=b%60;a.setHours(24-g,0==h?0:60-h);a.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()-l);this.remindInput.value=ws.date.formatDateTime(a,this.timeFormat);this.customRemindMenu.setOption(4,!0);this.remindAtEndInput.value=ws.date.formatDateTime(a,this.dateFormat)}this.reminderInputPrevValue=
"1"}else 0==b%10080?(this.remindInput.value=b/10080,this.customRemindMenu.setOption(3,!0)):0==b%1440?(this.remindInput.value=b/1440,this.customRemindMenu.setOption(2,!0)):0==b%60?(this.remindInput.value=b/60,this.customRemindMenu.setOption(1,!0)):(this.remindInput.value=b,this.customRemindMenu.setOption(0,!0)),a=new Date,a.setHours(18,0),this.reminderInputPrevValue=ws.date.formatDateTime(a,this.timeFormat)},toggleTitle:function(b){"Add"==b?(this.dlgTitleEdit.style.display="none",this.dlgTitleAdd.style.display=
"",this.saveButton.setLabel(Config.Strings.AddEventBtn)):(this.dlgTitleEdit.style.display="",this.dlgTitleAdd.style.display="none",this.saveButton.setLabel(Config.Strings.Save))},show:function(b,d){this.hide();this.eventInfo=null;this.toggleTitle("Edit");this.eventDatePopupPicker.clearSelectedDate();this.calendarMenu.buildList(d);if(1==b||4==b)if(d){this.eventInfo=d;if(null!=d.index)this.showIndexCB=d.index;null!=this.eventInfo.id||this.toggleTitle("Add");this.populateForm(b);this.inherited(arguments)}else return;
else if(2==b)if(d){this.model.isSuccess||this.model.getData();this.defaultPopulateForm();this.eventInfo=this.model.getDefaultArgs();null==d.notes||""==d.notes||this.addNotesInput.setValue(d.notes);if(!(null==d.location||""==d.location))this.addLocationInputArea.className="wsInput addLocationInputShow",this.addLocationInputArea.value=d.location,this.hasPrevLocationValue=!0;if(d.start)this.startDateInput.value=ws.date.formatDateTime(d.start,this.dateFormat),this.startTimeInput.value=ws.date.formatDateTime(d.start,
this.timeFormat);this.toggleTitle("Add");this.inherited(arguments);if(null==d.summary||""==d.summary){var e;ws.lang.setTimeout(this,function(){this.summaryInput.value=Config.Strings.AddEventName;ws.html.selectInputText(this.summaryInput)},50)}else a.replaceClass(this.summaryInput,"summaryInput","summaryInputNew"),this.summaryInput.value=d.summary}else return;else this.toggleTitle("Add"),this.eventInfo=this.model.getDefaultArgs(),this.defaultPopulateForm(),this.inherited(arguments),ws.lang.setTimeout(this,
function(){this.summaryInput.value=Config.Strings.AddEventName;ws.html.selectInputText(this.summaryInput)},50);a.isMozilla&&!ws.browser.ns7&&ws.widget.fixFFCursor(this.contentPane);ws.browser.ns7&&(a.style(this.addDialogWidget,"padding-right","13px"),a.style(this.summaryInput,"margin-top","6px"));this.endDateMenu.hide();this.endDateMenu.show();this.repeatMenu.sizeMyself();this.repeatEveryMenu.sizeMyself();this.endDateMenu.sizeMyself();this.reminderMenu.sizeMyself();this.customRemindMenu.sizeMyself()},
hide:function(){this.hideRepeat();this.customSelectUnit=null;this.sortedDays=[];this.hideRemind();this.repeatEverySummarySpan.innerHTML="";this.repeatCustomSummary.style.display="none";this.remindSummarySpan.innerHTML="";this.remindSummaryRow.style.display="none";this.addNotesInput.setValue();this.addLocation();this.inherited(arguments)},checkBoxChange:function(b){if(this.allDayBox.checked){if(this.startTimeInput.style.display="none",this.endTimeInput.style.display="none",this.customRemindBeforeSpan.style.display=
"none",a.replaceClass(this.remindInput,"remindAt","everyInput"),this.remindInput.parentNode.setAttribute("width","14"),this.remindInput.onclick=a.hitch(this,"showTimePicker",this.remindInput),this.toSpan.style.display="none",b){this.buildReminderMenu(!0);this.buildCustomReminderMenu(!0);var d=this.reminderInputPrevValue?this.reminderInputPrevValue:"6:00pm"}}else this.startTimeInput.style.display="",this.endTimeInput.style.display="",this.customRemindBeforeSpan.style.display="",a.replaceClass(this.remindInput,
"everyInput","remindAt"),this.remindInput.parentNode.setAttribute("width","28"),this.remindInput.onclick=function(){},this.toSpan.style.display="",b&&(this.buildReminderMenu(!1),this.buildCustomReminderMenu(!1),d=this.reminderInputPrevValue?this.reminderInputPrevValue:"1");if(b)this.reminderMenu.setOption(0,!0),this.reminderInputPrevValue=this.remindInput.value,this.remindInput.value=d},showPicker:function(b){if(!this.eventDatePopupPicker.isShowing())ws.widget.popup({popup:this.eventDatePopupPicker,
around:b,orient:{BL:"TL"}}),this.dateInputField=b},showTimePicker:function(b){if(!this.eventTimePopupPicker.isShowing()){ws.widget.popup({popup:this.eventTimePopupPicker,around:b,orient:{BL:"TL"}});this.timeInputField=b;var a=new Date,b=ws.date.ParseHourMinTextField(b.value,this.timeFormat,this.timeFormatShort);null!=b?(a.setHours(b.hr,b.min,0,0),this.eventTimePopupPicker.initializeTime(a)):this.eventTimePopupPicker.initializeTime()}},fillInDateField:function(b){this.dateInputField.value=ws.date.formatDateTime(new Date(b),
this.dateFormat);this.dateInputField==this.startDateInput&&"repeatEveryMonth"==this.repeatEveryMenu.currentValue&&this.handleCustomRepeat();if(this.dateInputField==this.startDateInput){if(ws.date.ParseDateFromFormat(this.endDateInput.value,Config.Strings.CalDateParseFormat)<b)this.endDateInput.value=this.dateInputField.value;this.endDateInput.value=this.startDateInput.value}else if(this.dateInputField==this.endDateInput){if(ws.date.ParseDateFromFormat(this.startDateInput.value,Config.Strings.CalDateParseFormat)>
b)this.startDateInput.value=this.dateInputField.value;this.startDateInput.value=this.endDateInput.value}},fillInTimeField:function(b){this.timeInputField.value=b},monthButtonChange:function(){this.eventInfo.recurType=this.customMonthDateButton.checked?"5":"4"},setupDaySpans:function(){for(var b in this.selectedDays)switch(b){case "0":a.addClass(this.day0Span,"pickDaySpanOnHover");break;case "1":a.addClass(this.day1Span,"pickDaySpanOnHover");break;case "2":a.addClass(this.day2Span,"pickDaySpanOnHover");
break;case "3":a.addClass(this.day3Span,"pickDaySpanOnHover");break;case "4":a.addClass(this.day4Span,"pickDaySpanOnHover");break;case "5":a.addClass(this.day5Span,"pickDaySpanOnHover");break;case "6":a.addClass(this.day6Span,"pickDaySpanOnHover")}},sortSelectedDays:function(){for(var b in this.selectedDays)this.sortedDays.push(1*b);this.sortedDays.sort(function(b,a){return b-a})},hideRepeat:function(){this.selectedDays={};for(var b=0;b<this.daySpanValues.length;b++)a.removeClass(this[this.daySpanValues[b]+
"Span"],"pickDaySpanOnHover");this.repeatDialog.style.display="none"},hideRemind:function(){this.remindDialog.style.display="none"},getLeadTimeInMinutes:function(b){var a=0;switch(b){case "timeOfEvent":a=0;break;case "min15Before":a=15;break;case "min30Before":a=30;break;case "hour1Before":a=60;break;case "day1Before":a=1440;break;default:a=0}return a},calculateLeadTimeInMinutes:function(b,a,e){var g=0;switch(b){case "remindMinutes":a=Math.round(new Number(a));if("NaN"==a)return Config.Strings.Calendar_AddEvent_InvalidNumberCustomRemind;
g=a;break;case "remindHours":a=Math.round(new Number(a));if("NaN"==a)return Config.Strings.Calendar_AddEvent_InvalidNumberCustomRemind;g=a*this.getLeadTimeInMinutes("hour1Before");break;case "remindDays":a=Math.round(new Number(a));if("NaN"==a)return Config.Strings.Calendar_AddEvent_InvalidNumberCustomRemind;g=a*this.getLeadTimeInMinutes("day1Before");break;case "remindWeeks":a=Math.round(new Number(a));if("NaN"==a)return Config.Strings.Calendar_AddEvent_InvalidNumberCustomRemind;g=7*a*this.getLeadTimeInMinutes("day1Before");
break;case "dayOfEvent":g=0;break;case "oneDayBefore":g=this._getLeadTime(ws.date.ParseHourMinTextField(a,this.timeFormat,this.timeFormatShort),1);break;case "twoDaysBefore":g=this._getLeadTime(ws.date.ParseHourMinTextField(a,this.timeFormat,this.timeFormatShort),2);break;case "oneWeekBefore":g=this._getLeadTime(ws.date.ParseHourMinTextField(a,this.timeFormat,this.timeFormatShort),7);break;case "onThisDate":b=ws.date.ParseDateFromFormat(this.remindAtEndInput.value,Config.Strings.CalDateParseFormat);
g=this._getLeadTime(ws.date.ParseHourMinTextField(a,this.timeFormat,this.timeFormatShort),b,e);break;default:g=0}return g},_getLeadTime:function(b,a,e){if(null==b)return Config.Strings.Calendar_AddEvent_InvalidTimeCustomRemind;if(e&&"object"==typeof a)return e=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0),b=new Date(a.getFullYear(),a.getMonth(),a.getDate(),b.hr,b.min,0,0),b=e.getTime()-b.getTime(),0<b?Math.round(b/1E3/60):Config.Strings.Calendar_AddEvent_ReminderAfterEvent;var g=new Date,
e=new Date(g.getFullYear(),g.getMonth(),g.getDate(),0,0,0,0),b=new Date(g.getFullYear(),g.getMonth(),g.getDate()-a,b.hr,b.min,0,0),b=e.getTime()-b.getTime();return Math.round(b/1E3/60)},getReminderLeadTime:function(b){var a=null;switch(b){case 0:a=1;break;case 15:a=2;break;case 30:a=3;break;case 60:a=4;break;default:a=ws.string.substituteParams(Config.Strings.RemindBefore,b,Config.Strings.Minutes)}return a},summaryTextClick:function(){if(a.hasClass(this.summaryInput,"summaryInputNew"))this.summaryInput.value=
"",a.replaceClass(this.summaryInput,"summaryInput","summaryInputNew")},summaryKeyPress:function(){a.hasClass(this.summaryInput,"summaryInputNew")&&a.replaceClass(this.summaryInput,"summaryInput","summaryInputNew")},summaryTextBlur:function(){if(""==this.summaryInput.value)a.addClass(this.summaryInput,"summaryInputNew"),this.summaryInput.value=Config.Strings.AddEventName},_suiteOnKeyPress:function(b){this.isShowing()&&(Config.EnableKeyboardShortcuts&&b.ctrlKey?ws.html.fixKeyCodeForMac(b)==a.keys.ENTER&&
this.saveAndClose():b.keyChar&&a.isString(b.keyChar)&&b.keyChar.toLowerCase()==Config.Strings.KeyCancelAddContact&&b.altKey&&this.hide())}})})},"ws/pictures/PictureViewControl":function(){define("ws/pictures/PictureViewControl",["dojo/_base/declare","dojo","ws/html","ws/io","ws/widget/util"],function(n,j){return n(null,{picturesModel:null,image:null,isAttachment:!1,folder:"",uid:"",constructor:function(n){j.mixin(this,n);j.query("*",this.domNode).forEach(function(a){var l=a.getAttribute("data-dojo-attach-point");
l&&(this[l]=a)},this);ws.lang.setTimeout(this,"positionSelf",0);this.isAttachment=j.hasClass(this.image,"AOLAttachedImage");Config.EnablePictures||(ws.html.setShowing(this.saveNode,!1),ws.html.setShowing(this.saveNodeSep,!1),ws.html.setShowing(this.savingNode,!1));this.positionSelf()},positionSelf:function(){if(this.domNode)try{j.withDoc(this.domNode.ownerDocument,j.hitch(this,function(){var a=j.position(this.image,!0),l=j.contentBox(this.image);this.domNode.style.left=a.x+"px";this.domNode.style.top=
a.y+l.h+1+"px"}))}catch(n){}}})})},"ws/mail/AddTaskCard":function(){require({cache:{"url:ws/mail/AddTaskCard.html":'<div class="addTaskCard">\n\t<div class="todoPanelLabelDiv" data-dojo-attach-point="todoPanelLabelDiv">\n\t\t<span class="todoPanelLabel">${Panel_TodoLabel}</span>\n\t\t<div class="mainSprite wsSmallCloseBtn" data-dojo-attach-event="onclick:close"></div>\n\t</div>\n\t<div class="wsInput addTaskInput">\n\t\t<input type="text" data-dojo-attach-point="addTaskInputNode" maxlength="100" data-dojo-attach-event="onfocus: onFocus, onblur: onBlur, onkeypress: onAddTaskKeyPress" class="default wsInputBare"/>\n\t\t<div title="${EnterTask}" class="wsSmallAddButton" data-dojo-attach-point="addTaskImage" data-dojo-attach-event="onclick:onClickAddFromInput"></div>\n\t</div>\n</div>\n',
"url:ws/mail/AddTaskCard.css":""}});define("ws/mail/AddTaskCard","dojo/_base/declare,dojo/text!ws/mail/AddTaskCard.html,dojo/text!ws/mail/AddTaskCard.css,dojo,dijit,dijit/_Widget,dijit/_Templated,ws/date,ws/widget/popup,ws/calendar/CalendarViewModel".split(","),function(n,j,q,a,l,m,e){return n([m,e],{templateString:j,css:{templateString:q},isStandAlone:!1,isPopup:!1,startup:function(){},setModel:function(a){this.model=a},open:function(e,b,d,i,g,l){if(e&&""!=e)this.clearTaskInput(),a.removeClass(this.addTaskInputNode,
"default"),a.removeClass(this.addTaskImage,"wsSmallAddDisabled"),a.addClass(this.addTaskImage,"wsSmallAddButton"),this.addTaskInputNode.value=e,this.around=b,this.orient=d,this.padding=i,this.pointerSide=g,this.nudge=l,ws.widget.popup({popup:this,around:b,orient:d,padding:i}),ws.widget.pointer({node:this.domNode,side:g,target:b,nudge:l})},close:function(){ws.widget.popup.close(this)},clearTaskInput:function(){a.addClass(this.addTaskInputNode,"default");this.addTaskInputNode.value=Config.Strings.EnterTask;
a.removeClass(this.addTaskImage,"wsSmallAddButton");a.addClass(this.addTaskImage,"wsSmallAddDisabled");this.addTaskInputNode.blur();this.currentTaskUID=null},onClickAddFromInput:function(){a.hasClass(this.addTaskImage,"wsSmallAddButton")&&(this.close(),this._updateTask(this.addTaskInputNode.value))},onAddTaskKeyPress:function(e){e.keyCode==a.keys.ENTER?(this.close(),this._updateTask(this.addTaskInputNode.value)):e.keyCode==a.keys.ESCAPE&&this.clearTaskInput()},_updateTask:function(e){e=ws.string.sanitize(e);
if(""!=e){var b=this.model.getDefaultTaskArgs();b.sortBy=this._sortBy;b.sortDir=this._sortDir;b.start=ws.date.formatISO8601(new Date);b.summary=e;b.end=null;b.reminderEnabled=!1;b.reminderLeadTime=0;b.start=ws.date.formatISO8601(new Date);b.loadCallback=a.hitch(this,function(){a.publish("WSFeedbackStart",[Config.Strings.ToDoCreated,!0]);if(this.onSavedCB)this.onSavedCB()});this.model.saveComponent(b)}},onFocus:function(){if(a.hasClass(this.addTaskInputNode,"default"))this.addTaskInputNode.value="",
a.removeClass(this.addTaskInputNode,"default"),a.removeClass(this.addTaskImage,"wsSmallAddDisabled"),a.addClass(this.addTaskImage,"wsSmallAddButton"),this.addTaskInputNode.focus()},onBlur:function(){if(""==a.trim(this.addTaskInputNode.value))this.addTaskInputNode.value=Config.Strings.EnterTask,a.addClass(this.addTaskInputNode,"default"),a.removeClass(this.addTaskImage,"wsSmallAddButton"),a.addClass(this.addTaskImage,"wsSmallAddDisabled")}})})},"url:ws/calendar/CalendarSelect.css":"","url:ws/address/PeoplePanelAddContactCard.html":'<div class="peoplePanelAddContactCard hoverCard">\n\t<img src="${spacer}" class="mainSprite wsCloseBtn" data-dojo-attach-event="onclick: close">\n\t<div class="contentDiv" data-dojo-attach-point="contentDiv">\n\t\t<table data-dojo-attach-point="inputTable">\n\t\t\t<tr>\n\t\t\t\t<td>${Name}</td>\n\t\t\t\t<td colspan="2">\n\t\t\t\t\t<div data-dojo-type="ws/widget/DefaultTextbox" data-dojo-props="\'class\': \'nameInput ieFirstNameInput\'" data-dojo-attach-point="firstNameInput" maxlength="255" defaultValue="${FirstName}" tabindex="200"></div>\n\t\t\t\t\t<div data-dojo-type="ws/widget/DefaultTextbox" data-dojo-props="\'class\': \'nameInput\'" data-dojo-attach-point="lastNameInput" maxlength="255" defaultValue="${LastName}" tabindex="201"></div>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td>${Email}</td>\n\t\t\t\t<td colspan="2"><input type="text" maxlength="255" data-dojo-attach-point="emailInput" class="wsInput emailInput" tabindex="202"></td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td>${Phone}</td>\n\t\t\t\t<td style="width:130px"><input type="text" maxlength="255" data-dojo-attach-point="phoneInput" class="wsInput" tabindex="203"></td>\n\t\t\t\t<td style="width:170px">\n\t\t\t\t\t<ul data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="phoneTypeSelect" style="margin-left:3px">\n\t\t\t\t\t\t<li value="Cellular">${Cellular}</li>\n\t\t\t\t\t\t<li value="Home">${Home}</li>\n\t\t\t\t\t\t<li value="Work">${Work}</li>\n\t\t\t\t\t\t<li value="Pager">${Pager}</li>\n\t\t\t\t\t\t<li value="Fax">${Fax}</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t<td>\n\t\t\t\t<span class="wsLink moreDetailsLink" data-dojo-attach-event="onclick: moreDetails">${MoreDetails2}</span>\n\t\t\t</td>\n\t\t\t<td colspan="2">\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: checkRequiredFields">${AddContact}</div>\n\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t</div>\n</div>\n',
"dijit/_editor/selection":function(){define("dijit/_editor/selection",["dojo/dom","dojo/_base/lang","dojo/sniff","dojo/_base/window","../main"],function(n,j,q,a,l){var m={getType:function(){if(a.doc.getSelection){var e="text",h;try{h=a.global.getSelection()}catch(b){}h&&1==h.rangeCount&&(h=h.getRangeAt(0),h.startContainer==h.endContainer&&1==h.endOffset-h.startOffset&&3!=h.startContainer.nodeType&&(e="control"));return e}return a.doc.selection.type.toLowerCase()},getSelectedText:function(){if(a.doc.getSelection){var e=
a.global.getSelection();return e?e.toString():""}return"control"==l._editor.selection.getType()?null:a.doc.selection.createRange().text},getSelectedHtml:function(){if(a.doc.getSelection){var e=a.global.getSelection();if(e&&e.rangeCount){var h,b="";for(h=0;h<e.rangeCount;h++){var d=e.getRangeAt(h).cloneContents(),i=a.doc.createElement("div");i.appendChild(d);b+=i.innerHTML}return b}return null}return"control"==l._editor.selection.getType()?null:a.doc.selection.createRange().htmlText},getSelectedElement:function(){if("control"==
l._editor.selection.getType()){if(a.doc.getSelection){var e=a.global.getSelection();return e.anchorNode.childNodes[e.anchorOffset]}if((e=a.doc.selection.createRange())&&e.item)return a.doc.selection.createRange().item(0)}return null},getParentElement:function(){if("control"==l._editor.selection.getType()){var e=this.getSelectedElement();if(e)return e.parentNode}else if(a.doc.getSelection){if(e=a.global.getSelection()){for(e=e.anchorNode;e&&1!=e.nodeType;)e=e.parentNode;return e}}else return e=a.doc.selection.createRange(),
e.collapse(!0),e.parentElement();return null},hasAncestorElement:function(a){return null!=this.getAncestorElement.apply(this,arguments)},getAncestorElement:function(a){return this.getParentOfType(this.getSelectedElement()||this.getParentElement(),arguments)},isTag:function(a,h){if(a&&a.tagName)for(var b=a.tagName.toLowerCase(),d=0;d<h.length;d++){var i=(""+h[d]).toLowerCase();if(b==i)return i}return""},getParentOfType:function(a,h){for(;a;){if(this.isTag(a,h).length)return a;a=a.parentNode}return null},
collapse:function(e){if(a.doc.getSelection){var h=a.global.getSelection();h.removeAllRanges?e?h.collapseToStart():h.collapseToEnd():h.collapse(e)}else h=a.doc.selection.createRange(),h.collapse(e),h.select()},remove:function(){var e=a.doc.selection;a.doc.getSelection?(e=a.global.getSelection(),e.deleteFromDocument()):"none"!=e.type.toLowerCase()&&e.clear();return e},selectElementChildren:function(e,h){var b=a.doc,e=n.byId(e);if(a.doc.getSelection){var d=a.global.getSelection();q("opera")?(b=d.rangeCount?
d.getRangeAt(0):b.createRange(),b.setStart(e,0),b.setEnd(e,3==e.nodeType?e.length:e.childNodes.length),d.addRange(b)):d.selectAllChildren(e)}else if(b=e.ownerDocument.body.createTextRange(),b.moveToElementText(e),!h)try{b.select()}catch(i){}},selectElement:function(e,h){var b,e=n.byId(e),d=e.ownerDocument,i=a.global;if(d.getSelection)i=i.getSelection(),b=d.createRange(),i.removeAllRanges&&(q("opera")&&i.getRangeAt(0)&&(b=i.getRangeAt(0)),b.selectNode(e),i.removeAllRanges(),i.addRange(b));else try{var g=
e.tagName?e.tagName.toLowerCase():"";b="img"===g||"table"===g?a.body(d).createControlRange():a.body(d).createRange();b.addElement(e);h||b.select()}catch(l){this.selectElementChildren(e,h)}},inSelection:function(e){if(e){var h,b=a.doc,d;if(a.doc.getSelection){var i=a.global.getSelection();i&&0<i.rangeCount&&(d=i.getRangeAt(0));if(d&&d.compareBoundaryPoints&&b.createRange)try{if(h=b.createRange(),h.setStart(e,0),1===d.compareBoundaryPoints(d.START_TO_END,h))return!0}catch(g){}}else{d=b.selection.createRange();
try{(h=e.ownerDocument.body.createControlRange())&&h.addElement(e)}catch(l){try{h=e.ownerDocument.body.createTextRange(),h.moveToElementText(e)}catch(j){}}if(d&&h&&1===d.compareEndPoints("EndToStart",h))return!0}}return!1}};j.setObject("dijit._editor.selection",m);return m})},"ws/calendar/CalendarSelect":function(){require({cache:{"url:ws/calendar/CalendarSelect.css":""}});define("ws/calendar/CalendarSelect",["dojo/_base/declare","dojo","dojo/text!ws/calendar/CalendarSelect.css","ws/widget/DropDownLink",
"ws/calendar/calutil"],function(n,j,q,a){return n([a],{css:{templateString:q},constructor:function(){this.model=null;this.menuDef=[];this.currentValue=null;this.valueChanged=this.calendarSelected;this.setOption=this.setByIndex},model:null,menuDef:null,currentValue:null,listWritableCalendars:!0,postCreate:function(){j.addClass(this.domNode,"wsIcon")},onClick:function(){if(1!=this.model.getCalendarList().length)this.anchorPosition=j.query(".text",this.containerNode)[0],this.inherited(arguments)},setModel:function(a){this.model=
a;this.menuDef=[];this.currentValue=null;this.buildList()},selectCalendar:function(a){if(a)for(var j=this.model.getCalendarList(),e=this.model.calendarEnum,h,b=0;b<j.length;b++){if(h=j[b],h[e.id]==a){this.calendarMenuClick(b);break}}else this.calendarMenuClick(0)},buildList:function(a){if(null!=this.model){this.menuDef=[];this.currentValue=null;var m,e,h,b,d,i,g,p,n,q;h=this.model.getCalendarList();if(0!=h.length){e=this.model.calendarEnum;(!h||!e)&&this.menuDef.push({caption:"",enabled:!1,calid:""});
for(var s=0,x=0;s<h.length;s++)m=h[s],this.listWritableCalendars&&m[e.writable]&&(b=m[e.id],d=m[e.calType],i=m[e.color],p=(g=m[e.subscribeURL])&&0<g.length,n=m[e.displayName],ws.string.escapeXml(n),m="wsCalCB_"+i.substring(1)+" checked",q="wsCalCB_"+i.substring(1)+"_c",m='<div class="calendarItem"><div class="wsCalCB '+m+'"></div><div class="text '+q+'"><span>'+n+"</span></div></div>",this.menuDef.push({caption:m,onClick:j.hitch(this,"calendarMenuClick",x++),enabled:!0,calid:b,calType:d,subscribeUrl:g,
isIcalSubcal:p,color:i}));1<h.length&&(e=j.query("img",this.contentNode)[0],j.removeClass(e,"btnArrowImg"),j.addClass(e,"wsArrow"),this.setMenuDefinition(this.menuDef),this.getMenu());a&&a.calid&&this.selectCalendar(a.calid)}}},calendarMenuClick:function(a){if(0!=this.menuDef.length){if(a>this.menuDef.length-1||0==this.menuDef.length)a=0;this.setLabel(this.menuDef[a].caption);j.addClass(this.containerNode.firstChild,"calendarLabel");var m=j.query(".text",this.domNode)[0].firstChild;this.currentValue=
this.menuDef[a].calid;m.style.color=ws.calendar.calutil.componentColorMapTxt[this.menuDef[a].color];1==this.model.getCalendarList().length?(j.query("img",this.contentNode)[0].style.display="none",j.addClass(j.query(".calendarItem",this.domNode)[0],"noDropDown")):(j.query("img",this.contentNode)[0].style.display="",j.removeClass(j.query(".calendarItem",this.domNode)[0],"noDropDown"));this.calendarSelected(this.menuDef[a])}},getValue:function(){return this.currentValue},setValue:function(a){this.currentValue=
"object"==typeof a&&a.calid?a.calid:a;for(a=0;a<this.menuDef.length;a++)if(this.menuDef[a].calid==this.currentValue){this.calendarMenuClick(a);break}},calendarSelected:function(){},setByIndex:function(a){this.calendarMenuClick(a)}})})},"ws/address/AddContactCard":function(){require({cache:{"url:ws/address/PeoplePanelAddContactCard.html":'<div class="peoplePanelAddContactCard hoverCard">\n\t<img src="${spacer}" class="mainSprite wsCloseBtn" data-dojo-attach-event="onclick: close">\n\t<div class="contentDiv" data-dojo-attach-point="contentDiv">\n\t\t<table data-dojo-attach-point="inputTable">\n\t\t\t<tr>\n\t\t\t\t<td>${Name}</td>\n\t\t\t\t<td colspan="2">\n\t\t\t\t\t<div data-dojo-type="ws/widget/DefaultTextbox" data-dojo-props="\'class\': \'nameInput ieFirstNameInput\'" data-dojo-attach-point="firstNameInput" maxlength="255" defaultValue="${FirstName}" tabindex="200"></div>\n\t\t\t\t\t<div data-dojo-type="ws/widget/DefaultTextbox" data-dojo-props="\'class\': \'nameInput\'" data-dojo-attach-point="lastNameInput" maxlength="255" defaultValue="${LastName}" tabindex="201"></div>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td>${Email}</td>\n\t\t\t\t<td colspan="2"><input type="text" maxlength="255" data-dojo-attach-point="emailInput" class="wsInput emailInput" tabindex="202"></td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t\t<td>${Phone}</td>\n\t\t\t\t<td style="width:130px"><input type="text" maxlength="255" data-dojo-attach-point="phoneInput" class="wsInput" tabindex="203"></td>\n\t\t\t\t<td style="width:170px">\n\t\t\t\t\t<ul data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="phoneTypeSelect" style="margin-left:3px">\n\t\t\t\t\t\t<li value="Cellular">${Cellular}</li>\n\t\t\t\t\t\t<li value="Home">${Home}</li>\n\t\t\t\t\t\t<li value="Work">${Work}</li>\n\t\t\t\t\t\t<li value="Pager">${Pager}</li>\n\t\t\t\t\t\t<li value="Fax">${Fax}</li>\n\t\t\t\t\t</ul>\n\t\t\t\t</td>\n\t\t\t</tr>\n\t\t\t<tr>\n\t\t\t<td>\n\t\t\t\t<span class="wsLink moreDetailsLink" data-dojo-attach-event="onclick: moreDetails">${MoreDetails2}</span>\n\t\t\t</td>\n\t\t\t<td colspan="2">\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: checkRequiredFields">${AddContact}</div>\n\t\t\t</td>\n\t\t\t</tr>\n\t\t</table>\n\t</div>\n</div>\n',
"url:ws/address/PeoplePanel.css":""}});define("ws/address/AddContactCard","dojo/_base/declare,dojo/text!ws/address/PeoplePanelAddContactCard.html,dojo/text!ws/address/PeoplePanel.css,dojo,dijit,dijit/_Widget,dijit/_TemplatedMixin,dijit/_WidgetsInTemplateMixin,ws/address/DistributionListWidget,ws/widget/BuddyIcon,ws/widget/DefaultTextbox,ws/widget/Dialogs,ws/widget/popup".split(","),function(n,j,q,a,l,m,e,h){return n([m,e,h],{templateString:j,css:{templateString:q},addressModel:null,isPopup:!1,open:function(a){a.popup=
this;this.cachedArgs=a;ws.widget.popup(a);this.phoneTypeSelect.sizeMyself()},close:function(){ws.widget.popup.close(this)},moreDetails:function(){this.isPopup&&_ws_isOpenerWS()?opener.ws.WebSuite.editContact(0,this.getData(),!0):ws.WebSuite.editContact(0,this.getData(),!0);this.close()},isEmptyContact:function(){return this.firstNameInput.getValue()?!1:this.lastNameInput.getValue()?!1:!0},checkRequiredFields:function(){if(!0==this.isEmptyContact())ws.widget.Dialogs.ok(Config.Strings.EmptyContactMessageNoNickName);
else{var b="";if(this.emailInput.value&&!this.isEmailAddress(this.emailInput.value))b=Config.Strings.ErrorEmailFormat2;b?(this.close(),ws.widget.Dialogs.ok(b,a.hitch(this,"open",this.cachedArgs))):this.addContact()}},isEmailAddress:function(a){a=a.match(/(.+)@(.+)\.(.+)/);return null!=a&&4==a.length},addContact:function(){var b=this.getData();b.category="General";b.uid=0;b.load=a.hitch(this,function(){a.publish("WSFeedbackStart",[Config.Strings.ContactCreated,!0]);this.close()});b.error=function(a){if(a&&
0<=a.indexOf(Config.AddressBookFullCodeString))a=Config.Strings.ErrorAddressBookFull;ws.widget.Dialogs.ok(a||Config.Strings.ErrorSavingContactServerError)};this.addressModel.createOrModifyContact(b)},getData:function(){var b="",d="";this.firstNameInput.getValue()&&(b=a.trim(this.firstNameInput.getValue()));this.lastNameInput.getValue()&&(d=a.trim(this.lastNameInput.getValue()));return{firstName:b,lastName:d,email1:this.emailInput.value,phone1:this.phoneInput.value,phone1Type:this.phoneTypeSelect.currentValue}},
setData:function(a,d,e,g,h){null!=a&&this.firstNameInput.setValue(a);null!=d&&this.lastNameInput.setValue(d);if(null!=e)this.emailInput.value=e;if(null!=g)this.phoneInput.value=g;null!=h&&this.phoneTypeSelect.setOption(h)},setPointer:function(a,d){null!=a?(this.domNode.style.overflow="visible",ws.widget.setPointerLoc(this.domNode,d)):(this.domNode.style.overflow="auto",ws.widget.hidePointer(this.domNode))},reset:function(){this.firstNameInput.setValue();this.lastNameInput.setValue();this.emailInput.value=
"";this.phoneInput.value="";this.phoneTypeSelect.setOption(0)}})})},"url:ws/calendar/AddEventDialog.html":'<div class="addEditEvent WSModalPane" data-dojo-attach-point="addDialogWidget">\n\t<div style="overflow: hidden;" data-dojo-attach-event="onkeypress:onKeyPress,onkeydown:onKeyPress">\n\t\t<div class="WSModalPaneInner">\n\t\t\t<img src="${spacer}" class="mainSprite wsCloseBtn" data-dojo-attach-event="onclick:hide">\n\t\t\t<div class="modalContainer" data-dojo-attach-point="modalContainer">\n\t\t\t\t<div data-dojo-attach-point="dlgTitleDiv">\n\t\t\t\t\t<div data-dojo-attach-point="dlgTitleAdd" class="dlgTitle">${AddEventBtn}</div>\n\t\t\t\t\t<div data-dojo-attach-point="dlgTitleEdit" class="dlgTitle" style="display:none">${EditEvent}</div>\n\t\t\t\t</div>\n\t\t\t\t<div data-dojo-attach-point="contentPane" class="inputData">\n                    <input type="text" class="wsInput summaryInput" maxlength="100" data-dojo-attach-point="summaryInput" data-dojo-attach-event="onclick:summaryTextClick,onblur:summaryTextBlur,onkeypress:summaryKeyPress" />\n                    <div class="dateTimeDiv">\n                        <input type="text" class="wsInput dateInputField" data-dojo-attach-point="startDateInput" />\n                        <input type="text" class="wsInput timeInputField" data-dojo-attach-point="startTimeInput" />\n                        <span style="padding-bottom:2px" data-dojo-attach-point="toSpan" style="display:none">${CalTo}</span>\n                        <input type="text" class="wsInput timeInputField" data-dojo-attach-point="endTimeInput" />\n                        <input type="text" class="wsInput dateInputField" data-dojo-attach-point="endDateInput" style="display:none" />\n\n                    </div>\n\n                    <div class="allDayDiv">\n                        <div data-dojo-type="ws/widget/Checkbox" data-dojo-attach-event="onClick:checkBoxChange" data-dojo-attach-point="allDayBox" label="${AllDay}" uncheckedClass="checkBoxNotChecked"></div>\n                    </div>\n\n                    <div class="menuDivs">\n                        <div class="mainSprite iconDiv iconCalendar"></div>\n                        <div data-dojo-type="ws/calendar/CalendarSelect" data-dojo-attach-point="calendarMenu" class="calendarList"></div>\n                    </div>\n\n                    <div class="separator"></div>\n\n                    <div data-dojo-attach-point="repeatDiv" class="menuDivs">\n                        <div class="mainSprite iconDiv iconRepeat"></div>\n                        <ul data-dojo-type="ws/widget/WSSelect" data-dojo-props="\'class\': \'selectMenu\'" data-dojo-attach-point="repeatMenu" size="byValue">\n                            <li value="doesNotRepeat">${DoesNotRepeat}</li>\n                            <li value="everyDay">${EveryDay}</li>\n                            <li value="everyWeek">${EveryWeek}</li>\n                            <li value="everyMonth">${EveryMonth}</li>\n                            <li value="everyYear">${EveryYear}</li>\n                            <li value="customRepeat">${CustomRepeat}</li>\n                        </ul>\n\n                        <div class="customDialog" data-dojo-attach-point="repeatDialog" style="display:none;overflow: auto;">\n                            <div style="clear:both;overflow: auto;">\n                                <span class="spanText">${Every}&nbsp;</span>\n                                <input type="text" class="wsInput everyInput" data-dojo-attach-point="repeatEveryInput" />\n                                <ul data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="repeatEveryMenu" data-dojo-props="\'class\': \'repeatOption\'" size="byValue">\n                                    <li value="repeatEveryDay">${day}</li>\n                                    <li value="repeatEveryWeek">${week}</li>\n                                    <li value="repeatEveryMonth">${month}</li>\n                                    <li value="repeatEveryYear">${year}</li>\n                                </ul>\n                            </div>\n                            <div data-dojo-attach-point="dayIntervalSelect" class="dayIntervalSelect" style="overflow: hidden;">\n                                <span class="spanText" data-dojo-attach-point="onTextSpan">${CalendarOn}:</span>\n                                <span class="pickDaySpan" data-dojo-attach-point="day0Span"></span>\n                                <span class="pickDaySpan" data-dojo-attach-point="day1Span"></span>\n                                <span class="pickDaySpan" data-dojo-attach-point="day2Span"></span>\n                                <span class="pickDaySpan" data-dojo-attach-point="day3Span"></span>\n                                <span class="pickDaySpan" data-dojo-attach-point="day4Span"></span>\n                                <span class="pickDaySpan" data-dojo-attach-point="day5Span"></span>\n                                <span class="pickDaySpan" data-dojo-attach-point="day6Span"></span>\n                            </div>\n                            <div data-dojo-attach-point="monthIntervalSelect" class="monthIntervalSelect" style="display:none">\n                                <input name="monthSelect" type="radio" data-dojo-attach-event="onchange:monthButtonChange" data-dojo-attach-point="customMonthDateButton" />\n                                <span data-dojo-attach-point="customMonthDate">on the 15th&nbsp;</span>\n                                <input name="monthSelect" type="radio" data-dojo-attach-event="onchange:monthButtonChange" data-dojo-attach-point="customMonthDayButton" />\n                                <span data-dojo-attach-point="customMonthDay">on the fourth Monday</span>\n                            </div>\n                            <div class="endMenuRow">\n                                <ul data-dojo-type="ws/widget/WSSelect" data-dojo-props="\'class\': \'zeroMarginLeft\'" data-dojo-attach-point="endDateMenu" size="byValue">\n                                    <li value="noEndDate">${NoEndDate}</li>\n                                    <li value="repeatUntil">${RepeatUntil}</li>\n                                </ul>\n                                <input type="text" data-dojo-attach-point="endRepeatDateInput" class="wsInput dateInputField" />\n                            </div>\n                        </div>\n                        <div data-dojo-attach-point="repeatCustomSummary" class="customSummaryDiv" style="display:none">\n                            <span data-dojo-attach-point="repeatEverySummarySpan"></span>\n                        </div>\n                    </div>\n\n                    <div class="separator"></div>\n\n                    <div data-dojo-attach-point="remindRow" class="menuDivs">\n                        <div class="mainSprite iconReminder iconDiv"></div>\n                        <ul data-dojo-type="ws/widget/WSSelect" data-dojo-props="\'class\': \'selectMenu\'" data-dojo-attach-point="reminderMenu" size="byValue"></ul>\n                        <div data-dojo-attach-point="remindDialog" class="customDialog" style="display:none">\n                            <table data-dojo-attach-point="repeatTable" border="0" style="width:100%">\n                                <tr>\n                                    <td width="14" align="left">\n                                        <input type="text" data-dojo-attach-point="remindInput" class="wsInput remindAt" />\n                                    </td>\n                                    <td align="left">\n                                        <ul data-dojo-type="ws/widget/WSSelect" data-dojo-attach-point="customRemindMenu" data-dojo-props="\'class\': \'customReminderMenu\'" size="byValue"></ul>\n                                        <span data-dojo-attach-point="customRemindBeforeSpan" class="remindBeforeSpan" style="display:none">${Before}</span>\n                                        <input type="text" class="wsInput dateInputField remindBeforeInput" data-dojo-attach-point="remindAtEndInput" style="display:none" />\n                                    </td>\n                                </tr>\n                            </table>\n                        </div>\n                     </div>\n\n                    <div data-dojo-attach-point="remindSummaryRow" style="display:none" class="customSummaryDiv">\n                        <span data-dojo-attach-point="remindSummarySpan"></span>\n                    </div>\n                    <div class="separator"></div>\n                    <div data-dojo-attach-point="locationRow" class="menuDivs">\n                        <div class="mainSprite iconDiv iconLocation"></div>\n                        <input type="text" class="wsInput addLocationInputShowNew" data-dojo-attach-event="onclick:locationTextType" data-dojo-attach-point="addLocationInputArea" />\n                        <span class="ctrl wsLink" data-dojo-attach-point="mapLink" data-dojo-attach-event="onclick:showMapLink">${ShowMapLink}</span>\n                    </div>\n                    <div class="separator"></div>\n                    <div class="menuDivs">\n                        <div class="mainSprite iconDiv iconNotes"></div>\n                        <div class="notesDiv">\n                            <div defaultValue="${AddNoteHere}" class="addNotesInputShow" data-dojo-attach-point="addNotesInput" data-dojo-type="ws/widget/DefaultTextarea"></div>\n                        </div>\n                    </div>\n                    \n                    <div data-dojo-type="ws/widget/WSToolbar" data-dojo-attach-point="toolbar" data-dojo-props="region:\'top\'" vizType="Bare">\n                        <div data-dojo-type="ws/widget/Button" data-dojo-attach-point="saveButton" data-dojo-attach-event="onClick:saveAndClose" data-dojo-props="toolbarPosition: \'right\'">${AddEventBtn}</div>\n                    </div>\n\n    \t\t\t</div>\n                <div data-dojo-type="ws/widget/PopupDatePicker" data-dojo-attach-point="eventDatePopupPicker" hidePickerOnSetDate="true" closeOnMouseOut="true"></div>\n                <div data-dojo-type="ws/widget/PopupTimePicker" data-dojo-attach-point="eventTimePopupPicker" hidePickerOnSetTime="true" closeOnMouseOut="true"></div>\n            </div>\n\t\t</div>\n\t</div>\n</div>\n',
"url:ws/mail/DisplayMessageWidget.html":'<div>\n\t<div data-dojo-type="dijit/layout/BorderContainer" class="displayMessage" data-dojo-attach-point="layoutWidget">\n\t\t<div data-dojo-props="region:\'top\'" data-dojo-type="ws/widget/WSToolbar" data-dojo-attach-point="toolbar" viztype="Controls">\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: backToInbox" data-dojo-attach-point="backToMail" title="${BackToMail}" iconClassName="iconInbox" style="display: none">${BackToMail}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: reportNotSpam" data-dojo-attach-point="notSpamButton" iconClassName="notSpamIcon" title="${NotSpamButton}" style="display:none">${NotSpamButton}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: markUnread" data-dojo-attach-point="keepNewButton" iconClassName="keepNewIcon" style="display:none" tip="${KeepAsNewActionLabel}">${KeepAsNewActionLabel}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: reply, onMouseDown: saveSelection" iconClassName="replyIcon" title="${DisplayReply} (${KeyMailReply})" tip="${DisplayReply} <span>(${KeyMailReply})</span>">${DisplayReply}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: replyAll, onMouseDown: saveSelection" iconClassName="replyAllIcon" title="${DisplayReplyAll} (${KeyMailReplyAll})" tip="${DisplayReplyAll} <span>(${KeyMailReplyAll})</span>">${DisplayReplyAll}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: forward, onMouseDown: saveSelection" iconClassName="forwardIcon" title="${DisplayForward} (${KeyMailForward})" tip="${DisplayForward} <span>(${KeyMailForward})</span>">${DisplayForward}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: restartIM" iconClassName="iconIM" data-dojo-attach-point="restartIMButton" title="${DisplayIM}" style="display:none">${DisplayIM}</div>\n\t\t\t<div data-dojo-type="ws/widget/DropDownButton" data-dojo-attach-point="actionButton" iconClassName="actionIcon" title="${ActionButtonTip}">${ActionButton}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: deleteMessage" iconClassName="delIcon" title="${DeleteButton} (${DeleteKey})" tip="${DeleteButton} <span>(${DeleteKey})</span>">${DeleteButton}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: restoreMessage" data-dojo-attach-point="restoreButton" iconClassName="restoreIcon" style="display:none" title="${RestoreButton}">${RestoreButton}</div>\n\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: reportSpam" data-dojo-attach-point="spamButton" iconClassName="spamIcon" title="${ReportSpamTooltip}" style="display:none">${ReportSpamButton}</div>\n\t\t\t<div data-dojo-props="toolbarPosition: \'right\'" data-dojo-type="ws/widget/Pane" style="white-space: nowrap">\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: nextMessage" data-dojo-attach-point="nextButtonNode" iconClassName="nextButton"></div>\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: prevMessage" data-dojo-attach-point="prevButtonNode" iconClassName="prevButton"></div>\n\t\t\t\t<div data-dojo-type="ws/widget/Button" data-dojo-attach-event="onClick: backToList" data-dojo-attach-point="backButton" iconClassName="cancelIcon"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div data-dojo-type="ws/widget/Pane" class="messageArea" data-dojo-props="region:\'center\'" data-dojo-attach-point="messageArea">\n\t\t\t<div class="iframeContainer" data-dojo-attach-point="bodyPane">\n\t\t\t\t<iframe name="bodyFrame" data-dojo-attach-point="bodyFrame" class="msgBody" src="about:blank" frameborder="no"></iframe>\n\t\t\t</div>\n\n\t\t\t<div class="headerArea" data-dojo-attach-point="headerArea">\n\t\t\t\t<div data-dojo-type="ws/widget/Pane" class="searchInfo" data-dojo-attach-point="searchInfoPane" style="display: none">\n\t\t\t\t\t<div class="searchData">\n\t\t\t\t\t\t<div data-dojo-attach-point="searchInfoLink" data-dojo-attach-event="onclick: backToList">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="clrFlt">\n\t\t\t\t</div>\n\t\t\t\t<div data-dojo-attach-point="infoStrips">\n\t\t\t\t</div>\n\t\t\t\t<div class="header" data-dojo-attach-point="headerNode">\n\t\t\t\t\t<div class="main" data-dojo-attach-point="mainHeaderNode">\n\t\t\t\t\t\t<div class="headerLinksNode" data-dojo-attach-point="headerLinksNode">\n\t\t\t\t\t\t\t<img src="${spacer}" data-dojo-attach-event="onclick: print,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point="printLink" class="mainSprite printIcon">\n\t\t\t\t\t\t\t<span data-dojo-attach-point="addToLinksNode">\n\t\t\t\t\t\t\t\t<img src="${spacer}" data-dojo-attach-event="onclick: addToCalendar, onmousedown: saveSelection,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point="createEventLink" class="mainSprite calendarIcon">\n\t\t\t\t\t\t\t\t<img src="${spacer}" data-dojo-attach-event="onclick: addToTask, onmousedown: saveSelection,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point="addToTaskLink" class="mainSprite toDoIcon">\n\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t<img src="${spacer}" class="mainSprite newWindowIcon" data-dojo-attach-event="onclick: popOut,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point="newWindowLink">\n\t\t\t\t\t\t\t<img src="${spacer}" class="mainSprite fullMessageIcon" data-dojo-attach-event="onclick: showFullMessage,onmouseenter:showTip,onmouseleave:hideTip" data-dojo-attach-point="fullMessageLink" title="${FullMessage}">\n\t\t\t\t\t\t\t<div data-dojo-attach-point="fullDateNode" class="dateField">\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div data-dojo-attach-point="subjectContainer" class="subjectContainer">\n\t\t\t\t\t\t\t<span data-dojo-attach-point="editDraft" style="display: none" class="wsLink editDraft" data-dojo-attach-event="onclick: openDraft">${EditDraft}</span> <span class="subject" data-dojo-attach-point="subjectNode"></span>\n\t\t\t\t\t\t\t<img src="${spacer}" class="mainSprite flag" data-dojo-attach-point="flagIcon" data-dojo-attach-event="onclick: toggleFlag">\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div data-dojo-attach-point="shortHeaderContainer" class="shortHeader">\n\t\t\t\t\t\t\t<span data-dojo-attach-point="shortHeaderNode"></span><span data-dojo-attach-event="onclick: showFullHeader"><span class="wsLink moreLessLink" title="${MoreInfoTip}">${showDetails}</span><img src="${spacer}" class="mainSprite moreLinkArrw"></span><span data-dojo-attach-point="showSlideShowLnk" data-dojo-attach-event="onclick: showImageSlideshow" class="wsLink showSlideShow" title="${showSlideShowTip}">${showSlideShow}</span>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<table data-dojo-attach-point="fullFromTable" class="fullFromTable" style="display: none">\n\t\t\t\t\t\t\t<tr data-dojo-attach-point="fromRow" class="fieldRow" style="display: none">\n\t\t\t\t\t\t\t\t<td class="label">\n\t\t\t\t\t\t\t\t\t${From}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td data-dojo-attach-point="fullFromNode">\n\t\t\t\t\t\t\t\t\t<span data-dojo-attach-point="fullFromNode"></span><span data-dojo-attach-event="onclick: showShortHeader"><span class="wsLink moreLessLink" title="${HideDetailsTip}">${hideDetails}</span><img src="${spacer}" class="mainSprite lessLinkArrw"></span>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr data-dojo-attach-point="toRow" class="fieldRow" style="display: none">\n\t\t\t\t\t\t\t\t<td class="label">\n\t\t\t\t\t\t\t\t\t${To}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td data-dojo-attach-point="fullToNode">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr data-dojo-attach-point="ccRow" class="fieldRow" style="display: none">\n\t\t\t\t\t\t\t\t<td class="label">\n\t\t\t\t\t\t\t\t\t${Cc}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td data-dojo-attach-point="fullCcNode">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr data-dojo-attach-point="bccRow" class="fieldRow" style="display: none">\n\t\t\t\t\t\t\t\t<td class="label">\n\t\t\t\t\t\t\t\t\t${Bcc}\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t<td data-dojo-attach-point="fullBccNode">\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t\t<tr data-dojo-attach-point="slideShowRow" class="fieldRow" style="display: none">\n\t\t\t\t\t\t\t\t<td data-dojo-attach-point="slideShowShowLink" colspan="2">\n\t\t\t\t\t\t\t\t\t<span data-dojo-attach-event="onclick: showImageSlideshow" class="wsLink" title="${showSlideShowTip}">${showSlideShow}</span>\n\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t</table>\n\t\t\t\t\t</div>\n\t\t\t\t\t<div data-dojo-attach-point="attachmentsRow" class="attachmentsRow" style="display: none">\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t<div data-dojo-type="ws/widget/Pane" data-dojo-props="region:\'center\'" class="bodyPrompt" style="display: none" data-dojo-attach-point="bodyPromptPane">\n\t\t</div>\n\t\t<div data-dojo-type="ws/widget/Pane" data-dojo-attach-point="bottomPane" data-dojo-props="region:\'bottom\'">\n\t\t\t<div data-dojo-attach-point="adsPane" class="ads" style="display: none">\n\t\t\t\t<div data-dojo-type="ws/widget/Advertisement" adtype="displaymessagetext" data-dojo-attach-point="displayMessageAd">\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'}});
define("release/DisplayMessage",[],1);